<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/star.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/star.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/star.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/blog/lib/pace/pace-theme-minimal.min.css">
  <script src="/blog/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mazui3.github.io","root":"/blog/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":265,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"text":"Load Disqus","order":-1}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="个人用笔记,写的很杂(再放送).包括了初学SQL时用的sqlite,自己刷题时的mysql(dlc篇较多),最近学的Oracle中的语法.Oracle会单独标出.DLC篇.">
<meta property="og:type" content="article">
<meta property="og:title" content="关于SQL的笔记">
<meta property="og:url" content="https://mazui3.github.io/blog/2020/11/24/P134/index.html">
<meta property="og:site_name" content="Underlake Reading Room">
<meta property="og:description" content="个人用笔记,写的很杂(再放送).包括了初学SQL时用的sqlite,自己刷题时的mysql(dlc篇较多),最近学的Oracle中的语法.Oracle会单独标出.DLC篇.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_1.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_2.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_3.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_6.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_7.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_9.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_11.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_12.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_10.png">
<meta property="article:published_time" content="2020-11-24T20:07:13.000Z">
<meta property="article:modified_time" content="2022-11-12T20:25:15.285Z">
<meta property="article:author" content="Mazui">
<meta property="article:tag" content="以头抢地(诚)">
<meta property="article:tag" content="data">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mazui3.github.io/blog/2020/11/24/P134/P134_1.png">

<link rel="canonical" href="https://mazui3.github.io/blog/2020/11/24/P134/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>关于SQL的笔记 | Underlake Reading Room</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Underlake Reading Room</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">这里是图书馆外的阅览室🌟</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/blog/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
        <li class="menu-item menu-item-zone">

    <a href="https://cerulean-raclette-358.notion.site/QQ-7770800c659c4c5cbda0ba1b6720dec8" rel="noopener" target="_blank"><i class="fab fa-diaspora fa-fw"></i>Zone</a>

  </li>
        <li class="menu-item menu-item-back">

    <a href="https://mazui3.github.io/" rel="section"><i class="fa fa-cloud fa-fw"></i>Back</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mazui3.github.io/blog/2020/11/24/P134/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/logo_10.jpg">
      <meta itemprop="name" content="Mazui">
      <meta itemprop="description" content="与孤独和平共处.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Underlake Reading Room">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          关于SQL的笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-11-24 15:07:13" itemprop="dateCreated datePublished" datetime="2020-11-24T15:07:13-05:00">2020-11-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-11-12 15:25:15" itemprop="dateModified" datetime="2022-11-12T15:25:15-05:00">2022-11-12</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E5%86%99%E7%A0%81%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">写码笔记</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/blog/2020/11/24/P134/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2020/11/24/P134/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="C">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>47k</span>
            </span>
            <span class="post-meta-item" title="T">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>43 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>个人用笔记,写的很杂(再放送).包括了初学SQL时用的sqlite,自己刷题时的mysql(dlc篇较多),最近学的Oracle中的语法.<br>Oracle会单独标出.<br><a href="https://mazui3.github.io/blog/2021/01/31/P167/">DLC篇.</a></p>
<span id="more"></span>

<h1 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h1><div class="note ">
            <p>关于每次每次打开SQLite studio都不记得怎么做这件事你有什么头绪吗:</p><p>db文件,是database文件.<br>Tab左边有open database.要导入db文件是用open database,在小窗里加入db文件的路径.<br>要注意看哪个database connect了哪些没有.</p><p>Tab中间有sql editor,那是写script的地方.<br>窗口最下面的tab是显示打开了的不同窗口的地方.</p>
          </div>

<p><strong>Hot key</strong></p>
<div class="note ">
            <p>ctrl + o -&gt; open database<br>alt + e -&gt; SQL editor<br>F9 -&gt; Execute query</p>
          </div>

<p><strong>Comment</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- comments</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">a lot</span></span><br><span class="line"><span class="comment">a lot</span></span><br><span class="line"><span class="comment">comments</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<div class="note ">
            <p>基本小笔记:加入代码和数据库.<br>点击tool,open sql editor,在第三行的小文件load sql from file就可以加在sql的代码.<br>导入数据的时候,是先create table再在其table中利用<strong>import</strong>导入数据.</p>
          </div>

<div class="note ">
            <p>SQL的function分为两种,对单一value做处理的叫做elementary function(sqrt),会对多个value作处理的的叫做summary function(max).</p>
          </div>

<br>
<br>
<br>

<p><strong>Side Note</strong></p>
<p><strong>记得查看documentation</strong></p>
<div class="note ">
            <p>SQLite是大小写不敏感的,除了用string来做search的时候.</p>
          </div>

<div class="note ">
            <p>column name &lt;= 30 characters. 只能用a-z/A-Z/0-9/_/$<br><a target="_blank" rel="noopener" href="https://docs.actian.com/ingres/11.0/index.html#page/SQLRef/SQL_Naming_and_Statement_Rules.htm">doc_sql</a> &amp; <a target="_blank" rel="noopener" href="https://www.tutlane.com/tutorial/sqlite/sqlite-syntax">doc_sqlite</a></p>
          </div>

<div class="note info no-icon">
            <p>Oracle中的naming:</p><ul><li>Up to 30 characters in length</li><li>Must begin with a letter</li><li>Can contain letters, numbers, $,  _,  and #</li><li>Must be unique within a schema</li><li>Cannot be an Oracle reserved word</li><li>Case insensitive</li></ul>
          </div>

<div class="note ">
            <p>一个table现在能有1000的columns.</p>
          </div>

<div class="note ">
            <p>如果我们要在搜索有单引号或者双引号的内容.<br>For example we are searching Can”a’da.<br>WHERE jurisdiction = ‘Can”a’’da’<br>两个单引号search一个单引号.<br>双引号不变.<br>但如果 WHERE jurisdiction = “Can”a’da”<br>两个双引号search一个双引号.<br>单引号不变.</p>
          </div>


<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

<h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><h2 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h2><p>Like的用法(note见sql string).</p>
<ul>
<li>_ which denotes one char</li>
<li>% which denotes 0 or more chars</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Name, Continent, Population <span class="keyword">FROM</span> Country</span><br><span class="line">  <span class="keyword">WHERE</span> Name <span class="keyword">LIKE</span> <span class="string">&#x27;%island%&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name; <span class="comment">-- wherever there&#x27;s island in the string, %means 前面或者后面可以有其他字符</span></span><br><span class="line"><span class="keyword">SELECT</span> Name, Continent, Population <span class="keyword">FROM</span> Country</span><br><span class="line">  <span class="keyword">WHERE</span> Name <span class="keyword">LIKE</span> <span class="string">&#x27;_island%&#x27;</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name; <span class="comment">-- _ 的意思是某一个字符.island%前面可以有任何一个字符</span></span><br><span class="line"><span class="keyword">SELECT</span> Name, Continent, Population <span class="keyword">FROM</span> Country</span><br><span class="line"> <span class="keyword">WHERE</span> Continent <span class="keyword">IN</span> ( <span class="string">&#x27;Europe&#x27;</span>, <span class="string">&#x27;Asia&#x27;</span> ) <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name; <span class="comment">-- continent是europe或者asia</span></span><br></pre></td></tr></table></figure>
<p>在sql string tag下接string comparsion笔记.</p>
<span style="color:#64c0f5">
(oracle课程中)
</span>
Literal values.
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name_1 ,<span class="string">&#x27;Hello&#x27;</span>,<span class="number">5</span>,<span class="string">&#x27;01-Jan-15&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>
这样output时,每一行都会有,Hello,5和01-Jan-15三个value.
强调string和date要放在single quote中.

<p>Substituion variable.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name_1</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> column_name_1 <span class="operator">=</span> <span class="operator">&amp;</span>theValue;</span><br></pre></td></tr></table></figure>
<p>这是会跳出来一个框让你输入theValue的值.</p>
<p>Use a variable name prefixed with &amp;&amp; to prompt the user only once.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name_1, <span class="operator">&amp;&amp;</span>theValue</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">Order</span> <span class="keyword">BY</span> <span class="operator">&amp;</span>theValue;</span><br></pre></td></tr></table></figure>
<span style="color:#64c0f5">
(oracle课程笔记结束)
</span>

<p>select + as可以用于取名字或改名字.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name_1 <span class="keyword">AS</span> alias_name_1,  <span class="comment">-- 这时就可以改名了</span></span><br><span class="line">    column_name_2 <span class="keyword">AS</span> alias_name_2,</span><br><span class="line">    column_name_N <span class="keyword">AS</span> alias_name_n</span><br><span class="line"><span class="keyword">FROM</span> table_name;</span><br></pre></td></tr></table></figure>

<p>select + format, <a target="_blank" rel="noopener" href="https://www.sqlshack.com/a-comprehensive-guide-to-the-sql-format-function/">常用format.</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> amount format<span class="operator">=</span>dollar10<span class="number">.2</span> <span class="comment">-- 小数点前保留十位,后面保留两位</span></span><br></pre></td></tr></table></figure>

<p>select + label, 给variable加label.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> amount label <span class="operator">=</span> <span class="string">&#x27;usd&#x27;</span></span><br></pre></td></tr></table></figure>

<p>select + *, 全选.</p>
<p>select + calculated, calculated的作用是使用临时计算的值(在原table中没有).</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proc <span class="keyword">sql</span> outobs<span class="operator">=</span><span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> flightnumber, <span class="type">date</span>, destination,</span><br><span class="line">boarded <span class="operator">+</span> transferred <span class="operator">+</span> nonrevenue <span class="keyword">as</span> Total</span><br><span class="line"><span class="keyword">from</span> sasuser.marchflights</span><br><span class="line"><span class="keyword">where</span> calculated total <span class="operator">&lt;</span> <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">proc <span class="keyword">sql</span> outobs<span class="operator">=</span><span class="number">10</span>;</span><br><span class="line"><span class="keyword">select</span> flightnumber, <span class="type">date</span>, destination,</span><br><span class="line">boarded <span class="operator">+</span> transferred <span class="operator">+</span> nonrevenue <span class="keyword">as</span> Total,</span><br><span class="line">calculated total<span class="operator">/</span><span class="number">2</span> <span class="keyword">as</span> Half</span><br><span class="line"><span class="keyword">from</span> sasuser.marchflights;</span><br></pre></td></tr></table></figure>

<p>where去掉missing(在sas中):</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where Salary is not missing</span><br></pre></td></tr></table></figure>
<p>在sql中可以写:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where Salary ne .</span><br></pre></td></tr></table></figure>
<p><strong>要注意细节</strong></p>
<div class="note ">
            <p>关于select.<br>我们可以使用NOT, AND, OR 来更加的区别,但注意这几个关键词有优先级.</p><blockquote><p>NOT &gt; AND &gt; OR</p></blockquote><p>所以使用NOT的时候记得用括号.(有 not in (‘A’,’B’)的语法.)</p>
          </div>

<p>我们还可以用between.有两种写法.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- Contiunes: Between value1 and Value2</span></span><br><span class="line"><span class="comment">--            in (value1, value2, ..., valueN)</span></span><br></pre></td></tr></table></figure>
<p>String也是可以连续的.C001到C004是连续的(按ascii的循序).</p>
<p>search多个无排序element的时候可以用in和括号.</p>
<blockquote>
<p>WHERE jurisdiciton in (‘Canada’,’US’);</p>
</blockquote>
<div class="note ">
            <p>不等于有 &lt;&gt; 和 !=.</p>
          </div>

<br>
<br>

<h2 id="DISTINCT"><a href="#DISTINCT" class="headerlink" title="DISTINCT"></a>DISTINCT</h2><p><strong>select distinct</strong> 可以remove duplicate,也同时可以用来查看数据一共有的种类…</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Continent <span class="keyword">FROM</span> Country;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Continent <span class="keyword">FROM</span> Country;</span><br><span class="line"><span class="comment">-- Using the SELECT DISTINCT statement, you will get only unique results.</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> column1, column2, column3 <span class="keyword">FROM</span> Country;</span><br></pre></td></tr></table></figure>

<p>顺便一提NULL也算distinct的一种.</p>
<p>如果使用select distinct就会apply到所有的column,如果只要其中一个column distinct:<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/966176/select-distinct-on-one-column">可以用group by</a>.<br>从:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ID  SKU     PRODUCT</span><br><span class="line"><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span><span class="operator">=</span></span><br><span class="line"><span class="number">1</span>   FOO<span class="number">-23</span>  Orange</span><br><span class="line"><span class="number">2</span>   BAR<span class="number">-23</span>  Orange</span><br><span class="line"><span class="number">3</span>   FOO<span class="number">-24</span>  Apple</span><br><span class="line"><span class="number">4</span>   FOO<span class="number">-25</span>  Orange</span><br></pre></td></tr></table></figure>
<p>到:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>   FOO<span class="number">-23</span>  Orange</span><br><span class="line"><span class="number">3</span>   FOO<span class="number">-24</span>  Apple</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> [TestData] <span class="keyword">WHERE</span> [ID] <span class="keyword">IN</span> (</span><br><span class="line">   <span class="keyword">SELECT</span> <span class="built_in">MIN</span>([ID]) <span class="keyword">FROM</span> [TestData]</span><br><span class="line">   <span class="keyword">WHERE</span> [SKU] <span class="keyword">LIKE</span> <span class="string">&#x27;FOO-%&#x27;</span></span><br><span class="line">   <span class="keyword">GROUP</span> <span class="keyword">BY</span> [PRODUCT]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<br>
<br>

<h2 id="WHEN"><a href="#WHEN" class="headerlink" title="WHEN"></a>WHEN</h2><p><strong>condition</strong>, <strong>case和end</strong>是一定要在一起用的.</p>
<p>select + case when (像if else statment.)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">proc <span class="keyword">sql</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> temp_2 <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>, <span class="keyword">case</span></span><br><span class="line"> <span class="keyword">when</span> cty<span class="operator">=</span>&quot;North YorkC&quot; <span class="keyword">then</span> &quot;North York&quot;</span><br><span class="line"> <span class="keyword">when</span> cty<span class="operator">=</span>&quot;North YorkW&quot; <span class="keyword">then</span> &quot;North York&quot;</span><br><span class="line"> <span class="keyword">when</span> cty<span class="operator">=</span>&quot;North Yrko&quot; <span class="keyword">then</span> &quot;North York&quot;</span><br><span class="line"> <span class="keyword">else</span> cty <span class="keyword">end</span> <span class="keyword">as</span> city_clean</span><br><span class="line"><span class="keyword">from</span> disk.txn_data_v9</span><br><span class="line">quit;</span><br></pre></td></tr></table></figure>
<p>这里as city_clean就是新造的column,同理可以用来categories things.</p>
<br>
<br>

<span style="color:#64c0f5">
Oracle中有另一种if else:
</span>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id,</span><br><span class="line">	DECODE (job_id,   <span class="string">&#x27;ASD_ASST&#x27;</span> ,  <span class="number">1.1</span> <span class="operator">*</span> salary,</span><br><span class="line">				 	 	  <span class="string">&#x27;MK_REP&#x27;</span>   ,  <span class="number">1.15</span> <span class="operator">*</span> salary,</span><br><span class="line">					 	  <span class="string">&#x27;HR_REP&#x27;</span>   ,  <span class="number">1.2</span> <span class="operator">*</span> salary,</span><br><span class="line">					 salary) <span class="keyword">AS</span> revised_salary</span><br><span class="line">	<span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="FROM"><a href="#FROM" class="headerlink" title="FROM"></a>FROM</h2><p>FROM clause + WHERE clause(WHERE + logical expression)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Countries <span class="keyword">WHERE</span> Continent <span class="operator">=</span> <span class="string">&#x27;Europe&#x27;</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h2><p>用于更改数据.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update <span class="keyword">table</span></span><br><span class="line">  <span class="keyword">set</span> column1<span class="operator">=</span>value1,column2<span class="operator">=</span>value2,...</span><br><span class="line">  <span class="keyword">where</span> columnX<span class="operator">=</span>valueX [<span class="keyword">and</span><span class="operator">/</span><span class="keyword">or</span>] columnY<span class="operator">=</span>valueY [<span class="keyword">and</span><span class="operator">/</span><span class="keyword">or</span>]...</span><br></pre></td></tr></table></figure>
<p>一次只能更新一个表.<br>All databases support update with subquery.<br>Only MySQL support update with subquery and with join statement.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">UPDATE Customer</span><br><span class="line">  <span class="keyword">SET</span></span><br><span class="line">    Address <span class="operator">=</span> <span class="string">&#x27;123 music ave&#x27;</span>,</span><br><span class="line">    Zip <span class="operator">=</span> <span class="string">&#x27;98056&#x27;</span></span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">5</span>; <span class="comment">-- which/where row to be updated</span></span><br><span class="line"></span><br><span class="line">UPDATE Customer</span><br><span class="line">  <span class="keyword">SET</span></span><br><span class="line">    Address <span class="operator">=</span> <span class="keyword">NULL</span>, <span class="comment">-- 如果没有的话</span></span><br><span class="line">    Zip <span class="operator">=</span> <span class="keyword">NULL</span></span><br><span class="line">  <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>
<p>如果没有where就会把所有的都替换.</p>
<br>
<br>

<h2 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> column1<span class="operator">=</span>value1 [<span class="keyword">and</span><span class="operator">/</span><span class="keyword">or</span>] column2<span class="operator">=</span>value2...</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> Customer <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">4</span>;</span><br></pre></td></tr></table></figure>
<p>delete删除的数据后台还有保留,就是可以找回.<br>Note:增删改只能一个一个命令来.</p>
<br>
<br>

<h2 id="AS"><a href="#AS" class="headerlink" title="AS"></a>AS</h2><p>as create column的alias名字.<strong>注:as有时可以省略.</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ‘Helloworld’ <span class="keyword">AS</span> <span class="keyword">Result</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="ORDER-BY"><a href="#ORDER-BY" class="headerlink" title="ORDER BY"></a>ORDER BY</h2><p>sorting的一种方式.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> Country <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name;</span><br><span class="line"><span class="keyword">SELECT</span> Name, LifeExpectncy <span class="keyword">FROM</span> Country <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name; <span class="comment">-- get only Name&amp;LifeExpectncy column data.</span></span><br></pre></td></tr></table></figure>
<p>Note: single quote for string, double string for most of other things(eg. identifier).</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Country <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name <span class="keyword">DESC</span>; <span class="comment">-- descending 从z到a的顺序</span></span><br><span class="line"><span class="keyword">SELECT</span> Name <span class="keyword">FROM</span> Country <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name <span class="keyword">ASC</span>; <span class="comment">-- 从a到z,默认的顺序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> Name, Continent <span class="keyword">FROM</span> Country <span class="keyword">ORDER</span> <span class="keyword">BY</span> Continent, Name; <span class="comment">--按两个条件排序,从continent到name</span></span><br><span class="line"><span class="keyword">SELECT</span> Name, Continent <span class="keyword">FROM</span> Country <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">3</span>, <span class="number">4</span>; <span class="comment">--也可以通过列数指代variable,continent是第3列,name是第4列.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> Name, Continent, Region <span class="keyword">FROM</span> Country <span class="keyword">ORDER</span> <span class="keyword">BY</span> Continent <span class="keyword">DESC</span>, Region, Name;</span><br></pre></td></tr></table></figure>

<p>Example:<br>Query the two cities in STATION with the shortest and longest CITY names, as well as their respective lengths (i.e.: number of characters in the name). If there is more than one smallest or largest city, choose the one that comes first when ordered alphabetically.</p>
<p>这道题如果写两个query,我会先把city按alphabetical order给排序好,再用select min(city), length(min(city))来写.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">select</span> city, length(city)</span><br><span class="line"><span class="keyword">from</span> station</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> length(city) <span class="keyword">desc</span>, city <span class="keyword">asc</span> limit <span class="number">1</span>)</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line">(<span class="keyword">select</span> city, length(city)</span><br><span class="line"><span class="keyword">from</span> station</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> length(city) <span class="keyword">asc</span>, city <span class="keyword">asc</span> limit <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>这是答案的代码,思路也很清晰:按length先排,再按alphabetical order排.<br>我试max(city)或者min(city)会跑不出来.</p>
<div class="note ">
            <p>max(city):’Zionsville’<br>order by length(city) desc:’Marine On Saint Croix’</p>
          </div>
<p>注意到了吗!!直接比较city,比较的不是按string长度,而是acsii的value(震惊).</p>
<br>
<br>

<h2 id="WHERE"><a href="#WHERE" class="headerlink" title="WHERE"></a>WHERE</h2><p>选择部分(row)data.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Name, Continent, Region <span class="keyword">FROM</span> Country <span class="keyword">WHERE</span> Continent <span class="operator">=</span> <span class="string">&#x27;Europe&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>如果要选两个,可以用in+括号.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Name, Continent, Region <span class="keyword">FROM</span> Country <span class="keyword">WHERE</span> Continent <span class="keyword">in</span> (<span class="string">&#x27;Europe&#x27;</span>,<span class="string">&#x27;Africa&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- not</span></span><br><span class="line"><span class="keyword">SELECT</span> Name, Continent, Region <span class="keyword">FROM</span> Country <span class="keyword">WHERE</span> Continent <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;Europe&#x27;</span>,<span class="string">&#x27;Africa&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>举例之选择even number of rows:<br>sql的除法是%.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> city <span class="keyword">from</span> station</span><br><span class="line"><span class="keyword">where</span> ( ID <span class="operator">%</span> <span class="number">2</span> ) <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="LIMIT-and-OFFSET"><a href="#LIMIT-and-OFFSET" class="headerlink" title="LIMIT and OFFSET"></a>LIMIT and OFFSET</h2><p>选择部分(row)data.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Name, Continent, Region</span><br><span class="line"><span class="keyword">FROM</span> Country</span><br><span class="line"><span class="keyword">WHERE</span> Continent <span class="operator">=</span> <span class="string">&#x27;Europe&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Name LIMIT <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> Name, Continent, Region</span><br><span class="line"><span class="keyword">FROM</span> Country</span><br><span class="line"><span class="keyword">WHERE</span> Continent <span class="operator">=</span> <span class="string">&#x27;Europe&#x27;</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Name LIMIT <span class="number">5</span> <span class="keyword">OFFSET</span> <span class="number">5</span>; <span class="comment">--5-10的数据</span></span><br></pre></td></tr></table></figure>
<p>我们也可以用limit来做offset的事.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LIMIT [# <span class="keyword">of</span> records]<span class="operator">|</span>[(# <span class="keyword">of</span> <span class="keyword">start</span>) <span class="operator">-</span> <span class="number">1</span>, # <span class="keyword">of</span> records];</span><br></pre></td></tr></table></figure>
<p>上面是给SQLite和MySQL的.</p>
<p>或者使用TOP.</p>
<blockquote>
<p>Access, MS SQL SERVER  - Microsoft – Transact-SQL -&gt; T-SQL<br>  Select top [# of records] | [(# of start) - 1, # of records] column1, column2 From Table<br>  Select top [# of records] | [(# of start) - 1, # of records] * From Table</p>
</blockquote>
<p>注意其他的语法可能不一样,最好查看doc.</p>
<p><strong>用limit在求第二大小的数:</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Limit <span class="number">1</span>, <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="COUNT"><a href="#COUNT" class="headerlink" title="COUNT"></a>COUNT</h2><p>count rows.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> Country</span><br><span class="line"><span class="keyword">WHERE</span> Population <span class="operator">&gt;</span> <span class="number">10000000</span> <span class="keyword">AND</span> Continent <span class="operator">=</span> <span class="string">&#x27;Europe&#x27;</span>; <span class="operator">/</span><span class="operator">/</span>算表中有多少的记录.</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(Continent)</span><br><span class="line"><span class="keyword">FROM</span> Country; <span class="operator">/</span><span class="operator">/</span>count <span class="keyword">where</span> continent has data</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="keyword">column</span>)</span><br><span class="line"><span class="keyword">FROM</span> table_name; <span class="operator">/</span><span class="operator">/</span>我们还可以这样count <span class="keyword">unique</span>的值.</span><br></pre></td></tr></table></figure>
<p>注意NULL不会被count进去. Count( * ) 比select * 快很多.</p>
<p>Example:<br>Find the difference between the total number of CITY entries in the table and the number of distinct CITY entries in the table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(city) <span class="operator">-</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> city) <span class="keyword">from</span> station;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="INSERT-INTO"><a href="#INSERT-INTO" class="headerlink" title="INSERT INTO"></a>INSERT INTO</h2><p>用code码的方式add data.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Table</span>(column1,...) <span class="keyword">values</span> (value1, ...)</span><br><span class="line"><span class="comment">-- or</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">Table</span> <span class="keyword">values</span> (value1, ...)</span><br></pre></td></tr></table></figure>
<p>当用第二种方式的时候,可以用NULL来空去没有值的column.<br><strong>Primary key不能为空(null).</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> Customer (name, city, state, zip)</span><br><span class="line">  <span class="keyword">VALUES</span> (<span class="string">&#x27;Jimi Hendrix&#x27;</span>, <span class="string">&#x27;Renton&#x27;</span>, <span class="string">&#x27;WA&#x27;</span>, <span class="string">&#x27;12398&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test <span class="keyword">VALUES</span> ( <span class="number">1</span>, <span class="string">&#x27;This&#x27;</span>, <span class="string">&#x27;Right here!&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test ( b, c ) <span class="keyword">VALUES</span> ( <span class="string">&#x27;That&#x27;</span>, <span class="string">&#x27;Over there!&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test <span class="keyword">DEFAULT</span> <span class="keyword">VALUES</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test ( a, b, c ) <span class="keyword">SELECT</span> id, name, description <span class="keyword">from</span> item;</span><br></pre></td></tr></table></figure>

<p>我们也可以用subquery来insert.<br>不过注意,如果将一个表格复制给它本身,也就是将数据翻倍.很可能出现primary key也重复而报错的情况.<br>所以要做改动.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> bond_price</span><br><span class="line">  <span class="keyword">select</span> &quot;column_name&quot;,column1,column2,column3</span><br><span class="line">  <span class="keyword">from</span> bond_price</span><br><span class="line">  <span class="keyword">where</span> column_name <span class="operator">=</span> <span class="string">&#x27;data&#x27;</span></span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="INSERT-INTO-Oracle"><a href="#INSERT-INTO-Oracle" class="headerlink" title="INSERT INTO(Oracle)"></a>INSERT INTO(Oracle)</h2><ul>
<li>List the columns that will receive values</li>
<li>List the corresponding values in the VALUES clause</li>
<li>Enclose character and date values in single quotations</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> departments(department_id, department_name, 										  manager_id, location_id)</span><br><span class="line">	<span class="keyword">VALUES</span>(<span class="number">280</span>, <span class="string">&#x27;Operations&#x27;</span>, <span class="number">101</span>, <span class="number">1800</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Inserting-nulls"><a href="#Inserting-nulls" class="headerlink" title="Inserting nulls"></a>Inserting nulls</h3><p>Implicit method: Omit the columns from the column list(会默认null)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> departments (department_id,department_name)</span><br><span class="line">	<span class="keyword">VALUES</span>(<span class="number">290</span>, <span class="string">&#x27;Dining Services&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>Explicit method: Specify NULL in the VALUES list</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> departments(department_id, department_name, 								manager_id, location_id)</span><br><span class="line">	<span class="keyword">VALUES</span>(<span class="number">290</span>, <span class="string">&#x27;Dining Services&#x27;</span>, <span class="keyword">NULL</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>Copy rows from another table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sales_reps(id, lname, salary, comm)</span><br><span class="line">	<span class="keyword">SELECT</span> employee_id, last_name, salary, commission_pct</span><br><span class="line">		<span class="keyword">FROM</span> employees</span><br><span class="line">		<span class="keyword">WHERE</span> job_id <span class="operator">=</span> <span class="string">&#x27;SA_REP&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> emps_copy</span><br><span class="line">  <span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line">  <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="CREATE-TABLE"><a href="#CREATE-TABLE" class="headerlink" title="CREATE TABLE"></a>CREATE TABLE</h2><p>在SQLite studio中,得先建database,database-&gt;add a database,然后创造的table就在database之中了.<br>新建table后,在tools,import中选择其table和导入文件.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test (</span><br><span class="line">  a <span class="type">INTEGER</span>,</span><br><span class="line">  b TEXT</span><br><span class="line">); <span class="comment">-- column name will be a and b, followed by type declaration</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test <span class="keyword">VALUES</span> ( <span class="number">1</span>, <span class="string">&#x27;a&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test <span class="keyword">VALUES</span> ( <span class="number">2</span>, <span class="string">&#x27;b&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test <span class="keyword">VALUES</span> ( <span class="number">3</span>, <span class="string">&#x27;c&#x27;</span> );</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test;</span><br></pre></td></tr></table></figure>
<p>这里的data type,有 <strong>NULL</strong>, <strong>INTEGER</strong>, <strong>REAL</strong>(像c里的float), <strong>TEXT</strong>(string value), <strong>BLOB</strong>(stored exactly as it was input).<br>SQLite没有Boolean,可以手动用0(false)和1(true).<br>(在<a href="https://mazui3.github.io/blog/2021/01/31/P167/">SQL-续</a>里有更详细的笔记).</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test (</span><br><span class="line">  a TEXT <span class="keyword">UNIQUE</span>,</span><br><span class="line">  b TEXT,</span><br><span class="line">  c TEXT <span class="keyword">DEFAULT</span> <span class="string">&#x27;panda&#x27;</span></span><br><span class="line">); <span class="comment">--UNIQUE and DEFAULT</span></span><br></pre></td></tr></table></figure>
<p>Note: we can have more NULL while using UNIQUE(depends on different system)<br>格式是 column_name + data_type + PRIMARY KEY/ NOT NULL/ NOT NULL UNIQUE.</p>
<blockquote>
<p>specify the column list of the table. Each column has a name, data type, and the column constraint. SQLite supports PRIMARY KEY, UNIQUE, NOT NULL, and CHECK.<br>specify the table constraints such as PRIMARY KEY, FOREIGN KEY, UNIQUE, and CHECK constraints.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] [schema_name].table_name (</span><br><span class="line">	column_1 data_type <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">   	column_2 data_type <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">	column_3 data_type <span class="keyword">DEFAULT</span> <span class="number">0</span>,</span><br><span class="line">	table_constraints</span><br><span class="line">) [<span class="keyword">WITHOUT</span> ROWID];</span><br></pre></td></tr></table></figure>

<p>在initial的时候需要加括号来define column.<br>中途想要把result记载下来时,</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> temp_1 <span class="keyword">as</span></span><br><span class="line">  <span class="keyword">select</span> trade_id,</span><br><span class="line">         transaction_date</span><br><span class="line">  <span class="keyword">from</span> col_trans</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>不需要加括号,注意有as.</p>
<br>
<br>

<h2 id="CREATE-TABLE-Oracle"><a href="#CREATE-TABLE-Oracle" class="headerlink" title="CREATE TABLE(Oracle)"></a>CREATE TABLE(Oracle)</h2><p>跟sqlite不同,oracle定义table时要注明size.</p>
<p>For each column the following must be specified<br>        - The column name<br>        - The column datatype and size where applicable<br>        - Any constraints you want applied to the column</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> table_name</span><br><span class="line">(</span><br><span class="line">	column1	datatype(size) <span class="keyword">constraint</span>,</span><br><span class="line">	column2 datatype(size) <span class="keyword">constraint</span>,</span><br><span class="line">	etc</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>Constraints:</p>
<ul>
<li>Primary key: Uniquely identifies each row with non-null value</li>
<li>Foreign key: Establishes Referential Integrity between the column and a unique identifier, usually in another table, so the values in the two columns match</li>
<li>Unique: The values must be unique in each row</li>
<li>Not null: The column cannot contain nulls</li>
<li>Check: Specifies which values are allowed</li>
</ul>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> departments</span><br><span class="line">   ( department_id 		NUMBER(<span class="number">4</span>) <span class="keyword">CONSTRAINT</span> dept_id_pk <span class="keyword">PRIMARY</span> KEY	,</span><br><span class="line">     department_name  	VARCHAR2(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">     manager_id 		NUMBER(<span class="number">6</span>),</span><br><span class="line">     location_id 	NUMBER(<span class="number">4</span>) <span class="keyword">CONSTRAINT</span> dept_loc_id_fk</span><br><span class="line">                   <span class="keyword">REFERENCES</span> locations (location_id)</span><br><span class="line">   ) ;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h2><p>Index are used for improving performance in a table.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_staff_last_name</span><br><span class="line">  <span class="keyword">ON</span> staff</span><br><span class="line">  <span class="keyword">USING</span> (last_name)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>index on staff table</p>
</blockquote>
<br>
<br>

<h2 id="DROP-TABLE"><a href="#DROP-TABLE" class="headerlink" title="DROP TABLE"></a>DROP TABLE</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test ( a TEXT, b TEXT ); <span class="comment">--here will have a error since the table is already created</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test <span class="keyword">VALUES</span> ( <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span> );</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> test;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> test;</span><br></pre></td></tr></table></figure>

<p>Truncate: 跟drop table类似但不同.会把table里所有的数据删掉,table保留.</p>
<br>
<br>

<h2 id="IS-NULL"><a href="#IS-NULL" class="headerlink" title="IS NULL"></a>IS NULL</h2><p>When search for null</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">WHERE</span> a <span class="keyword">IS</span> <span class="keyword">NULL</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test <span class="keyword">WHERE</span> a <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>; <span class="comment">--opposite</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> test;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test (</span><br><span class="line">  a <span class="type">INTEGER</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  b TEXT <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  c TEXT</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="NVL-Oracle"><a href="#NVL-Oracle" class="headerlink" title="NVL(Oracle)"></a>NVL(Oracle)</h2><p>一种查到了null替换值的function.<br>NVL(val1,val2) -&gt; if val1 null, return val2.<br>NVL2(val1,val2,val3) -&gt; if val1 null, return val2, else return val3.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, NVL(commission_pct, <span class="number">0</span>) <span class="keyword">AS</span> commission_pct</span><br><span class="line">  <span class="keyword">FROM</span> employees</span><br><span class="line">  <span class="keyword">WHERE</span> department_id <span class="keyword">IN</span>(<span class="number">60</span>, <span class="number">80</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary, commission_pct,		</span><br><span class="line">  NVL2(commission_pct, salary<span class="operator">+</span>salary<span class="operator">*</span>commission_pct, salary)</span><br><span class="line">			<span class="keyword">AS</span> gross_pay</span><br><span class="line">  	<span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="NULL"><a href="#NULL" class="headerlink" title="NULL"></a>NULL</h2><p>关于null的note:<br>null在计算avg和sum时不受影响.如果全部都是null的数据,min,max也会return null.<br>null进行加减乘除,或者大小比较也是return null.<br>null == null也是return null.</p>
<p>logic involve null(unknown)的时候:</p>
<table>
<thead>
<tr>
<th></th>
<th>True</th>
<th>False</th>
<th>Both</th>
</tr>
</thead>
<tbody><tr>
<td>or</td>
<td>unknown or true == true</td>
<td>unknown or false == unknown</td>
<td>unknown or unknown == unknown</td>
</tr>
<tr>
<td>and</td>
<td>unknown and true == unknown</td>
<td>unknown and false == false</td>
<td>unknown and unknown == unknown</td>
</tr>
<tr>
<td>not</td>
<td>not(unknown) == unknown</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<br>
<br>

<h3 id="COALESCE"><a href="#COALESCE" class="headerlink" title="COALESCE"></a>COALESCE</h3><p>用来默认替换null的.<br>SELECT COALESCE(要查找的column_name, replace null的值);</p>
<p>Evaluates the arguments in order and returns the current value of the first expression that initially doesn’t evaluate to NULL.<br>For example, SELECT COALESCE(NULL, NULL, ‘third_value’, ‘fourth_value’); returns the third value because the third value is the first value that isn’t null.</p>
<br>
<br>

<h2 id="ALTER"><a href="#ALTER" class="headerlink" title="ALTER"></a>ALTER</h2><p>add a new column</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> test <span class="keyword">ADD</span> d TEXT;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> test <span class="keyword">ADD</span> e TEXT <span class="keyword">DEFAULT</span> <span class="string">&#x27;panda&#x27;</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="ID-columns"><a href="#ID-columns" class="headerlink" title="ID columns"></a>ID columns</h2><p><strong>this is different in different data system</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test (</span><br><span class="line">  id <span class="type">INTEGER</span> <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">  a <span class="type">INTEGER</span>,</span><br><span class="line">  b TEXT</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test (a, b) <span class="keyword">VALUES</span> ( <span class="number">10</span>, <span class="string">&#x27;a&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test (a, b) <span class="keyword">VALUES</span> ( <span class="number">11</span>, <span class="string">&#x27;b&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> test (a, b) <span class="keyword">VALUES</span> ( <span class="number">12</span>, <span class="string">&#x27;c&#x27;</span> );</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> test;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> test;</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<br>
<br>

<h2 id="Join-table"><a href="#Join-table" class="headerlink" title="Join table"></a>Join table</h2><p>(aka join table)</p>
<p>Each row of table has a unique key. The table’s unique key may or may not correspond with a column in the table.<br>Sometime unique key is hidden but the table must have one.<br>When a column is used as a unique key, it often called <strong>primary key</strong> (子table) .(用于identify)</p>
<img src="/blog/2020/11/24/P134/P134_1.png" class="">
<p>通过key来连接各个表格.这是的连接用key被称为foreign keys(主table).<br>如果链接的一方是primary key,自己就是foreign key.</p>
<p>种类:<br>Inner join(no null),保留两个table的共同值.<br>Outer join(may have null): LEFT/RIGHT/FULL join<br><strong>Right and full outer join are not supported in sqlite right now</strong> 但是可以用left改写right.</p>
<p>Left join:</p>
<table>
<thead>
<tr>
<th>Num</th>
<th>Var</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>A1</td>
</tr>
<tr>
<td>2</td>
<td>A2</td>
</tr>
<tr>
<td>3</td>
<td>A3</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Num</th>
<th>VarB</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>B1</td>
</tr>
<tr>
<td>2</td>
<td>B2</td>
</tr>
<tr>
<td>4</td>
<td>B4</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>Num</th>
<th>VarA</th>
<th>VarB</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>A1</td>
<td>B1</td>
</tr>
<tr>
<td>2</td>
<td>A2</td>
<td>B2</td>
</tr>
<tr>
<td>3</td>
<td>A3</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.column1, ... ,b.column1, ...</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">tableA [<span class="keyword">AS</span>] [<span class="keyword">INNER</span><span class="operator">|</span><span class="keyword">LEFT</span><span class="operator">|</span><span class="keyword">RIGHT</span><span class="operator">|</span><span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span>] tableB [<span class="keyword">AS</span>] b <span class="comment">--这里的as可以省略</span></span><br><span class="line"><span class="keyword">ON</span> a.column1 <span class="operator">=</span> b.column1 [AND...];</span><br></pre></td></tr></table></figure>

<br>
<br>

<p>Another inner join example:<br>(这样的join默认inner join)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.<span class="operator">*</span>, b.<span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> clean_data <span class="keyword">as</span> a, disk.master_v1 <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">WHERE</span> a.card_num<span class="operator">=</span>b.card_num;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">proc <span class="keyword">sql</span>;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> inner_join_master <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> a.<span class="operator">*</span>, b.<span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> clean_data <span class="keyword">as</span> a <span class="keyword">inner</span> <span class="keyword">join</span> disk.master_v1 <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">on</span> a.card_num <span class="operator">=</span> b.card_num;</span><br><span class="line">quit;</span><br></pre></td></tr></table></figure>

<div class="note ">
            <p>If we have two keys in the right table, only have one in left table.<br>Join(inner + left + right) will keep two keys in right table and two copy of info in the joined table.</p>
          </div>

<div class="note ">
            <p>If we have two keys in the right table, have two in left table as well.<br>Join(inner + left + right) will have 4 results.</p>
          </div>

<br>
<br>

<h3 id="Natural-Join-Oracle"><a href="#Natural-Join-Oracle" class="headerlink" title="Natural Join(Oracle)"></a>Natural Join(Oracle)</h3><p>Oracle的笔记.</p>
<p>Joins tables based on all columns with the same name and datatype.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, department_name, location_id, city</span><br><span class="line">	<span class="keyword">FROM</span> departments <span class="keyword">NATURAL</span> <span class="keyword">JOIN</span> locations;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Join-using-Oracle"><a href="#Join-using-Oracle" class="headerlink" title="Join using(Oracle)"></a>Join using(Oracle)</h3><p>Oracle里有两种普通join的写法.一种是用using,还有一种是跟sqlite一样用等号.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_id, department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees <span class="keyword">JOIN</span> departments</span><br><span class="line">	<span class="keyword">USING</span> (department_id);</span><br></pre></td></tr></table></figure>

<p>用等号叫做:Equijoin.</p>
<br>
<br>

<h3 id="Three-way-join-Oracle"><a href="#Three-way-join-Oracle" class="headerlink" title="Three way join(Oracle)"></a>Three way join(Oracle)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name, city</span><br><span class="line">	<span class="keyword">FROM</span> employees <span class="keyword">JOIN</span> departments</span><br><span class="line">	<span class="keyword">ON</span> employee.department_id <span class="operator">=</span> departments.department_id</span><br><span class="line">	<span class="keyword">JOIN</span> locations</span><br><span class="line">	<span class="keyword">ON</span> departments.location_id <span class="operator">=</span> locations.location_id;</span><br></pre></td></tr></table></figure>

<p>可以在join时同时加入condition.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">	<span class="keyword">AND</span> e.department_id <span class="keyword">IN</span> (<span class="number">50</span>,<span class="number">60</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">	<span class="keyword">WHERE</span> e.department_id <span class="keyword">IN</span> (<span class="number">50</span>,<span class="number">60</span>);</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Non-equijoin-Oracle"><a href="#Non-equijoin-Oracle" class="headerlink" title="Non equijoin(Oracle)"></a>Non equijoin(Oracle)</h3><p>An operator such as BETWEEN…AND can be used to display an employee’s salary grade.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> grade_level, salary, last_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> sal_grades s</span><br><span class="line">	<span class="keyword">ON</span> salary <span class="keyword">BETWEEN</span> lowest_sal <span class="keyword">AND</span> highest_sal</span><br><span class="line">   <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Non-standard-joins-Oracle"><a href="#Non-standard-joins-Oracle" class="headerlink" title="Non standard joins(Oracle)"></a>Non standard joins(Oracle)</h3><p>一种格式不大一样的Oracle only的join.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_name, city</span><br><span class="line"> 	<span class="keyword">FROM</span> employees e, departments d, locations l</span><br><span class="line"> 	<span class="keyword">WHERE</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line"> 	<span class="keyword">AND</span> d.location_id <span class="operator">=</span> l.location_id;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Combine-two-tables-right-and-left-relationship"><a href="#Combine-two-tables-right-and-left-relationship" class="headerlink" title="Combine two tables(right and left relationship)"></a>Combine two tables(right and left relationship)</h3><p>Relational database, using JOIN clause</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">left</span> ( id <span class="type">INTEGER</span>, description TEXT );</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">right</span> ( id <span class="type">INTEGER</span>, description TEXT );</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">left</span> <span class="keyword">VALUES</span> ( <span class="number">1</span>, <span class="string">&#x27;left 01&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">left</span> <span class="keyword">VALUES</span> ( <span class="number">2</span>, <span class="string">&#x27;left 02&#x27;</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">right</span> <span class="keyword">VALUES</span> ( <span class="number">1</span>, <span class="string">&#x27;right 06&#x27;</span> );</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">right</span> <span class="keyword">VALUES</span> ( <span class="number">2</span>, <span class="string">&#x27;right 07&#x27;</span> );</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">left</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">right</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这里拼起来(inner join, 只有id有重叠的行会join)</span></span><br><span class="line"><span class="keyword">SELECT</span> l.description <span class="keyword">AS</span> <span class="keyword">left</span>, r.description <span class="keyword">AS</span> <span class="keyword">right</span></span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">left</span> <span class="keyword">AS</span> l</span><br><span class="line">  <span class="keyword">JOIN</span> <span class="keyword">right</span> <span class="keyword">AS</span> r <span class="keyword">ON</span> l.id <span class="operator">=</span> r.id <span class="comment">-- 用on来告诉他们用什么condition来join(intersection);</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- (outer join, 全部join)</span></span><br><span class="line"><span class="keyword">SELECT</span> l.description <span class="keyword">AS</span> <span class="keyword">left</span>, r.description <span class="keyword">AS</span> <span class="keyword">right</span></span><br><span class="line">  <span class="keyword">FROM</span> <span class="keyword">left</span> <span class="keyword">AS</span> l</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> <span class="keyword">right</span> <span class="keyword">AS</span> r <span class="keyword">ON</span> l.id <span class="operator">=</span> r.id <span class="comment">-- 没有数据的地方就会生成NULL;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> s.id <span class="keyword">AS</span> sale, s.date, i.name, i.description, s.price <span class="comment">-- 这里可以选更多的一起放到表格里来</span></span><br><span class="line">  <span class="keyword">FROM</span> sale <span class="keyword">AS</span> s</span><br><span class="line">  <span class="keyword">JOIN</span> item <span class="keyword">AS</span> i <span class="keyword">ON</span> s.item_id <span class="operator">=</span> i.id;</span><br></pre></td></tr></table></figure>

<br>
<br>

<span style="color:#64c0f5">
Oracle中的left join算left full join:
</span>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees e [<span class="keyword">LEFT</span><span class="operator">|</span><span class="keyword">RIGHT</span><span class="operator">|</span><span class="keyword">FULL</span>] <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line">	<span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Junction-table-many-to-many-relationship"><a href="#Junction-table-many-to-many-relationship" class="headerlink" title="Junction table(many to many relationship)"></a>Junction table(many to many relationship)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> customer;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> item;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> sale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> c.name <span class="keyword">AS</span> Cust, c.zip, i.name <span class="keyword">AS</span> Item, i.description, s.quantity <span class="keyword">AS</span> Quan, s.price <span class="keyword">AS</span> Price</span><br><span class="line">  <span class="keyword">FROM</span> sale <span class="keyword">AS</span> s</span><br><span class="line">  <span class="keyword">JOIN</span> item <span class="keyword">AS</span> i <span class="keyword">ON</span> s.item_id <span class="operator">=</span> i.id</span><br><span class="line">  <span class="keyword">JOIN</span> customer <span class="keyword">AS</span> c <span class="keyword">ON</span> s.customer_id <span class="operator">=</span> c.id</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> Cust, Item</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> customer ( name ) <span class="keyword">VALUES</span> ( <span class="string">&#x27;Jane Smith&#x27;</span> );</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> customer;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- left joins</span></span><br><span class="line"><span class="keyword">SELECT</span> c.name <span class="keyword">AS</span> Cust, c.zip, i.name <span class="keyword">AS</span> Item, i.description, s.quantity <span class="keyword">AS</span> Quan, s.price <span class="keyword">AS</span> Price</span><br><span class="line">  <span class="keyword">FROM</span> customer <span class="keyword">AS</span> c</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> sale <span class="keyword">AS</span> s <span class="keyword">ON</span> s.customer_id <span class="operator">=</span> c.id</span><br><span class="line">  <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> item <span class="keyword">AS</span> i <span class="keyword">ON</span> s.item_id <span class="operator">=</span> i.id</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> Cust, Item;</span><br></pre></td></tr></table></figure>

<br>
<br>

<span style="color:#64c0f5">
在oracle中有类似的Cross join:
</span>
>Generates a Cartesian Product.

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, department_name</span><br><span class="line">	<span class="keyword">FROM</span> employees <span class="keyword">CROSS</span> <span class="keyword">JOIN</span> departments;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="UNION"><a href="#UNION" class="headerlink" title="UNION"></a>UNION</h3><p>合并table.多个table竖着合并.<br>Union中会选择union前的column name作为最后的column name.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table1</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(s) <span class="keyword">FROM</span> table2;</span><br></pre></td></tr></table></figure>
<p>注:<br>Union 会默认remove duplicated rows,union all不会.</p>
<br>
<br>

<span style="color:#64c0f5">
关于Oracle的竖着的合并:
</span>

<p>Union和Union all 一样,注意union会自带sort:</p>
<p>Union all:</p>
<ul>
<li>Including duplicated rows</li>
<li>Result is not sorted</li>
</ul>
<p>Union:</p>
<ul>
<li>Removing duplicated rows</li>
<li>Performs a record sort, from left to right</li>
</ul>
<p>Intersect:</p>
<ul>
<li>Returns the rows that are common to both queries</li>
<li>Displays names that appear in both tables, removing duplicated rows</li>
<li>Performs a record sort</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">INTERSECT</span></span><br><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line">	<span class="keyword">FROM</span> consultants;</span><br></pre></td></tr></table></figure>

<p>Minus:</p>
<ul>
<li>Returns the distinct rows selected by the first query not selected by the next query</li>
<li>Displays employees who are not consultants, removing duplicated rows, if any</li>
<li>Performs a record sort</li>
</ul>
<p>(也就是第二个query的数据用来减第一个query.)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">MINUS</span><br><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line">	<span class="keyword">FROM</span> consultants;</span><br></pre></td></tr></table></figure>

<p>关于这些竖着的合并:</p>
<ul>
<li>All column headings come from the first query, use generic column aliases as needed</li>
<li>The number of columns selected must match</li>
<li>The datatype family of the columns selected must match</li>
<li>The order by clause can appear only once, at the very end</li>
<li>To avoid confusion, it is common practice to order by column integers</li>
</ul>
<p>比如把order2放在最后面:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line">	<span class="keyword">FROM</span> consultants</span><br><span class="line">MINUS</span><br><span class="line"><span class="keyword">SELECT</span> first_name, last_name</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, job_id, salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> employee_id, job_id, <span class="number">0</span></span><br><span class="line">	<span class="keyword">FROM</span> job_history;</span><br></pre></td></tr></table></figure>
<p>把从job_history里的数据在salary里默认为0.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> location_id, department_name, <span class="keyword">NULL</span> <span class="keyword">AS</span> city</span><br><span class="line">	<span class="keyword">FROM</span> departments</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> location_id, <span class="keyword">NULL</span>, city</span><br><span class="line">	<span class="keyword">FROM</span> locations;</span><br></pre></td></tr></table></figure>
<p>注意第一个query中要确认名字,空出null为city给第二个query.<br>而第二个query中的departent_name就不用.</p>
<span style="color:#64c0f5">
(oracle笔记结束)
</span>


<br>
<br>
<br>

<h3 id="Self-join"><a href="#Self-join" class="headerlink" title="Self join"></a>Self join</h3><p>Write an SQL query to fetch the list of employees with the same salary.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">distinct</span> W.WORKER_ID, W.FIRST_NAME, W.Salary</span><br><span class="line"><span class="keyword">from</span> Worker W, Worker W1</span><br><span class="line"><span class="keyword">where</span> W.Salary <span class="operator">=</span> W1.Salary</span><br><span class="line"><span class="keyword">and</span> W.WORKER_ID <span class="operator">!=</span> W1.WORKER_ID;</span><br></pre></td></tr></table></figure>

<br>
<br>

<span style="color:#64c0f5">
来自Oracle的Self join笔记:
</span>
You may need to scan more than one row in a table to arrive at an answer.
例子:一个employee有id也有manager_id.要直接寻找employee的manager可以按两者的id join.

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> e.last_name <span class="keyword">as</span> emp, m.last_name <span class="keyword">as</span> mgr</span><br><span class="line">	<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> employees m</span><br><span class="line">	<span class="keyword">ON</span> e.manager_id <span class="operator">=</span> m.employee_id</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> emp;</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Substitution-variables-Oracle"><a href="#Substitution-variables-Oracle" class="headerlink" title="Substitution variables(Oracle)"></a>Substitution variables(Oracle)</h2><blockquote>
<p>Use a variable name prefixed with &amp; to prompt the user</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name, salary, job_id</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="operator">&amp;</span>empid;</span><br></pre></td></tr></table></figure>

<p>会跳出让输入empid的窗口.</p>
<p>Use a variable name prefixed with &amp;&amp; to prompt the user only once</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> first_name, last_name, salary, <span class="operator">&amp;&amp;</span>col4</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="operator">&amp;</span>col4;</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="SQL-string"><a href="#SQL-string" class="headerlink" title="SQL string"></a>SQL string</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- in standard sql case</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;a literal sql string&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;if we need a single quote in our string we do &#x27;&#x27;two single quote to represent one&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;we can also&#x27;</span> <span class="operator">||</span> <span class="string">&#x27;connect string&#x27;</span> <span class="operator">||</span> <span class="string">&#x27;like this&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>每个system不大一样,记得查看documentation(再放送).<br>// in SQLite case</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- string length</span></span><br><span class="line"><span class="keyword">SELECT</span> LENGTH(<span class="string">&#x27;string&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 数每一个city的名字长度,从大到小排序.</span></span><br><span class="line"><span class="keyword">SELECT</span> Name, LENGTH(Name) <span class="keyword">AS</span> Len <span class="keyword">FROM</span> City <span class="keyword">ORDER</span> <span class="keyword">BY</span> Len <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p>用SUBSTRING来cut string.</p>
<blockquote>
<p>What is the difference between substr and substring in SQL?<br>Both functions take two parameters, but substr() takes the length of the substring to be returned, while substring takes end index (excluding) for a substring.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- substring</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;this string&#x27;</span>, <span class="number">6</span>); <span class="comment">-- second argument is the starting position, return &#x27;string&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> SUBSTR(<span class="string">&#x27;this string&#x27;</span>, <span class="number">6</span>, <span class="number">3</span>); <span class="comment">-- third argument is the length of return, return &#x27;str&#x27;</span></span><br></pre></td></tr></table></figure>
<p>截取string可以用于改名.</p>
<p>注意:<br>在SQLite中没有substring只有substr.<br>SQLite中也没有right:从右边cut string.<br>如果要从右边cut string,可以用substr(‘THE STRING’, -6).</p>
<br>
<br>

<p>接select的string comparison:</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/515039/use-or-like-to-compare-strings-in-sql">Like和equal(=)的区别.</a>,一个是match一组pattern,一个是完全等于.<br><a target="_blank" rel="noopener" href="https://www.sqlservertutorial.net/sql-server-string-functions/sql-server-string_escape-function/">Special character in sql.</a><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/12897886/find-all-special-characters-in-a-column-in-sql-server-2008">Find all special characters in a column in SQL Server 2008.</a></p>
</blockquote>
<div class="note ">
            <p>^ (as the first character inside []) says “anything not in this range. The [] block can just contain individual characters - you just put each possible character in turn. The above is equivalent to [^aAbBcCdD….yYzZ0123456789’. If you said [^a-Z,0-9] then you’re just allowing , as another character that will not be highlighted.</p>
          </div>
<p>关于这个capital(^)的字符,在sql里是not的意思,但在<a href="https://mazui3.github.io/blog/2021/03/14/P176/">bash的笔记中</a>是beginning的意思.<br>包括bash中并没有百分号(%)的使用.这个两个不同啊.</p>
<p><a target="_blank" rel="noopener" href="https://www.w3schools.com/sql/sql_wildcards.asp">Other wildcards symbols.</a><br>MySQL和sqlite和其他也有区别,要注意(悲).</p>
<p>Example:<br>Query the list of CITY names starting with vowels (i.e., a, e, i, o, or u) from STATION. Your result cannot contain duplicates.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- mysql的答案</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> city <span class="keyword">FROM</span> station <span class="keyword">WHERE</span> city REGEXP &quot;^[aeiou].*&quot;;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- not start with vowels</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> city <span class="keyword">FROM</span> STATION <span class="keyword">WHERE</span> city REGEXP <span class="string">&#x27;^[^aeiou]&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>这题也可以笨一点的做,用cut string的方式来compare第一个字母.</p>
<p>Ending with vowels (i.e., a, e, i, o, or u):</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> CITY <span class="keyword">FROM</span> STATION <span class="keyword">WHERE</span> <span class="keyword">RIGHT</span>(CITY,<span class="number">1</span>) <span class="keyword">IN</span> (<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;i&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;o&#x27;</span>,<span class="string">&#x27;u&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- not</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> city <span class="keyword">from</span> station <span class="keyword">where</span> <span class="keyword">right</span>(city,<span class="number">1</span>) <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;u&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- % : a%b -&gt; ab, aab, axbdb</span></span><br><span class="line"><span class="comment">-- _ : a_b -&gt; aab, abb, acb,adb</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> customer <span class="keyword">WHERE</span> credit_rating <span class="keyword">like</span> <span class="string">&#x27;A%&#x27;</span>;</span><br></pre></td></tr></table></figure>
<p>注意,这个加下划线和百分号的使用是跟<a target="_blank" rel="noopener" href="https://www.w3schools.com/sql/sql_like.asp">like</a>相关的.<br>以及并不能<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1865353/combining-like-and-in-for-sql-server">一起用like和in</a>.</p>
<br>
<br>

<h3 id="INSTR-Oracle"><a href="#INSTR-Oracle" class="headerlink" title="INSTR(Oracle)"></a>INSTR(Oracle)</h3><p>INSTR returns the numeric position of a substring.</p>
<blockquote>
<p>INSTR(column, ‘string’ , beginning position , occurrence)</p>
</blockquote>
<ul>
<li>0 is returned if the substring is not found</li>
<li>The position where you want the search to start. Position 1 is the default</li>
<li>Which occurrence you want searched for. Occurrence 1 is the default</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> street_address, INSTR(street_address, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">	<span class="keyword">FROM</span> locations;</span><br></pre></td></tr></table></figure>
<p>用空格很实用.</p>
<br>
<br>

<h3 id="INSTR-Oracle-1"><a href="#INSTR-Oracle-1" class="headerlink" title="INSTR(Oracle)"></a>INSTR(Oracle)</h3><blockquote>
<p>Use LPAD and RPAD to pad a column on the left or right with specified character(s) up to a specified length<br>Pad the salary on the left with $ up to a length of 6 characters</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> LPAD(salary, <span class="number">6</span>, <span class="string">&#x27;$&#x27;</span>)</span><br><span class="line">	<span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>
<p>一共6个char,左边空出来的加$.</p>
<br>
<br>

<h3 id="Char-data-type-Oracle"><a href="#Char-data-type-Oracle" class="headerlink" title="Char data type(Oracle)"></a>Char data type(Oracle)</h3><div class="note ">
            <p>关于Orcale char的data type:</p><p>Varchar2</p><ul><li>used for variable-length character columns</li><li>has a maximum length of 4000 characters</li><li>most character data is of this type<blockquote><p>last_name VARCHAR2(15)</p></blockquote></li></ul><p>Char:</p><ul><li>used for fixed-length character data columns</li><li>has a maximum length of 2000 characters</li><li>useful for country codes and other fixed-length character data<blockquote><p>country_id CHAR(2)</p></blockquote></li></ul><p>My sql也有类似的varchar(没有2),和char,<a target="_blank" rel="noopener" href="https://www.w3schools.com/sql/sql_datatypes.asp">详情.</a></p>
          </div>

<div class="note ">
            <p>Oracle:<br>Use LIKE to perform wildcard searches through character, number, date, and timestamp data<br>Search conditions will be in quotes, or ticks, and can contain</p><ul><li>Literal values</li><li>_ which denotes one character</li><li>% which denotes 0 or more characters</li></ul>
          </div>

<br>
<br>

<h3 id="TRIM"><a href="#TRIM" class="headerlink" title="TRIM"></a>TRIM</h3><p>可以做到“remove white spaces from the right side”之类的.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="string">&#x27;   string   &#x27;</span>); <span class="comment">-- 会remove all spaces</span></span><br><span class="line"><span class="keyword">SELECT</span> LTRIM(<span class="string">&#x27;   string   &#x27;</span>); <span class="comment">-- remove spaces from beginning</span></span><br><span class="line"><span class="keyword">SELECT</span> RTRIM(<span class="string">&#x27;   string   &#x27;</span>); <span class="comment">-- remove spaces from the end</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">TRIM</span>(<span class="string">&#x27;...string...&#x27;</span>, <span class="string">&#x27;.&#x27;</span>); <span class="comment">-- second statement是要remove的character</span></span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="TRIM-Oracle"><a href="#TRIM-Oracle" class="headerlink" title="TRIM(Oracle)"></a>TRIM(Oracle)</h3><p>Oracle中的trim感觉很不一样…</p>
<p>TRIM the leading S from email</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> email, <span class="built_in">TRIM</span>(<span class="keyword">LEADING</span> <span class="string">&#x27;S&#x27;</span> <span class="keyword">FROM</span> email) 	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">&#x27;S%&#x27;</span> ;</span><br></pre></td></tr></table></figure>

<p>TRIM the trailing S from email</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> email, <span class="built_in">TRIM</span>(<span class="keyword">TRAILING</span> <span class="string">&#x27;S&#x27;</span> <span class="keyword">FROM</span> email) 	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">&#x27;%S&#x27;</span> ;</span><br></pre></td></tr></table></figure>

<p>TRIM BOTH the leading and training S from email<br>Because BOTH is the default, it can be omitted</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> email, <span class="built_in">TRIM</span>(<span class="keyword">BOTH</span> <span class="string">&#x27;S&#x27;</span> <span class="keyword">FROM</span> email)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">&#x27;S%S&#x27;</span> ;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="REPLACE"><a href="#REPLACE" class="headerlink" title="REPLACE"></a>REPLACE</h3><p>Example: Write an SQL query to print FIRST_NAME from Worker table after replacing ‘a’ with ‘A’.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> REPLACE(FIRST_NAME, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;A&#x27;</span>) <span class="keyword">from</span> Worker;</span><br></pre></td></tr></table></figure>
<p>SQLite也能做,好强.</p>
<br>
<br>

<h3 id="CONCAT"><a href="#CONCAT" class="headerlink" title="CONCAT"></a>CONCAT</h3><p>用于合并两个column的value,append string那样的感觉.</p>
<p>Example: Write an SQL query to print the FIRST_NAME and LAST_NAME from Worker table into a single column COMPLETE_NAME. A space char should separate them.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> CONCAT(FIRST_NAME, <span class="string">&#x27; &#x27;</span>, LAST_NAME) <span class="keyword">AS</span> <span class="string">&#x27;COMPLETE_NAME&#x27;</span> <span class="keyword">from</span> Worker;</span><br></pre></td></tr></table></figure>
<p>SQLite并不支持concat.<br>但是可以使用｜｜ &lt;-真是淳朴的链接方式!</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> FIRST_NAME <span class="operator">||</span>  <span class="string">&#x27; &#x27;</span> <span class="operator">||</span> LAST_NAME <span class="keyword">AS</span> <span class="string">&#x27;COMPLETE_NAME&#x27;</span> <span class="keyword">from</span> Worker;</span><br></pre></td></tr></table></figure>
<p>(同时mysql不支持||,悲)</p>
<br>
<br>

<h3 id="UPPER-and-LOWER"><a href="#UPPER-and-LOWER" class="headerlink" title="UPPER and LOWER"></a>UPPER and LOWER</h3><p>they convert ASCII characters</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;StRiNg&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;string&#x27;</span>; <span class="comment">-- this returns false,大小写matters</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(<span class="string">&#x27;StRiNg&#x27;</span>) <span class="operator">=</span> <span class="built_in">LOWER</span>(<span class="string">&#x27;string&#x27;</span>); <span class="comment">-- return true</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;StRiNg&#x27;</span>) <span class="operator">=</span> <span class="built_in">UPPER</span>(<span class="string">&#x27;string&#x27;</span>); <span class="comment">-- return true</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">UPPER</span>(Name) <span class="keyword">FROM</span> City <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">LOWER</span>(Name) <span class="keyword">FROM</span> City <span class="keyword">ORDER</span> <span class="keyword">BY</span> Name;</span><br></pre></td></tr></table></figure>

<br>
<br>

<p>在oracle中还有一种格式function:</p>
<blockquote>
<p>Change the output character data to capitalized initials</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> email, INITCAP(email)</span><br><span class="line">	<span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h2 id="SQL-number"><a href="#SQL-number" class="headerlink" title="SQL number"></a>SQL number</h2><p>again:每个system都不一样<br>fundamental numeric types: real &amp; integer<br>integer types:</p>
<img src="/blog/2020/11/24/P134/P134_2.png" class="">
<img src="/blog/2020/11/24/P134/P134_3.png" class="">
<p>real number sacrifice accuracy for scale.</p>
<div class="note ">
            <p>Oracle的nuber:</p><p>Contain variable-length number data up to 38 digits long<br>Number data could be</p><ul><li>Integer data created with a Precision</li><li>Floating point data created with Precision and Scale.</li></ul><p>Precision - the total number of digits:</p><blockquote><p>employee_id NUMBER(6)</p></blockquote><p>Scale specifies how many digits are on the right of the decimal.</p><blockquote><p>gross_pay NUMBER(9,2) – 9 is Precision and 2 is scale</p></blockquote>
          </div>

<br>
<br>

<h3 id="TYPEOF"><a href="#TYPEOF" class="headerlink" title="TYPEOF"></a>TYPEOF</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TYPEOF( <span class="number">1</span> <span class="operator">+</span> <span class="number">1</span> ); <span class="comment">-- integer</span></span><br><span class="line"><span class="keyword">SELECT</span> TYPEOF( <span class="number">1</span> <span class="operator">+</span> <span class="number">1.0</span> ); <span class="comment">-- real</span></span><br><span class="line"><span class="keyword">SELECT</span> TYPEOF(<span class="string">&#x27;panda&#x27;</span>); <span class="comment">-- text</span></span><br><span class="line"><span class="keyword">SELECT</span> TYPEOF(<span class="string">&#x27;panda&#x27;</span> <span class="operator">+</span> <span class="string">&#x27;koala&#x27;</span>); <span class="comment">-- integer -&gt; 注意这里每个system都可能不一样,在这个情况下先string convert to integer再加在一起</span></span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="CAST"><a href="#CAST" class="headerlink" title="CAST"></a>CAST</h3><p>cast用于转换数据类型.cast(express as datatype)<br>string转int好助手.<br>//integer的result always be integer</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">1</span> <span class="operator">/</span> <span class="number">2</span>; <span class="comment">-- result is 0</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">1.0</span> <span class="operator">/</span> <span class="number">2</span>; <span class="comment">-- result 0.5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CAST</span>(<span class="number">1</span> <span class="keyword">AS</span> <span class="type">REAL</span>) <span class="operator">/</span> <span class="number">2</span>; <span class="comment">-- result 0.5</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">17</span> <span class="operator">/</span> <span class="number">5</span>; <span class="comment">-- result 3</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">17</span> <span class="operator">/</span> <span class="number">5</span>, <span class="number">17</span> <span class="operator">%</span> <span class="number">5</span>; <span class="comment">-- result 3 with remainder of 2</span></span><br></pre></td></tr></table></figure>
<p>cast可以用来拼接字符串.先把数字转换成char,在用｜｜拼接.可以拼成百分号的数字.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Cast</span>(round((high<span class="operator">-</span>low)<span class="operator">/</span>(<span class="keyword">open</span><span class="operator">+</span><span class="keyword">close</span>) <span class="operator">*</span> <span class="number">2</span>,<span class="number">2</span>) <span class="operator">*</span> <span class="number">100</span> <span class="keyword">as</span> <span class="type">varchar</span>) <span class="operator">||</span> <span class="string">&#x27;%&#x27;</span> <span class="keyword">as</span> vol <span class="comment">-- (别名)</span></span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="ROUND"><a href="#ROUND" class="headerlink" title="ROUND"></a>ROUND</h3><p>四舍五入函数.<br>round(expression, precision精度)<br>精度可以是负数,保留到百位.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="number">2.55555</span>;</span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">2.55555</span>); <span class="comment">-- result is 3</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">2.55555</span>, <span class="number">3</span>); <span class="comment">-- 2.556, second is 位数</span></span><br><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">2.55555</span>, <span class="number">0</span>); <span class="comment">-- default,也就是到整数位</span></span><br></pre></td></tr></table></figure>

<p>Oracle:<br>Trunc: Rounds a value down to a specified decimal<br>Mod: Returns the remainder of division<br>Ceil: Returns the smallest integer greater than a number<br>Floor: Returns the largest integer less than a number</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ROUND(<span class="number">187.8575</span>,<span class="number">2</span>)</span><br><span class="line">	<span class="keyword">FROM</span> DUAL;</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>
<br>

<h2 id="Nested-and-Repeated-Data"><a href="#Nested-and-Repeated-Data" class="headerlink" title="Nested and Repeated Data"></a><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/alexisbcook/nested-and-repeated-data/tutorial">Nested and Repeated Data</a></h2><img src="/blog/2020/11/24/P134/P134_6.png" class="" title="nested data">
<p>自带class的感觉.</p>
<p>Nested columns have type STRUCT (or type RECORD). This is reflected in the table schema below.</p>
<p>Recall that we refer to the structure of a table as its schema. If you need to review how to interpret table schema, feel free to check out <a target="_blank" rel="noopener" href="https://www.kaggle.com/code/dansbecker/getting-started-with-sql-and-bigquery/tutorial">this lesson</a> from the Intro to SQL micro-course.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># Print information on all the columns in the table</span><br><span class="line">sample_commits_table.schema</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SchemaField(‘author’, ‘RECORD’, ‘NULLABLE’, None, (SchemaField(‘name’, ‘STRING’, ‘NULLABLE’, None, (), None), SchemaField(‘email’, ‘STRING’, ‘NULLABLE’, None, (), None), SchemaField(‘time_sec’, ‘INTEGER’, ‘NULLABLE’, None, (), None), SchemaField(‘tz_offset’, ‘INTEGER’, ‘NULLABLE’, None, (), None), SchemaField(‘date’, ‘TIMESTAMP’, ‘NULLABLE’, None, (), None)), None),</p>
</blockquote>
<p>比如说在这个名为committer的column里面,有很多种项目.<br>如果要access name这一栏,用committer.name.</p>
<img src="/blog/2020/11/24/P134/P134_7.png" class="" title="repeated data">
<p>自带array的感觉.</p>
<p>When querying repeated data, we need to put the name of the column containing the repeated data inside an UNNEST() function.</p>
<img src="/blog/2020/11/24/P134/P134_9.png" class="" title="repeated data">

<p>要选择repeated data的时候:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> `bigquery<span class="operator">-</span>public<span class="operator">-</span>data.github_repos.languages`,</span><br><span class="line">                     <span class="built_in">UNNEST</span>(<span class="keyword">language</span>) <span class="keyword">AS</span> l</span><br></pre></td></tr></table></figure>
<p>repeated column会分开来select.</p>
<br>
<br>
<br>
<br>

<h2 id="SQL-date-and-time"><a href="#SQL-date-and-time" class="headerlink" title="SQL date and time"></a>SQL date and time</h2><p>SQL store date and time in UTC</p>
<p>//for SQLite</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> DATETIME(<span class="string">&#x27;now&#x27;</span>); <span class="comment">-- in UTC -&gt; ‘2020-11-24 15:07:13’</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">DATE</span>(<span class="string">&#x27;now&#x27;</span>); <span class="comment">-- -&gt; ‘2020-11-24&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="type">TIME</span>(<span class="string">&#x27;now&#x27;</span>); <span class="comment">-- -&gt;&#x27;15:07:13&#x27;</span></span><br><span class="line"><span class="keyword">SELECT</span> DATETIME(<span class="string">&#x27;now&#x27;</span>, <span class="string">&#x27;+1 day&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> DATETIME(<span class="string">&#x27;now&#x27;</span>, <span class="string">&#x27;+3 days&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> DATETIME(<span class="string">&#x27;now&#x27;</span>, <span class="string">&#x27;-1 month&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> DATETIME(<span class="string">&#x27;now&#x27;</span>, <span class="string">&#x27;+1 year&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> DATETIME(<span class="string">&#x27;now&#x27;</span>, <span class="string">&#x27;+3 hours&#x27;</span>, <span class="string">&#x27;+27 minutes&#x27;</span>, <span class="string">&#x27;-1 day&#x27;</span>, <span class="string">&#x27;+3 years&#x27;</span>);</span><br></pre></td></tr></table></figure>

<div class="note ">
            <p>这里是后期订正:</p><p>在sqlite中遇到了’D/M/YYYY’格式的string,想要转换成timestamp.<br>用了很笨的方法:</p><p>先把最后的year给cut出来,<br>用负值的substr,substr(‘’D/M/YYYY’’, -4).<br>把’D/M’给cut出来:<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/1256915/remove-the-last-character-in-a-string-in-t-sql">Remove the last character in a string in T-SQL?</a><br>再把D和M分开:<br><a target="_blank" rel="noopener" href="http://www.npap.me/blog/sqlite-split-string">SQLite split string.</a><br>最后用integer value合并一个timestamp:<br><strong>select date(my_year ||’-01-01’,’+’||(my_month-1)||’ month’,’+’||(my_day-1)||’ day’);</strong><br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/6718119/sqlite-how-to-create-a-date-from-integer-year-and-month-components">SQLite: how to create a date from integer year and month components?</a></p><p>想知道更聪明的方法…</p>
          </div>

<p>关于sql还有一个截取时间的办法.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Strftime(format, timestring[,modifiers])</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>format</th>
<th>explanation</th>
</tr>
</thead>
<tbody><tr>
<td>%Y</td>
<td>year with century(yyyy)</td>
</tr>
<tr>
<td>%m</td>
<td>month(01-12)</td>
</tr>
<tr>
<td>%d</td>
<td>day of the month(1-31)</td>
</tr>
<tr>
<td>%H</td>
<td>hour on 24-hour clock(00-23)</td>
</tr>
<tr>
<td>%M</td>
<td>minute(00-59)</td>
</tr>
<tr>
<td>%S</td>
<td>second(00-59)</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>timestring</th>
<th>explanation</th>
</tr>
</thead>
<tbody><tr>
<td>now</td>
<td>now is a literal used to return the current date</td>
</tr>
<tr>
<td>YYYY-MM-DD</td>
<td>date value formatted as ‘YYYY-MM-DD’</td>
</tr>
<tr>
<td>HH:MM:SS.SSS</td>
<td>HH:MM:SS.SSS</td>
</tr>
</tbody></table>
<p>对于timestamp来说,可以用 <a target="_blank" rel="noopener" href="https://www.w3schools.com/sql/func_sqlserver_datepart.asp">datepart()</a> function来分别时间和日期.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> datepart(<span class="type">timestamp</span>) <span class="keyword">as</span> <span class="type">date</span> format<span class="operator">=</span><span class="type">date</span> <span class="comment">--通过format转换成看得懂的格式</span></span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="SQL-date-and-time-Oracle"><a href="#SQL-date-and-time-Oracle" class="headerlink" title="SQL date and time(Oracle)"></a>SQL date and time(Oracle)</h2><h3 id="TO-CHAR"><a href="#TO-CHAR" class="headerlink" title="TO_CHAR"></a>TO_CHAR</h3><blockquote>
<p>TO_CHAR(date, ‘format model’)</p>
</blockquote>
<p>Converts dates from the default DD-MON-RR format to a more readable format based on the format model you provide</p>
<ul>
<li>Must be enclosed in single quotes</li>
<li>May be caSe sEnsiTive</li>
<li>Use fm to remove extra spaces and/or leading zeros</li>
</ul>
<table>
<thead>
<tr>
<th align="left">Element</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">YYYY</td>
<td align="left">Four digit year</td>
</tr>
<tr>
<td align="left">YEAR</td>
<td align="left">Year spelled out - case sensitive</td>
</tr>
<tr>
<td align="left">MONTH</td>
<td align="left">Month spelled out - case sensitive</td>
</tr>
<tr>
<td align="left">MON</td>
<td align="left">Three letter month - case sensitive</td>
</tr>
<tr>
<td align="left">MM</td>
<td align="left">Two digital month</td>
</tr>
<tr>
<td align="left">DAY</td>
<td align="left">Day of the week spelled out - case sensitive</td>
</tr>
<tr>
<td align="left">DY</td>
<td align="left">Three letter day - case sensitive</td>
</tr>
<tr>
<td align="left">DD</td>
<td align="left">Two digit day of the month - case sensitive</td>
</tr>
<tr>
<td align="left">AM or PM</td>
<td align="left">Meridian Indicator</td>
</tr>
<tr>
<td align="left">A.M. or P.M.</td>
<td align="left">Meridian Indicator with periods</td>
</tr>
<tr>
<td align="left">HH or HH12 or HH24</td>
<td align="left">Hour of day 12-11 or 12-11 or 00-23</td>
</tr>
<tr>
<td align="left">MI</td>
<td align="left">Minutes 0-59</td>
</tr>
<tr>
<td align="left">SS</td>
<td align="left">Seconds 0-59</td>
</tr>
<tr>
<td align="left">SSSSS</td>
<td align="left">Seconds since midnight 00000-86399</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(start_date, ‘DD <span class="keyword">Month</span>, yyyy’) <span class="keyword">AS</span> start_date</span><br><span class="line">	<span class="keyword">FROM</span> job_history;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> TO_CHAR(sysdate, <span class="string">&#x27;DD Month, yyyy HH:MI:SS AM&#x27;</span>) <span class="keyword">AS</span> right_now</span><br><span class="line">  <span class="keyword">FROM</span> dual;</span><br></pre></td></tr></table></figure>
<p><strong>dual</strong> is the dummy table.</p>
<p>TO_CHAR can also use in number.</p>
<table>
<thead>
<tr>
<th align="left">Element</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">9</td>
<td align="left">Represents one digit</td>
</tr>
<tr>
<td align="left">0</td>
<td align="left">Forces a zero to be displayed</td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">Displays a floating dollar sign</td>
</tr>
<tr>
<td align="left">.</td>
<td align="left">Displays a decimal point</td>
</tr>
<tr>
<td align="left">,</td>
<td align="left">Displays a comma</td>
</tr>
<tr>
<td align="left">L</td>
<td align="left">Floating local currency symbol</td>
</tr>
<tr>
<td align="left">G</td>
<td align="left">Local group separator</td>
</tr>
<tr>
<td align="left">D</td>
<td align="left">Local decimal symbol</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TO_CHAR(salary, <span class="string">&#x27;$999,999.99&#x27;</span>) <span class="keyword">AS</span> salary</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure>
<p>会得到$13,000.00格式的数字.</p>
<p>类似还有TO_DATE的function.</p>
<blockquote>
<p>Converts characters into dates using the same available format elements as TO_CHAR</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary, hire_date</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> hire_date <span class="operator">&gt;=</span> TO_DATE(<span class="string">&#x27;December 1, 2009&#x27;</span>,<span class="string">&#x27;Month dd, yyyy&#x27;</span>);</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Aggregate-聚合函数"><a href="#Aggregate-聚合函数" class="headerlink" title="Aggregate(聚合函数)"></a>Aggregate(聚合函数)</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- here we count all countries</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> Country;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- here we count all countries in different region</span></span><br><span class="line"><span class="keyword">SELECT</span> Region, <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> Count</span><br><span class="line">  <span class="keyword">FROM</span> Country</span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> Region</span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> Count <span class="keyword">DESC</span>, Region;</span><br></pre></td></tr></table></figure>

<p>GROUP BY:用于分组.</p>
<div class="note ">
            <p>The GROUP BY clause allows you to apply the summary functions to a group of observations (the same as CLASS statement in PROC MEANS), you only need it when you apply summary functions.</p>
          </div>

<p>如有以下的数据:</p>
<table>
<thead>
<tr>
<th>gender</th>
<th>height</th>
</tr>
</thead>
<tbody><tr>
<td>male</td>
<td>60</td>
</tr>
<tr>
<td>female</td>
<td>70</td>
</tr>
</tbody></table>
<p>我们通过group by gender来求不同gender的height mean.</p>
<div class="note ">
            <p>If you specify a GROUP BY clause in a query that does not contain a summary<br>function, your clause is changed to an ORDER BY clause, and a message to<br>that effect is written to the SAS log.</p>
          </div>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cty, mean(amount) <span class="keyword">as</span> Avg_fraud_dollar <span class="keyword">from</span> disk.txn_data_v9 <span class="keyword">where</span> fraud<span class="operator">=</span><span class="string">&#x27;Yes&#x27;</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> cty <span class="keyword">having</span> <span class="built_in">count</span>(<span class="operator">*</span>)<span class="operator">&gt;=</span><span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1,column2,columnN,</span><br><span class="line">  <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> rec_per_group  <span class="comment">--一般会用COUNT(*),因为返回不会为0.</span></span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> column1,column2,columnN;</span><br></pre></td></tr></table></figure>

<div class="note ">
            <p>如果用group by搜寻max,每一组只会返回一个数据,在同时出现两个max的情况下,我们可以先找出每组的最高,再用这个数据去搜索拥有最高的人.</p>
          </div>

<div class="note ">
            <p>select和group by的列得对应.如果run出来有问题…可以试试在group by里增加全select的列.</p>
          </div>

<p>寻找第二大的数:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 用order by</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span><span class="keyword">from</span> employee</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> salary</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> salary <span class="keyword">desc</span> limit <span class="number">1</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, <span class="built_in">MAX</span>(salary) <span class="keyword">AS</span> salary</span><br><span class="line"><span class="keyword">FROM</span> employee</span><br><span class="line"><span class="keyword">WHERE</span> salary <span class="operator">&lt;&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employee);</span><br></pre></td></tr></table></figure>

<p>Write an SQL query to determine the nth (say n=5) highest salary from a table.<br>Ans.</p>
<p>The following MySQL query returns the nth highest salary:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Salary <span class="keyword">FROM</span> Worker <span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span> LIMIT n<span class="number">-1</span>,<span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>The following SQL Server query returns the nth highest salary:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">1</span> Salary</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> TOP n Salary</span><br><span class="line"><span class="keyword">FROM</span> Worker</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">DESC</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> Salary <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="WITH-AS"><a href="#WITH-AS" class="headerlink" title="WITH AS"></a><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/dansbecker/as-with">WITH AS</a></h2><p>On its own, AS is a convenient way to clean up the data returned by your query. It’s even more powerful when combined with WITH in what’s called a “common table expression”.</p>
<p>A common table expression (or CTE) is a temporary table that you return within your query. CTEs are helpful for splitting your queries into readable chunks, and you can write queries against them.</p>
<img src="/blog/2020/11/24/P134/P134_11.png" class="">
<img src="/blog/2020/11/24/P134/P134_12.png" class="">

<br>
<br>
<br>

<h2 id="Analytic-function"><a href="#Analytic-function" class="headerlink" title="Analytic function"></a><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/alexisbcook/analytic-functions/tutorial">Analytic function</a></h2><p>This is a good way to do rolling time aggregation.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> trips_by_day <span class="keyword">AS</span></span><br><span class="line">                  (</span><br><span class="line">                  <span class="keyword">SELECT</span> <span class="type">DATE</span>(start_date) <span class="keyword">AS</span> trip_date,</span><br><span class="line">                      <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">as</span> num_trips</span><br><span class="line">                  <span class="keyword">FROM</span> `bigquery<span class="operator">-</span>public<span class="operator">-</span>data.san_francisco.bikeshare_trips`</span><br><span class="line">                  <span class="keyword">WHERE</span> <span class="built_in">EXTRACT</span>(<span class="keyword">YEAR</span> <span class="keyword">FROM</span> start_date) <span class="operator">=</span> <span class="number">2015</span></span><br><span class="line">                  <span class="keyword">GROUP</span> <span class="keyword">BY</span> trip_date</span><br><span class="line">                  )</span><br><span class="line">                  <span class="keyword">SELECT</span> <span class="operator">*</span>,</span><br><span class="line">                      <span class="built_in">SUM</span>(num_trips)</span><br><span class="line">                          <span class="keyword">OVER</span> (</span><br><span class="line">                               <span class="keyword">ORDER</span> <span class="keyword">BY</span> trip_date</span><br><span class="line">                               <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> UNBOUNDED PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span></span><br><span class="line">                               ) <span class="keyword">AS</span> cumulative_trips</span><br><span class="line">                      <span class="keyword">FROM</span> trips_by_day</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">trip_date</th>
<th align="left">num_trips</th>
<th align="left">cumulative_trips</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">2015-01-01</td>
<td align="left">181</td>
<td align="left">181</td>
</tr>
<tr>
<td align="left">1</td>
<td align="left">2015-01-02</td>
<td align="left">428</td>
<td align="left">609</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">2015-01-03</td>
<td align="left">283</td>
<td align="left">892</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">2015-01-04</td>
<td align="left">206</td>
<td align="left">1098</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">2015-01-05</td>
<td align="left">1186</td>
<td align="left">2284</td>
</tr>
</tbody></table>
<p>具体见kaggle教程.</p>
<ol>
<li>Analytic aggregate functions<blockquote>
<p>As you might recall, AVG() (from the example above) is an aggregate function. The OVER clause is what ensures that it’s treated as an analytic (aggregate) function. Aggregate functions take all of the values within the window as input and return a single value.</p>
</blockquote>
</li>
</ol>
<p>MIN() (or MAX()) - Returns the minimum (or maximum) of input values<br>AVG() (or SUM()) - Returns the average (or sum) of input values<br>COUNT() - Returns the number of rows in the input</p>
<ol start="2">
<li>Analytic navigation functions<blockquote>
<p>Navigation functions assign a value based on the value in a (usually) different row than the current row.</p>
</blockquote>
</li>
</ol>
<p>FIRST_VALUE() (or LAST_VALUE()) - Returns the first (or last) value in the input<br>LEAD() (and LAG()) - Returns the value on a subsequent (or preceding) row</p>
<ol start="3">
<li>Analytic numbering functions<blockquote>
<p>Numbering functions assign integer values to each row based on the ordering.</p>
</blockquote>
</li>
</ol>
<p>ROW_NUMBER() - Returns the order in which rows appear in the input (starting with 1)<br>RANK() - All rows with the same value in the ordering column receive the same rank value, where the next row receives a rank value which increments by the number of rows with the previous rank value.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pickup_community_area,</span><br><span class="line">                        trip_start_timestamp,</span><br><span class="line">                        trip_end_timestamp,</span><br><span class="line">                      <span class="built_in">RANK</span>()</span><br><span class="line">                          <span class="keyword">OVER</span> (</span><br><span class="line">                               <span class="keyword">PARTITION</span> <span class="keyword">BY</span> pickup_community_area</span><br><span class="line">                               <span class="keyword">ORDER</span> <span class="keyword">BY</span> trip_start_timestamp</span><br><span class="line">                               ) <span class="keyword">AS</span> trip_number</span><br><span class="line">                    <span class="keyword">FROM</span> `bigquery<span class="operator">-</span>public<span class="operator">-</span>data.chicago_taxi_trips.taxi_trips`</span><br><span class="line">                    <span class="keyword">WHERE</span> <span class="type">DATE</span>(trip_start_timestamp) <span class="operator">=</span> <span class="string">&#x27;2017-05-01&#x27;</span></span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="HAVING-and-WHERE"><a href="#HAVING-and-WHERE" class="headerlink" title="HAVING and WHERE"></a>HAVING and WHERE</h3><p>对分组进行筛选.会需要先group by再用having筛选.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.title <span class="keyword">AS</span> Album, <span class="built_in">COUNT</span>(t.track_number) <span class="keyword">as</span> Tracks</span><br><span class="line">  <span class="keyword">FROM</span> track <span class="keyword">AS</span> t</span><br><span class="line">  <span class="keyword">JOIN</span> album <span class="keyword">AS</span> a</span><br><span class="line">    <span class="keyword">ON</span> a.id <span class="operator">=</span> t.album_id</span><br><span class="line">  <span class="keyword">WHERE</span> a.artist <span class="operator">=</span> <span class="string">&#x27;The Beatles&#x27;</span></span><br><span class="line">  <span class="keyword">GROUP</span> <span class="keyword">BY</span> a.id</span><br><span class="line">  <span class="keyword">HAVING</span> Tracks <span class="operator">&gt;=</span> <span class="number">10</span> <span class="comment">--using having clause similar to where</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> Tracks <span class="keyword">DESC</span>, Album</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<div class="note ">
            <p>where和having的区别.<br>where用于选行,having用于选组.<br>where比having先run.<br>where不可以但having可以加summary function.(where后不可以加单个variable的summary function)</p>
          </div>

<br>
<br>

<h3 id="AVG-and-MIN-MAX-and-SUM"><a href="#AVG-and-MIN-MAX-and-SUM" class="headerlink" title="AVG and MIN, MAX and SUM"></a>AVG and MIN, MAX and SUM</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(Population) <span class="keyword">FROM</span> Country;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(Population) <span class="keyword">FROM</span> Country;</span><br><span class="line"><span class="keyword">SELECT</span> Region, <span class="built_in">AVG</span>(Population) <span class="keyword">FROM</span> Country <span class="keyword">GROUP</span> <span class="keyword">BY</span> Region;</span><br><span class="line"><span class="keyword">SELECT</span> Region, <span class="built_in">MIN</span>(Population), <span class="built_in">MAX</span>(Population) <span class="keyword">FROM</span> Country <span class="keyword">GROUP</span> <span class="keyword">BY</span> Region;</span><br><span class="line"><span class="keyword">SELECT</span> Region, <span class="built_in">SUM</span>(Population) <span class="keyword">FROM</span> Country <span class="keyword">GROUP</span> <span class="keyword">BY</span> Region;</span><br></pre></td></tr></table></figure>
<p>注,sum一定要写在最外面,sum多项时是sum(A,B,C).</p>
<p>sum(A)会从上到下sum A中的所有值.<br>sum(A,B)会从左到右从上到下sum A B中所有值.</p>
<p>注,语法顺序:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, column2, columnN, <span class="built_in">sum</span>(columnX)</span><br><span class="line"><span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> [ <span class="keyword">condition</span> ]</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> column1, column2, columnN</span><br><span class="line"><span class="keyword">HAVING</span> [ <span class="keyword">condition</span> ]</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> column1, column2, columnN</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>所以group by后面接having,where不能用在group by后面.<br>where:在原表中筛选;having是筛完了后再筛.</p>
<div class="note ">
            <p>SELECT 6<br>FROM 1<br>WHERE 2<br>GROUP BY 3<br>HAVING 4<br>ORDER BY 5</p>
          </div>

<br>
<br>
<br>


<h2 id="Printf"><a href="#Printf" class="headerlink" title="Printf"></a>Printf</h2><p>在sqlite里面only.printf(“%X.YF”, expression),第一个%没有意义,X为整数位保留的数据,Y为小数位保留的数据,F为format.<br><strong>没有四舍五入,是硬截.</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">printf(&quot;%.2f%&quot;, (high<span class="operator">-</span>low)<span class="operator">/</span>(<span class="keyword">open</span><span class="operator">+</span><span class="keyword">close</span>)<span class="number">2100</span>) <span class="keyword">as</span> vol <span class="comment">--123.567 = 123.56(整数位不变,小数位取两位,f为float,最后一个%为加上的char)</span></span><br><span class="line">round(<span class="number">123.456</span>, <span class="number">2</span>) <span class="operator">=</span> <span class="number">123.46</span></span><br><span class="line">printf(&quot;%.2f&quot;, <span class="number">123.456</span>) <span class="operator">=</span> <span class="number">123.45</span></span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Transaction"><a href="#Transaction" class="headerlink" title="Transaction"></a>Transaction</h2><p>可以理解为C语言里的try和catch.如果一个命令fail了,保护其他的/原数据库不会造成影响.<br>For example:</p>
<ul>
<li>A transfer of funds between two accounts should include a debit from one     account and a credit to another account in the same amount</li>
<li>Both actions should succeed or fail together</li>
<li>The commit should occur after both steps are successfully completed</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- all statement between will be performed by one unit</span></span><br><span class="line"><span class="keyword">BEGIN</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetSales ( inv_id, quan, price ) <span class="keyword">VALUES</span> ( <span class="number">1</span>, <span class="number">5</span>, <span class="number">500</span> );</span><br><span class="line">UPDATE widgetInventory <span class="keyword">SET</span> onhand <span class="operator">=</span> ( onhand <span class="operator">-</span> <span class="number">5</span> ) <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"><span class="keyword">END</span> TRANSACTION;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span> TRANSACTION;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetInventory ( description, onhand ) <span class="keyword">VALUES</span> ( <span class="string">&#x27;toy&#x27;</span>, <span class="number">25</span> );</span><br><span class="line"><span class="keyword">ROLLBACK</span>; <span class="comment">--  if we rollback before end transaction, nothing happened</span></span><br></pre></td></tr></table></figure>

<p>Aside: transaction makes things faster also.</p>
<hr>
<p>Oracle中分为:commit and rollback.有点像git保存,在中间做一个savepoint,可以rollback取消更新.<br>A database transaction begins when the first DML statement is executed</p>
<p>The transaction ends when one of the following events occurs</p>
<ul>
<li>A COMMIT or ROLLBACK statement is issued</li>
<li>A DDL statement is executed – implicit COMMIT</li>
<li>A DCL statement is executed – implicit COMMIT</li>
<li>The user exits SQL Developer</li>
<li>The database crashes - implicit ROLLBACK</li>
</ul>
<p>ALL DML CHANGES MUST BE EITHER COMMITED OR ROLLED BACK</p>
<br>
<br>
<br>

<h2 id="Triggers"><a href="#Triggers" class="headerlink" title="Triggers"></a>Triggers</h2><p>Will trigger when certain condition meet. Also highly depends on different system.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> newWidgetSale AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> widgetSale</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        UPDATE widgetCustomer <span class="keyword">SET</span> last_order_id <span class="operator">=</span> NEW.id <span class="keyword">WHERE</span> widgetCustomer.id <span class="operator">=</span> NEW.customer_id;</span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>we can also use trigger to prevent an update(using rollback).//using before update</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> updateWidgetSale BEFORE UPDATE <span class="keyword">ON</span> widgetSale</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        <span class="keyword">SELECT</span> RAISE(<span class="keyword">ROLLBACK</span>, <span class="string">&#x27;cannot update table &quot;widgetSale&quot;&#x27;</span>) <span class="keyword">FROM</span> widgetSale</span><br><span class="line">            <span class="keyword">WHERE</span> id <span class="operator">=</span> NEW.id <span class="keyword">AND</span> reconciled <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="keyword">BEGIN</span> TRANSACTION;</span><br><span class="line">UPDATE widgetSale <span class="keyword">SET</span> quan <span class="operator">=</span> <span class="number">9</span> <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"><span class="keyword">END</span> TRANSACTION;</span><br></pre></td></tr></table></figure>

<p>and timestamps.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> widgetSale;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> widgetCustomer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> widgetCustomer ( id <span class="type">integer</span> <span class="keyword">primary</span> key, name TEXT, last_order_id <span class="type">INT</span>, stamp TEXT );</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> widgetSale ( id <span class="type">integer</span> <span class="keyword">primary</span> key, item_id <span class="type">INT</span>, customer_id <span class="type">INTEGER</span>, quan <span class="type">INT</span>, price <span class="type">INT</span>, stamp TEXT );</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> widgetLog ( id <span class="type">integer</span> <span class="keyword">primary</span> key, stamp TEXT, event TEXT, username TEXT, tablename TEXT, table_id <span class="type">INT</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetCustomer (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;Bob&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetCustomer (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;Sally&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetCustomer (name) <span class="keyword">VALUES</span> (<span class="string">&#x27;Fred&#x27;</span>);</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> widgetCustomer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> stampSale AFTER <span class="keyword">INSERT</span> <span class="keyword">ON</span> widgetSale <span class="operator">/</span><span class="operator">/</span><span class="keyword">using</span> after <span class="keyword">insert</span> <span class="keyword">to</span> <span class="keyword">create</span> stamps</span><br><span class="line">    <span class="keyword">BEGIN</span></span><br><span class="line">        UPDATE widgetSale <span class="keyword">SET</span> stamp <span class="operator">=</span> DATETIME(<span class="string">&#x27;now&#x27;</span>) <span class="keyword">WHERE</span> id <span class="operator">=</span> NEW.id;</span><br><span class="line">        UPDATE widgetCustomer <span class="keyword">SET</span> last_order_id <span class="operator">=</span> NEW.id, stamp <span class="operator">=</span> DATETIME(<span class="string">&#x27;now&#x27;</span>)</span><br><span class="line">            <span class="keyword">WHERE</span> widgetCustomer.id <span class="operator">=</span> NEW.customer_id;</span><br><span class="line">        <span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetLog (stamp, event, username, tablename, table_id)</span><br><span class="line">            <span class="keyword">VALUES</span> (DATETIME(<span class="string">&#x27;now&#x27;</span>), <span class="string">&#x27;INSERT&#x27;</span>, <span class="string">&#x27;TRIGGER&#x27;</span>, <span class="string">&#x27;widgetSale&#x27;</span>, NEW.id);</span><br><span class="line">    <span class="keyword">END</span></span><br><span class="line">;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetSale (item_id, customer_id, quan, price) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">1995</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetSale (item_id, customer_id, quan, price) <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1495</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> widgetSale (item_id, customer_id, quan, price) <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2995</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> widgetSale;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> widgetCustomer;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> widgetLog;</span><br><span class="line"><span class="comment">-- restore database</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> newWidgetSale;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> updateWidgetSale;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TRIGGER</span> IF <span class="keyword">EXISTS</span> stampSale;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> widgetCustomer;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> widgetSale;</span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> widgetLog;</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Exists-Oracle"><a href="#Exists-Oracle" class="headerlink" title="Exists(Oracle)"></a>Exists(Oracle)</h2><ul>
<li>Tests for the existence of a value in the result of the subquery</li>
<li>If the value is found, the subquery stops and TRUE is returned</li>
<li>If the value is not found in the subquery, FALSE is returned</li>
<li>The subquery does not return any table data</li>
<li>EXISTS was originally introduced to make correlated subqueries more efficient</li>
</ul>
<p>Who is a manager?</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> employee_id, last_name, job_id</span><br><span class="line">	<span class="keyword">FROM</span> employees e</span><br><span class="line">	<span class="keyword">WHERE</span> <span class="keyword">EXISTS</span> 	(<span class="keyword">SELECT</span> <span class="string">&#x27;x&#x27;</span></span><br><span class="line">					<span class="keyword">FROM</span> employees</span><br><span class="line">					<span class="keyword">WHERE</span> manager_id <span class="operator">=</span> e.employee_id);</span><br></pre></td></tr></table></figure>

<p>Find departments with no employees, NOT flips TRUE to FALSE</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, department_name</span><br><span class="line">	<span class="keyword">FROM</span> departments d</span><br><span class="line">	<span class="keyword">WHERE</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> (<span class="keyword">SELECT</span> <span class="string">&#x27;x&#x27;</span></span><br><span class="line">							<span class="keyword">FROM</span> employees</span><br><span class="line">							<span class="keyword">WHERE</span> department_id <span class="operator">=</span> d.department_id);</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="View"><a href="#View" class="headerlink" title="View"></a>View</h2><span style="color:#64c0f5">
在oracle时的解释:
</span>

<p>Table: Basic storage unit composed of rows and columns.<br>View: Shows subsets of data from one or more underlying tables.</p>
<ul>
<li>Views control which columns and/or rows a user can see</li>
<li>Views present a subset of table data to a user</li>
<li>A view is a SELECT statement that has a name</li>
<li>Views are permanently stored in the Data Dictionary</li>
</ul>
<p>Creating a view.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> view_name</span><br><span class="line">	<span class="keyword">AS</span> <span class="keyword">SELECT</span> col1, col2, col3, etc</span><br><span class="line">			<span class="keyword">FROM</span> tables</span><br><span class="line">			<span class="keyword">WHERE</span> etc;</span><br></pre></td></tr></table></figure>

<p>Describe the structure of the view</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESC</span> view_name;</span><br></pre></td></tr></table></figure>

<p><strong>All columns selected in a view must have a name.</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> yearly_pay_vu</span><br><span class="line">	<span class="keyword">AS</span> <span class="keyword">SELECT</span> employee_id, last_name, salary <span class="operator">*</span> <span class="number">12</span> <span class="keyword">AS</span> yearly_pay <span class="comment">-- 用as取名</span></span><br><span class="line">			<span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>

<p>Modifying a view.</p>
<blockquote>
<p>Modify the emps50_vu by reducing the columns selected and giving each column an alias.</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">VIEW</span> emps50_vu	(empid, fname, lname, sal, mgr, deptid)</span><br><span class="line">	<span class="keyword">AS</span> <span class="keyword">SELECT</span> employee_id, first_name, last_name, salary, manager_id, 				department_id</span><br><span class="line">			<span class="keyword">FROM</span> employees</span><br><span class="line">			<span class="keyword">WHERE</span> department_id <span class="operator">=</span> <span class="number">50</span>;</span><br></pre></td></tr></table></figure>

<p>Dropping a view.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> view_name;</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Schemas"><a href="#Schemas" class="headerlink" title="Schemas"></a>Schemas</h2><blockquote>
<p>A way to organizing tables and views.</p>
</blockquote>
<p>Schemas are grouping structures, we create schema by specifying the create schema command.<br>Visually it allows us to group things like our tables, views, and indexes into a logical unit.<br>We could create a schema based on a project or kind of analysis that we’re doing.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> SCHEMA data_sci</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Subselect"><a href="#Subselect" class="headerlink" title="Subselect"></a>Subselect</h2><p>把select当作select的source.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> co.Name, ss.CCode <span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> SUBSTR(a, <span class="number">1</span>, <span class="number">2</span>) <span class="keyword">AS</span> State, SUBSTR(a, <span class="number">3</span>) <span class="keyword">AS</span> SCode,</span><br><span class="line">      SUBSTR(b, <span class="number">1</span>, <span class="number">2</span>) <span class="keyword">AS</span> Country, SUBSTR(b, <span class="number">3</span>) <span class="keyword">AS</span> CCode <span class="keyword">FROM</span> t</span><br><span class="line">  ) <span class="keyword">AS</span> ss</span><br><span class="line">  <span class="keyword">JOIN</span> Country <span class="keyword">AS</span> co</span><br><span class="line">    <span class="keyword">ON</span> co.Code2 <span class="operator">=</span> ss.Country</span><br><span class="line">;</span><br></pre></td></tr></table></figure>

<p>When you SELECT from a subquery, you are selecting from a temporary result set</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">AVG</span>(dept_tot)</span><br><span class="line">	<span class="keyword">FROM</span> (<span class="keyword">SELECT</span> manager_id, <span class="built_in">sum</span>(salary) <span class="keyword">as</span> dept_tot							</span><br><span class="line">        <span class="keyword">FROM</span> employees</span><br><span class="line">				<span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id) a;</span><br></pre></td></tr></table></figure>

<ul>
<li>The outer query selects FROM “a”</li>
<li>a is a query that is inline, has a name, and represents a result set of data, much like a view</li>
<li>a is known as an Inline View</li>
<li>An inline view is not permanently stored in the database</li>
</ul>
<br>
<br>
<br>

<h2 id="Subquery"><a href="#Subquery" class="headerlink" title="Subquery"></a>Subquery</h2><p>也就是Nested(嵌套)query.</p>
<blockquote>
<p>SQL allows you to embed a query into another query, subquery can be uncorrelated or correlated</p>
</blockquote>
<div class="note ">
            <p>Subquery的结构中,整体的叫parent/main query,其中的子query叫nested/inner query.<br>(当作subset来理解.)<br>什么时候要使用nested query:无法用and和or做一次查询得出结论,得使用多次查询.(第一次的查询的结果用于第二次查询.)</p>
          </div>

<p>Uncorrelated subquery:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> card_num <span class="keyword">from</span> clean_data</span><br><span class="line"><span class="keyword">where</span> Fraud<span class="operator">=</span><span class="string">&#x27;Yes&#x27;</span> <span class="keyword">and</span> MCC_desc <span class="operator">=</span> <span class="string">&#x27;Transportation&#x27;</span> <span class="keyword">and</span></span><br><span class="line">card_num <span class="keyword">in</span> (<span class="keyword">select</span> card_num <span class="keyword">from</span> clean_data <span class="keyword">where</span> Fraud <span class="operator">=</span> <span class="string">&#x27;Yes&#x27;</span> <span class="keyword">and</span> MCC_desc <span class="operator">=</span> <span class="string">&#x27;Grocery&#x27;</span>); <span class="comment">-- 如果没有主query副query也可以独立运行</span></span><br></pre></td></tr></table></figure>

<p>Correlated Subquery:</p>
<p>A sub-query that uses values from the outer query. In this case the inner<br>query has to be executed for every row of outer query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> disk.multiple_financial <span class="keyword">as</span> a <span class="keyword">where</span> <span class="keyword">exists</span></span><br><span class="line">(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> disk.multiple_rating <span class="keyword">as</span> b <span class="keyword">where</span> a.id<span class="operator">=</span>b.id <span class="keyword">and</span> a.year<span class="operator">=</span>b.year <span class="keyword">and</span> b.df<span class="operator">=</span><span class="number">1</span>); <span class="comment">-- 不建议用correlated subquery因为run得很慢</span></span><br></pre></td></tr></table></figure>

<p>Comparison的时候:<br>When a subquery might return multiple values, you must use one of the conditional operators ANY or ALL to modify a comparison operator in the WHERE or HAVING clause immediately before the subquery.<br>For example, the following WHERE clause contains the less than (&lt;) comparison operator and the conditional operator ANY:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">where</span> dateofbirth <span class="operator">&lt;</span> <span class="keyword">ANY</span> &#123;subquery...&#125;</span><br><span class="line"><span class="keyword">where</span> dateofbirth <span class="operator">&lt;</span> <span class="keyword">ALL</span> &#123;subquery...&#125;</span><br></pre></td></tr></table></figure>

<p>other example:这里的使用是两个select套在一起.查询两个表.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> column1, ... ,columnN</span><br><span class="line"><span class="keyword">FROM</span> tableA</span><br><span class="line"><span class="keyword">WHERE</span> column1 <span class="keyword">IN</span> (<span class="keyword">SELECT</span> columnN</span><br><span class="line">                  <span class="keyword">FROM</span> tableB</span><br><span class="line">                  <span class="keyword">WHERE</span> ...)</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tmp3 <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> col_trans</span><br><span class="line"><span class="keyword">where</span> customer_id <span class="keyword">in</span> (</span><br><span class="line">    <span class="keyword">select</span> customer_id <span class="keyword">from</span> customer</span><br><span class="line">    <span class="keyword">where</span> jurisdiction <span class="operator">=</span> <span class="string">&#x27;Canada&#x27;</span></span><br><span class="line">      <span class="keyword">and</span> industry <span class="operator">=</span> <span class="string">&#x27;Financial&#x27;</span></span><br><span class="line">)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>注意这里前一个where和后一个select是对应的,不然会出现return和需求的column个数不对.<br>不一定需要内容一样,但return的column数得相同.</p>
<p>有时可以用join代替,先join再查询.<br>但建议使用subquery,运算速度会快(提升性能).<br>在数量对应不上的时候,我们可以用or来拆开子query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tmp9 <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> col_trans</span><br><span class="line"><span class="keyword">where</span> security_id <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> security_id <span class="keyword">from</span> sec</span><br><span class="line"><span class="keyword">where</span> security_type <span class="operator">=</span> <span class="string">&#x27;Equity&#x27;</span> <span class="keyword">and</span> price <span class="operator">&lt;=</span> <span class="number">30</span></span><br><span class="line">) <span class="keyword">or</span> security_id <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> security_id_2 <span class="keyword">from</span> sec</span><br><span class="line"><span class="keyword">where</span> security_type <span class="operator">=</span> <span class="string">&#x27;Equity&#x27;</span> <span class="keyword">and</span> price <span class="operator">&lt;=</span> <span class="number">30</span></span><br><span class="line">)</span><br><span class="line">;</span><br></pre></td></tr></table></figure>
<p>或者用union合并.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tmp10 <span class="keyword">as</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> col_trans</span><br><span class="line"><span class="keyword">where</span> security_id <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">select</span> security_id <span class="keyword">from</span> sec <span class="keyword">where</span> security_type <span class="operator">=</span> <span class="string">&#x27;Equity&#x27;</span> <span class="keyword">and</span> price <span class="operator">&lt;=</span><span class="number">30</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> security_id_2 <span class="keyword">from</span> sec <span class="keyword">where</span> security_type <span class="operator">=</span> <span class="string">&#x27;Equity&#x27;</span> <span class="keyword">and</span> price <span class="operator">&lt;=</span><span class="number">30</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Subquery-Oracle"><a href="#Subquery-Oracle" class="headerlink" title="Subquery(Oracle)"></a>Subquery(Oracle)</h2><p>Subquery学的很烂所以在oracle中又记一次.</p>
<h3 id="Subqueries-in-the-where-clause"><a href="#Subqueries-in-the-where-clause" class="headerlink" title="Subqueries in the where clause"></a>Subqueries in the where clause</h3><ul>
<li>The inner query executes before the main query.</li>
<li>The result of the subquery is used to complete the outer query.</li>
<li>The shorthand shows the basic layout of subqueries in the WHERE</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> select_list</span><br><span class="line">	<span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">	<span class="keyword">WHERE</span> column_name operator (<span class="keyword">SELECT</span> select_list</span><br><span class="line">											<span class="keyword">FROM</span> <span class="keyword">table</span></span><br><span class="line">											<span class="keyword">WHERE</span> …);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary 			 		    </span><br><span class="line">	<span class="keyword">FROM</span> employees				</span><br><span class="line">	<span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> salary</span><br><span class="line">								<span class="keyword">FROM</span> employees</span><br><span class="line">								<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">145</span>);</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>
<br>

<p>还可以subquery中套outer query.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">column</span>(s)</span><br><span class="line">	<span class="keyword">FROM</span> outer_table</span><br><span class="line">	<span class="keyword">WHERE</span> column_name operator</span><br><span class="line">		(<span class="keyword">SELECT</span> <span class="keyword">column</span></span><br><span class="line">			<span class="keyword">FROM</span> inner_table</span><br><span class="line">			<span class="keyword">WHERE</span> <span class="keyword">column</span> <span class="operator">=</span> outer_table.column);</span><br></pre></td></tr></table></figure>

<p>Example:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, salary, job_id</span><br><span class="line">	<span class="keyword">FROM</span> employees e</span><br><span class="line">	<span class="keyword">WHERE</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">avg</span>(salary)</span><br><span class="line">								<span class="keyword">FROM</span> employees</span><br><span class="line">								<span class="keyword">WHERE</span> job_id <span class="operator">=</span> e.job_id);</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Single-row-subqueries"><a href="#Single-row-subqueries" class="headerlink" title="Single row subqueries"></a>Single row subqueries</h3><p>Use single-value comparison operators in the WHERE clause of the outer query</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary 			 		    </span><br><span class="line">	<span class="keyword">FROM</span> employees				</span><br><span class="line">	<span class="keyword">WHERE</span> job_id <span class="operator">=</span> (<span class="keyword">SELECT</span> job_id</span><br><span class="line">								<span class="keyword">FROM</span> employees</span><br><span class="line">								<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">152</span>)</span><br><span class="line">	<span class="keyword">AND</span> salary <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> salary</span><br><span class="line">						<span class="keyword">FROM</span> employees</span><br><span class="line">						<span class="keyword">WHERE</span> employee_id <span class="operator">=</span> <span class="number">152</span>);</span><br></pre></td></tr></table></figure>

<h3 id="Multi-row-subqueries"><a href="#Multi-row-subqueries" class="headerlink" title="Multi row subqueries"></a>Multi row subqueries</h3><p>有IN, ANY, ALL三种.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line">	<span class="keyword">FROM</span> employees				</span><br><span class="line">	<span class="keyword">WHERE</span> salary <span class="keyword">IN</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary)</span><br><span class="line">							<span class="keyword">FROM</span> employees</span><br><span class="line">							<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id);</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line">	<span class="keyword">FROM</span> employees				</span><br><span class="line">	<span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="keyword">ANY</span> (<span class="keyword">SELECT</span> salary</span><br><span class="line">     									<span class="keyword">FROM</span> employees</span><br><span class="line">									    <span class="keyword">WHERE</span> job_id <span class="operator">=</span> ‘IT_PROG’)</span><br><span class="line">	<span class="keyword">AND</span> job_id <span class="operator">!=</span> ‘IT_PROG’;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name, job_id, salary</span><br><span class="line">	<span class="keyword">FROM</span> employees				</span><br><span class="line">	<span class="keyword">WHERE</span> salary <span class="operator">&lt;</span> <span class="keyword">ALL</span> (<span class="keyword">SELECT</span> salary</span><br><span class="line">    								  <span class="keyword">FROM</span> employees</span><br><span class="line">									    <span class="keyword">WHERE</span> job_id <span class="operator">=</span> ‘IT_PROG’);</span><br></pre></td></tr></table></figure>

<h3 id="Subqueries-in-the-having-clause"><a href="#Subqueries-in-the-having-clause" class="headerlink" title="Subqueries in the having clause"></a>Subqueries in the having clause</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_id, <span class="built_in">MIN</span>(salary)</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line">  <span class="keyword">HAVING</span> <span class="built_in">MIN</span>(salary) <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">MIN</span>(salary) 													</span><br><span class="line">                              <span class="keyword">FROM</span> employees);</span><br></pre></td></tr></table></figure>

<p>(orcacle笔记结束)</p>
<br>
<br>
<br>

<h2 id="With"><a href="#With" class="headerlink" title="With"></a>With</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> cte_name <span class="keyword">AS</span> (<span class="keyword">SELECT</span> statement)</span><br><span class="line">  [, cte_name2 <span class="keyword">AS</span> (<span class="keyword">SELECT</span> statement)]</span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> cte_name [<span class="keyword">inner</span> <span class="keyword">join</span> cte_name2]</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> ... <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> statement) <span class="keyword">AS</span></span><br><span class="line">subquery_name</span><br></pre></td></tr></table></figure>
<p>Note: WITH clause is mostly equivalent to a subquery.<br>WITH RECURSIVE is more useful, provide the ability to do hieracrchical/recursive queries</p>
<div class="note ">
            <p>The WITH clause allows complex queries to be broken into smaller blocks.<br>It is useful when joins, subqueries, aggregation, or repeated query blocks are being used.<br>WITH allows you to make inline views which can be repeatedly referenced as needed.<br>The inline views create output that can be used as input to subsequent queries.</p>
          </div>

<p>Example:<br>Suppose you need to find the department names and their total salary for any department whose total salary is greater than the average of all the total salaries by department.</p>
<p>Without the WITH clause.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> department_name, <span class="built_in">SUM</span>(salary)</span><br><span class="line">   <span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line">  <span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">   <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name</span><br><span class="line">   <span class="keyword">HAVING</span> <span class="built_in">SUM</span>(salary) <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> <span class="built_in">AVG</span>(<span class="built_in">SUM</span>(salary))</span><br><span class="line">                       <span class="keyword">FROM</span> employees</span><br><span class="line">                 <span class="keyword">WHERE</span> department_id <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">                           <span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id)                   	 </span><br><span class="line">                           <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>The WHERE clause removes employee Grant, with a null department_id, from the calculations.</p>
<p>Using the WITH clause.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> a <span class="keyword">AS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> department_name, <span class="built_in">sum</span>(salary)	<span class="keyword">AS</span> totpay</span><br><span class="line">			<span class="keyword">FROM</span> employees e <span class="keyword">JOIN</span> departments d</span><br><span class="line">			<span class="keyword">ON</span> e.department_id <span class="operator">=</span> d.department_id</span><br><span class="line">			<span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name),</span><br><span class="line">	  b <span class="keyword">AS</span> (</span><br><span class="line">		<span class="keyword">SELECT</span> <span class="built_in">avg</span>(totpay) <span class="keyword">AS</span> depts_avg</span><br><span class="line">			<span class="keyword">FROM</span> a)</span><br><span class="line"><span class="keyword">SELECT</span> department_name, tot_pay</span><br><span class="line">	<span class="keyword">FROM</span> a</span><br><span class="line">	<span class="keyword">WHERE</span>  totpay <span class="operator">&gt;</span> (<span class="keyword">SELECT</span> depts_avg</span><br><span class="line">								<span class="keyword">FROM</span> b)</span><br><span class="line">	<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h2 id="Autoincrement"><a href="#Autoincrement" class="headerlink" title="Autoincrement"></a>Autoincrement</h2><p>用于自动添加从1开始的不重复column内容.可以用为增加新的primary key.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="string">&#x27;table_name&#x27;</span>&#123;</span><br><span class="line">  ‘id’ <span class="type">integer</span> <span class="keyword">primary</span> key autoincrement</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>但注意,在这样生成的表中.如果一开始的id为1-20.有数据删除再添加,新的数据会从21开始.</p>
<br>
<br>
<br>

<h2 id="Writing-Efficient-Queries"><a href="#Writing-Efficient-Queries" class="headerlink" title="Writing Efficient Queries"></a><a target="_blank" rel="noopener" href="https://www.kaggle.com/code/alexisbcook/writing-efficient-queries/tutorial">Writing Efficient Queries</a></h2><p><strong>Avoid scanning too much data at once.</strong><br>To begin,you can estimate the size of any query before running it.</p>
<br>
<br>
<br>

<p>关于bigQuery这个web service.</p>
<img src="/blog/2020/11/24/P134/P134_10.png" class="">

<p>BigQuery里的数据结构.</p>
<p>在bigQuery里可以create a <a target="_blank" rel="noopener" href="https://www.kaggle.com/code/dansbecker/select-from-where">QueryJobConfig object</a> and set the dry_run parameter to True to see how much data a query will scan.</p>
<div class="note ">
            <p>If you are ever unsure what to put inside the COUNT() function, you can do COUNT(1) to count the rows in each group. Most people find it especially readable, because we know it’s not focusing on other columns. It also scans less data than if supplied column names (making it faster and using less of your data access quota).</p>
          </div>

<div class="note ">
            <p>There are <a target="_blank" rel="noopener" href="https://cloud.google.com/bigquery/docs/reference/legacy-sql#datetimefunctions">two ways that dates</a> can be stored in BigQuery: as a DATE or as a DATETIME.</p><p>The DATE format has the year first, then the month, and then the day. It looks like this:</p><p>YYYY-[M]M-[D]D<br>YYYY: Four-digit year<br>[M]M: One or two digit month<br>[D]D: One or two digit day<br>So 2019-01-10 is interpreted as January 10, 2019.</p><p>The DATETIME format is like the date format … but with time added at the end.</p><p>There are two ways that dates can be stored in BigQuery: as a DATE or as a DATETIME.</p><p>The DATE format has the year first, then the month, and then the day. It looks like this:</p><p>YYYY-[M]M-[D]D<br>YYYY: Four-digit year<br>[M]M: One or two digit month<br>[D]D: One or two digit day<br>So 2019-01-10 is interpreted as January 10, 2019.</p><p>The DATETIME format is like the date format … but with time added at the end.</p><p>Often you’ll want to look at part of a date, like the year or the day. You can do this with EXTRACT.</p>
          </div>


<br>
<br>
<br>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> LocationsAndOwners <span class="keyword">AS</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> CostumeOwners co <span class="keyword">INNER</span> <span class="keyword">JOIN</span> CostumeLocations cl</span><br><span class="line">   <span class="keyword">ON</span> co.CostumeID <span class="operator">=</span> cl.CostumeID</span><br><span class="line">),</span><br><span class="line">LastSeen <span class="keyword">AS</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> CostumeID, <span class="built_in">MAX</span>(<span class="type">Timestamp</span>)</span><br><span class="line"><span class="keyword">FROM</span> LocationsAndOwners</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> CostumeID</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> lo.CostumeID, Location</span><br><span class="line"><span class="keyword">FROM</span> LocationsAndOwners lo <span class="keyword">INNER</span> <span class="keyword">JOIN</span> LastSeen ls</span><br><span class="line">    <span class="keyword">ON</span> lo.Timestamp <span class="operator">=</span> ls.Timestamp <span class="keyword">AND</span> lo.CostumeID <span class="operator">=</span> ls.CostumeID</span><br><span class="line"><span class="keyword">WHERE</span> OwnerID <span class="operator">=</span> MitzieOwnerID</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">WITH</span> CurrentOwnersCostumes <span class="keyword">AS</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> CostumeID</span><br><span class="line"><span class="keyword">FROM</span> CostumeOwners</span><br><span class="line"><span class="keyword">WHERE</span> OwnerID <span class="operator">=</span> MitzieOwnerID</span><br><span class="line">),</span><br><span class="line">OwnersCostumesLocations <span class="keyword">AS</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> cc.CostumeID, <span class="type">Timestamp</span>, Location</span><br><span class="line"><span class="keyword">FROM</span> CurrentOwnersCostumes cc <span class="keyword">INNER</span> <span class="keyword">JOIN</span> CostumeLocations cl</span><br><span class="line">    <span class="keyword">ON</span> cc.CostumeID <span class="operator">=</span> cl.CostumeID</span><br><span class="line">),</span><br><span class="line">LastSeen <span class="keyword">AS</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> CostumeID, <span class="built_in">MAX</span>(<span class="type">Timestamp</span>)</span><br><span class="line"><span class="keyword">FROM</span> OwnersCostumesLocations</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> CostumeID</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> ocl.CostumeID, Location</span><br><span class="line"><span class="keyword">FROM</span> OwnersCostumesLocations ocl <span class="keyword">INNER</span> <span class="keyword">JOIN</span> LastSeen ls</span><br><span class="line">    <span class="keyword">ON</span> ocl.timestamp <span class="operator">=</span> ls.timestamp <span class="keyword">AND</span> ocl.CostumeID <span class="operator">=</span> ls.costumeID</span><br></pre></td></tr></table></figure>

<p>Why is this better?</p>
<p>Instead of doing large merges and running calculations (like finding the last timestamp) for every costume, we discard the rows for other owners as the first step. So each subsequent step (like calculating the last timestamp) is working with something like 99.999% fewer rows than what was needed in the original query.</p>
<p>Databases have something called “Query Planners” to optimize details of how a query executes even after you write it. Perhaps some query planner would figure out the ability to do this. But the original query as written would be very inefficient on large datasets.</p>
<br>
<br>
<br>
<link rel="stylesheet" href="/blog/css/spoiler.css" type="text/css"><script src="/blog/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/%E4%BB%A5%E5%A4%B4%E6%8A%A2%E5%9C%B0-%E8%AF%9A/" rel="tag"># 以头抢地(诚)</a>
              <a href="/blog/tags/data/" rel="tag"># data</a>
              <a href="/blog/tags/SQL/" rel="tag"># SQL</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2020/11/28/P140/" rel="prev" title="关于data的笔记 - Week1">
      <i class="fa fa-chevron-left"></i> 关于data的笔记 - Week1
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2020/11/24/P132/" rel="next" title="The amazing treasure - 番外">
      The amazing treasure - 番外 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Notes"><span class="nav-number">1.</span> <span class="nav-text">Notes</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Code"><span class="nav-number">2.</span> <span class="nav-text">Code</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#SELECT"><span class="nav-number">2.1.</span> <span class="nav-text">SELECT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DISTINCT"><span class="nav-number">2.2.</span> <span class="nav-text">DISTINCT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WHEN"><span class="nav-number">2.3.</span> <span class="nav-text">WHEN</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FROM"><span class="nav-number">2.4.</span> <span class="nav-text">FROM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UPDATE"><span class="nav-number">2.5.</span> <span class="nav-text">UPDATE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DELETE"><span class="nav-number">2.6.</span> <span class="nav-text">DELETE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AS"><span class="nav-number">2.7.</span> <span class="nav-text">AS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ORDER-BY"><span class="nav-number">2.8.</span> <span class="nav-text">ORDER BY</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WHERE"><span class="nav-number">2.9.</span> <span class="nav-text">WHERE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LIMIT-and-OFFSET"><span class="nav-number">2.10.</span> <span class="nav-text">LIMIT and OFFSET</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#COUNT"><span class="nav-number">2.11.</span> <span class="nav-text">COUNT</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#INSERT-INTO"><span class="nav-number">2.12.</span> <span class="nav-text">INSERT INTO</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#INSERT-INTO-Oracle"><span class="nav-number">2.13.</span> <span class="nav-text">INSERT INTO(Oracle)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Inserting-nulls"><span class="nav-number">2.13.1.</span> <span class="nav-text">Inserting nulls</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CREATE-TABLE"><span class="nav-number">2.14.</span> <span class="nav-text">CREATE TABLE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CREATE-TABLE-Oracle"><span class="nav-number">2.15.</span> <span class="nav-text">CREATE TABLE(Oracle)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Index"><span class="nav-number">2.16.</span> <span class="nav-text">Index</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DROP-TABLE"><span class="nav-number">2.17.</span> <span class="nav-text">DROP TABLE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#IS-NULL"><span class="nav-number">2.18.</span> <span class="nav-text">IS NULL</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NVL-Oracle"><span class="nav-number">2.19.</span> <span class="nav-text">NVL(Oracle)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NULL"><span class="nav-number">2.20.</span> <span class="nav-text">NULL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#COALESCE"><span class="nav-number">2.20.1.</span> <span class="nav-text">COALESCE</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ALTER"><span class="nav-number">2.21.</span> <span class="nav-text">ALTER</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ID-columns"><span class="nav-number">2.22.</span> <span class="nav-text">ID columns</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Join-table"><span class="nav-number">2.23.</span> <span class="nav-text">Join table</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Natural-Join-Oracle"><span class="nav-number">2.23.1.</span> <span class="nav-text">Natural Join(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Join-using-Oracle"><span class="nav-number">2.23.2.</span> <span class="nav-text">Join using(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Three-way-join-Oracle"><span class="nav-number">2.23.3.</span> <span class="nav-text">Three way join(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Non-equijoin-Oracle"><span class="nav-number">2.23.4.</span> <span class="nav-text">Non equijoin(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Non-standard-joins-Oracle"><span class="nav-number">2.23.5.</span> <span class="nav-text">Non standard joins(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Combine-two-tables-right-and-left-relationship"><span class="nav-number">2.23.6.</span> <span class="nav-text">Combine two tables(right and left relationship)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Junction-table-many-to-many-relationship"><span class="nav-number">2.23.7.</span> <span class="nav-text">Junction table(many to many relationship)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UNION"><span class="nav-number">2.23.8.</span> <span class="nav-text">UNION</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Self-join"><span class="nav-number">2.23.9.</span> <span class="nav-text">Self join</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Substitution-variables-Oracle"><span class="nav-number">2.24.</span> <span class="nav-text">Substitution variables(Oracle)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-string"><span class="nav-number">2.25.</span> <span class="nav-text">SQL string</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#INSTR-Oracle"><span class="nav-number">2.25.1.</span> <span class="nav-text">INSTR(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#INSTR-Oracle-1"><span class="nav-number">2.25.2.</span> <span class="nav-text">INSTR(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Char-data-type-Oracle"><span class="nav-number">2.25.3.</span> <span class="nav-text">Char data type(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TRIM"><span class="nav-number">2.25.4.</span> <span class="nav-text">TRIM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TRIM-Oracle"><span class="nav-number">2.25.5.</span> <span class="nav-text">TRIM(Oracle)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#REPLACE"><span class="nav-number">2.25.6.</span> <span class="nav-text">REPLACE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CONCAT"><span class="nav-number">2.25.7.</span> <span class="nav-text">CONCAT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UPPER-and-LOWER"><span class="nav-number">2.25.8.</span> <span class="nav-text">UPPER and LOWER</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-number"><span class="nav-number">2.26.</span> <span class="nav-text">SQL number</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TYPEOF"><span class="nav-number">2.26.1.</span> <span class="nav-text">TYPEOF</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CAST"><span class="nav-number">2.26.2.</span> <span class="nav-text">CAST</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ROUND"><span class="nav-number">2.26.3.</span> <span class="nav-text">ROUND</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Nested-and-Repeated-Data"><span class="nav-number">2.27.</span> <span class="nav-text">Nested and Repeated Data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-date-and-time"><span class="nav-number">2.28.</span> <span class="nav-text">SQL date and time</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL-date-and-time-Oracle"><span class="nav-number">2.29.</span> <span class="nav-text">SQL date and time(Oracle)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#TO-CHAR"><span class="nav-number">2.29.1.</span> <span class="nav-text">TO_CHAR</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Aggregate-%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-number">2.30.</span> <span class="nav-text">Aggregate(聚合函数)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#WITH-AS"><span class="nav-number">2.31.</span> <span class="nav-text">WITH AS</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Analytic-function"><span class="nav-number">2.32.</span> <span class="nav-text">Analytic function</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#HAVING-and-WHERE"><span class="nav-number">2.32.1.</span> <span class="nav-text">HAVING and WHERE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AVG-and-MIN-MAX-and-SUM"><span class="nav-number">2.32.2.</span> <span class="nav-text">AVG and MIN, MAX and SUM</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Printf"><span class="nav-number">2.33.</span> <span class="nav-text">Printf</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Transaction"><span class="nav-number">2.34.</span> <span class="nav-text">Transaction</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Triggers"><span class="nav-number">2.35.</span> <span class="nav-text">Triggers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Exists-Oracle"><span class="nav-number">2.36.</span> <span class="nav-text">Exists(Oracle)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#View"><span class="nav-number">2.37.</span> <span class="nav-text">View</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Schemas"><span class="nav-number">2.38.</span> <span class="nav-text">Schemas</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Subselect"><span class="nav-number">2.39.</span> <span class="nav-text">Subselect</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Subquery"><span class="nav-number">2.40.</span> <span class="nav-text">Subquery</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Subquery-Oracle"><span class="nav-number">2.41.</span> <span class="nav-text">Subquery(Oracle)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Subqueries-in-the-where-clause"><span class="nav-number">2.41.1.</span> <span class="nav-text">Subqueries in the where clause</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Single-row-subqueries"><span class="nav-number">2.41.2.</span> <span class="nav-text">Single row subqueries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Multi-row-subqueries"><span class="nav-number">2.41.3.</span> <span class="nav-text">Multi row subqueries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Subqueries-in-the-having-clause"><span class="nav-number">2.41.4.</span> <span class="nav-text">Subqueries in the having clause</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#With"><span class="nav-number">2.42.</span> <span class="nav-text">With</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Autoincrement"><span class="nav-number">2.43.</span> <span class="nav-text">Autoincrement</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Writing-Efficient-Queries"><span class="nav-number">2.44.</span> <span class="nav-text">Writing Efficient Queries</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mazui"
      src="/blog/images/logo_10.jpg">
  <p class="site-author-name" itemprop="name">Mazui</p>
  <div class="site-description" itemprop="description">与孤独和平共处.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">294</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:mazui.and.rio@gmail.com" title="E-Mail → mailto:mazui.and.rio@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/3032131561?topnav=1&wvr=6&topsug=1&ssl_rnd=1606158448.6943&is_all=1" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3032131561?topnav&#x3D;1&amp;wvr&#x3D;6&amp;topsug&#x3D;1&amp;ssl_rnd&#x3D;1606158448.6943&amp;is_all&#x3D;1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/mazui_3" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;mazui_3" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/mazui_3" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;mazui_3" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



      </div>

<br>
      <!--new music test-->

  <!--网易云插件-->
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/4mCwspCTPF1aoWUNxsS5aD?utm_source=generator" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mazui</span>

<!--
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>


    <span title="C">1.4m</span>
  -->

  <!--
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="T">21:19</span>

  -->

</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>
<br>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">阅览室一共有1.4m的老兔正在打瞌睡</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://mazui3-com.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://mazui3.github.io/blog/2020/11/24/P134/";
    this.page.identifier = "2020/11/24/P134/";
    this.page.title = "关于SQL的笔记";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://mazui3-com.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
