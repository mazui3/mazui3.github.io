<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/star.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/star.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/star.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/blog/lib/pace/pace-theme-minimal.min.css">
  <script src="/blog/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mazui3.github.io","root":"/blog/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":265,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"text":"Load Disqus","order":-1}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="朋友友情赞助的stat442的笔记加一点点点tableau(坑了)的笔记.">
<meta property="og:type" content="article">
<meta property="og:title" content="关于stat的笔记 - visualization">
<meta property="og:url" content="https://mazui3.github.io/blog/2021/11/07/P182/index.html">
<meta property="og:site_name" content="Underlake Reading Room">
<meta property="og:description" content="朋友友情赞助的stat442的笔记加一点点点tableau(坑了)的笔记.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-11-07T04:43:19.000Z">
<meta property="article:modified_time" content="2022-07-26T23:37:45.269Z">
<meta property="article:author" content="Mazui">
<meta property="article:tag" content="以头抢地(诚)">
<meta property="article:tag" content="data">
<meta property="article:tag" content="statistics">
<meta property="article:tag" content="R">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://mazui3.github.io/blog/2021/11/07/P182/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>关于stat的笔记 - visualization | Underlake Reading Room</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Underlake Reading Room</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">这里是图书馆外的阅览室🌟</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/blog/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
        <li class="menu-item menu-item-zone">

    <a href="https://cerulean-raclette-358.notion.site/QQ-7770800c659c4c5cbda0ba1b6720dec8" rel="noopener" target="_blank"><i class="fab fa-diaspora fa-fw"></i>Zone</a>

  </li>
        <li class="menu-item menu-item-back">

    <a href="https://mazui3.github.io/" rel="section"><i class="fa fa-cloud fa-fw"></i>Back</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mazui3.github.io/blog/2021/11/07/P182/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/logo_11.jpg">
      <meta itemprop="name" content="Mazui">
      <meta itemprop="description" content="与孤独和平共处.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Underlake Reading Room">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          关于stat的笔记 - visualization
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-11-07 00:43:19" itemprop="dateCreated datePublished" datetime="2021-11-07T00:43:19-04:00">2021-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-07-26 19:37:45" itemprop="dateModified" datetime="2022-07-26T19:37:45-04:00">2022-07-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E5%AD%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">数学笔记</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/blog/2021/11/07/P182/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/11/07/P182/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="C">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>79k</span>
            </span>
            <span class="post-meta-item" title="T">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>1:12</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>朋友友情赞助的stat442的笔记加一点点点tableau(坑了)的笔记.</p>
<span id="more"></span>
<p>加上另一位朋友<a href="hhttps://drive.google.com/drive/folders/142BfLAX4dMk04aFZRfkBaVwsmWBEkF8C?usp=sharing">友情赞助的笔记与dataset</a>.</p>
<br>
<br>
<br>

<h1 id="R"><a href="#R" class="headerlink" title="R"></a>R</h1><h2 id="NumbersOrder"><a href="#NumbersOrder" class="headerlink" title="NumbersOrder"></a>NumbersOrder</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#library(aplpack)</span></span><br><span class="line"><span class="comment"># stem(marks, scale = 0.5, width = 100)</span></span><br><span class="line"><span class="comment">#      the defalut in separated each group from 1-4 and 5-9. see page 7.</span></span><br><span class="line"><span class="comment"># stem.leaf(marks)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the value of ordered values</span></span><br><span class="line">wordLeaders &lt;- <span class="built_in">c</span>(<span class="number">62</span>,<span class="number">65</span>,<span class="number">65</span>,<span class="number">65</span>,<span class="number">66</span>,<span class="number">67</span>,<span class="number">68</span>,<span class="number">72</span>,<span class="number">73</span>,<span class="number">73</span>)</span><br><span class="line">n &lt;- <span class="built_in">length</span>(wordLeaders)</span><br><span class="line">p &lt;- ppoints(n)</span><br><span class="line">plot(x = p, y = wordLeaders, type = <span class="string">&quot;o&quot;</span>, lwd = <span class="number">2</span>,</span><br><span class="line">     col = <span class="string">&quot;grey10&quot;</span>, xlab = <span class="string">&quot;proportions&quot;</span>, ylab = <span class="string">&quot;height in inches&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;heights of world leaders&quot;</span>)</span><br><span class="line"><span class="comment"># n &lt;- length(marks)</span></span><br><span class="line"><span class="comment"># p &lt;- ppoints(n)</span></span><br><span class="line"><span class="comment"># plot(x = p, y = sort(marks), type = &quot;o&quot;, lwd = 2, col = &quot;grey10&quot;,</span></span><br><span class="line"><span class="comment">#     xlab = &quot;proportion p&quot;, xlim = c(0,1), ylim = c(0, 100),</span></span><br><span class="line"><span class="comment">#     main = &quot;empirical qunatile function for the final grades&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># quantile plot for marks data</span></span><br><span class="line">data(<span class="string">&quot;sittingHeights&quot;</span>, package = <span class="string">&quot;qqtest&quot;</span>)</span><br><span class="line">with(sittingHeights,</span><br><span class="line">     plot(percentCumulative, upperBound, type = <span class="string">&quot;o&quot;</span>, lwd = <span class="number">2</span>,</span><br><span class="line">          xlim = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">100</span>), ylim = <span class="built_in">c</span>(<span class="number">27</span>, <span class="number">38</span>),</span><br><span class="line">          xlab = <span class="string">&quot;percentage of women&quot;</span>,</span><br><span class="line">          ylab = <span class="string">&quot;sitting heights in inches&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># air quality measurements</span></span><br><span class="line">qvals &lt;- sort(airquality$Solar.R)</span><br><span class="line">n &lt;- <span class="built_in">length</span>(qvals)</span><br><span class="line">pvals &lt;- ppoints(n)</span><br><span class="line"></span><br><span class="line">plot(pvals, qvals,</span><br><span class="line">     main = <span class="string">&quot;solar radiation in central park&quot;</span>,</span><br><span class="line">     xlab = <span class="string">&quot;cumulative proportion&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;radiation (Langleys)&quot;</span>)</span><br><span class="line"><span class="comment"># comments : very dense at the bottom, but not on the top</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># old faithful geyser</span></span><br><span class="line">data(<span class="string">&quot;geyser&quot;</span>, package = <span class="string">&quot;MASS&quot;</span>)</span><br><span class="line">qvals &lt;- sort(geyser$duration)</span><br><span class="line">n &lt;- <span class="built_in">length</span>(qvals)</span><br><span class="line">pvals &lt;- ppoints(n)</span><br><span class="line">plot(pvals, qvals, cex = <span class="number">1.5</span>,</span><br><span class="line">     main = <span class="string">&quot;quantile plot of old faithful eruptions&quot;</span>,</span><br><span class="line">     xlab = <span class="string">&quot;cumulative proportion&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;duration (minutes)&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Histograms"><a href="#Histograms" class="headerlink" title="Histograms"></a>Histograms</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">drawbox &lt;- <span class="keyword">function</span>(x,y,...)&#123;</span><br><span class="line">  xvals &lt;- <span class="built_in">c</span>(x, reve(x), x[<span class="number">1</span>])</span><br><span class="line">  yvals &lt;- <span class="built_in">c</span>(<span class="built_in">rep</span>(y, each = <span class="number">2</span>), y[<span class="number">1</span>])</span><br><span class="line">  lines(xvals, yvals, ...)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#  the emprical cumulative distirbution</span></span><br><span class="line">plot(x = sort(marks), y = ppoints(<span class="built_in">length</span>(marks)), type =<span class="string">&quot;o&quot;</span>,</span><br><span class="line">     col = <span class="string">&quot;grey10&quot;</span>, xlab = <span class="string">&quot;final grade&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;proportion&quot;</span>, main = <span class="string">&quot;empirical distribution function&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># in r, the function ecdf() produces the empirical distribution function from</span></span><br><span class="line"><span class="comment"># any collection of numbers</span></span><br><span class="line">Fhat &lt;- ecdf(marks)</span><br><span class="line">plot(Fhat,type =<span class="string">&quot;o&quot;</span>,</span><br><span class="line">     col = <span class="string">&quot;grey10&quot;</span>, xlab = <span class="string">&quot;final grade&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;proportion&quot;</span>, main = <span class="string">&quot;empirical distribution function&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># histogram</span></span><br><span class="line">data(<span class="string">&quot;geyser&quot;</span>, package = <span class="string">&quot;MASS&quot;</span>)</span><br><span class="line">plot_colour &lt;- <span class="string">&quot;grey50&quot;</span></span><br><span class="line">with(geyser,</span><br><span class="line">     hist(duration, col = plot_colour, xlim = extendrange(duration),</span><br><span class="line">          main = <span class="string">&quot;old faithful&quot;</span>,xlab =<span class="string">&quot;duration&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># change the brak points     </span></span><br><span class="line">with(geyser,</span><br><span class="line">     hist(duration, col = plot_colour, xlim = extendrange(duration),</span><br><span class="line">          breaks = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">0.5</span>,<span class="number">1.0</span>,<span class="number">2.75</span>,<span class="number">3</span>,<span class="number">3.5</span>,<span class="number">4</span>,<span class="number">4.5</span>,<span class="number">5</span>,<span class="number">6.0</span>),</span><br><span class="line">          main = <span class="string">&quot;old faithful&quot;</span>,xlab =<span class="string">&quot;duration&quot;</span>))     </span><br><span class="line"></span><br><span class="line"><span class="comment"># change the starting point in histogram</span></span><br><span class="line">savepar &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">with(geyser,</span><br><span class="line">     <span class="keyword">for</span> (start <span class="keyword">in</span> seq(<span class="number">0</span>,<span class="number">0.4</span>,<span class="number">0.1</span>))</span><br><span class="line">       &#123;</span><br><span class="line">       hist(duration,</span><br><span class="line">            breaks = seq(start, <span class="number">6.0</span>,<span class="number">0.5</span>),</span><br><span class="line">            probability = <span class="literal">TRUE</span>,</span><br><span class="line">            xlim = <span class="built_in">c</span>(<span class="number">0</span>, <span class="number">6</span>),</span><br><span class="line">            ylim = <span class="built_in">c</span>(<span class="number">0</span>, <span class="number">0.7</span>),</span><br><span class="line">            main = <span class="string">&quot;&quot;</span>,</span><br><span class="line">            xlab = <span class="string">&quot;duration&quot;</span>)</span><br><span class="line">     &#125;)</span><br><span class="line"></span><br><span class="line">par(savepar)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># interactive histograms with loon package</span></span><br><span class="line">library(loon)</span><br><span class="line">data(<span class="string">&quot;geyser&quot;</span>, package = <span class="string">&quot;MASS&quot;</span>)</span><br><span class="line">with(geyser,</span><br><span class="line">     &#123;l_hist(duration,</span><br><span class="line">             yshows = <span class="string">&quot;density&quot;</span>,</span><br><span class="line">             showBinHandle = <span class="literal">TRUE</span>,</span><br><span class="line">             xlab = <span class="string">&quot;duration of eruption (minutes)&quot;</span>,</span><br><span class="line">             title = <span class="string">&quot;old faithful geyser&quot;</span>,</span><br><span class="line">             showScales = <span class="literal">TRUE</span>,</span><br><span class="line">             showGuides = <span class="literal">TRUE</span>,</span><br><span class="line">             linkingGroup = <span class="string">&quot;old faithful&quot;</span></span><br><span class="line">             )&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># show uncertainty due to bin locations</span></span><br><span class="line"><span class="comment"># blurness suggests uncertainty</span></span><br><span class="line">data(<span class="string">&quot;geyser&quot;</span>, package = <span class="string">&quot;MASS&quot;</span>)</span><br><span class="line">Nstarts &lt;- 5</span><br><span class="line">start_values &lt;- seq(<span class="number">0</span>,<span class="number">0.4</span>, length.out = Nstarts)</span><br><span class="line">plot_colour_transparent &lt;- adjustcolor(plot_colour, alpha.f = <span class="number">1</span>/Nstarts)</span><br><span class="line">with(geyser,</span><br><span class="line">     <span class="keyword">for</span> (start <span class="keyword">in</span> start_values)</span><br><span class="line">       &#123;<span class="keyword">if</span> (start == <span class="number">0</span>)</span><br><span class="line">         &#123;hist(duration,</span><br><span class="line">               breaks = seq(start, <span class="number">6.0</span>, <span class="number">0.5</span>),</span><br><span class="line">               col = plot_colour_transparent,</span><br><span class="line">               border = adjustcolor(plot_colour_transparent, <span class="number">0.0</span>),</span><br><span class="line">               probability = <span class="literal">TRUE</span>,</span><br><span class="line">               xlim = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">7</span>), ylim = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">0.7</span>),</span><br><span class="line">               main = <span class="string">&quot;&quot;</span>,xlab = <span class="string">&quot;duration&quot;</span>)</span><br><span class="line"></span><br><span class="line">       &#125; <span class="keyword">else</span> &#123; <span class="comment">#add the histogram to the existing plot</span></span><br><span class="line">         hist(duration,</span><br><span class="line">              breaks = seq(start, <span class="number">6.0</span>, <span class="number">0.5</span>),</span><br><span class="line">              col = plot_colour_transparent,</span><br><span class="line">              border = adjustcolor(plot_colour_transparent, <span class="number">0.0</span>),</span><br><span class="line">              probability = <span class="literal">TRUE</span>,</span><br><span class="line">              add = <span class="literal">TRUE</span>)</span><br><span class="line">       &#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># averaging over histograms as the bins change</span></span><br><span class="line">hist &lt;- hist(geyser$duration,breaks=seq(<span class="number">0.0</span>,<span class="number">6.0</span>,<span class="number">0.5</span>),</span><br><span class="line">             plot = <span class="literal">FALSE</span>)</span><br><span class="line"><span class="comment"># str(hist) #gives the summary of the structure</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the function averages the shifted histograms</span></span><br><span class="line">ash &lt;- <span class="keyword">function</span>(x, n_hists = <span class="number">5</span>, binwidth = <span class="literal">NULL</span>,</span><br><span class="line">                type = <span class="string">&quot;l&quot;</span>, xlab = <span class="string">&quot;x&quot;</span>, main = <span class="string">&quot;average shifted histogram&quot;</span>,</span><br><span class="line">                ylab = <span class="string">&quot;averaged&quot;</span>, lwd = <span class="number">2</span>, lty = <span class="number">1</span>, xlim, ylim,</span><br><span class="line">                col = <span class="string">&quot;grey50&quot;</span>, fill, ...)&#123;</span><br><span class="line">  xrange &lt;- <span class="built_in">round</span>(extendrange(x), <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(binwidth)) binwidth &lt;- diff(xrange) / <span class="number">10</span></span><br><span class="line">  delta &lt;- binwidth/n_hists</span><br><span class="line">  xmin &lt;- <span class="built_in">min</span>(xrange) - binwidth</span><br><span class="line">  xmax &lt;- <span class="built_in">max</span>(xrange) + binwidth</span><br><span class="line">  breaks &lt;- seq(xmin, xmax -binwidth, binwidth)</span><br><span class="line">  n_breaks &lt;- <span class="built_in">length</span>(breaks)</span><br><span class="line"></span><br><span class="line">  <span class="comment">## x values where density will be calculated and averaged</span></span><br><span class="line">  xvals &lt;- seq(xmin, xmax-delta, delta)</span><br><span class="line">  n_xvals &lt;- <span class="built_in">length</span>(xvals)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># total density will be numeric, this is where we store a total density for</span></span><br><span class="line">  <span class="comment">#    each xval</span></span><br><span class="line">  density &lt;- numeric(n_xvals)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># the loop over the histograms to get densities, add them up</span></span><br><span class="line">  <span class="comment"># the indices of x have n_hists fewer values becasue there are</span></span><br><span class="line">  <span class="comment"># n_hists shifts in the summing</span></span><br><span class="line">  x_indices &lt;- seq(<span class="number">1</span>,n_xvals-n_hists)</span><br><span class="line">  <span class="keyword">for</span> ( i <span class="keyword">in</span>  seq(<span class="number">0</span>, n_hists - <span class="number">1</span>)) &#123;</span><br><span class="line">    cur_hist &lt;- hist(x, breaks=breaks+delta*i, plot = <span class="literal">FALSE</span>)</span><br><span class="line">    density[i+x_indices] &lt;-</span><br><span class="line">      <span class="comment"># current values</span></span><br><span class="line">      density[i + x_indices] +</span><br><span class="line">       <span class="comment">## add the density from the current histogram</span></span><br><span class="line">      <span class="comment">## rep: repeatsnthe data returned by its first arguement</span></span><br><span class="line">  <span class="built_in">rep</span>(cur_hist$density, <span class="built_in">rep</span>(n_hists, n_breaks - <span class="number">1</span>))</span><br><span class="line">  &#125;</span><br><span class="line">  density &lt;- density/n_hists</span><br><span class="line">  <span class="comment"># plot the averages, and check for missing arguments</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">missing</span>(xlim)) xlim &lt;- xrange</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">missing</span>(ylim)) ylim &lt;- extendrange(density)</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">missing</span>(fill)) fill &lt;- col</span><br><span class="line">  plot(<span class="built_in">rep</span>(xvals, each = <span class="number">2</span>) + <span class="built_in">rep</span>(<span class="built_in">c</span>(-delta/<span class="number">2</span>, delta/<span class="number">2</span>), <span class="built_in">length</span>(xvals)),</span><br><span class="line">       <span class="built_in">rep</span>(density, each = <span class="number">2</span>), type = type,</span><br><span class="line">       xlim = xlim, ylim = ylim, xlab = xlab, ylab = ylab, main = main,</span><br><span class="line">       lwd = lwd, lty = lty, col = col,</span><br><span class="line">       bty = <span class="string">&quot;n&quot;</span>, ...)</span><br><span class="line">  <span class="comment"># and fill it in</span></span><br><span class="line">  polygon(<span class="built_in">rep</span>(xvals, each = <span class="number">2</span>) + <span class="built_in">rep</span>(<span class="built_in">c</span>(-delta/<span class="number">2</span>, delta/<span class="number">2</span>), <span class="built_in">length</span>(xvals)),</span><br><span class="line">          <span class="built_in">rep</span>(density, each = <span class="number">2</span>), col =fill)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">savePar &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">with(geyser,</span><br><span class="line">     &#123;<span class="keyword">for</span>(start <span class="keyword">in</span> seq(<span class="number">0</span>,<span class="number">0.4</span>,<span class="number">0.1</span>))</span><br><span class="line">     &#123;hist(duration,</span><br><span class="line">           breaks=seq(start,<span class="number">6.0</span>,<span class="number">0.5</span>),</span><br><span class="line">           col = plot_colour,</span><br><span class="line">           probability = <span class="literal">TRUE</span>,</span><br><span class="line">           xlim = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">6</span>),</span><br><span class="line">           ylim = <span class="built_in">c</span>(<span class="number">0</span>, <span class="number">0.7</span>),</span><br><span class="line">           main = <span class="string">&quot;&quot;</span>,</span><br><span class="line">           xlab = <span class="string">&quot;duration&quot;</span></span><br><span class="line">           )  </span><br><span class="line">     &#125;</span><br><span class="line">       ash(duration, main=<span class="string">&quot;&quot;</span>,xlab = <span class="string">&quot;duration&quot;</span>, xlim = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">6</span>),</span><br><span class="line">           ylim=<span class="built_in">c</span>(<span class="number">0</span>,<span class="number">0.7</span>))</span><br><span class="line">       &#125;</span><br><span class="line">     )  </span><br><span class="line">par(savePar)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># weight function, this returns the weights alone or the weights and information</span></span><br><span class="line"><span class="comment"># on how to draw them as a function of x</span></span><br><span class="line">ashweights &lt;- <span class="keyword">function</span>(m,h,k=<span class="number">0</span>)&#123;</span><br><span class="line">  <span class="comment"># k is the subscript of the central bin containing x, B_k,</span></span><br><span class="line">  <span class="comment"># m is the number of histograms</span></span><br><span class="line">  <span class="comment"># h is the bin width in each of the m histograms being averaged</span></span><br><span class="line">  indices &lt;- seq(<span class="number">1</span>-m, m-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">  wts &lt;- 1-<span class="built_in">abs</span>(indices)/m</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">missing</span>(h))&#123;</span><br><span class="line">    width &lt;- h/m</span><br><span class="line">    hts &lt;- <span class="built_in">rep</span>(<span class="built_in">c</span>(<span class="number">0</span>, wts, <span class="number">0</span>), each = <span class="number">2</span>)</span><br><span class="line">    bins &lt;- <span class="built_in">c</span>(-m, <span class="built_in">rep</span>(<span class="built_in">c</span>(indices, m), each = <span class="number">2</span>), m+<span class="number">1</span>) * width + k</span><br><span class="line">    <span class="built_in">list</span>(wts = wts, bins = bins, hts = hts)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">list</span>(wts = wts)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># when m = 4, the weights are</span></span><br><span class="line">ashweights(m = <span class="number">4</span>)$wts</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw the weighted function</span></span><br><span class="line">h &lt;- 0.5</span><br><span class="line">m &lt;- 4</span><br><span class="line">ashInfo &lt;- ashweights(m = m, h = h, k = <span class="number">0</span>)</span><br><span class="line">w_hts &lt;- ashInfo$hts</span><br><span class="line">B_bins &lt;- ashInfo$bins</span><br><span class="line"></span><br><span class="line">plot(B_bins, w_hts, type = <span class="string">&quot;l&quot;</span>,</span><br><span class="line">     main = <span class="built_in">expression</span>(<span class="string">&quot;ASH weight function for&quot;</span> ~ x %in% B[<span class="number">0</span>]),</span><br><span class="line">     ylab = <span class="string">&quot;weights&quot;</span>, xlab = <span class="string">&quot;x&quot;</span>,</span><br><span class="line">     col = <span class="string">&quot;firebrick&quot;</span>)</span><br><span class="line">lines(<span class="built_in">c</span>(<span class="number">0</span>,<span class="number">0</span>), <span class="built_in">c</span>(<span class="number">0</span>, <span class="built_in">max</span>(w_hts)), lty = <span class="number">2</span>)</span><br><span class="line">lines(<span class="built_in">rep</span>(h/m,<span class="number">2</span>), <span class="built_in">c</span>(<span class="number">0</span>, <span class="built_in">max</span>(w_hts)), lty = <span class="number">2</span>)</span><br><span class="line">text(<span class="number">0.5</span>*(h/m), <span class="number">0.1</span>, labels = <span class="built_in">expression</span>(B[<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># the weight is highest for the count of x in B_0, and decreases symmetrically</span></span><br><span class="line"><span class="comment">#  for m-1 small bins on either side</span></span><br></pre></td></tr></table></figure>

<h2 id="visual-comparisons"><a href="#visual-comparisons" class="headerlink" title="visual comparisons"></a>visual comparisons</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">library(knitr)</span><br><span class="line">classTable &lt;- apply(Titanic,MARGIN = <span class="built_in">c</span>(<span class="number">4</span>,<span class="number">1</span>), FUN = <span class="built_in">sum</span>)</span><br><span class="line">kable(classTable)</span><br><span class="line"></span><br><span class="line"><span class="comment"># number in each class is</span></span><br><span class="line">classTotals &lt;- apply(classTable, MARGIN = <span class="number">2</span>, FUN =<span class="built_in">sum</span>)</span><br><span class="line">classSurvival &lt;- t(classTable[<span class="string">&quot;Yes&quot;</span>, ]/classTotals)</span><br><span class="line">rownames(classSurvival) &lt;- <span class="built_in">c</span>(<span class="string">&quot;survived&quot;</span>)</span><br><span class="line">kable(classSurvival)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># follw the rules for tables, a better way to present these numbers is</span></span><br><span class="line">newTable &lt;- 100 * <span class="built_in">round</span>(classSurvival, <span class="number">2</span>)</span><br><span class="line">newTable &lt;- t(newTable)</span><br><span class="line"><span class="comment"># descendeing order</span></span><br><span class="line">descendingOrder &lt;- order(newTable, decreasing = <span class="literal">TRUE</span>)</span><br><span class="line">newTable &lt;- newTable[descendingOrder, ,drop = <span class="literal">FALSE</span>] <span class="comment"># note drop argument</span></span><br><span class="line">colnames(newTable) &lt;- <span class="built_in">c</span>(<span class="string">&quot;% survived&quot;</span>)</span><br><span class="line">kable(newTable, caption = <span class="string">&quot;survival rates on the titanic by class&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># as lengths of bars, colour coded and labelled by class</span></span><br><span class="line">nvals &lt;- nrow(newTable)</span><br><span class="line">col &lt;- rainbow(nvals, alpha = <span class="number">0.5</span>)</span><br><span class="line">barplot(newTable, col = col, horiz = <span class="literal">TRUE</span>, axes = <span class="literal">FALSE</span>,</span><br><span class="line">        names.arg = <span class="built_in">c</span>(<span class="string">&quot;&quot;</span>), xlab = colnames(newTable))</span><br><span class="line">xlocs &lt;- <span class="built_in">cumsum</span>(newTable)</span><br><span class="line">centres &lt;- <span class="built_in">c</span>(xlocs[<span class="number">1</span>]/<span class="number">2</span>, xlocs[<span class="number">1</span>:(nvals - <span class="number">1</span>)] + diff(xlocs)/<span class="number">2</span>)</span><br><span class="line">text(centres, <span class="number">0.75</span>, labels = rownames(newTable))</span><br><span class="line"></span><br><span class="line">barplot(newTable, col = col, horiz = <span class="literal">TRUE</span>, beside = <span class="literal">TRUE</span>,</span><br><span class="line">        names.arg = <span class="built_in">c</span>(<span class="string">&quot;&quot;</span>),</span><br><span class="line">        xlab = colnames(newTable),</span><br><span class="line">        legend.text = rownames(newTable))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the titanic - survivors beside deaths</span></span><br><span class="line">survivalProportions &lt;- classTable</span><br><span class="line">survivalProportions[<span class="string">&quot;Yes&quot;</span>,] &lt;- survivalProportions[<span class="string">&quot;Yes&quot;</span>, ]/classTotals</span><br><span class="line">survivalProportions[<span class="string">&quot;No&quot;</span>,] &lt;- survivalProportions[<span class="string">&quot;No&quot;</span>, ]/classTotals</span><br><span class="line">survivalCols &lt;- adjustcolor(<span class="built_in">c</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;grey&quot;</span>), <span class="number">0.5</span>)</span><br><span class="line">barplot(survivalProportions, col = survivalCols,</span><br><span class="line">        horiz = <span class="literal">TRUE</span>, beside = <span class="literal">TRUE</span>,</span><br><span class="line">        xlab = <span class="string">&quot;proportion of class&quot;</span>, xlim = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">1</span>))</span><br><span class="line">legend(<span class="string">&quot;bottomright&quot;</span>, title = <span class="string">&quot;survival&quot;</span>, fill = survivalCols,</span><br><span class="line">       legend = rownames(survivalProportions))</span><br><span class="line"></span><br><span class="line"><span class="comment"># survivor and deaths within a common frame</span></span><br><span class="line"><span class="comment"># there ia a framing effect which makes proportions very easy to compare</span></span><br><span class="line"><span class="comment"># from one end or the other</span></span><br><span class="line"><span class="comment"># all are along common aligned scales</span></span><br><span class="line"></span><br><span class="line">barplot(survivalProportions, col = survivalCols,</span><br><span class="line">        horiz = <span class="literal">TRUE</span>, beside = <span class="literal">FALSE</span>,</span><br><span class="line">        xlab = <span class="string">&quot;proportion of class&quot;</span>, space = <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">barplot(apply(classTable, MARGIN = <span class="number">2</span>, FUN =<span class="built_in">sum</span>),</span><br><span class="line">        col = adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.5</span>),</span><br><span class="line">        xlab = <span class="string">&quot;class&quot;</span>, ylab = <span class="string">&quot;number of passengers&quot;</span>)</span><br><span class="line">barplot(classTable, col=survivalCols, xlab = <span class="string">&quot;class&quot;</span>, ylab = <span class="string">&quot;numebr of passengers&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library(loon.data)</span><br><span class="line">data(<span class="string">&quot;SAheart&quot;</span>, package = <span class="string">&quot;loon.data&quot;</span>)</span><br><span class="line">kable(head(SAheart))</span><br><span class="line"></span><br><span class="line">noFamilyHistory &lt;- SAheart[,<span class="string">&quot;famhist&quot;</span>] == <span class="string">&quot;Absent&quot;</span></span><br><span class="line">FamilyHistory &lt;- SAheart[,<span class="string">&quot;famhist&quot;</span>] == <span class="string">&quot;Present&quot;</span></span><br><span class="line">famHIsotryCol &lt;- adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.5</span>)</span><br><span class="line">noHistoryCol &lt;- adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.5</span>)</span><br><span class="line">boxplot(SAheart[noFamilyHistory, <span class="string">&quot;sbp&quot;</span>], col = famHIsotryCol,</span><br><span class="line">        main = <span class="string">&quot;No family history&quot;</span>, horizontal = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># use formula notation y~x and a single data set, on common aligned scales</span></span><br><span class="line">boxplot(sbp~famhist, data = SAheart, col = <span class="built_in">c</span>(noHistoryCol, famHIsotryCol),</span><br><span class="line">        main = <span class="string">&quot;systolic blood pressure&quot;</span>, horizontal = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data=SAheart, mapping = aes(x=famhist, y = sbp)) +</span><br><span class="line">  geom_boxplot(colour = <span class="built_in">c</span>(<span class="string">&quot;firebrick&quot;</span>, <span class="string">&quot;steelblue&quot;</span>),</span><br><span class="line">               fill = <span class="built_in">c</span>(<span class="string">&quot;firebrick&quot;</span>, <span class="string">&quot;steelblue&quot;</span>),</span><br><span class="line">               alpha = <span class="number">0.5</span>) +</span><br><span class="line">  coord_flip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hist(SAheart[noFamilyHistory, <span class="string">&quot;sbp&quot;</span>], col = noHistoryCol,</span><br><span class="line">     main = <span class="string">&quot;No family history&quot;</span>,</span><br><span class="line">     xlab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     xlim = extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>]), ylim = <span class="built_in">c</span>(<span class="number">0</span>, <span class="number">60</span>))</span><br><span class="line"><span class="comment"># when use par(mfrow = c(2,1)) , means not on common scale</span></span><br><span class="line"><span class="comment"># put on common scale as follows</span></span><br><span class="line">hist(SAheart[noFamilyHistory, <span class="string">&quot;sbp&quot;</span>], col = noHistoryCol,</span><br><span class="line">     main = <span class="string">&quot;No family history&quot;</span>,</span><br><span class="line">     xlim = extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>]))</span><br><span class="line">hist(SAheart[FamilyHistory, <span class="string">&quot;sbp&quot;</span>], col = famHIsotryCol,</span><br><span class="line">     xlim = extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>]), add = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reflected histograms</span></span><br><span class="line">xrange &lt;- extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>])</span><br><span class="line">breaks &lt;- seq(xrange[<span class="number">1</span>], xrange[<span class="number">2</span>], length.out = <span class="number">12</span>)</span><br><span class="line">h1 &lt;- hist(SAheart[noFamilyHistory,<span class="string">&quot;sbp&quot;</span>],</span><br><span class="line">           breaks = breaks, plot = <span class="literal">FALSE</span>)</span><br><span class="line">h2 &lt;- hist(SAheart[FamilyHistory,<span class="string">&quot;sbp&quot;</span>],</span><br><span class="line">           breaks = breaks, plot = <span class="literal">FALSE</span>)</span><br><span class="line">hmax = <span class="built_in">max</span>(<span class="built_in">c</span>(h1$counts, h2$counts))</span><br><span class="line">h2$counts &lt;- -h2$counts</span><br><span class="line">hmin = -hmax</span><br><span class="line">X = <span class="built_in">c</span>(h1$breaks, h2$breaks)</span><br><span class="line">xmax &lt;- <span class="built_in">max</span>(X)</span><br><span class="line">xmin = <span class="built_in">min</span>(X)</span><br><span class="line">plot(h1, xlab = <span class="string">&quot;systolic blood pressure&quot;</span>, main = <span class="string">&quot;comapring patients with(blue) and without(pink)&quot;</span>,</span><br><span class="line">     ylim = <span class="built_in">c</span>(hmin, hmax),xlim = <span class="built_in">c</span>(xmin, xmax),</span><br><span class="line">     col = noHistoryCol)</span><br><span class="line">lines(h2, col = famHIsotryCol)</span><br><span class="line"></span><br><span class="line"><span class="comment"># back to back histograms&#x27;</span></span><br><span class="line">yrange &lt;- extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>])</span><br><span class="line">breaks &lt;- seq(yrange[<span class="number">1</span>], yrange[<span class="number">2</span>], length.out = <span class="number">12</span>)</span><br><span class="line">h1 &lt;- hist(SAheart[noFamilyHistory,<span class="string">&quot;sbp&quot;</span>],</span><br><span class="line">           breaks = breaks, plot = <span class="literal">FALSE</span>)</span><br><span class="line">h2 &lt;- hist(SAheart[FamilyHistory,<span class="string">&quot;sbp&quot;</span>],</span><br><span class="line">           breaks = breaks, plot = <span class="literal">FALSE</span>)</span><br><span class="line">nbreaks &lt;- <span class="built_in">length</span>(breaks)</span><br><span class="line">hmax = <span class="built_in">max</span>(<span class="built_in">c</span>(h1$counts, h2$counts))</span><br><span class="line">h2$counts &lt;- -h2$counts</span><br><span class="line">hmin = -hmax</span><br><span class="line">Y &lt;- <span class="built_in">rep</span>(h1$breaks, each = <span class="number">2</span>)</span><br><span class="line">X &lt;- <span class="built_in">c</span>(<span class="number">0</span>,<span class="built_in">rep</span>(h1$counts, each = <span class="number">2</span>), <span class="number">0</span>)</span><br><span class="line">plot(<span class="built_in">rep</span>(<span class="number">0</span>,<span class="number">2</span>), <span class="built_in">range</span>(Y), type = <span class="string">&quot;l&quot;</span>, col = <span class="string">&quot;black&quot;</span>,</span><br><span class="line">     xlim = <span class="built_in">c</span>(hmin, hmax), ylim = extendrange(Y),</span><br><span class="line">     bty = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">     xlab = <span class="string">&quot;frequency&quot;</span>, ylab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;comparing patients with and without&quot;</span>)</span><br><span class="line">polygon(X, Y, col = noHistoryCol)</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:nbreaks)&#123;lines(<span class="built_in">c</span>(<span class="number">0</span>, h1$counts[i]), <span class="built_in">c</span>(<span class="built_in">rep</span>(h1$breaks[i+<span class="number">1</span>], <span class="number">2</span>)))&#125;</span><br><span class="line">Y &lt;- <span class="built_in">rep</span>(h2$breaks, each = <span class="number">2</span>)</span><br><span class="line">X &lt;- <span class="built_in">c</span>(<span class="number">0</span>,<span class="built_in">rep</span>(h2$counts, each = <span class="number">2</span>), <span class="number">0</span>)</span><br><span class="line">polygon(X, Y, col = famHIsotryCol)</span><br><span class="line"><span class="keyword">for</span>(i <span class="keyword">in</span> <span class="number">1</span>:nbreaks)&#123;lines(<span class="built_in">c</span>(<span class="number">0</span>,h2$counts[i]), <span class="built_in">c</span>(<span class="built_in">rep</span>(h2$breaks[i+<span class="number">1</span>],<span class="number">2</span>)))&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># using facet with ggplot2</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data =SAheart, mapping = aes(x =sbp)) +</span><br><span class="line">  geom_histogram(bins =<span class="number">12</span>,</span><br><span class="line">                 colour = <span class="string">&quot;grey50&quot;</span>,</span><br><span class="line">                 fill=<span class="string">&quot;white&quot;</span>) +</span><br><span class="line">  facet_grid(famhist~.)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># what can be compared via density estimates</span></span><br><span class="line">savepAr &lt;- par(mfrow=<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">densAbsent &lt;- density(SAheart[noFamilyHistory,<span class="string">&quot;sbp&quot;</span>], bw = <span class="string">&quot;SJ&quot;</span>)</span><br><span class="line">densPresent &lt;- density(SAheart[FamilyHistory,<span class="string">&quot;sbp&quot;</span>], bw = <span class="string">&quot;SJ&quot;</span>)</span><br><span class="line"></span><br><span class="line">plot(densAbsent, col = <span class="string">&quot;firebrick&quot;</span>, main = <span class="string">&quot;no family history&quot;</span>)</span><br><span class="line">polygon(densAbsent, col = noHistoryCol)</span><br><span class="line">plot(densPresent, col = <span class="string">&quot;steelblue&quot;</span>, main = <span class="string">&quot;family history&quot;</span>)</span><br><span class="line">polygon(densPresent, col = famHIsotryCol)</span><br><span class="line">par(savepAr)</span><br><span class="line"><span class="comment"># note the scales are not necesssarily identical</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># compare both x,y aligned x only scales</span></span><br><span class="line">savep &lt;- par(mfrow=<span class="built_in">c</span>(<span class="number">2</span>,<span class="number">1</span>))</span><br><span class="line">xlim &lt;- extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>])</span><br><span class="line">ylim &lt;- extendrange(<span class="built_in">c</span>(densAbsent$y, densPresent$y))</span><br><span class="line">plot(densAbsent, col = <span class="string">&quot;firebrick&quot;</span>, main = <span class="string">&quot;no family history&quot;</span>,</span><br><span class="line">     xlim = xlim, ylim = ylim)</span><br><span class="line">polygon(densAbsent, col = noHistoryCol)</span><br><span class="line">plot(densPresent, col = <span class="string">&quot;steelblue&quot;</span>,main = <span class="string">&quot;family history&quot;</span>,</span><br><span class="line">     xlim = xlim, ylim = ylim)</span><br><span class="line">polygon(densPresent, col = famHIsotryCol)</span><br><span class="line">par(savep)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># common aligned scales</span></span><br><span class="line">plot(densAbsent, col = <span class="string">&quot;firebrick&quot;</span>, xlab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;comparing a no family history with family history&quot;</span>,</span><br><span class="line">     xlim = xlim, ylim = ylim)</span><br><span class="line">polygon(densAbsent, col = noHistoryCol)</span><br><span class="line">lines(densPresent, col = <span class="string">&quot;steelblue&quot;</span>)</span><br><span class="line">polygon(densPresent, col = famHIsotryCol)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># common aligned scales-reflected</span></span><br><span class="line">densPresent$y &lt;- - densPresent$y</span><br><span class="line">ylim2 &lt;- extendrange(<span class="built_in">c</span>(densAbsent$y, densPresent$y))</span><br><span class="line">plot(densAbsent, col = <span class="string">&quot;firebrick&quot;</span>, xlab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;comparing a no family history with family history&quot;</span>,</span><br><span class="line">     xlim = xlim, ylim = ylim2)</span><br><span class="line">polygon(densAbsent, col = noHistoryCol)</span><br><span class="line">lines(densPresent, col = <span class="string">&quot;steelblue&quot;</span>)</span><br><span class="line">polygon(densPresent, col = famHIsotryCol)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># back to back</span></span><br><span class="line">ylim3 &lt;- extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>])</span><br><span class="line">xlim2 &lt;- extendrange(<span class="built_in">c</span>(densAbsent$y, densPresent$y))</span><br><span class="line">xyswitch &lt;- <span class="keyword">function</span>(xy_thing)&#123;</span><br><span class="line">  yx_thing &lt;- xy_thing</span><br><span class="line">  yx_thing$x &lt;- xy_thing$y</span><br><span class="line">  yx_thing$y &lt;- xy_thing$x</span><br><span class="line">  yx_thing</span><br><span class="line">&#125;</span><br><span class="line">plot(xyswitch(densAbsent), col = <span class="string">&quot;firebrick&quot;</span>, xlab = <span class="string">&quot;Density&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;comparing a no family history with family history&quot;</span>,</span><br><span class="line">     xlim = xlim2, ylim = ylim3)</span><br><span class="line">polygon(xyswitch(densAbsent), col = noHistoryCol)</span><br><span class="line">lines(xyswitch(densPresent), col = <span class="string">&quot;steelblue&quot;</span>)</span><br><span class="line">polygon(xyswitch(densPresent), col = famHIsotryCol)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># using facet with ggplot2</span></span><br><span class="line">libarary(ggplot2)</span><br><span class="line">ggplot(data=SAheart, mapping = aes(x=sbp, col = famhist)) +</span><br><span class="line">  geom_density(colour = <span class="string">&quot;grey50&quot;</span>,</span><br><span class="line">               fill = <span class="string">&quot;black&quot;</span>,</span><br><span class="line">               alpha = <span class="number">0.4</span>,</span><br><span class="line">               bw = <span class="string">&quot;SJ&quot;</span>) +</span><br><span class="line">  facet_grid(famhist~.)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># simple points</span></span><br><span class="line">xlim &lt;- extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>])</span><br><span class="line">n &lt;- nrow(SAheart)</span><br><span class="line">col = <span class="built_in">rep</span>(adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.2</span>),n)</span><br><span class="line">col[FamilyHistory] &lt;- adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.2</span>)</span><br><span class="line">Y &lt;- <span class="built_in">rep</span>(<span class="number">1</span>,n)</span><br><span class="line">Y[FamilyHistory] &lt;- -<span class="number">1</span></span><br><span class="line">plot(SAheart[,<span class="string">&quot;sbp&quot;</span>], y = Y, col = col, pch = <span class="number">19</span>, cex = <span class="number">3</span>,</span><br><span class="line">     xlab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;comparing a no family history with family history&quot;</span>,</span><br><span class="line">     xlim = xlim, ylim = <span class="built_in">c</span>(-<span class="number">2</span>,<span class="number">2</span>), bty = <span class="string">&quot;n&quot;</span>, yaxt = <span class="string">&quot;n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># simple points with jittering</span></span><br><span class="line"></span><br><span class="line">xlim &lt;- extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>])</span><br><span class="line">n &lt;- nrow(SAheart)</span><br><span class="line">col = <span class="built_in">rep</span>(adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.2</span>),n)</span><br><span class="line">col[FamilyHistory] &lt;- adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.2</span>)</span><br><span class="line">Y &lt;- <span class="built_in">rep</span>(<span class="number">1</span>,n)</span><br><span class="line">Y[FamilyHistory] &lt;- -<span class="number">1</span></span><br><span class="line">U &lt;- runif(n, -<span class="number">0.3</span>,<span class="number">0.3</span>)</span><br><span class="line">plot(SAheart[,<span class="string">&quot;sbp&quot;</span>], y = Y + U, col = col, pch = <span class="number">19</span>, cex = <span class="number">3</span>,</span><br><span class="line">     xlab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;comparing a no family history with family history&quot;</span>,</span><br><span class="line">     xlim = xlim, ylim = <span class="built_in">c</span>(-<span class="number">2</span>,<span class="number">2</span>), bty = <span class="string">&quot;n&quot;</span>, yaxt = <span class="string">&quot;n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># quantile plots</span></span><br><span class="line">savePar &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">nAbsent &lt;- <span class="built_in">sum</span>(noFamilyHistory)</span><br><span class="line">nPresent &lt;- <span class="built_in">sum</span>(FamilyHistory)</span><br><span class="line">pAbsent &lt;- ppoints(nAbsent)</span><br><span class="line">pPresent &lt;- ppoints(nPresent)</span><br><span class="line"></span><br><span class="line">plot(pAbsent,sort(SAheart[noFamilyHistory, <span class="string">&quot;sbp&quot;</span>]), type = <span class="string">&quot;b&quot;</span>,</span><br><span class="line">     col = noHistoryCol, pch =<span class="number">19</span>,</span><br><span class="line">     xlab = <span class="string">&quot;cumulative proportion&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;no family histroy&quot;</span>)</span><br><span class="line"></span><br><span class="line">plot(pPresent,sort(SAheart[FamilyHistory, <span class="string">&quot;sbp&quot;</span>]), type = <span class="string">&quot;b&quot;</span>,</span><br><span class="line">     col = famHIsotryCol, pch =<span class="number">19</span>,</span><br><span class="line">     xlab = <span class="string">&quot;cumulative proportion&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;family histroy&quot;</span>)</span><br><span class="line">par(savePar)</span><br><span class="line"></span><br><span class="line"><span class="comment"># quantile plot common aligned scales via overlaying</span></span><br><span class="line">ylim &lt;- extendrange(SAheart[,<span class="string">&quot;sbp&quot;</span>])</span><br><span class="line">nAbsent &lt;- <span class="built_in">sum</span>(noFamilyHistory)</span><br><span class="line">nPresent &lt;- <span class="built_in">sum</span>(FamilyHistory)</span><br><span class="line">pAbsent &lt;- ppoints(nAbsent)</span><br><span class="line">pPresent &lt;- ppoints(nPresent)</span><br><span class="line"></span><br><span class="line">plot(pAbsent,sort(SAheart[noFamilyHistory, <span class="string">&quot;sbp&quot;</span>]), type = <span class="string">&quot;b&quot;</span>,</span><br><span class="line">     col = noHistoryCol, pch =<span class="number">19</span>,</span><br><span class="line">     xlab = <span class="string">&quot;cumulative proportion&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;systolic blood pressure&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;no family histroy&quot;</span>)</span><br><span class="line">points(pPresent, sort(SAheart[FamilyHistory, <span class="string">&quot;sbp&quot;</span>]),</span><br><span class="line">       type = <span class="string">&quot;b&quot;</span>, col = famHIsotryCol, pch =<span class="number">19</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="visual-hypothesis-testing"><a href="#visual-hypothesis-testing" class="headerlink" title="visual hypothesis testing"></a>visual hypothesis testing</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># a function which would achieve this mixing is</span></span><br><span class="line">mixRandomly &lt;- <span class="keyword">function</span>(data)&#123;</span><br><span class="line">  <span class="comment"># note the data need not to be a data frame</span></span><br><span class="line">  <span class="comment"># it is expected to be a list with an x and y component (possibly different lengths)</span></span><br><span class="line">  x &lt;- data$x</span><br><span class="line">  y &lt;- data$y</span><br><span class="line">  m &lt;- <span class="built_in">length</span>(x)</span><br><span class="line">  n &lt;- <span class="built_in">length</span>(y)</span><br><span class="line">  mix &lt;- <span class="built_in">c</span>(x,y)</span><br><span class="line">  select4x &lt;- sample(<span class="number">1</span>:(m+n),</span><br><span class="line">                     m,</span><br><span class="line">                     replace = <span class="literal">FALSE</span>)</span><br><span class="line">  new_x &lt;- mix[select4x]</span><br><span class="line">  new_y &lt;- mix[-select4x]</span><br><span class="line">  <span class="built_in">list</span>(x = new_x, y = new_y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">myplot &lt;- <span class="keyword">function</span>(data) &#123;</span><br><span class="line">  xrange &lt;- extendrange(<span class="built_in">c</span>(data$x, data$y))</span><br><span class="line">  breaks &lt;- seq(xrange[<span class="number">1</span>], xrange[<span class="number">2</span>], length.out = <span class="number">12</span>)</span><br><span class="line">  hx &lt;- hist(data$x, breaks = breaks, plot = <span class="literal">FALSE</span>)</span><br><span class="line">  hy = hist(data$y, breaks = breaks, plot = <span class="literal">FALSE</span>)</span><br><span class="line">  yrange &lt;- extendrange(<span class="built_in">c</span>(hx$counts, hy$counts))</span><br><span class="line"></span><br><span class="line">  plot(hx, main = <span class="string">&quot;&quot;</span>, axes = <span class="literal">FALSE</span>,</span><br><span class="line">       ylab = <span class="string">&quot;&quot;</span>, xlab = <span class="string">&quot;&quot;</span>, xaxt = <span class="string">&quot;n&quot;</span>, yaxt = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">       ylim = yrange, xlim = xrange,</span><br><span class="line">       col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.4</span>))</span><br><span class="line">  lines(hy, col = adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.4</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># apply it</span></span><br><span class="line">library(loon.data)</span><br><span class="line">data(<span class="string">&quot;SAheart&quot;</span>, package = <span class="string">&quot;loon.data&quot;</span>)</span><br><span class="line">Present &lt;- SAheart[, <span class="string">&quot;famhist&quot;</span>] == <span class="string">&quot;Present&quot;</span></span><br><span class="line">x &lt;- SAheart[Present, <span class="string">&quot;sbp&quot;</span>]</span><br><span class="line">y &lt;- SAheart[!Present, <span class="string">&quot;sbp&quot;</span>]</span><br><span class="line">data = <span class="built_in">list</span>(x= x, y=y)</span><br><span class="line"></span><br><span class="line">savePar &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">heads &lt;- runif(<span class="number">1</span>) &gt; <span class="number">0.5</span> <span class="comment"># toss a coin for order</span></span><br><span class="line">tails = !heads</span><br><span class="line"><span class="keyword">if</span> (heads) myplot(data) <span class="keyword">else</span> myplot(mixRandomly(data))</span><br><span class="line"><span class="keyword">if</span> (tails) myplot(mixRandomly(data)) <span class="keyword">else</span> myplot(data)</span><br><span class="line"></span><br><span class="line">par(savePar)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># function to do a line up test</span></span><br><span class="line"></span><br><span class="line">lineup &lt;- <span class="keyword">function</span>(data, showSubject = <span class="literal">NULL</span>, generateSubject = NUll,</span><br><span class="line">                   trueLoc = <span class="literal">NULL</span>, layout = <span class="built_in">c</span>(<span class="number">5</span>,<span class="number">4</span>))&#123;</span><br><span class="line">  nSubjects &lt;- layout[<span class="number">1</span>] *layout[<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(trueLoc)) &#123;trueLoc &lt;- sample(<span class="number">1</span>:nSubjects, <span class="number">1</span>)&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(showSubject)) &#123;stop(<span class="string">&quot;need a plot function for the subject&quot;</span>)&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(generateSubject)) &#123; stop(<span class="string">&quot;need a function to generate subject&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># need to decide which subject to present</span></span><br><span class="line">  presentSubject &lt;- <span class="keyword">function</span>(subjectNo)&#123;</span><br><span class="line">    <span class="keyword">if</span> (subjectNo != trueLoc) &#123;data &lt;- generateSubject(data)&#125;</span><br><span class="line">    showSubject(data, subjectNo)&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># this does the plotting</span></span><br><span class="line">    savePar &lt;- par(mfrow= layout,</span><br><span class="line">                   mar = <span class="built_in">c</span>(<span class="number">2.5</span>,<span class="number">0.1</span>,<span class="number">0.3</span>,<span class="number">0.1</span>), oma = <span class="built_in">rep</span>(<span class="number">0</span>,<span class="number">4</span>))</span><br><span class="line">    sapply(<span class="number">1</span>:nSubjects, FUN = presentSubject)</span><br><span class="line">    par(savePar)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># hide the true location but return information to reconstruct it</span></span><br><span class="line">    hideLocation(trueLoc, nSubjects)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">hideLocation &lt;- <span class="keyword">function</span>(trueLoc, nSubjects)&#123;</span><br><span class="line">  possibleBaseVals &lt;- 3:<span class="built_in">min</span>(<span class="number">2</span>*nSubjects, <span class="number">50</span>)</span><br><span class="line">  <span class="comment"># remove easy base values</span></span><br><span class="line">  possibleBaseVals &lt;- possibleBaseVals[possibleBaseVals != <span class="number">10</span> &amp;</span><br><span class="line">                                         possibleBaseVals != <span class="number">5</span>]</span><br><span class="line">  base &lt;- sample(possibleBaseVals, <span class="number">1</span>)</span><br><span class="line">  offset &lt;- sample(<span class="number">5</span>:<span class="built_in">min</span>(<span class="number">5</span>*nSubjects, <span class="number">125</span>), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># return the location information (trueLoc hidden)</span></span><br><span class="line">  <span class="built_in">list</span>(trueLoc &lt;- paste0(<span class="string">&quot;log(&quot;</span>,</span><br><span class="line">                         base^(trueLoc +offset),</span><br><span class="line">                         <span class="string">&quot;, base = &quot;</span>, base,</span><br><span class="line">                         <span class="string">&quot;) - &quot;</span>, offset))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">revealLocation &lt;- <span class="keyword">function</span>(hideLocation)&#123;eval(parse(text=hideLocation$trueLoc))&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># suspectLocation &lt;- hideLocation(3,20)</span></span><br><span class="line"><span class="comment"># revealLocation(suspectLocation)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># have to fix myPlot to acccept a subject number</span></span><br><span class="line">myPlot &lt;- <span class="keyword">function</span>(data, subjectNo) &#123;</span><br><span class="line">  xrange &lt;- extendrange(<span class="built_in">c</span>(data$x, data$y))</span><br><span class="line">  breaks &lt;- seq(xrange[<span class="number">1</span>], xrange[<span class="number">2</span>], length.out = <span class="number">12</span>)</span><br><span class="line">  hx &lt;- hist(data$x, breaks = breaks, plot = <span class="literal">FALSE</span>)</span><br><span class="line">  hy &lt;- hist(data$y, breaks = breaks, plot = <span class="literal">FALSE</span>)</span><br><span class="line">  yrange &lt;- extendrange(<span class="built_in">c</span>(hx$counts, hy$counts))</span><br><span class="line"></span><br><span class="line">  plot(hx, main = paste(   subjectNo), cex.main = <span class="number">1.5</span>, line = -<span class="number">0.75</span>,</span><br><span class="line">       ylab = <span class="string">&quot;&quot;</span>, xlab = <span class="string">&quot;&quot;</span>, xaxt = <span class="string">&quot;n&quot;</span>, yaxt = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">       ylim = yrange, xlim = xrange,</span><br><span class="line">       col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.4</span>))</span><br><span class="line">  lines(hy, col = adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.4</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># we need only execute the test as follows</span></span><br><span class="line">data &lt;- <span class="built_in">list</span>(x = x, y=y)</span><br><span class="line">lineup(data,</span><br><span class="line">       generateSubject = mixRandomly,</span><br><span class="line">       showSubject = myPlot,</span><br><span class="line">       layout = <span class="built_in">c</span>(<span class="number">4</span>,<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># back to back displays</span></span><br><span class="line">back2back &lt;- <span class="keyword">function</span>(data, subjectNo) &#123;</span><br><span class="line">  ylim &lt;- extendrange(<span class="built_in">c</span>(data$x, data$y))</span><br><span class="line">  Xdensity &lt;- density(data$x, bw = <span class="string">&quot;SJ&quot;</span>)</span><br><span class="line">  Ydensity &lt;- density(data$y, bw = <span class="string">&quot;SJ&quot;</span>)</span><br><span class="line">  Ydensity$y &lt;- - Ydensity$y</span><br><span class="line">  xlim &lt;- extendrange(<span class="built_in">c</span>(Xdensity$y, Ydensity$y))</span><br><span class="line">  xyswitch &lt;- <span class="keyword">function</span>(xy_thing)&#123;</span><br><span class="line">    yx_thing &lt;- xy_thing</span><br><span class="line">    yx_thing$x &lt;- xy_thing$y</span><br><span class="line">    yx_thing$y &lt;- xy_thing$x</span><br><span class="line">    yx_thing</span><br><span class="line">  &#125;</span><br><span class="line">  plot(xyswitch(Xdensity), col = <span class="string">&quot;firebrick&quot;</span>, xlab = <span class="string">&quot;&quot;</span>,</span><br><span class="line">       ylab = <span class="string">&quot;&quot;</span>,</span><br><span class="line">       main = paste(subjectNo),cex.main = <span class="number">1.5</span>, adj = <span class="number">0.75</span>,line = -<span class="number">0.85</span>,</span><br><span class="line">       xaxt = <span class="string">&quot;n&quot;</span>, yaxt = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">       xlim = xlim, ylim = ylim)</span><br><span class="line">  polygon(xyswitch(Xdensity), col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.4</span>))</span><br><span class="line">  lines(xyswitch(Ydensity), col = <span class="string">&quot;steelblue&quot;</span>)</span><br><span class="line">  polygon(xyswitch(Ydensity), col = adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.4</span>))</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &lt;- <span class="built_in">list</span>(x = x, y=y)</span><br><span class="line">lineup(data,</span><br><span class="line">       generateSubject = mixRandomly,</span><br><span class="line">       showSubject = back2back,</span><br><span class="line">       layout = <span class="built_in">c</span>(<span class="number">4</span>,<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># quantiles display</span></span><br><span class="line">quantiles &lt;- <span class="keyword">function</span>(data, subjectNo)&#123;</span><br><span class="line">  ylim &lt;- extendrange(<span class="built_in">c</span>(data$x, data$y))</span><br><span class="line">  n_x &lt;- <span class="built_in">length</span>(data$x)</span><br><span class="line">  n_y &lt;- <span class="built_in">length</span>(data$y)</span><br><span class="line">  p_x &lt;- ppoints(n_x)</span><br><span class="line">  p_y &lt;- ppoints(n_y)</span><br><span class="line"></span><br><span class="line">  plot(p_x, sort(data$x), type = <span class="string">&quot;b&quot;</span>,</span><br><span class="line">       pch = <span class="number">19</span>, col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.4</span>),</span><br><span class="line">       cex = <span class="number">2</span>, ylim = ylim,</span><br><span class="line">      xlab = <span class="string">&quot;&quot;</span>, ylab = <span class="string">&quot;&quot;</span>, main = paste(subjectNo),</span><br><span class="line">      cex.main = <span class="number">1.5</span>, adj = <span class="number">0.75</span>,line = -<span class="number">0.85</span>,</span><br><span class="line">      xaxt = <span class="string">&quot;n&quot;</span>, yaxt = <span class="string">&quot;n&quot;</span>)</span><br><span class="line">  points(p_y, sort(data$y), type = <span class="string">&quot;b&quot;</span>,</span><br><span class="line">         col = adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.4</span>),pch = <span class="number">19</span>,</span><br><span class="line">         cex = <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lineup(data,</span><br><span class="line">       generateSubject = mixRandomly,</span><br><span class="line">       showSubject = quantiles,</span><br><span class="line">       layout = <span class="built_in">c</span>(<span class="number">4</span>,<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># we might use boxplot if we are only interested in comparing locations and</span></span><br><span class="line"><span class="comment">#   possible scales and symmetry</span></span><br><span class="line"></span><br><span class="line">boxplots &lt;- <span class="keyword">function</span>(data, subjectNo)&#123;</span><br><span class="line">  y &lt;- <span class="built_in">c</span>(data$x, data$y)</span><br><span class="line">  x &lt;- <span class="built_in">c</span>(<span class="built_in">rep</span>(<span class="number">0</span>, <span class="built_in">length</span>(data$x)),</span><br><span class="line">         <span class="built_in">rep</span>(<span class="number">1</span>, <span class="built_in">length</span>(data$y)))</span><br><span class="line">  boxplot(y~x, data = cbind(x,y),</span><br><span class="line">          col = adjustcolor(<span class="built_in">c</span>(<span class="string">&quot;firebrick&quot;</span>, <span class="string">&quot;steelblue&quot;</span>), <span class="number">0.4</span>),</span><br><span class="line">          main = paste(subjectNo),</span><br><span class="line">          cex.main = <span class="number">1.5</span>, adj = <span class="number">0.75</span>, line = -<span class="number">0.75</span>,</span><br><span class="line">          xlab = <span class="string">&quot;&quot;</span>, ylab = <span class="string">&quot;&quot;</span>, xaxt = <span class="string">&quot;n&quot;</span>, yaxt = <span class="string">&quot;n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="hypothetical-generative"><a href="#hypothetical-generative" class="headerlink" title="hypothetical generative"></a>hypothetical generative</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this function will return x and y data that have the same median(0) and</span></span><br><span class="line"><span class="comment"># interquartile range(1): same slope in the middle</span></span><br><span class="line"></span><br><span class="line">matchData &lt;- <span class="keyword">function</span>(data)&#123;</span><br><span class="line">  x &lt;- data$x</span><br><span class="line">  y &lt;- data$y</span><br><span class="line">  <span class="built_in">list</span> (x = scale(x, center = median(x), scale=IQR(x)),</span><br><span class="line">        y = scale(y, center = median(y), scale=IQR(y)))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">lineup(data,</span><br><span class="line">       showSubject = back2back,</span><br><span class="line">       layout = <span class="built_in">c</span>(<span class="number">4</span>,<span class="number">5</span>),</span><br><span class="line">       generateSubject =</span><br><span class="line">         <span class="keyword">function</span>(data) &#123;</span><br><span class="line">           data &lt;- matchData(data)</span><br><span class="line">           data &lt;- mixRandomly(data)</span><br><span class="line">           matchData(data)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># compare to a specific shape</span></span><br><span class="line"><span class="comment"># rdist(): will generate n pseudo-random values from the hypothesized generative</span></span><br><span class="line"><span class="comment">#  distribution (for some location and scale), then data matched on location (median)</span></span><br><span class="line"><span class="comment">#  and scale(IQR) can be geenrated using:</span></span><br><span class="line">getMatchData &lt;- <span class="keyword">function</span>(x,</span><br><span class="line">                         rdist = rnorm,</span><br><span class="line">                         matchScale = <span class="literal">TRUE</span>,</span><br><span class="line">                         matchLocation = <span class="literal">TRUE</span>)&#123;</span><br><span class="line">  new_x &lt;- rdist(<span class="built_in">length</span>(x))   <span class="comment"># geenrate new data Hershey</span></span><br><span class="line">  <span class="comment"># now match the new data to have the same location and scale as the old data</span></span><br><span class="line">  <span class="keyword">if</span> (matchScale) &#123;new_x &lt;- new_x * (IQR(x)/IQR(new_x))&#125;</span><br><span class="line">  <span class="keyword">if</span> (matchLocation) &#123;new_x &lt;- new_x - median(new_x) + median(x)&#125;</span><br><span class="line">  new_x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># first, get the actual data</span></span><br><span class="line">x &lt;- beaver1[,<span class="string">&quot;temp&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># construct a pairing of it with a randomly geenrated sample from any Gaussian distribution</span></span><br><span class="line"><span class="comment"># and match the location and scale</span></span><br><span class="line">data &lt;- <span class="built_in">list</span>(x = x, y = getMatchData(x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># then this data can now be used in a line up test,</span></span><br><span class="line">lineup(data,</span><br><span class="line">       showSubject = back2back,</span><br><span class="line">       layout = <span class="built_in">c</span>(<span class="number">4</span>,<span class="number">5</span>),</span><br><span class="line">       generateSubject =</span><br><span class="line">         <span class="keyword">function</span>(data) &#123;</span><br><span class="line">           <span class="built_in">list</span>(x = getMatchData(data$x),</span><br><span class="line">                y = getMatchData(data$y))</span><br><span class="line">         &#125;</span><br><span class="line">       )</span><br><span class="line"></span><br><span class="line"><span class="comment"># if from other distribution, like t3</span></span><br><span class="line">rdist &lt;- <span class="keyword">function</span>(n) rt(n, df = <span class="number">3</span>)</span><br><span class="line">data &lt;- <span class="built_in">list</span>(x = x, y = getMatchData(x, rdist = rdist))</span><br><span class="line"></span><br><span class="line"><span class="comment">## the above method was compared to several other pairs of x and y where both were</span></span><br><span class="line"><span class="comment"># generated from the hyppthesized dsitribuiotn</span></span><br><span class="line"><span class="comment"># the extra variation introduced by random generation of both x and y under the null hypothesis might</span></span><br><span class="line"><span class="comment"># be making the detemination more difficult</span></span><br><span class="line"><span class="comment"># the variation might be reduced if we instead use a single representative set of values</span></span><br><span class="line"><span class="comment"># for the comparison in each graphic.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sample quantiles vs. theoretical quantiles</span></span><br><span class="line"></span><br><span class="line">library(<span class="string">&quot;MASS&quot;</span>)</span><br><span class="line">attach(geyser)</span><br><span class="line">plot_colour &lt;- adjustcolor(<span class="string">&quot;black&quot;</span>, <span class="number">0.3</span>)</span><br><span class="line">qqnorm(duration, pch = <span class="number">19</span>, col = plot_colour)</span><br><span class="line"><span class="comment"># here geyser duration data with alpha blending to help reveal point density</span></span><br><span class="line"></span><br><span class="line">savePar = par(mfrow=<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">qqnorm(SAheart[noFamilyHistory, <span class="string">&quot;sbp&quot;</span>], pch = <span class="number">19</span>,</span><br><span class="line">       col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.4</span>),</span><br><span class="line">       main = <span class="string">&quot;no family history&quot;</span>)</span><br><span class="line">qqnorm(SAheart[FamilyHistory, <span class="string">&quot;sbp&quot;</span>], pch = <span class="number">19</span>,</span><br><span class="line">       col = adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.4</span>),</span><br><span class="line">       main = <span class="string">&quot;family history&quot;</span>)</span><br><span class="line">par(savePar)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># self calibrating qqplots</span></span><br><span class="line">library(qqtest)</span><br><span class="line">qqtest(duration)</span><br><span class="line">qqtest(duration, xAxisAsProbs = <span class="literal">TRUE</span>,yAxisAsProbs = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ordering comparisons</span></span><br><span class="line">library(loon.data)</span><br><span class="line">data(<span class="string">&quot;SAheart&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># getting the comparisons of interest</span></span><br><span class="line"><span class="comment"># get the groups</span></span><br><span class="line">groups &lt;- with(SAheart, split(sbp, <span class="built_in">list</span>(famhist, chd)))</span><br><span class="line">kable(t(<span class="built_in">names</span>(groups)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># now ordering the groups</span></span><br><span class="line">ord &lt;- <span class="built_in">c</span>(<span class="string">&quot;Present.No&quot;</span>, <span class="string">&quot;Present.Yes&quot;</span>, <span class="string">&quot;Absent.Yes&quot;</span>,</span><br><span class="line">         <span class="string">&quot;Absent.No&quot;</span>, <span class="string">&quot;Present.No&quot;</span>)</span><br><span class="line"><span class="comment"># match the colours to the famliy history</span></span><br><span class="line">cols &lt;- adjustcolor(<span class="built_in">c</span>(<span class="string">&quot;steelblue&quot;</span>, <span class="string">&quot;steelblue&quot;</span>, <span class="string">&quot;firebrick&quot;</span>,</span><br><span class="line">                      <span class="string">&quot;firebrick&quot;</span>, <span class="string">&quot;steelblue&quot;</span>), <span class="number">0.5</span>)</span><br><span class="line">boxplot(groups[ord], col = cols)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># layout via graph structure</span></span><br><span class="line">library(<span class="string">&quot;PairViz&quot;</span>)</span><br><span class="line">library(loon.data)</span><br><span class="line">data(cancer)</span><br><span class="line">str(cancer)</span><br><span class="line"></span><br><span class="line"><span class="comment"># we can separate the survival times by which organ is affected</span></span><br><span class="line">organs &lt;- with(cancer, split(Survival, Organ))</span><br><span class="line"><span class="comment"># and record their names for use later</span></span><br><span class="line">organNames &lt;- <span class="built_in">names</span>(organs)</span><br><span class="line"><span class="comment"># the structure of the organs data</span></span><br><span class="line">str(organs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># getting Eulerians and Hamiltonians</span></span><br><span class="line">ord &lt;- eulerian(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">library(colorspace)</span><br><span class="line"><span class="comment"># getting a rainbow of colours but choose chromaticity of 50 to dull them</span></span><br><span class="line">cols &lt;- rainbow_hcl(<span class="number">5</span>, <span class="built_in">c</span> = <span class="number">50</span>)</span><br><span class="line">boxplot(organs[ord], col = cols[ord],</span><br><span class="line">        ylab = <span class="string">&quot;Survival time&quot;</span>, main = <span class="string">&quot;cancer treated by vitamin C&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># logout via graph structure</span></span><br><span class="line"><span class="comment"># taking square roots should make the data look a liitle more symmetric</span></span><br><span class="line">sqrtOrgans &lt;- with(cancer, split(<span class="built_in">sqrt</span>(Survival), Organ))</span><br><span class="line"></span><br><span class="line">boxplot(sqrtOrgans[ord], col = cols[ord],</span><br><span class="line">        ylab = <span class="built_in">expression</span>(<span class="built_in">sqrt</span>(<span class="string">&quot;Survival time&quot;</span>)),</span><br><span class="line">        main = <span class="string">&quot;cancer treated by vitamin C&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hamiltonian decompositions</span></span><br><span class="line">ordHam &lt;- hpaths(<span class="number">5</span>) <span class="comment"># here each hamiltonian is a row of the matrix&#x27;</span></span><br><span class="line"><span class="comment"># for our purpose, we would like the hamiltonians to be joined togehter</span></span><br><span class="line">ordHam &lt;- hpaths(<span class="number">5</span>, matrix = <span class="literal">FALSE</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># run a statistical test comapring each pair and use the p-value</span></span><br><span class="line"><span class="comment"># to order. e.g. test the equality of each pair of means(assuming normlaity)</span></span><br><span class="line"><span class="comment"># pairwise.t.test() does this and corrects the p-values for simultaneity</span></span><br><span class="line">test &lt;- with(cancer,</span><br><span class="line">             pairwise.t.test(<span class="built_in">sqrt</span>(Survival), Organ))</span><br><span class="line">pvals &lt;- test$p.value</span><br><span class="line"><span class="built_in">round</span>(pvals, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># the pairviz package can handle graphs with weights</span></span><br><span class="line">ngrps &lt;- <span class="built_in">length</span>(organNames)</span><br><span class="line"><span class="comment"># build matrix of weights</span></span><br><span class="line">weights &lt;- matrix(<span class="number">0</span>, nrow = ngrps, ncol= ngrps)</span><br><span class="line">rownames(weights) &lt;- organNames</span><br><span class="line">colnames(weights) &lt;- organNames</span><br><span class="line">weights[<span class="number">2</span>:ngrps, <span class="number">1</span>:(ngrps-<span class="number">1</span>)] &lt;- pvals</span><br><span class="line"><span class="built_in">round</span>(weights, <span class="number">4</span>)</span><br><span class="line"><span class="comment"># right size matrix but need to be symmetric by filling the upper triangle to</span></span><br><span class="line"><span class="comment"># match lower</span></span><br><span class="line">diag(weights) &lt;- <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:(ngrps - <span class="number">1</span>)) &#123;</span><br><span class="line">  <span class="keyword">for</span> (j <span class="keyword">in</span> (i+<span class="number">1</span>):ngrps) &#123;</span><br><span class="line">    weights[i,j] &lt;- weights[j,i]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">round</span>(weights, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># greedy eulerians</span></span><br><span class="line"><span class="comment"># low to high</span></span><br><span class="line">low2highEulord &lt;- eulerian(weights);</span><br><span class="line">colnames(weights)[low2highEulord]</span><br><span class="line"><span class="comment"># high to low</span></span><br><span class="line">high2lowEulord &lt;- eulerian(- weights)</span><br><span class="line">colnames(weights)[high2lowEulord]</span><br><span class="line"></span><br><span class="line"><span class="comment"># weighted hamiltonian decompositions</span></span><br><span class="line">low2higihHamord &lt;- weighted_hpaths(weights)</span><br><span class="line"><span class="comment"># high to low</span></span><br><span class="line">high2lowHamord &lt;- weighted_hpaths(- weights)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># having weigthed graph g</span></span><br><span class="line">library(Rgraphviz)</span><br><span class="line">g &lt;- mk_complete_graph(weights)</span><br><span class="line"><span class="comment"># par(mar = c(bottom, left, top, right))</span></span><br><span class="line">par(mar = <span class="built_in">c</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">plot(g, <span class="string">&quot;circo&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment">########### the code used to install packages in bioManager</span></span><br><span class="line"><span class="keyword">if</span> (!requireNamespace(<span class="string">&quot;BiocManager&quot;</span>, quietly = <span class="literal">TRUE</span>))</span><br><span class="line">  install.packages(<span class="string">&quot;BiocManager&quot;</span>)</span><br><span class="line"></span><br><span class="line">BiocManager::install(<span class="string">&quot;Rgraphviz&quot;</span>)</span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># remove all edges in the top hald the edges weights</span></span><br><span class="line">wvals &lt;- weights[upper.tri(weights)]</span><br><span class="line"><span class="comment"># the median</span></span><br><span class="line">q &lt;- quantile(wvals, <span class="number">0.5</span>)</span><br><span class="line"><span class="comment"># trim the graph via the pairviz function dn_graph()</span></span><br><span class="line">g1 &lt;- dn_graph(g,q,`&lt;=`)</span><br><span class="line">par(mar = <span class="built_in">c</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">plot(g1, <span class="string">&quot;circo&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># this subgraph g1 is not even (some nodes have an odd numebr of edges)</span></span><br><span class="line"><span class="comment"># so it must be made even by adding extra edges to get an Eulerian</span></span><br><span class="line">g1EulOrd &lt;- eulerian(g1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># back to the SAheart data</span></span><br><span class="line">library(PairViz);library(loon.data);data(<span class="string">&quot;SAheart&quot;</span>)</span><br><span class="line"><span class="comment"># building the graph</span></span><br><span class="line">nodes &lt;- <span class="built_in">names</span>(groups)</span><br><span class="line">SAheartGraph &lt;- new(<span class="string">&quot;graphNEL&quot;</span>, nodes = nodes, edgemode = <span class="string">&quot;undirected&quot;</span>)</span><br><span class="line">SAheartGraph &lt;- addEdge(<span class="string">&quot;Present.Yes&quot;</span>, <span class="string">&quot;Absent.No&quot;</span>, SAheartGraph)</span><br><span class="line">SAheartGraph &lt;- addEdge(<span class="string">&quot;Present.Yes&quot;</span>, <span class="string">&quot;Absent.Yes&quot;</span>, SAheartGraph)</span><br><span class="line">SAheartGraph &lt;- addEdge(<span class="string">&quot;Absent.Yes&quot;</span>, <span class="string">&quot;Absent.No&quot;</span>, SAheartGraph)</span><br><span class="line">SAheartGraph &lt;- addEdge(<span class="string">&quot;Absent.No&quot;</span>, <span class="string">&quot;Present.No&quot;</span>, SAheartGraph)</span><br><span class="line"></span><br><span class="line">ord &lt;-eulerian(SAheartGraph)</span><br><span class="line">cols &lt;- adjustcolor(<span class="built_in">rep</span>(<span class="built_in">c</span>(<span class="string">&quot;firebrick&quot;</span>, <span class="string">&quot;steelblue&quot;</span>), <span class="number">2</span>), <span class="number">0.5</span>)</span><br><span class="line"><span class="built_in">names</span>(cols) &lt;- nodes</span><br><span class="line">savePar &lt;- par(mfrow=<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>), oma = <span class="built_in">rep</span>(<span class="number">6</span>,<span class="number">4</span>))</span><br><span class="line">boxplot(groups[ord], col= cols[ord], main = <span class="string">&quot;family hisotry and chd&quot;</span>)</span><br><span class="line">plot(SAheartGraph, <span class="string">&quot;circo&quot;</span>)</span><br><span class="line">par(savePar)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="time-order"><a href="#time-order" class="headerlink" title="time order"></a>time order</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># time series data</span></span><br><span class="line">library(loon)</span><br><span class="line">p &lt;- l_plot(sunspot.month, color = <span class="string">&quot;grey&quot;</span>, size = <span class="number">1</span>,</span><br><span class="line">            showScales = <span class="literal">TRUE</span>)</span><br><span class="line"><span class="comment"># connect the dots</span></span><br><span class="line">l_layer_line(p, x = time(sunspot.month), y = sunspot.month,</span><br><span class="line">             color = <span class="string">&quot;grey&quot;</span>, linewidth = <span class="number">2</span>,</span><br><span class="line">             index = <span class="string">&quot;end&quot;</span>)</span><br><span class="line"></span><br><span class="line">l_layer_hide(p, <span class="string">&quot;model&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># show a window of a couple of years</span></span><br><span class="line">window(sunspot.month, start=<span class="built_in">c</span>(<span class="number">1960</span>, <span class="number">1</span>), end = <span class="built_in">c</span>(<span class="number">1961</span>, <span class="number">12</span>))</span><br><span class="line">end(sunspot.month)</span><br><span class="line">start(sunspot.month)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># cycle: group the data by season or quarterly phase by using the cycle() function</span></span><br><span class="line">window(cycle(sunspot.month), start = <span class="built_in">c</span>(<span class="number">1960</span>, <span class="number">1</span>), end = <span class="built_in">c</span>(<span class="number">1960</span>, <span class="number">12</span>))</span><br><span class="line">quarter &lt;- 1 + ((cycle(sunspot.month) - <span class="number">1</span>) %/% <span class="number">3</span>)</span><br><span class="line">monthplot(sunspot.month, col = <span class="string">&quot;grey50&quot;</span>, col.base = <span class="string">&quot;red&quot;</span>,</span><br><span class="line">          lwd.base = <span class="number">3</span>, xlab = <span class="string">&quot;quarter&quot;</span>, phase = quarter,</span><br><span class="line">          labels = <span class="built_in">c</span>(<span class="string">&quot;first&quot;</span>, <span class="string">&quot;second&quot;</span>, <span class="string">&quot;third&quot;</span>, <span class="string">&quot;fourth&quot;</span>))</span><br><span class="line"><span class="comment"># we might explore how well the value of one month might be predicted by the immediately</span></span><br><span class="line"><span class="comment"># prior month, that is how well might any value be predicted from knowing</span></span><br><span class="line"><span class="comment"># only its immediate predecessor</span></span><br><span class="line">plot(x = sunspot.month[-<span class="built_in">length</span>(sunspot.month)], y = sunspot.month[-<span class="number">1</span>],</span><br><span class="line">     col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.15</span>), pch = <span class="number">19</span>,</span><br><span class="line">     main = <span class="string">&quot;sunspot activity lagged by one month&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># lag plots: can lag the data by any number of months,</span></span><br><span class="line">lag.plot(sunspot.month,</span><br><span class="line">         col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.15</span>), pch = <span class="number">19</span>,</span><br><span class="line">         main = <span class="string">&quot;sunspot activity lagged by up to 12 months&quot;</span>,</span><br><span class="line">         lags = <span class="number">12</span>)</span><br><span class="line"></span><br><span class="line">freq &lt;- frequency(sunspot.month)</span><br><span class="line">lag.plot(sunspot.month,</span><br><span class="line">         col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.15</span>), pch = <span class="number">19</span>,</span><br><span class="line">         main = <span class="string">&quot;sunspot activity lagged by up to 15 months&quot;</span>,</span><br><span class="line">         set.lags = freq*(<span class="number">1</span>:<span class="number">15</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># jumped by 4 months</span></span><br><span class="line">lag.plot(<span class="built_in">sqrt</span>(sunspot.month),</span><br><span class="line">         col = adjustcolor(<span class="string">&quot;firebrick&quot;</span>, <span class="number">0.15</span>), pch = <span class="number">19</span>,</span><br><span class="line">         main = <span class="string">&quot;sunspot activity^(1/2) lagged 84 tp 180 by 4&quot;</span>,</span><br><span class="line">         set.lags = seq(<span class="number">84</span>,<span class="number">180</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># identify every 11 years of the series as a cycle.</span></span><br><span class="line"><span class="comment"># determine the starting year of each 11 year cycle</span></span><br><span class="line">timeseries &lt;- <span class="built_in">sqrt</span>(sunspot.month)</span><br><span class="line">startYears &lt;- seq(start(timeseries)[<span class="number">1</span>], end(timeseries)[<span class="number">1</span>], <span class="number">11</span>)</span><br><span class="line"><span class="comment"># number of cycles</span></span><br><span class="line">ncycles &lt;- <span class="built_in">length</span>(startYears)</span><br><span class="line">cycleNums &lt;- <span class="built_in">rep</span>(<span class="number">1</span>:ncycles, each = <span class="number">132</span>)</span><br><span class="line"><span class="comment"># only need as many as we have data points</span></span><br><span class="line">cycleNUms &lt;- cycleNUms[<span class="number">1</span>:<span class="built_in">length</span>(timeseries)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># each month will have a position number within its cycle</span></span><br><span class="line">cyclePositions &lt;- <span class="built_in">rep</span>(<span class="number">1</span>:<span class="number">132</span>, ncycles)</span><br><span class="line">cyclePositions &lt;- cyclePositions[<span class="number">1</span>:<span class="built_in">length</span>(timeseries)]</span><br><span class="line">head(cyclePositions)</span><br><span class="line"></span><br><span class="line">library(RColorBrewer)</span><br><span class="line">cols &lt;- adjustcolor(<span class="built_in">rep</span>(brewer.pal(<span class="number">9</span>, name = <span class="string">&quot;Set1&quot;</span>),</span><br><span class="line">                       length.out = ncycles), alpha.f = <span class="number">0.5</span>)</span><br><span class="line">opt &lt;- par(bg=<span class="string">&quot;grey95&quot;</span>)</span><br><span class="line">plot(x = time(timeseries), y =as.vector(timeseries),</span><br><span class="line">     type = <span class="string">&quot;b&quot;</span>, col=cols[cycleNUms], lwd = <span class="number">2</span>, pch = <span class="number">19</span>,</span><br><span class="line">     xlab = <span class="string">&quot;Time&quot;</span>, ylab = <span class="string">&quot;sqrt monthly sunspots&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;sunspot activity&quot;</span>)</span><br><span class="line">par(opt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># comparing groups by overlaying them</span></span><br><span class="line">opt &lt;- par(bg = <span class="string">&quot;grey95&quot;</span>)</span><br><span class="line">data &lt;- window(timeseries, start = <span class="built_in">c</span>(startYears[<span class="number">1</span>], <span class="number">1</span>),</span><br><span class="line">                end = <span class="built_in">c</span>(startYears[<span class="number">2</span>] - <span class="number">1</span>, <span class="number">12</span>),</span><br><span class="line">                frequency = <span class="number">12</span>)</span><br><span class="line">plot(<span class="number">1</span>:<span class="built_in">length</span>(data), data,</span><br><span class="line">     type = <span class="string">&quot;l&quot;</span>, col=cols[<span class="number">1</span>], lwd = <span class="number">2</span>,</span><br><span class="line">     xlab = <span class="string">&quot;Month number in 11 year sequence&quot;</span>, ylab = <span class="string">&quot;sqrt monthly sunspots&quot;</span>,</span><br><span class="line">     main = <span class="string">&quot;all 11 tear sequence: 1749-1983&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ( i <span class="keyword">in</span> <span class="number">2</span>:(ncycles - <span class="number">1</span>)) &#123;</span><br><span class="line"> data &lt;- window(timeseries, start = <span class="built_in">c</span>(startYears[i], <span class="number">1</span>),</span><br><span class="line">                 end = <span class="built_in">c</span>(startYears[i+<span class="number">1</span>] - <span class="number">1</span>, <span class="number">12</span>),</span><br><span class="line">                 frequency = <span class="number">12</span>)</span><br><span class="line"> lines(<span class="number">1</span>:<span class="built_in">length</span>(data), data, col = cols[i], lwd = <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># tidy up the last partial cycle</span></span><br><span class="line">data &lt;- window(timeseries, start = <span class="built_in">c</span>(startYears[ncycles], <span class="number">1</span>),</span><br><span class="line">               end = end(timeseries),</span><br><span class="line">               frequency = <span class="number">12</span>)</span><br><span class="line">lines(<span class="number">1</span>:<span class="built_in">length</span>(data), data, col = cols[ncycles], lwd = <span class="number">2</span>)</span><br><span class="line">par(opt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### an interactive display</span></span><br><span class="line">library(loon)</span><br><span class="line"></span><br><span class="line"><span class="comment"># plot the original data, marking 11 year cycles in colour</span></span><br><span class="line">p &lt;-l_plot(x =time(timeseries), y=as.vector(timeseries),</span><br><span class="line">           ylabel=<span class="string">&quot;Mean sqrt monthly sunspots&quot;</span>,</span><br><span class="line">           xlabel=<span class="string">&quot;Time&quot;</span>,</span><br><span class="line">           title=<span class="string">&quot;Sunspot activity&quot;</span>,</span><br><span class="line">           linkingGroup=<span class="string">&quot;sunspots&quot;</span>,</span><br><span class="line">           color = cols[cycleNums], size=<span class="number">1</span>,showGuides=<span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#  And all the cycles over top of each ot</span></span><br><span class="line">cycleplot &lt;-l_plot(x = cyclePositions,</span><br><span class="line">                  y=as.vector(timeseries),</span><br><span class="line">                  ylabel=<span class="string">&quot;Mean sqrt monthly sunspots&quot;</span>,</span><br><span class="line">                  xlabel=<span class="string">&quot;Month number in 11 year sequence&quot;</span>,</span><br><span class="line">                  title=<span class="string">&quot;11 year sequences&quot;</span>,linkingGroup=<span class="string">&quot;sunspots&quot;</span>,</span><br><span class="line">                  color = cols[cycleNums], size=<span class="number">1</span>,showGuides=<span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Adding a histogram in the same linking group allows</span></span><br><span class="line"><span class="comment">#    all to the# plots to be linked together</span></span><br><span class="line">h &lt;-l_hist(x= cycleNums,xlabel=<span class="string">&quot;Cycle number&quot;</span>,</span><br><span class="line">           title=<span class="string">&quot;Sunspot  cycles&quot;</span>,linkingGroup=<span class="string">&quot;sunspots&quot;</span>,</span><br><span class="line">           color = cols[cycleNums],showStackedColors =<span class="literal">TRUE</span>,</span><br><span class="line">           showGuides=<span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># now add the lines as layers</span></span><br><span class="line">data &lt;- window(timeseries, start = <span class="built_in">c</span>(startYears[ncycles], <span class="number">1</span>),</span><br><span class="line">               end = <span class="built_in">c</span>(startYears[<span class="number">2</span>] - <span class="number">1</span>, <span class="number">12</span>),</span><br><span class="line">               frequency = <span class="number">12</span>)</span><br><span class="line">l_layer_line(cyclesplot, x = <span class="number">1</span>:<span class="built_in">length</span>(data), y = data, color = cols[<span class="number">1</span>],</span><br><span class="line">             label = paste(start(data)[<span class="number">1</span>], end(data)[<span class="number">1</span>], sep=<span class="string">&quot;-&quot;</span>), indx = <span class="string">&quot;end&quot;</span>)</span><br><span class="line">l_layer_line(p, x = time(data), y = data, color = cols[<span class="number">1</span>],</span><br><span class="line">             label = paste(start(data)[<span class="number">1</span>], end(data)[<span class="number">1</span>], sep=<span class="string">&quot;-&quot;</span>), indx = <span class="string">&quot;end&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">2</span>:(ncycles - <span class="number">1</span>))&#123;</span><br><span class="line">  data &lt;- window(timeseries, start = <span class="built_in">c</span>(startYears[i], <span class="number">1</span>),</span><br><span class="line">                 end = <span class="built_in">c</span>(startYears[i+<span class="number">1</span>] - <span class="number">1</span>, <span class="number">12</span>),</span><br><span class="line">                 frequency = <span class="number">12</span>)</span><br><span class="line">  l_layer_line(cyclesplot, x = <span class="number">1</span>:<span class="built_in">length</span>(data), y = data, color = cols[i],</span><br><span class="line">               label = paste(start(data)[<span class="number">1</span>], end(data)[<span class="number">1</span>], sep=<span class="string">&quot;-&quot;</span>),</span><br><span class="line">               indx = <span class="string">&quot;end&quot;</span>)</span><br><span class="line">  l_layer_line(p, x = time(data), y = data, color = cols[i],</span><br><span class="line">               label = paste(start(data)[<span class="number">1</span>], end(data)[<span class="number">1</span>], sep=<span class="string">&quot;-&quot;</span>),</span><br><span class="line">               indx = <span class="string">&quot;end&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># tidy up the last partial cycles</span></span><br><span class="line">data &lt;- window(timeseries, start = <span class="built_in">c</span>(startYears[ncycles], <span class="number">1</span>),</span><br><span class="line">               end = end(timeseries),</span><br><span class="line">               frequency = <span class="number">12</span>)</span><br><span class="line">l_layer_line(p, x = time(data), y = data, color = cols[ncycles],</span><br><span class="line">             label = paste(start(data)[<span class="number">1</span>], end(data)[<span class="number">1</span>], sep=<span class="string">&quot;-&quot;</span>),</span><br><span class="line">             indx = <span class="string">&quot;end&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="time-series-decomposition"><a href="#time-series-decomposition" class="headerlink" title="time series decomposition"></a>time series decomposition</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line">plot(co2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># explore it interactively</span></span><br><span class="line">library(loon)</span><br><span class="line">getDates &lt;- <span class="keyword">function</span>(ts)&#123;</span><br><span class="line">  mapply(FUN = <span class="keyword">function</span>(x,y) &#123;paste(x,y)&#125;, <span class="built_in">floor</span>(time(co2)),</span><br><span class="line">         <span class="built_in">month.name</span>)</span><br><span class="line">&#125;</span><br><span class="line">data = co2</span><br><span class="line"></span><br><span class="line">p &lt;- l_plot(data, title=<span class="string">&quot;Muna loa atmospheric CO2&quot;</span>,</span><br><span class="line">            ylabel = <span class="string">&quot;concentration (ppm)&quot;</span>,</span><br><span class="line">            xlabel = <span class="string">&quot;Date&quot;</span>, linkingGroup = <span class="string">&quot;co2&quot;</span>, color = <span class="string">&quot;grey20&quot;</span>,</span><br><span class="line">            showScales = <span class="literal">TRUE</span>, showGuides = <span class="literal">TRUE</span>,</span><br><span class="line">            itemLabel = getDates(data), showItemLabels = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># another way to get the x and y coordinates</span></span><br><span class="line">xy.raw &lt;- xy.coords(data)</span><br><span class="line">l_layer_line(p, x = xy.raw$x, y = xy.raw$y,</span><br><span class="line">             clor = <span class="string">&quot;grey50&quot;</span>, linewidth = <span class="number">3</span>, index = <span class="string">&quot;end&quot;</span>,</span><br><span class="line">             label = <span class="string">&quot;connect the dots&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># a couple of helper functions</span></span><br><span class="line">getYears &lt;- <span class="keyword">function</span>(ts) &#123;unique(<span class="built_in">floor</span>(time(ts)))&#125;</span><br><span class="line">getYears(co2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get the number of the month</span></span><br><span class="line"><span class="comment"># this will actually work more generally using frequency()</span></span><br><span class="line">getMonthNos &lt;- <span class="keyword">function</span>(ts)&#123;<span class="number">1</span>:frequency(ts)&#125;</span><br><span class="line">getMonthNos(co2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># we can now computate the averages, first over all months for each year, and</span></span><br><span class="line"><span class="comment">#   second over all years for each month</span></span><br><span class="line">getAves &lt;- <span class="keyword">function</span>(x, by = <span class="string">&quot;year&quot;</span>) &#123;</span><br><span class="line">  years &lt;- getYears(x)</span><br><span class="line">  monthNos &lt;- getMonthNos(x)</span><br><span class="line">  nyears &lt;- <span class="built_in">length</span>(years)</span><br><span class="line">  nmonths &lt;- <span class="built_in">length</span>(monthNos)</span><br><span class="line">  <span class="keyword">if</span> (! (by %in% <span class="built_in">c</span>(<span class="string">&quot;year&quot;</span>, <span class="string">&quot;month&quot;</span>)))&#123;</span><br><span class="line">    stop(<span class="string">&quot;unkwown value for by = &quot;</span>,</span><br><span class="line">         by,</span><br><span class="line">         <span class="string">&quot;; by must be one of &#123;\&quot;year\&quot;,\&quot;month\&quot;&#125;&quot;</span>)</span><br><span class="line">         &#125;</span><br><span class="line">  <span class="keyword">if</span> (by == <span class="string">&quot;year&quot;</span>) &#123;</span><br><span class="line">    aves &lt;- sapply(<span class="number">1</span>:nyears,</span><br><span class="line">                   FUN = <span class="keyword">function</span>(i) &#123;</span><br><span class="line">                     mean(window(x,</span><br><span class="line">                                 start = <span class="built_in">c</span>(years[i], monthNos[<span class="number">1</span>]),</span><br><span class="line">                                 end = <span class="built_in">c</span>(years[i], monthNos[nmonths])))</span><br><span class="line">                   &#125;)</span><br><span class="line">    aves &lt;- data.frame(aves = aves, row.names = years)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    aves &lt;- sapply(<span class="number">1</span>:nmonths,</span><br><span class="line">                   FUN = <span class="keyword">function</span>(i) &#123;</span><br><span class="line">                     mean(window(x,</span><br><span class="line">                                 start = <span class="built_in">c</span>(years[<span class="number">1</span>], monthNos[i]),</span><br><span class="line">                                 end = <span class="built_in">c</span>(years[nyears], monthNos[i]),</span><br><span class="line">                                 frequency = <span class="number">1</span>))</span><br><span class="line">                   &#125;)</span><br><span class="line">    aves &lt;- data.frame(aves = aves, row.names = <span class="built_in">month.abb</span>[monthNos])</span><br><span class="line">  &#125;</span><br><span class="line">  aves</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">head(getAves(co2, by = <span class="string">&quot;month&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># plot them</span></span><br><span class="line">plot(getYears(co2), getAves(co2, by = <span class="string">&quot;year&quot;</span>)$aves,</span><br><span class="line">     type = <span class="string">&quot;l&quot;</span>, xlab = <span class="string">&quot;Year&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;annual average over ll months&quot;</span>)</span><br><span class="line">plot(getAves(co2, by = <span class="string">&quot;month&quot;</span>)$aves,</span><br><span class="line">     type = <span class="string">&quot;l&quot;</span>, xlab = <span class="string">&quot;Year&quot;</span>,xaxt = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">     ylab = <span class="string">&quot;monthly average over all years&quot;</span>)</span><br><span class="line">axis(<span class="number">1</span>,at = getMonthNos(co2), labels = <span class="built_in">month.abb</span>) <span class="comment">#month.abb: month abbreviations</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reduce the white space between plots</span></span><br><span class="line">savePar &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">3</span>,<span class="number">1</span>),</span><br><span class="line">               mar = <span class="built_in">c</span>(<span class="number">2</span>,<span class="number">4</span>,<span class="number">1.5</span>,<span class="number">0.5</span>), oma = <span class="built_in">rep</span>(<span class="number">0.1</span>,<span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># decompositions of a time series</span></span><br><span class="line"><span class="comment"># the default decomposition is an additive one</span></span><br><span class="line">co2_decomp &lt;- decompose(co2)</span><br><span class="line"><span class="comment"># having structure</span></span><br><span class="line">str(co2_decomp)</span><br><span class="line">plot(co2_decomp)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># we can see how the local fits behave as we change various elements</span></span><br><span class="line"><span class="comment">#  xloc is the location where we are fitting</span></span><br><span class="line"><span class="comment">#  proportionRange stands for proportion of the x range, which determine</span></span><br><span class="line"><span class="comment">#     what is meant by local</span></span><br><span class="line"><span class="comment"># all weights are 1 or zero</span></span><br><span class="line"></span><br><span class="line">ourdata &lt;- data.frame(x = xy.raw$x, y = xy.raw$y)</span><br><span class="line">unitWeight &lt;- <span class="keyword">function</span>(xloc, x, proportionRange = <span class="number">0.5</span>)&#123;</span><br><span class="line">  xhalf &lt;- diff(<span class="built_in">range</span>(x)) * proportionRange/<span class="number">2</span></span><br><span class="line">  wts &lt;- <span class="built_in">rep</span>(<span class="number">0</span>, <span class="built_in">length</span>(x))</span><br><span class="line">  wts[x &lt; xloc + xhalf &amp; x &gt; xloc - xhalf] &lt;- <span class="number">1</span></span><br><span class="line">  wts</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># we have our data with x and y as before and need weights</span></span><br><span class="line">xloc &lt;- 0.5</span><br><span class="line">weights &lt;- unitWeight(xloc, xy.raw$x, proportionRange = <span class="number">1</span>)</span><br><span class="line"><span class="comment"># and use thes to fit a line</span></span><br><span class="line"></span><br><span class="line">fitw &lt;- lm(y~x, data = ourdata, weights = weights)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># use a weight function shaped like a Gaussian</span></span><br><span class="line">GaussianWeight &lt;- <span class="keyword">function</span>(xloc, x, h = <span class="number">1</span>)&#123;</span><br><span class="line">  <span class="comment"># normal density</span></span><br><span class="line">  dnorm(x, mean = xloc, sd = h)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the function that will produce a smooth cureve from minimizing the locally</span></span><br><span class="line"><span class="comment">#   weighted sum of squares, or LoWeSS.</span></span><br><span class="line"><span class="comment"># it requires:</span></span><br><span class="line"><span class="comment">#   x,y:  - the data</span></span><br><span class="line"><span class="comment">#   xloc : - x locations at which the estimate is to be calculated</span></span><br><span class="line"><span class="comment">#   span: - a bandwidth</span></span><br><span class="line"><span class="comment">#   weightFn: - a weigthed function ,default will be GaussWeight</span></span><br><span class="line"><span class="comment">#   nloc: - number of equi-spaced locations at which estimate will be calculated</span></span><br><span class="line"><span class="comment">#               if xloc = NULL, ignored otherwise</span></span><br><span class="line"></span><br><span class="line">LoWeSS &lt;- <span class="keyword">function</span>(x, y, xloc = <span class="literal">NULL</span>, span = <span class="number">0.1</span>, weightFn = GaussianWeight,</span><br><span class="line">                   nlocs = <span class="number">200</span>)&#123;</span><br><span class="line">  data &lt;- data.frame(x= x, y = y)</span><br><span class="line">  xrange &lt;- extendrange(x)</span><br><span class="line">  bandwidth &lt;- (diff(xrange)*span)/<span class="number">4</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(xloc))&#123;</span><br><span class="line">    xloc &lt;- seq(xrange[<span class="number">1</span>], xrange[<span class="number">2</span>], length.out = nlocs)</span><br><span class="line">  &#125;</span><br><span class="line">  estimates &lt;- vector(<span class="string">&quot;numeric&quot;</span>, <span class="built_in">length</span> = <span class="built_in">length</span>(xloc))</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:<span class="built_in">length</span>(xloc))&#123;</span><br><span class="line">    weights &lt;- weightFn(xloc[i], x, bandwidth)</span><br><span class="line">    fit &lt;- lm(y~x, data = data, weights = weights)</span><br><span class="line">    pred &lt;- predict(fit, newdata = data.frame(x= xloc[i]))</span><br><span class="line">    estimates[i] &lt;- pred</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># return the estimates</span></span><br><span class="line">  <span class="built_in">list</span>(x = xloc, y = estimates)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x &lt;- xy.raw$x</span><br><span class="line">y &lt;- xy.raw$y</span><br><span class="line">smooth &lt;- LoWeSS(x,y, nlocs = <span class="number">1000</span>, span = <span class="number">0.75</span>)</span><br><span class="line">plot(x,y,col=<span class="string">&quot;grey50&quot;</span>, pch = <span class="number">19</span>, main = <span class="string">&quot;our data&quot;</span>, type = <span class="string">&quot;p&quot;</span>)</span><br><span class="line">lines(smooth$x, smooth$y, col = <span class="string">&quot;steelblue&quot;</span>, lwd = <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the data</span></span><br><span class="line">plot(x, y , col = <span class="string">&quot;grey50&quot;</span>, pch = <span class="number">19</span>, main = <span class="string">&quot;relating y to x&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the LoWeSS estimate</span></span><br><span class="line">lines(smooth$x, smooth$y, col = <span class="string">&quot;steelblue&quot;</span>, lwd = <span class="number">3</span>)</span><br><span class="line"><span class="comment"># add the true mu(x)</span></span><br><span class="line">xordered &lt;- sort(x)</span><br><span class="line">library(stpm)</span><br><span class="line">lines(xordered, mu(xordered), col = <span class="string">&quot;firebrick&quot;</span>, lwd = <span class="number">3</span>, lty = <span class="number">2</span>)</span><br><span class="line">      <span class="comment"># mu function is in library(stpm)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># locally weigthed sums of squares</span></span><br><span class="line">fit &lt;- loess(y~x, data = ourdata)</span><br><span class="line">plot(x,y,col = <span class="string">&quot;grey50&quot;</span>, pch =<span class="number">19</span>, main = <span class="string">&quot;relating y to x&quot;</span>)  </span><br><span class="line"><span class="comment"># get the values predicted by the loess</span></span><br><span class="line">pred &lt;- predict(fit)</span><br><span class="line"><span class="comment"># get the order of the x</span></span><br><span class="line">ord &lt;- order(x)</span><br><span class="line">lines(x[ord], pred[ord], lwd = <span class="number">2</span>, col = <span class="string">&quot;steelblue&quot;</span>)  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># we could also reduce the span being used here (default is 0.75)</span></span><br><span class="line">fit_Large &lt;- loess(y~x, data = ourdata, span = <span class="number">0.15</span>)</span><br><span class="line">pred_Large &lt;- predict(fit_Large)</span><br><span class="line">plot(fit)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># using spans to decompose</span></span><br><span class="line"><span class="comment"># first fit the large span</span></span><br><span class="line">fit &lt;- loess(y~x, data = ourdata, span = <span class="number">0.75</span>)</span><br><span class="line"><span class="comment"># from the fit we extract the estimated residuals</span></span><br><span class="line">r_Large &lt;- fit_Large$residuals</span><br><span class="line"></span><br><span class="line"><span class="comment"># this is another data set that we can plot</span></span><br><span class="line">plot(x, r_Large, col = <span class="string">&quot;grey50&quot;</span>, pch =<span class="number">19</span>,</span><br><span class="line">     main = <span class="string">&quot;s_small fit of r_large on x&quot;</span>)</span><br><span class="line"><span class="comment"># and we can fit this with a smaller span</span></span><br><span class="line">data_resids &lt;- data.frame(r = r_Large, x = x)</span><br><span class="line">fit_small &lt;- loess(r~x, data = data_resids, span = <span class="number">0.2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># get the values predicted by the loess</span></span><br><span class="line">pred_small &lt;- predict(fit_small)</span><br><span class="line"><span class="comment"># need the order of x</span></span><br><span class="line">ord &lt;- order(x)</span><br><span class="line">lines(x[ord], pred_small[ord], lwd = <span class="number">2</span>, col = <span class="string">&quot;steelblue&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r_Remains &lt;- fit_small$residuals</span><br><span class="line">data.remains &lt;- data.frame(r = r_Remains,  x= x)</span><br><span class="line">fit_Tiny &lt;- loess(r~x, data = data.remains, span = <span class="number">0.5</span>)</span><br><span class="line"><span class="comment"># get the values predicteed by the loess</span></span><br><span class="line">pred_Tiny &lt;- predict(fit_Tiny)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># putting together for the various fitted smooths we have adecomposition of the</span></span><br><span class="line"><span class="comment">#  observed values as</span></span><br><span class="line">opt &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">3</span>,<span class="number">1</span>), mar = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="number">2</span>) + <span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line">plot(x[ord], pred_Large[ord], xlab = <span class="string">&quot;&quot;</span>, ylab = <span class="string">&quot;&quot;</span>, xaxt = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">     col = <span class="string">&quot;grey50&quot;</span>, pch =<span class="number">19</span>, cex = <span class="number">0.5</span>, main = <span class="string">&quot;large span smooth&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add a range of residuals rectangle</span></span><br><span class="line">xleft &lt;- 1.01</span><br><span class="line">xright &lt;- 1.02</span><br><span class="line">yDelta &lt;- sd(r_Remains)</span><br><span class="line">rectCol &lt;- adjustcolor(<span class="string">&quot;red&quot;</span>, <span class="number">0.5</span>)</span><br><span class="line">ymiddle &lt;- mean(pred_Large)</span><br><span class="line">rect(xleft, ymiddle - yDelta, xright, ymiddle+yDelta,</span><br><span class="line">     border = <span class="string">&quot;grey50&quot;</span>, col = rectCol)</span><br><span class="line">plot(x[ord], pred_small[ord], xlab = <span class="string">&quot;&quot;</span>, ylab = <span class="string">&quot;&quot;</span>, xaxt = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">     col = <span class="string">&quot;grey50&quot;</span>, pch = <span class="number">19</span>, cex= <span class="number">0.5</span>, main = <span class="string">&quot;small span smooth&quot;</span>)</span><br><span class="line"><span class="comment"># add the same range rectangle</span></span><br><span class="line">ymiddle &lt;- mean(pred_small)</span><br><span class="line">rect(xleft, ymiddle - yDelta, xright, ymiddle+yDelta,</span><br><span class="line">     border = <span class="string">&quot;grey50&quot;</span>, col = rectCol)</span><br><span class="line"></span><br><span class="line">plot(x[ord], pred_small[ord], xlab = <span class="string">&quot;&quot;</span>, ylab = <span class="string">&quot;&quot;</span>, xaxt = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">     col = <span class="string">&quot;grey50&quot;</span>, pch = <span class="number">19</span>, cex= <span class="number">0.5</span>, main = <span class="string">&quot;remaining residuals&quot;</span>)</span><br><span class="line">ablines(h =<span class="number">0</span>, col = <span class="string">&quot;lightgrey&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># add the same range rectangle</span></span><br><span class="line">ymiddle &lt;- mean(r_Remains)</span><br><span class="line">rect(xleft, ymiddle - yDelta, xright, ymiddle+yDelta,</span><br><span class="line">     border = <span class="string">&quot;grey50&quot;</span>, col = rectCol)</span><br><span class="line"></span><br><span class="line">rect(xleft, ybottom, xright, ytop, border = <span class="string">&quot;grey50&quot;</span>, col = rectCol)</span><br><span class="line">par(opt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the seasonal components now vary a little more over the years</span></span><br><span class="line"><span class="comment"># there are similar arguements t.window and t.degree for the loess smoothing of the</span></span><br><span class="line"><span class="comment"># trend component</span></span><br><span class="line">plot(stl(co2, s.window = <span class="number">7</span>, s.degree = <span class="number">1</span>, t.degree = <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">library(<span class="string">&quot;loon&quot;</span>)</span><br><span class="line">l_plot(stl(co2, s.window = <span class="number">7</span>, s.degree = <span class="number">1</span>, t.degree = <span class="number">1</span>))</span><br><span class="line">demo(<span class="string">&quot;l_timeseries&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="transforming-data"><a href="#transforming-data" class="headerlink" title="transforming data"></a>transforming data</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line">x &lt;- <span class="built_in">round</span>(rnorm(<span class="number">10</span>), digits = <span class="number">2</span>)</span><br><span class="line"><span class="comment"># the ranks (in order smallest to largest)</span></span><br><span class="line">rank(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># the family of power transformation</span></span><br><span class="line">powerfun &lt;- <span class="keyword">function</span>(x, alpha)&#123;</span><br><span class="line">  <span class="keyword">if</span> (alpha == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">log</span>(x)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    (x^alpha - <span class="number">1</span>)/alpha</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">library(loon.data); data(SAheart, package = <span class="string">&quot;loon.data&quot;</span>)</span><br><span class="line">library(qqtest)</span><br><span class="line">data &lt;- SAheart$sbp</span><br><span class="line">savePar &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="comment"># note alpha is in descending order here</span></span><br><span class="line"><span class="keyword">for</span> (alpha <span class="keyword">in</span> <span class="built_in">c</span>(<span class="number">2</span>,<span class="number">1</span>,<span class="number">1</span>/<span class="number">2</span>,<span class="number">1</span>/<span class="number">3</span>,<span class="number">0</span>,-<span class="number">1</span>/<span class="number">3</span>,-<span class="number">1</span>/<span class="number">2</span>,-<span class="number">1</span>,-<span class="number">2</span>)) &#123;</span><br><span class="line">  newdata &lt;- powerfun(data, alpha)</span><br><span class="line">  dens &lt;- density(newdata, bw = <span class="string">&quot;SJ&quot;</span>)</span><br><span class="line">  h &lt;- hist(newdata, plot = <span class="literal">FALSE</span>)</span><br><span class="line">  ylim &lt;- extendrange(<span class="built_in">c</span>(dens$y, h$density))</span><br><span class="line">  plot(h, ylim = ylim, freq = <span class="literal">FALSE</span>, yaxt = <span class="string">&quot;n&quot;</span>, xaxt = <span class="string">&quot;n&quot;</span>,</span><br><span class="line">       main = <span class="string">&quot;SAheart&quot;</span>, xlab = paste0(<span class="string">&quot;(sbp)^&quot;</span>, <span class="built_in">round</span>(alpha, digits = <span class="number">2</span>)),</span><br><span class="line">       ylab =<span class="string">&quot;&quot;</span>)</span><br><span class="line">  polygon(dens, col = adjustcolor(<span class="string">&quot;grey50&quot;</span>, <span class="number">0.3</span>))</span><br><span class="line">  qqtest(newdata, main = <span class="string">&quot;normal qqplot&quot;</span>, legend = <span class="literal">FALSE</span>, cex = <span class="number">0.5</span>)</span><br><span class="line">&#125;</span><br><span class="line">par(savePar)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># an interactive exploration of chnaging alpha</span></span><br><span class="line">library(loon)</span><br><span class="line"><span class="comment"># something to scale the data</span></span><br><span class="line">scale01 &lt;- <span class="keyword">function</span>(x) &#123;</span><br><span class="line">  (x - <span class="built_in">min</span>(x))/diff(<span class="built_in">range</span>(x) + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">## setting up the interactive plots that will respond to chaning power</span></span><br><span class="line">power &lt;- <span class="keyword">function</span>(x, xlab = <span class="literal">NULL</span>, labels = <span class="literal">NULL</span>, lowest = -<span class="number">5</span>, highest = <span class="number">5</span>, ...)&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(xlab)) &#123;xlab &lt;- <span class="string">&quot;x&quot;</span>&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(labels)) &#123;labels &lt;- <span class="built_in">as.character</span>(<span class="number">1</span>:<span class="built_in">length</span>(x))&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">#scale and order the x values</span></span><br><span class="line">  xs &lt;- scale01(x)</span><br><span class="line">  ord &lt;- order(xs)</span><br><span class="line">  xs &lt;- xs[ord]</span><br><span class="line">  labels &lt;- labels[ord]</span><br><span class="line">  <span class="comment"># normal quantiles</span></span><br><span class="line">  qs &lt;- qnorm(ppoints(<span class="built_in">length</span>(x)))</span><br><span class="line">  <span class="comment"># qqplot</span></span><br><span class="line">  p &lt;- l_plot(x = qs, y = xs, itemLabel = labels,</span><br><span class="line">              ylabel = xlab, xlab = <span class="string">&quot;Gaussian qunatiles&quot;</span>, ...)</span><br><span class="line">  <span class="comment"># now we iwll build a more complex interface a histogram plus a slider for the</span></span><br><span class="line">  <span class="comment"># power</span></span><br><span class="line">  <span class="comment"># the top level window</span></span><br><span class="line">  tw &lt;- tktoplevel()</span><br><span class="line">  <span class="comment"># create and add the histogram to the top window</span></span><br><span class="line">  hx &lt;- l_hist(xs, xlabel = xlab, yshows = <span class="string">&quot;density&quot;</span>, parent = tw, ...)</span><br><span class="line">  <span class="comment"># now create a slider whose value will be the alpha of the power</span></span><br><span class="line">  <span class="comment">#  transformation</span></span><br><span class="line">  alpha_x &lt;- tclVar(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">  <span class="comment"># slider for x</span></span><br><span class="line">  sx &lt;- tkscale(tw, orient = <span class="string">&#x27;horizontal&#x27;</span>, label = <span class="string">&#x27;power x&#x27;</span>,</span><br><span class="line">                variable = alpha_x, from = lowest, to = highest,</span><br><span class="line">                resolution = <span class="number">0.1</span>)</span><br><span class="line">  <span class="comment"># pack the histogram and slider into the same window</span></span><br><span class="line">  tkpack(sx, fill = <span class="string">&#x27;x&#x27;</span>, side = <span class="string">&#x27;bottom&#x27;</span>)</span><br><span class="line">  tkpack(hx, fill = <span class="string">&#x27;both&#x27;</span>, expand = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># now we need an update function to evaluate when the slider changes</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># this is the power function that will change with the slider</span></span><br><span class="line">  update &lt;- <span class="keyword">function</span>(...)&#123;</span><br><span class="line">    alphax &lt;- <span class="built_in">as.numeric</span>(tclvalue(alpha_x))</span><br><span class="line">    newx &lt;- sort(scale01(powerfun(x,alphax)))</span><br><span class="line">    <span class="comment"># update the label</span></span><br><span class="line">    xlabel &lt;- <span class="keyword">if</span>(alphax ==<span class="number">0</span>)&#123;paste0(<span class="string">&quot;log(&quot;</span>,xlab,<span class="string">&quot;)&quot;</span>)</span><br><span class="line">      &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="keyword">if</span> (alphax == <span class="number">1</span>)&#123;</span><br><span class="line">            xlab</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            paste0(xlab, <span class="string">&quot;^&quot;</span>, alphax)</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    xrng &lt;- <span class="built_in">range</span>(newx)</span><br><span class="line">    <span class="comment"># update the qqplot p</span></span><br><span class="line">    l_configure(p, y = newx, ylabel = xlabel, xlabel = <span class="string">&quot;Gaussian quantiles&quot;</span>)</span><br><span class="line">    <span class="comment"># update the histogram</span></span><br><span class="line">    binwidthx &lt;- hx[<span class="string">&#x27;binwidth&#x27;</span>]</span><br><span class="line">    l_configure(hx, x = newx, binwidth = binwidthx, xlabel = xlabel)</span><br><span class="line">    l_scaleto_world(hx)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment"># configure the scale to call &quot;update&quot;</span></span><br><span class="line">  tkconfigure(sx, command = update)</span><br><span class="line">  <span class="built_in">invisible</span>(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with(SAheart,</span><br><span class="line">     p &lt;- power(x= sbp, labels = paste(<span class="string">&quot;Patient&quot;</span>, rownames(SAheart)),</span><br><span class="line">                linkingGroup = <span class="string">&quot;SAheart&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># turkey&#x27;s ladder of power transformation</span></span><br><span class="line">data &lt;- rchisq(<span class="number">200</span>, <span class="number">2</span>)</span><br><span class="line">power(data) <span class="comment"># Create a Power Link Object</span></span><br><span class="line"><span class="comment"># if it is concenrated on lower values, then move the power lower on the ladder</span></span><br><span class="line"><span class="comment"># otherwise, in the reverse order</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># power transformation</span></span><br><span class="line">library(MASS)</span><br><span class="line">data(mammals)</span><br><span class="line"></span><br><span class="line"><span class="comment"># straightening plots via power transformation</span></span><br><span class="line">power_xy &lt;- <span class="keyword">function</span>(x, y = <span class="literal">NULL</span>, xlab = <span class="literal">NULL</span>, ylab = <span class="literal">NULL</span>,</span><br><span class="line">                     from= <span class="number">5</span>, to = -<span class="number">5</span>,...)&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(xlab)) &#123;xlab &lt;- <span class="string">&quot;x&quot;</span>&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(ylab)) &#123;ylab &lt;- <span class="string">&quot;y&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">  scale01 &lt;- <span class="keyword">function</span>(x) &#123;</span><br><span class="line">    (x - <span class="built_in">min</span>(x))/diff(<span class="built_in">range</span>(x) + <span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  tt &lt;- tktoplevel() <span class="comment"># this is about dynamic graphic in r (你可以看一下)</span></span><br><span class="line">  <span class="comment"># https://www.stat.berkeley.edu/~spector/s244/Dyngraph.html</span></span><br><span class="line">  <span class="comment"># The basic widget in Tk is the frame, which is essentially a container for</span></span><br><span class="line">  <span class="comment"># any other widgets you wish to use.</span></span><br><span class="line">  <span class="comment"># You can have as many frames as you want, but each individual entity which</span></span><br><span class="line">  <span class="comment"># appears on the screen must be in a &quot;top level&quot; frame,</span></span><br><span class="line">  <span class="comment"># created with the tktoplevel function.</span></span><br><span class="line">  <span class="comment"># When using Tk, you first create a widget (specifying its appearance, the</span></span><br><span class="line">  <span class="comment"># command to be executed when the widget is activated, etc.), and then you</span></span><br><span class="line">  <span class="comment"># specify how it should appear in its parent frame. While Tk provides a number</span></span><br><span class="line">  <span class="comment"># of different schemes for achieving this, we&#x27;ll discuss the technique known as</span></span><br><span class="line">  <span class="comment"># &quot;packing&quot;. The basic idea is to group together widgets (and accompanying</span></span><br><span class="line">  <span class="comment"># labels, if appropriate) into a series of frames, and then to call the tkpack</span></span><br><span class="line">  <span class="comment"># function to put the widgets in the frames, then to finally pack the frames</span></span><br><span class="line">  <span class="comment"># into a main frame which is contained in a top-level widget</span></span><br><span class="line">  <span class="comment"># By default, objects are backed into a frame from top to bottom, with each</span></span><br><span class="line">  <span class="comment"># object being centered within its parent frame. You can control how widgets</span></span><br><span class="line">  <span class="comment"># get packed into a frame by the order in which you call tkpack, and the</span></span><br><span class="line">  <span class="comment"># optional side= argument which can take the values &quot;left&quot;, &quot;right&quot;, &quot;top&quot;</span></span><br><span class="line">  <span class="comment"># or &quot;bottom&quot;</span></span><br><span class="line">  xs &lt;- scale01(x)</span><br><span class="line">  ys &lt;- scale01(y)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># scatterplot</span></span><br><span class="line">  p &lt;- l_plot(x= xs, y = ys, xlabel = xlab, ylabel = ylab,</span><br><span class="line">              parent = tt,...)</span><br><span class="line">  <span class="comment"># a valid Tk parent widget path. When the parent widget is specified (i.e.</span></span><br><span class="line">  <span class="comment">#   not NULL) then the plot widget needs to be placed using some geometry</span></span><br><span class="line">  <span class="comment">#   manager like tkpack or tkplace in order to be displaye</span></span><br><span class="line">  fit &lt;- lm(ys~xs)</span><br><span class="line">  <span class="comment"># layer a fitted line</span></span><br><span class="line">  xrng &lt;- <span class="built_in">range</span>(xs)</span><br><span class="line">  yhat &lt;- predict(fit, data.frame(xs = xrng))</span><br><span class="line">  line &lt;- l_layer_line(p, x= xrng, y = yhat, linewidth = <span class="number">2</span>, index = <span class="string">&quot;end&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># histogram on each</span></span><br><span class="line">  hx &lt;- l_hist(xs, xlabel = xlab, yshows = <span class="string">&quot;density&quot;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># setting up separate sliders for each power transformation</span></span><br><span class="line">  alpha_x &lt;- tclVar(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">  alpha_y &lt;- tclVar(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">  sx &lt;- tkscale(tt, orient = <span class="string">&#x27;vertical&#x27;</span>, label = <span class="string">&#x27;power x&#x27;</span>, variable = alpha_x,</span><br><span class="line">                from = from, to = to, resoluation = <span class="number">0.1</span>)</span><br><span class="line">  sy &lt;- tkscale(tt, orient = <span class="string">&#x27;vertical&#x27;</span>, label = <span class="string">&#x27;power x&#x27;</span>, variable = alpha_y,</span><br><span class="line">                from = from, to = to, resoluation = <span class="number">0.1</span>)</span><br><span class="line">  tkpack(sy, fill = <span class="string">&#x27;y&#x27;</span>, side = <span class="string">&#x27;right&#x27;</span>)</span><br><span class="line">  tkpack(p, fill = <span class="string">&#x27;both&#x27;</span>, expand = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line">  update &lt;- <span class="keyword">function</span>(...) &#123;</span><br><span class="line">    alphax &lt;- <span class="built_in">as.numeric</span>(tclvalue(alpha_x))</span><br><span class="line">    alphay &lt;- <span class="built_in">as.numeric</span>(tclvalue(alpha_y))</span><br><span class="line">    newx &lt;- scale01(powerfun(x, alphax))</span><br><span class="line">    newy &lt;- scale01(powerfun(y, alphay))</span><br><span class="line">    xlabel &lt;- <span class="keyword">if</span> (alphax == <span class="number">0</span>) &#123;paste0(<span class="string">&quot;log(&quot;</span>, xlab,<span class="string">&quot;)&quot;</span>)&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (alphax== <span class="number">1</span>) &#123;xlab&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        paste0(xlab, <span class="string">&quot;^&quot;</span>, alphax)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ylabel &lt;- <span class="keyword">if</span> (alphay == <span class="number">0</span>) &#123;paste0(<span class="string">&quot;log(&quot;</span>, ylab,<span class="string">&quot;)&quot;</span>)&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (alphay== <span class="number">1</span>) &#123;ylab&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        paste0(ylab, <span class="string">&quot;^&quot;</span>, alphay)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment"># fit the line to the new data</span></span><br><span class="line">    fit.temp &lt;- lm(newy~newx)</span><br><span class="line">    xrng &lt;- <span class="built_in">range</span>(newx)</span><br><span class="line">    <span class="comment">## get the fitted line</span></span><br><span class="line">    yhat &lt;- predict(fit.temp, data.frame(newx=xrng))</span><br><span class="line">    <span class="comment"># update the line values</span></span><br><span class="line">    l_configure(line, y= yhat, x=xrng)</span><br><span class="line">    <span class="comment"># reconfigure the points</span></span><br><span class="line">    l_configure(p, x = newx, y= newy, xlabel = xlabel, ylabel = ylabel)</span><br><span class="line">    <span class="comment"># and the histogram</span></span><br><span class="line">    binwidthx &lt;- hx[<span class="string">&#x27;binwidth&#x27;</span>]</span><br><span class="line">    binwidthy &lt;- hx[<span class="string">&#x27;binwidth&#x27;</span>]</span><br><span class="line">    l_configure(hx, x = newx, binwidth = binwidth,</span><br><span class="line">                xlabel = xlabel)</span><br><span class="line">    l_scaleto_world(hx) <span class="comment">#Change Plot Region to Display All Plot Data</span></span><br><span class="line">    l_configure(hy, x = newy,</span><br><span class="line">                binwidth = binwidthy,</span><br><span class="line">                xlabel = ylabel)</span><br><span class="line">    l_scaleto_world(hy)</span><br><span class="line">  &#125;</span><br><span class="line"> <span class="comment"># add the update functions to the sliders</span></span><br><span class="line">  tkconfigure(sx, commmand = update)</span><br><span class="line">  tkconfigure(sy, commmand = update)</span><br><span class="line">  invisbile(p)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="categorical-data-overview"><a href="#categorical-data-overview" class="headerlink" title="categorical data overview"></a>categorical data overview</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">library(loon)</span><br><span class="line">areas &lt;- unique(olive[,<span class="string">&quot;Area&quot;</span>])</span><br><span class="line">nAreas &lt;- <span class="built_in">length</span>(areas)</span><br><span class="line">counts &lt;- <span class="built_in">rep</span>(<span class="number">0</span>, nAreas)</span><br><span class="line">regions &lt;- <span class="built_in">c</span>()</span><br><span class="line"><span class="comment"># construct the dataset</span></span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:nAreas) &#123;</span><br><span class="line">  counts[i] &lt;- <span class="built_in">sum</span>(olive[,<span class="string">&quot;Area&quot;</span>] == areas[i])</span><br><span class="line">  regions &lt;- <span class="built_in">c</span>(regions, unique(olive[olive[,<span class="string">&quot;Area&quot;</span>] == areas[i], <span class="string">&quot;Region&quot;</span>]))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># turn regions into a factor with the proper names</span></span><br><span class="line">regions &lt;- as.factor(levels(olive[,<span class="string">&quot;Region&quot;</span>])[regions])</span><br><span class="line"><span class="comment"># our constructed dataset of counts</span></span><br><span class="line">oliveOilCounts &lt;- data.frame(Region = regions, Area = areas, count= counts)</span><br><span class="line"></span><br><span class="line">library(treemap)</span><br><span class="line">treemap(oliveOilCounts, index = <span class="built_in">c</span>(<span class="string">&quot;Region&quot;</span>, <span class="string">&quot;Area&quot;</span>), vSize = <span class="string">&quot;count&quot;</span>) <span class="comment"># vsize could be any variate</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># could construct one interactively</span></span><br><span class="line">itreemap(oliveOilCounts, index = <span class="built_in">c</span>(<span class="string">&quot;Region&quot;</span>), vSize = <span class="string">&quot;count&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># another package that based on ggplot2 for graphics and employs an algorithm which</span></span><br><span class="line"><span class="comment"># tries to achive much squarer boxes</span></span><br><span class="line"></span><br><span class="line">library(treemapify)</span><br><span class="line">library(ggplot2)</span><br><span class="line">treeMapPlot &lt;- ggplot(oliveOilCounts, aes(area = count, fill = Region, <span class="comment"># colour by region</span></span><br><span class="line">                                          label = Area, subgroup = Region))</span><br><span class="line">treeMapPlot + geom_treemap() + geom_treemap_text() +</span><br><span class="line">  geom_treemap_subgroup_border() + geom_treemap_subgroup_text()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># alternatively, the coordinates of the squares can be had via the treemapify(...)</span></span><br><span class="line"><span class="comment"># function</span></span><br><span class="line">library(treemapify)</span><br><span class="line"><span class="comment"># alternatively</span></span><br><span class="line">treeMapCoordinates &lt;- treemapify(oliveOilCounts, area = <span class="string">&quot;count&quot;</span>,</span><br><span class="line">                                   subgroup = <span class="string">&quot;Region&quot;</span>)</span><br><span class="line">head(treeMapCoordinates)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># non-nested data - venneuler package</span></span><br><span class="line">library(venneuler)  <span class="comment"># 姐，这个我不准备run了，因为这个要下载java里的jdk， 还有rstudio</span></span><br><span class="line"><span class="comment"># 里的rjava和vennecular， 我不想下载了</span></span><br><span class="line">ve &lt;- venneuler(<span class="built_in">c</span>(A=<span class="number">1</span>, B=<span class="number">1</span>, <span class="string">&quot;A&amp;B&quot;</span> = <span class="number">1</span>))</span><br><span class="line">plot(ve)</span><br><span class="line"></span><br><span class="line">HairEye &lt;- apply(HairEyeColor, <span class="number">1</span>:<span class="number">2</span>, <span class="built_in">sum</span>)</span><br><span class="line">library(eikosograms)</span><br><span class="line">eikos(y = <span class="string">&quot;Hair&quot;</span>, x = <span class="string">&quot;Eye&quot;</span>, data = HairEye, xaxs = <span class="literal">FALSE</span>, yaxs = <span class="literal">FALSE</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="categorical-data"><a href="#categorical-data" class="headerlink" title="categorical data"></a>categorical data</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># categorical data</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line">city &lt;- <span class="built_in">c</span>(<span class="string">&quot;Kitchener&quot;</span>, <span class="string">&quot;Waterloo&quot;</span>)</span><br><span class="line">housing &lt;- <span class="built_in">c</span>(<span class="string">&quot;House&quot;</span>, <span class="string">&quot;Apartment&quot;</span>, <span class="string">&quot;Residence&quot;</span>)</span><br><span class="line"><span class="comment"># fake data</span></span><br><span class="line">counts &lt;- rpois(<span class="number">6</span>, lambda = <span class="number">50</span>)</span><br><span class="line"><span class="comment"># arranged in a rectangular array</span></span><br><span class="line">vacancy &lt;- matrix(counts, nrow = <span class="built_in">length</span>(city), ncol = <span class="built_in">length</span>(housing),</span><br><span class="line">                  byrow = <span class="literal">TRUE</span>, <span class="built_in">dimnames</span> = <span class="built_in">list</span>(city = city, housing = housing))</span><br><span class="line"><span class="comment"># coereced to be an object of class table</span></span><br><span class="line">vacancy &lt;- as.table(vacancy)</span><br><span class="line">vacancy</span><br><span class="line"><span class="comment"># creating a multi-way table</span></span><br><span class="line">term &lt;- <span class="built_in">c</span>(<span class="string">&quot;Fall&quot;</span>, <span class="string">&quot;Winter&quot;</span>, <span class="string">&quot;Spring&quot;</span>)</span><br><span class="line"><span class="comment"># more fake counts</span></span><br><span class="line">counts &lt;- seq(from = <span class="number">10</span>, to = <span class="number">180</span>, by = <span class="number">10</span>)</span><br><span class="line">vacancy &lt;- array(counts,</span><br><span class="line">                 <span class="built_in">dim</span> = <span class="built_in">c</span>(<span class="built_in">length</span>(city), <span class="built_in">length</span>(housing), <span class="built_in">length</span>(term)),</span><br><span class="line">                 <span class="built_in">dimnames</span> = <span class="built_in">list</span>(city = city, housing = housing, term = term))</span><br><span class="line">vacancy &lt;- as.table(vacancy)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reordering variates in tables</span></span><br><span class="line"><span class="comment"># the array dimension permutation function aperm(..)</span></span><br><span class="line">aperm(vacancy, perm = <span class="built_in">c</span>(<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># construting tables from data</span></span><br><span class="line">library(loon.data)</span><br><span class="line">data(<span class="string">&quot;SAheart&quot;</span>, package = <span class="string">&quot;loon.data&quot;</span>)</span><br><span class="line">table(SAheart$chd, SAheart$famhist, dnn = <span class="built_in">c</span>(<span class="string">&quot;chd&quot;</span>, <span class="string">&quot;famhist&quot;</span>))</span><br><span class="line"><span class="comment"># by cross-tabulation (&quot;cross tabs or xtabs)</span></span><br><span class="line">xtabs(~chd + famhist, data = SAheart)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># collapsing dimensions (marginalizing, projecting)</span></span><br><span class="line"><span class="comment"># zero dimensional</span></span><br><span class="line">margin.table(HairEyeColor)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 dimensional</span></span><br><span class="line">margin.table(HairEyeColor, margin = <span class="number">1</span>)</span><br><span class="line"><span class="comment"># 2 dimensioanl -- here margins 1 and 2 (&quot;hair&quot;, &quot;eye&quot;) are preserved</span></span><br><span class="line">margin.table(HairEyeColor, margin = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># note: except for 0 dimensional. there are the same as using apply with sum</span></span><br><span class="line">apply(HairEyeColor, MARGIN = <span class="number">1</span>, FUN = <span class="built_in">sum</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># adding sums to a table</span></span><br><span class="line"><span class="comment"># every margin is summed</span></span><br><span class="line">addmargins(HairEyeColor)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># just producing marginal sums over dimension 2(&quot;eye&quot;) values</span></span><br><span class="line"><span class="comment"># for each pair(i,k) pf remaining variates &quot;hair&quot; and &quot;sex</span></span><br><span class="line">addmargins(HairEyeColor, margin = <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># producing marginal sums over both dimensions 1 and 2 (&quot;hair&quot;, and &quot;eye&quot;)</span></span><br><span class="line">addmargins(HairEyeColor, margin = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sums to proportions</span></span><br><span class="line"><span class="comment"># no margins fixed, just total.. single multinomial</span></span><br><span class="line"><span class="built_in">round</span>(prop.table(HairEyeColor), <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># one margin is fiexed, (the theird here, i.e. Sex) is fixed,... as may multinomial</span></span><br><span class="line"><span class="comment">#  as in</span></span><br><span class="line"><span class="built_in">round</span>(prop.table(HairEyeColor, margin = <span class="number">3</span>),<span class="number">2</span>)</span><br><span class="line"><span class="comment"># probability models from tables</span></span><br><span class="line"><span class="comment"># easier to see with sums for a two way table</span></span><br><span class="line">HairEye &lt;- margin.table(HairEyeColor, margin = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="comment"># sum of each table&#x27;s proportions must be one</span></span><br><span class="line"><span class="built_in">round</span>(prop.table(HairEye, margin = <span class="number">2</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library(tidytable) <span class="comment"># provide an implementation of the rules we developed</span></span><br><span class="line"><span class="comment"># for table analysis</span></span><br><span class="line"></span><br><span class="line">tidytable(HairEyeColor)$table</span><br><span class="line"></span><br><span class="line">proportions &lt;- <span class="built_in">round</span>(prop.table(HairEye, margin = <span class="number">2</span>), <span class="number">2</span>)</span><br><span class="line">tidyproportions &lt;- tidytable(proportions)</span><br><span class="line">tidyproportions$proportions</span><br></pre></td></tr></table></figure>

<h2 id="categorical-modelling"><a href="#categorical-modelling" class="headerlink" title="categorical modelling"></a>categorical modelling</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># categorical modelling - modelling and independence</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line">HairEye &lt;- margin.table(HairEyeColor, margin = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line">total &lt;- margin.table(HairEye)</span><br><span class="line">colsums &lt;- margin.table(HairEye, margin = <span class="number">2</span>)</span><br><span class="line">colsums</span><br><span class="line">rowsums &lt;- margin.table(HairEye, margin = <span class="number">1</span>)</span><br><span class="line">rowsums</span><br><span class="line">rowProbs &lt;- rowsums / total</span><br><span class="line">rowProbs</span><br><span class="line"><span class="comment"># Draw one sample for column 1</span></span><br><span class="line">rmultinom(n = <span class="number">1</span>, size = colsums[<span class="number">1</span>], prob = rowProbs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># the function that generates a new table for fixed column totals</span></span><br><span class="line"><span class="comment">#   and given row probabilities</span></span><br><span class="line">generateCondTable &lt;- <span class="keyword">function</span>(columnSums = seq(<span class="number">100</span>, <span class="number">300</span>, <span class="number">100</span>),</span><br><span class="line">                              rowProbs = seq(<span class="number">0.1</span>,<span class="number">0.4</span>,<span class="number">0.1</span>),</span><br><span class="line">                              dnn = <span class="literal">NULL</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(dnn)) &#123;</span><br><span class="line">    dnn &lt;- <span class="built_in">list</span>(Y = paste0(<span class="string">&quot;y_&quot;</span>, <span class="number">1</span>:<span class="built_in">length</span>(rowProbs)),</span><br><span class="line">               X = paste0(<span class="string">&quot;x_&quot;</span>, <span class="number">1</span>:<span class="built_in">length</span>(columnSums))</span><br><span class="line">               )</span><br><span class="line">  &#125;</span><br><span class="line"> nRows &lt;- <span class="built_in">length</span>(rowProbs)</span><br><span class="line"> nCols &lt;- <span class="built_in">length</span>(columnSums)</span><br><span class="line"> result &lt;- matrix(nrow = nRows, ncol = nCols)</span><br><span class="line"> <span class="keyword">for</span> (j <span class="keyword">in</span> <span class="number">1</span>:nCols)&#123;</span><br><span class="line">   result[,j] &lt;- rmultinom(n = <span class="number">1</span>, size = columnSums[j], prob = rowProbs)</span><br><span class="line"> &#125;</span><br><span class="line"> result &lt;- as.table(result)</span><br><span class="line"> <span class="built_in">dimnames</span>(result) &lt;- dnn</span><br><span class="line"> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># unconditional - NO fixed margin</span></span><br><span class="line">generateUncondTable &lt;- <span class="keyword">function</span>(total = <span class="number">1000</span>, colProbs = seq(<span class="number">0.1</span>, <span class="number">0.4</span>, <span class="number">0.1</span>),</span><br><span class="line">                                rowProbs = seq(<span class="number">0.4</span>, <span class="number">0.1</span>, -<span class="number">0.1</span>), dnn = <span class="literal">NULL</span>)&#123;</span><br><span class="line">  colSums &lt;- rmultinom(n=<span class="number">1</span>, size = total, prob = colProbs)</span><br><span class="line">  generateCondTable(columnSums = colSums, rowProbs = rowProbs, dnn = dnn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># generating a new table under the hypothesis of independence , from an existing</span></span><br><span class="line"><span class="comment"># table of counts</span></span><br><span class="line">generateTable &lt;- <span class="keyword">function</span>(Table, y, x, conditionalTest = <span class="literal">TRUE</span>) &#123;</span><br><span class="line">  new_table &lt;- margin.table(Table, margin = <span class="built_in">c</span>(y,x))</span><br><span class="line">  <span class="comment">#get the marginal probabilities for the response variates</span></span><br><span class="line">  rowSums &lt;- margin.table(new_table, margin = y)</span><br><span class="line">  rowProbs &lt;- prop.table(rowSums)</span><br><span class="line">  <span class="comment"># get the marginal probailities for the conditioning variate</span></span><br><span class="line">  colSums &lt;- margin.table(new_table, margin = x)</span><br><span class="line">  colProbs &lt;- prop.table(colSums)</span><br><span class="line">  <span class="comment"># get the dnn</span></span><br><span class="line">  dnn &lt;- <span class="built_in">dimnames</span>(new_table)</span><br><span class="line">  <span class="keyword">if</span> (conditionalTest)&#123;</span><br><span class="line">    generateCondTable(columnSums = colSums, rowProbs = rowProbs,</span><br><span class="line">                      dnn = dnn)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    generateUncondTable(total = <span class="built_in">sum</span>(new_table),</span><br><span class="line">                        colProbs = colProbs,</span><br><span class="line">                        rowProbs = rowProbs,</span><br><span class="line">                        dnn = dnn)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># need to functions of the single argument data which will geenrate new data under</span></span><br><span class="line"><span class="comment"># the hypothesis</span></span><br><span class="line">generateTableDataCond &lt;- <span class="keyword">function</span>(data)&#123;</span><br><span class="line">  newtable &lt;- generateTable(data$table, y = data$y, x = data$x,</span><br><span class="line">                            conditionalTest = <span class="literal">TRUE</span>)</span><br><span class="line">  <span class="built_in">list</span>(table = newtable, y= data$y, x = data$x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">generateTableDataUncond &lt;- <span class="keyword">function</span>(data)&#123;</span><br><span class="line">  newtable &lt;- generateTable(data$table, y = data$y, x = data$x,</span><br><span class="line">                            conditionalTest = <span class="literal">FALSE</span>)</span><br><span class="line">  <span class="built_in">list</span>(table = newtable, y= data$y, x = data$x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the function that will show an eikosogram</span></span><br><span class="line">showTable &lt;- <span class="keyword">function</span>(data, Suspect, draw = <span class="literal">FALSE</span>)&#123;</span><br><span class="line">  result &lt;- eikos(y =data$y, x = data$x,</span><br><span class="line">                  data = data$table, legend = <span class="literal">FALSE</span>,</span><br><span class="line">                  xlabs = <span class="literal">FALSE</span>, ylabs = <span class="literal">FALSE</span>,</span><br><span class="line">                  xaxs = <span class="literal">FALSE</span>, yaxs = <span class="literal">FALSE</span>,</span><br><span class="line">                  main = paste(<span class="string">&quot;Suspect&quot;</span>, Suspect),</span><br><span class="line">                  draw = draw) <span class="comment"># default don&#x27;t draw</span></span><br><span class="line">  <span class="built_in">invisible</span>(result)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># since the eikos function is implemented using grid, need to update the lineup function</span></span><br><span class="line"></span><br><span class="line">lineup1 &lt;- <span class="keyword">function</span>(data, showSuspect = <span class="literal">NULL</span>, generateSuspect = NUll,</span><br><span class="line">                   trueLoc = <span class="literal">NULL</span>, layout = <span class="built_in">c</span>(<span class="number">5</span>,<span class="number">4</span>),</span><br><span class="line">                   pkg = <span class="built_in">c</span>(<span class="string">&quot;Graphics&quot;</span>, <span class="string">&quot;grid&quot;</span>, <span class="string">&quot;ggplot2&quot;</span>))&#123;</span><br><span class="line">  <span class="comment"># get the number of suspects in total</span></span><br><span class="line">  nSuspects &lt;- layout[<span class="number">1</span>] *layout[<span class="number">2</span>]</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(trueLoc)) &#123;trueLoc &lt;- sample(<span class="number">1</span>:nSuspects, <span class="number">1</span>)&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(showSuspect)) &#123;stop(<span class="string">&quot;need a plot function for the subject&quot;</span>)&#125;</span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">is.null</span>(generateSuspect)) &#123; stop(<span class="string">&quot;need a function to generate subject&quot;</span>)&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment"># need to decide which subject to present</span></span><br><span class="line">  presentSuspect &lt;- <span class="keyword">function</span>(suspectNo)&#123;</span><br><span class="line">    <span class="keyword">if</span> (SuspectNo != trueLoc) &#123;data &lt;- generateSuspect(data)&#125;</span><br><span class="line">    showSuspect(data, suspectNo)&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment"># plotting depends on the plotting package</span></span><br><span class="line">  pkg &lt;- match.arg(pkg) <span class="comment"># Argument Verification Using Partial Matching</span></span><br><span class="line">  <span class="built_in">switch</span>(pkg,</span><br><span class="line">         <span class="string">&quot;graphics&quot;</span> = &#123;</span><br><span class="line">           savePar &lt;- par(mfrow = layout,</span><br><span class="line">                          mar = <span class="built_in">c</span>(<span class="number">2.5</span>,<span class="number">0.1</span>,<span class="number">3</span>,<span class="number">0.1</span>),</span><br><span class="line">                          oma = <span class="built_in">rep</span>(<span class="number">0</span>,<span class="number">4</span>))</span><br><span class="line">           sapply(<span class="number">1</span>:nSuspects, FUN = presentSuspect)</span><br><span class="line">           <span class="comment"># the plot layout here is of no value for graphics</span></span><br><span class="line">           plotLayput &lt;- layout</span><br><span class="line">           par(savePar)</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="string">&quot;grid&quot;</span> = &#123;</span><br><span class="line">           grobs &lt;- lapply(<span class="number">1</span>:nSuspects, FUN = presentSuspect)</span><br><span class="line">           plotLayout &lt;- arrangeGrob(grobs = plots, <span class="comment"># Arrange multiple grobs on a page</span></span><br><span class="line">                                     nrow = layout[<span class="number">1</span>], ncol = layout[<span class="number">2</span>])</span><br><span class="line">         &#125;,</span><br><span class="line">         <span class="string">&quot;ggplot2&quot;</span> = &#123;</span><br><span class="line">           plots &lt;- lapply(<span class="number">1</span>:nSuspects, FUN = presentSuspect)</span><br><span class="line">           plotLayout &lt;- arrangeGrob(grobs = plots,</span><br><span class="line">                                     nrow = layput[<span class="number">1</span>], ncol = layout[<span class="number">2</span>])</span><br><span class="line">         &#125;,</span><br><span class="line">         stop(<span class="string">&quot;Wrong pkg&quot;</span>))</span><br><span class="line">  <span class="comment"># return obfuscated location and plot (if not &quot;graphics)</span></span><br><span class="line">  <span class="built_in">list</span>(trueLoc = hideLocation(trueLoc, nSuspects),</span><br><span class="line">       plotLayout = plotLayout)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">results &lt;- lineup(..., pkg = <span class="string">&quot;grid&quot;</span>,...) <span class="comment"># must supple other args</span></span><br><span class="line">grid.arrange(results$plotLayout) <span class="comment"># display the lineup</span></span><br><span class="line">revealLocation(results$trueLoc) <span class="comment"># reveal the true location</span></span><br><span class="line"></span><br><span class="line">library(eikosograms); library(gridExtra)</span><br><span class="line">results &lt;- lineup1(data,</span><br><span class="line">                  generateSuspect = generateTableDataCond,</span><br><span class="line">                  showSuspect = showTable,</span><br><span class="line">                  layout = <span class="built_in">c</span>(<span class="number">5</span>,<span class="number">5</span>),</span><br><span class="line">                  pkg = <span class="string">&quot;grid&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># display equivalence in eikosograms</span></span><br><span class="line">titanicsurvclass &lt;- margin.table(Titanic, margin = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">4</span>))</span><br><span class="line">mosaicplot(titanicsurvclass, main = <span class="string">&quot;MOsaic plot (two way table&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># spine plot</span></span><br><span class="line">spineplot(titanicsurvclass, main = <span class="string">&quot;spineplot (two way table&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># eikosograms and mosaic plots differ when there are more than two variates</span></span><br><span class="line">eikos(y = <span class="string">&quot;Survived&quot;</span>, x = <span class="built_in">c</span>(<span class="string">&quot;Class&quot;</span>, <span class="string">&quot;Sex&quot;</span>),</span><br><span class="line">      data = Titanic, xaxs = <span class="literal">FALSE</span>, yaxs = <span class="literal">FALSE</span>,</span><br><span class="line">      main = <span class="string">&quot;Eikosogram (three way table)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># mosaic plot, need to construct the marginal table first,</span></span><br><span class="line"><span class="comment"># note that the table is ordered so that survived is first,</span></span><br><span class="line"><span class="comment"># then class and sex (to match the eikosogram order above)</span></span><br><span class="line">titanicsurvclasssex &lt;- margin.table(Titanic, <span class="built_in">c</span>(<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># the mosaic plot</span></span><br><span class="line">mosaicplot(titanicsurvclasssex, main = <span class="string">&quot;mosaic plot ( three way table&quot;</span>)</span><br></pre></td></tr></table></figure>


<h2 id="onmaps"><a href="#onmaps" class="headerlink" title="onmaps"></a>onmaps</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># onmaps</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line">library(maps)</span><br><span class="line">savePar &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="comment"># first the map from the maps package</span></span><br><span class="line">map(<span class="string">&quot;world&quot;</span>, <span class="string">&quot;Canada&quot;</span>, xlim = <span class="built_in">c</span>(-<span class="number">141</span>, -<span class="number">53</span>), ylim = <span class="built_in">c</span>(<span class="number">40</span>, <span class="number">85</span>),</span><br><span class="line">    col = <span class="string">&quot;grey90&quot;</span>, fill= <span class="literal">TRUE</span>)</span><br><span class="line">title(main = <span class="string">&quot;maps package&quot;</span>)</span><br><span class="line"><span class="comment"># or use the map from the mapdata package</span></span><br><span class="line">library(mapdata)</span><br><span class="line">map(<span class="string">&quot;worldHires&quot;</span>, <span class="string">&quot;canada&quot;</span>, xlim = <span class="built_in">c</span>(-<span class="number">141</span>, -<span class="number">53</span>), ylim = <span class="built_in">c</span>(<span class="number">40</span>, <span class="number">85</span>),</span><br><span class="line">        col = <span class="string">&quot;grey90&quot;</span>, fill = <span class="literal">TRUE</span>)</span><br><span class="line">title(main = <span class="string">&quot;mapdata package&quot;</span>)</span><br><span class="line">par(savePar)</span><br><span class="line"></span><br><span class="line"><span class="comment"># annual precipitation as thermometer glyphs</span></span><br><span class="line">library(maps)</span><br><span class="line">precip &lt;- read.csv(<span class="string">&quot;/Users/xuanxiaowu/Desktop/stat442/rcode/precip.csv&quot;</span>)</span><br><span class="line"><span class="comment"># 这个csv可以在网上找到， 如果你想要的话我给你email， 或者等过几天我学一下github</span></span><br><span class="line"></span><br><span class="line">n &lt;- nrow(precip)</span><br><span class="line">lat &lt;- vector(<span class="string">&quot;numeric&quot;</span>, n)</span><br><span class="line">pop &lt;- vector(<span class="string">&quot;numeric&quot;</span>, n)</span><br><span class="line">long &lt;- vector(<span class="string">&quot;numeric&quot;</span>, n)</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> <span class="number">1</span>:n) &#123;</span><br><span class="line">  city &lt;- precip[i, <span class="string">&quot;name&quot;</span>]</span><br><span class="line">  selected.city &lt;- canada.cities[,<span class="string">&quot;name&quot;</span>] == city</span><br><span class="line">  lat[i] &lt;- canada.cities[selected.city, <span class="string">&quot;lat&quot;</span>]</span><br><span class="line">  long[i] &lt;- canada.cities[selected.city, <span class="string">&quot;long&quot;</span>]</span><br><span class="line">  pop[i] &lt;- canada.cities[selected.city, <span class="string">&quot;pop&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cities &lt;- data.frame(precip, lat = lat, long= long, pop = pop)</span><br><span class="line"><span class="comment"># take the subset</span></span><br><span class="line">indices &lt;- <span class="built_in">c</span>(<span class="number">5</span>,<span class="number">13</span>,<span class="number">18</span>, <span class="number">20</span>, <span class="number">24</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">29</span>, <span class="number">32</span>)</span><br><span class="line">cities &lt;- cities[indices, ]</span><br><span class="line">map(<span class="string">&quot;world&quot;</span>, <span class="string">&quot;Canada&quot;</span>, plot = <span class="literal">TRUE</span>, fill = <span class="literal">FALSE</span>)</span><br><span class="line">symbols(cities$long - <span class="number">1</span>, cities$lat, inches = <span class="literal">FALSE</span>,</span><br><span class="line">        thermometers = cbind(<span class="built_in">rep</span>(<span class="number">2</span>, nrow(cities)),</span><br><span class="line">                             <span class="built_in">rep</span>(<span class="number">4</span>, nrow(cities)),</span><br><span class="line">                             (cities$precip)/<span class="number">2000</span>), <span class="comment"># precip in mm</span></span><br><span class="line">        fg = <span class="string">&quot;red&quot;</span>,</span><br><span class="line">        add = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># statiscal glyphs - any kind of graphic</span></span><br><span class="line">vars &lt;- <span class="built_in">c</span>(<span class="string">&quot;days&quot;</span>, <span class="string">&quot;precip.mm.&quot;</span>, <span class="string">&quot;pop&quot;</span>)</span><br><span class="line">nVars &lt;- <span class="built_in">length</span>(vars)</span><br><span class="line">ncities &lt;- nrow(cities)</span><br><span class="line">cityVals &lt;- cities[,vars]</span><br><span class="line">maxVals &lt;- apply(cityVals, <span class="number">2</span>,<span class="built_in">max</span>)</span><br><span class="line"><span class="comment"># get values as proportions of each column</span></span><br><span class="line">stdCities &lt;- sweep(cityVals, <span class="number">2</span>, maxVals,`/`) <span class="comment"># sweep: Return an array obtained</span></span><br><span class="line">              <span class="comment">#from an input array by sweeping out a summary statistic.</span></span><br><span class="line">stdCitiesList &lt;- Map(<span class="keyword">function</span>(rowNum) &#123;t(stdCities[rowNum,])&#125;,</span><br><span class="line">                     <span class="number">1</span>:ncities) <span class="comment"># apply a function to each element of a vector</span></span><br><span class="line"><span class="comment"># in the loon package, the function l_make_glyphys() will create glyphs from any</span></span><br><span class="line"><span class="comment"># statiscal graphic</span></span><br><span class="line">library(loon)</span><br><span class="line"><span class="comment"># create the glyphs for each city</span></span><br><span class="line">my_glyphs &lt;- l_make_glyphs(stdCitiesList,</span><br><span class="line">                           draw_fun = <span class="keyword">function</span>(city)&#123;</span><br><span class="line">                             par(mar = <span class="built_in">rep</span>(<span class="number">1</span>,<span class="number">4</span>))</span><br><span class="line">                             barplot(height = city,</span><br><span class="line">                                     beside = <span class="literal">TRUE</span>,</span><br><span class="line">                                     axes = <span class="literal">FALSE</span>,</span><br><span class="line">                                     col = rainbow(nVars),</span><br><span class="line">                                     axisnames = <span class="literal">FALSE</span>,</span><br><span class="line">                                     ylim = <span class="built_in">c</span>(<span class="number">0</span>,<span class="number">1</span>))</span><br><span class="line">                           &#125;, width = <span class="number">100</span>, height = <span class="number">100</span>)</span><br><span class="line"><span class="comment"># can view the glyphs</span></span><br><span class="line">l_imageviewer(my_glyphs)</span><br><span class="line"></span><br><span class="line"><span class="comment"># these can be added as points symbols to any l_plot</span></span><br><span class="line"><span class="comment"># plot city locations</span></span><br><span class="line">p &lt;- l_plot(cities$long, cities$lat,</span><br><span class="line">            xlabel = <span class="string">&quot;longitude&quot;</span>,</span><br><span class="line">            ylabel = <span class="string">&quot;laitude&quot;</span>,</span><br><span class="line">            showLabels = <span class="literal">FALSE</span>)</span><br><span class="line"><span class="comment"># add the map</span></span><br><span class="line">Canada &lt;- map(<span class="string">&quot;world&quot;</span>, <span class="string">&quot;Canada&quot;</span>, fill = <span class="literal">TRUE</span>, plot = <span class="literal">FALSE</span>)</span><br><span class="line">l_map &lt;- l_layer(p, Canada, asSingleLayer = <span class="literal">TRUE</span>, color = <span class="string">&quot;cornsilk&quot;</span>)</span><br><span class="line">l_scaleto_world(p) <span class="comment">#Change Plot Region to Display All Plot Data</span></span><br><span class="line"><span class="comment"># then add the images as glyphs called &quot;barplot&quot;</span></span><br><span class="line">g &lt;- l_glyph_add_image(p, my_glyphs, <span class="string">&quot;barplot&quot;</span>)</span><br><span class="line">p[<span class="string">&#x27;glyph&#x27;</span>] &lt;- g</span><br><span class="line"></span><br><span class="line">library(loon)</span><br><span class="line">theEast &lt;- cities$long &gt; -<span class="number">80</span></span><br><span class="line">p[<span class="string">&quot;selected&quot;</span>] &lt;- theEast</span><br><span class="line"></span><br><span class="line"><span class="comment"># readShapeSpatial &#123;maptools&#125;	R Documentation</span></span><br><span class="line"><span class="comment">#       Read shape files into Spatial*DataFrame objects</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># rm(list = ls()): rm will remove all of the objects that are stored in</span></span><br><span class="line"><span class="comment"># your global environment (which may be what you want) but will not unload any</span></span><br><span class="line"><span class="comment">#   of the packages that you have loaded. You can do both by restarting your</span></span><br><span class="line"><span class="comment"># R session in RStudio with the keyboard shortcut Ctrl+Shift+F10 which will</span></span><br><span class="line"><span class="comment"># totally clear your global environment of both objects and loaded packages.</span></span><br><span class="line"><span class="comment">#  use graphic.off() to clear all the plots you have generated</span></span><br></pre></td></tr></table></figure>

<h2 id="three-dimensions"><a href="#three-dimensions" class="headerlink" title="three dimensions"></a>three dimensions</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># three dimensions</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line">library(MASS)</span><br><span class="line">library(ggplot2)</span><br><span class="line"><span class="comment"># use square grids, count the number of points in each cell</span></span><br><span class="line"><span class="comment"># code count to saturation. here use geom_bin2d() from ggplot2</span></span><br><span class="line">p &lt;- ggplot(geyser, aes(x = duration, y = waiting))</span><br><span class="line">h &lt;- p + geom_bin2d(bins = <span class="number">15</span>)</span><br><span class="line">h</span><br><span class="line"><span class="comment"># to switch the color around</span></span><br><span class="line">library(RColorBrewer)</span><br><span class="line"><span class="comment"># brew a sequence of blues</span></span><br><span class="line">blues &lt;- brewer.pal(<span class="number">9</span>, <span class="string">&quot;Blues&quot;</span>)</span><br><span class="line">darkerBlues &lt;- blues[-(<span class="number">1</span>:<span class="number">2</span>)] <span class="comment"># remove the two lightest blues</span></span><br><span class="line">h + scale_fill_gradientn(colours = darkerBlues)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># use hexbin for hexagonal binning</span></span><br><span class="line">library(<span class="string">&quot;hexbin&quot;</span>)</span><br><span class="line">bins &lt;- hexbin(x = geyser$duration, y = geyser$waiting, xbins = <span class="number">15</span>)</span><br><span class="line">plot(bins, main = <span class="string">&quot;hexagonal bin histogram&quot;</span>)</span><br><span class="line"><span class="comment"># alternatively we cna use the hexbinplot directly</span></span><br><span class="line">hexbinplot(waiting~duration,data = geyser, xbins = <span class="number">15</span>,</span><br><span class="line">           colramp = <span class="keyword">function</span>(n) rev(gray.colors(n)), <span class="comment"># rev:Reverse Elements</span></span><br><span class="line">           aspect = <span class="number">1</span>,</span><br><span class="line">           main = <span class="string">&quot;Hexagonal bin histogram&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#  or we could use size instead of the colour to indicate counts</span></span><br><span class="line">hexbinplot(waiting~duration, data = geyser,</span><br><span class="line">           style = <span class="string">&quot;lattice&quot;</span>, aspect = <span class="number">1</span>,</span><br><span class="line">           main = <span class="string">&quot;hexagonal bin histogram&quot;</span>)</span><br><span class="line"><span class="comment"># both colour and size are used</span></span><br><span class="line">hexbinplot(waiting~duration, data = geyser,</span><br><span class="line">           style = <span class="string">&quot;nested.lattice&quot;</span>, aspect = <span class="number">1</span>,</span><br><span class="line">           main = <span class="string">&quot;hexagonal bin histogram&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># density estimation in two-dimensions</span></span><br><span class="line"><span class="comment"># calculate the contours of the kernel function</span></span><br><span class="line">nxvals &lt;- 100</span><br><span class="line">nyvals &lt;- 100</span><br><span class="line">x &lt;- seq(-<span class="number">5</span>, <span class="number">5</span>,length.out = nxvals)</span><br><span class="line">y &lt;- seq(-<span class="number">5</span>, <span class="number">5</span>,length.out = nyvals)</span><br><span class="line">gridLocs &lt;- expand.grid(x,y)</span><br><span class="line"><span class="comment"># now have the indices to match the locations</span></span><br><span class="line">indices &lt;- cbind(<span class="built_in">rep</span>(<span class="number">1</span>:nxvals, times = nyvals), <span class="built_in">rep</span>(<span class="number">1</span>:nyvals, each = nxvals))</span><br><span class="line"><span class="comment"># a matrix to store away the kernel values</span></span><br><span class="line">kernel &lt;- matrix(<span class="number">0</span>, nrow = nxvals, ncol=nyvals)</span><br><span class="line"></span><br><span class="line"><span class="comment"># need multivariate nromal densities from mvtnorm</span></span><br><span class="line">library(<span class="string">&#x27;mvtnorm&#x27;</span>)</span><br><span class="line"><span class="comment"># bivaraite normal density</span></span><br><span class="line"><span class="comment"># (default is mean 0, and var-cov matrix the 2x2 identity matrix)</span></span><br><span class="line">kernel[indices] &lt;- dmvnorm(gridLocs)</span><br><span class="line"><span class="comment">#there is a contour function to showmlevel curves</span></span><br><span class="line">contour(x=x, y=y, z= kernel, asp = <span class="number">1</span>,</span><br><span class="line">        xlim = <span class="built_in">c</span>(-<span class="number">2</span>,<span class="number">2</span>), ylim = <span class="built_in">c</span>(-<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">        col = <span class="string">&quot;black&quot;</span>, lty = <span class="number">2</span>,</span><br><span class="line">        main = <span class="string">&quot;contours of a standard normal&quot;</span>)</span><br><span class="line">points(<span class="number">0</span>,<span class="number">0</span>, pch = <span class="number">19</span>, col = <span class="string">&quot;steelblue&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># we can use this bivariate density as a kernel for bivariate density estimation</span></span><br><span class="line"><span class="comment"># a function that performs the density estimation is kde2d() from the mass package</span></span><br><span class="line">x &lt;- geyser$duration</span><br><span class="line">y &lt;- geyser$waiting</span><br><span class="line">den &lt;- kde2d(x=x, y = y , n = <span class="number">100</span>)</span><br><span class="line">str(den)</span><br><span class="line"></span><br><span class="line"><span class="comment"># now plot the density estimates as contours</span></span><br><span class="line">zlim &lt;- <span class="built_in">range</span>(den$z)</span><br><span class="line">plot(x,y,pch =<span class="number">19</span>,</span><br><span class="line">     col = adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.5</span>))</span><br><span class="line">contour(den$x, den$y, den$z, col = <span class="string">&quot;grey10&quot;</span>,</span><br><span class="line">        levels = pretty(zlim, <span class="number">10</span>), lwd = <span class="number">1</span>, add = <span class="literal">TRUE</span>)</span><br><span class="line"><span class="comment"># pretty :Compute a sequence of about n+1 equally spaced ‘round’ values</span></span><br><span class="line"><span class="comment"># which cover the range of the values in x. The values are chosen so that</span></span><br><span class="line"><span class="comment"># they are 1, 2 or 5 times a power of 10.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># could add colour images of density</span></span><br><span class="line">library(RColorBrewer)</span><br><span class="line">blues &lt;- brewer.pal(<span class="number">9</span>, <span class="string">&quot;Blues&quot;</span>)</span><br><span class="line">image(den$x, den$y, den$z, col = blues, xlab = <span class="string">&quot;duration&quot;</span>,</span><br><span class="line">      ylab = <span class="string">&quot;waiting&quot;</span>, main = <span class="string">&quot;rectangles coloured by density&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># draw the density in three dimensions</span></span><br><span class="line"><span class="comment"># using the perspective &quot;wire frame&quot; drawings</span></span><br><span class="line">lineCol &lt;- <span class="string">&quot;steelblue&quot;</span></span><br><span class="line">fillCol &lt;- <span class="string">&quot;cornsilk&quot;</span></span><br><span class="line">savePar &lt;- par(mfrow = <span class="built_in">c</span>(<span class="number">1</span>,<span class="number">2</span>))</span><br><span class="line"><span class="comment"># 3d surface</span></span><br><span class="line">persp(den$z, border = lineCol, col = fillCol,</span><br><span class="line">      xlab = <span class="string">&quot;duration&quot;</span>, ylab = <span class="string">&quot;waiting time&quot;</span>,</span><br><span class="line">      zlab = <span class="string">&quot;density&quot;</span>, main = <span class="string">&quot;geyser density estimate&quot;</span>,</span><br><span class="line">      sub = <span class="string">&quot;solid&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># see through</span></span><br><span class="line">persp(den$z, border = lineCol, col = adjustcolor(fillCol,<span class="number">0.5</span>),</span><br><span class="line">      xlab = <span class="string">&quot;duration&quot;</span>, ylab = <span class="string">&quot;waiting time&quot;</span>,</span><br><span class="line">      zlab = <span class="string">&quot;density&quot;</span>, main = <span class="string">&quot;geyser density estimate&quot;</span>,</span><br><span class="line">      sub = <span class="string">&quot;transparent&quot;</span>)</span><br><span class="line"></span><br><span class="line">par(savePar)</span><br><span class="line"></span><br><span class="line"><span class="comment"># can change the viewing angles</span></span><br><span class="line">theta.val &lt;- 0   <span class="comment"># horizontal moving right to the left</span></span><br><span class="line">phi.val &lt;- 0 <span class="comment"># angle of tilt toward viewer</span></span><br><span class="line">lineCol &lt;- <span class="string">&quot;steelblue&quot;</span></span><br><span class="line">fillCol &lt;- <span class="string">&quot;cornsilk&quot;</span></span><br><span class="line">persp(den$z, border = lineCol, col = fillCol,</span><br><span class="line">      xlab = <span class="string">&quot;x&quot;</span>, ylab = <span class="string">&quot;y&quot;</span>, zlab = <span class="string">&quot;z&quot;</span>,</span><br><span class="line">      <span class="comment"># some magic below:</span></span><br><span class="line">      <span class="comment"># bquote: allows partial substitution;</span></span><br><span class="line">      <span class="comment"># terms wrapped in .() are evaluated</span></span><br><span class="line">      main = bquote(paste(phi, <span class="string">&quot;=&quot;</span>, .(phi.val),<span class="string">&quot;;&quot;</span>,</span><br><span class="line">                          thera,<span class="string">&quot;=&quot;</span>,.(theta.val))),</span><br><span class="line">      theta = theta.val,</span><br><span class="line">      phi = phi.val)</span><br><span class="line"><span class="comment"># radius r, the distance of the eyepoint from the centre of the box</span></span><br><span class="line"><span class="comment"># changing the radius (think of points at infinity)</span></span><br><span class="line">persp(den, border = lineCol, col = fillCol,</span><br><span class="line">      r = <span class="number">0.5</span>, phi = <span class="number">0</span>, xlab = <span class="string">&quot;x&quot;</span>, main = <span class="string">&quot;r = 0.5&quot;</span>)<span class="comment"># the smaller the r, the sooner the parallel lines meet</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the lattice package could be used</span></span><br><span class="line">library(<span class="string">&quot;lattice&quot;</span>)</span><br><span class="line">wireframe(den$z, xlab = <span class="string">&quot;duration&quot;</span>, ylab = <span class="string">&quot;waiting&quot;</span>, zlab = <span class="string">&quot;density&quot;</span>,</span><br><span class="line">          col = <span class="string">&quot;grey50&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># can change the relative dimensions of the box</span></span><br><span class="line">wireframe(den$z, xlab = <span class="string">&quot;duration&quot;</span>, ylab = <span class="string">&quot;waiting&quot;</span>, zlab = <span class="string">&quot;density&quot;</span>,</span><br><span class="line">          col = <span class="string">&quot;grey50&quot;</span>, aspect = <span class="built_in">c</span>(<span class="number">1.2</span>, <span class="number">0.4</span>))</span><br><span class="line"></span><br><span class="line">library(loon.data); data(SAheart)</span><br><span class="line">cloud(sbp~ldl + tobacco, data = SAheart)</span><br><span class="line"></span><br><span class="line"><span class="comment"># change the colour, point symbol, remove perspective and the frame box</span></span><br><span class="line">cloud(sbp~ldl + tobacco, data = SAheart,</span><br><span class="line">      col = adjustcolor(<span class="string">&quot;grey10&quot;</span>, <span class="number">0.3</span>),</span><br><span class="line">      pch = <span class="number">19</span>, perspective = <span class="literal">FALSE</span>,</span><br><span class="line">      par.settings = <span class="built_in">list</span>(axis.line=<span class="built_in">list</span>(col = <span class="literal">NA</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library(gridExtra)</span><br><span class="line">cloud1 &lt;- cloud(sbp~ldl + tobacco, data = SAheart,</span><br><span class="line">           col = adjustcolor(<span class="string">&quot;grey10&quot;</span>, <span class="number">0.3</span>),</span><br><span class="line">           pch = <span class="number">19</span>, perspective = <span class="literal">TRUE</span>,</span><br><span class="line">           par.settings = <span class="built_in">list</span>(axis.line=<span class="built_in">list</span>(col = <span class="literal">NA</span>)),</span><br><span class="line">           <span class="comment"># rotate (in degrees) about each axis</span></span><br><span class="line">           screen = <span class="built_in">list</span>(z= <span class="number">20</span>, x = -<span class="number">70</span>, y = <span class="number">0</span>),</span><br><span class="line">           xlab = <span class="string">&quot;&quot;</span>, ylab = <span class="string">&quot;&quot;</span>, zlab = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># rotate about y by 3 degrees</span></span><br><span class="line">cloud2 &lt;- cloud(sbp~ldl + tobacco, data = SAheart,</span><br><span class="line">                col = adjustcolor(<span class="string">&quot;grey10&quot;</span>, <span class="number">0.3</span>),</span><br><span class="line">                pch = <span class="number">19</span>, perspective = <span class="literal">TRUE</span>,</span><br><span class="line">                par.settings = <span class="built_in">list</span>(axis.line=<span class="built_in">list</span>(col = <span class="literal">NA</span>)),</span><br><span class="line">                <span class="comment"># rotate (in degrees) about each axis</span></span><br><span class="line">                screen = <span class="built_in">list</span>(z= <span class="number">20</span>, x = -<span class="number">70</span>, y = <span class="number">3</span>),</span><br><span class="line">                xlab = <span class="string">&quot;&quot;</span>, ylab = <span class="string">&quot;&quot;</span>, zlab = <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment"># stereo display</span></span><br><span class="line">grid.arrange(cloud1, cloud2, nrow =<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># use the rgl package</span></span><br><span class="line">library(rgl)</span><br><span class="line">solidcol &lt;- <span class="string">&quot;steelblue&quot;</span></span><br><span class="line">persp3d(den$z, col = solidcol)</span><br><span class="line">        <span class="comment"># with a three button mouse:</span></span><br><span class="line">        <span class="comment">#left buttom  - rotate</span></span><br><span class="line">        <span class="comment">#middle button - change perspective</span></span><br><span class="line">        <span class="comment"># right button - size)</span></span><br><span class="line">    <span class="comment"># get rid of perspective, make things orthogonal</span></span><br><span class="line">    <span class="comment"># FOV(or field of view) is &quot;the degee of parallax&quot;</span></span><br><span class="line">    <span class="comment"># FOV = 0, is orthogonal (or isometric) projection.</span></span><br><span class="line">par3d(FOV = <span class="number">0</span>)</span><br><span class="line">persp3d(den$z, col = <span class="string">&quot;cornsilk&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># interacitve three dimensional plots</span></span><br><span class="line"><span class="comment"># surfaces and planes</span></span><br><span class="line">x &lt;- den$x</span><br><span class="line">y &lt;- den$y        </span><br><span class="line">z &lt;- den$z</span><br><span class="line"><span class="comment"># put the coordinates in a unit cube</span></span><br><span class="line">myscale &lt;- <span class="keyword">function</span>(x)&#123;</span><br><span class="line">  xrange &lt;- <span class="built_in">range</span>(x)</span><br><span class="line">  (x - <span class="built_in">min</span>(xrange))/diff(xrange)</span><br><span class="line">&#125;</span><br><span class="line">x &lt;- myscale(x)</span><br><span class="line">y &lt;- myscale(y)</span><br><span class="line">z &lt;- myscale(z)</span><br><span class="line"></span><br><span class="line">surface3d(x,y,z, color = solidcol)</span><br><span class="line"><span class="comment"># we could ass an arbitrary plane as well</span></span><br><span class="line"><span class="comment"># say the plane a*x + b*y + c*z + d = 0</span></span><br><span class="line">planes3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>, -median(z), col = <span class="string">&quot;firebrick&quot;</span>, alpha =<span class="number">0.5</span>)</span><br><span class="line">planes3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>, -quantile(z, <span class="number">0.75</span>), col = <span class="string">&quot;steelblue&quot;</span>, alpha =<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a point in the centre of the box is</span></span><br><span class="line">centre &lt;- <span class="built_in">c</span>(median(x), median(y), median(z) )</span><br><span class="line"><span class="comment"># a plane&#x27;s orientation is given by its normal vector</span></span><br><span class="line">a &lt;- 1</span><br><span class="line">b &lt;- 1</span><br><span class="line">c &lt;- 1</span><br><span class="line">normal &lt;- <span class="built_in">c</span>(a,b,<span class="built_in">c</span>)</span><br><span class="line"><span class="comment"># get d to put this through the centre</span></span><br><span class="line">d &lt;- - t(normal) %*% centre</span><br><span class="line">planes3d(a,b,<span class="built_in">c</span>,d, col = <span class="string">&quot;purple&quot;</span>, alpha= <span class="number">0.7</span>)</span><br></pre></td></tr></table></figure>

<h2 id="marginal-contribution"><a href="#marginal-contribution" class="headerlink" title="marginal contribution"></a>marginal contribution</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># marginal contribution - projections and slices</span></span><br><span class="line"><span class="comment">#######################################################       </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># distance determines the amount of perspective ,default is 0.2</span></span><br><span class="line">cloud &lt;- cloud(obesity~alcohol + tobacco, data = SAheart,</span><br><span class="line">                distance = <span class="number">1</span>, perspective = <span class="literal">TRUE</span>,</span><br><span class="line">                par.settings = <span class="built_in">list</span>(axis.line=<span class="built_in">list</span>(col = <span class="literal">NA</span>)),</span><br><span class="line">                <span class="comment"># rotate (in degrees) about each axis</span></span><br><span class="line">                screen = <span class="built_in">list</span>(z= <span class="number">0</span>, x = <span class="number">10</span>, y = <span class="number">0</span>),</span><br><span class="line">                xlab = <span class="string">&quot;x&quot;</span>, ylab = <span class="string">&quot;y&quot;</span>, zlab = <span class="string">&quot;z&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># no perspective = marginal = orthogonal projection</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># three dimensional scatterplot - interactive</span></span><br><span class="line">library(loon)</span><br><span class="line">cols &lt;- <span class="built_in">rep</span>(<span class="string">&quot;firebrick&quot;</span>, <span class="built_in">length</span>(SAheart$chd))</span><br><span class="line">cols[SAheart$chd == <span class="string">&quot;Yes&quot;</span>] &lt;- <span class="string">&quot;steelblue&quot;</span></span><br><span class="line"><span class="comment"># need a new data frame</span></span><br><span class="line">newdata &lt;- data.frame(sbp = SAheart$sbp, ldl = SAheart$ldl,</span><br><span class="line">                      tob = SAheart$tobacco)</span><br><span class="line"><span class="comment"># create the navigation graph</span></span><br><span class="line">l_navgraph(data = newdata,</span><br><span class="line">           <span class="comment"># optional arguements follow</span></span><br><span class="line">           color = cols, glyph = <span class="string">&quot;ccircle&quot;</span>, showGuides = <span class="literal">TRUE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a free hand rotation in loon</span></span><br><span class="line">with(l_scale3D(newdata),</span><br><span class="line">     l_plot3D(x = sbp, y = ldl, z = tob, color = cols,</span><br><span class="line">              showGuides = <span class="literal">TRUE</span>, glyph = <span class="string">&quot;ccircle&quot;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># conditioninh on one or more variate values</span></span><br><span class="line"><span class="comment"># beginning with a density estimate for sbp</span></span><br><span class="line">library(ggplot2)</span><br><span class="line">ggplot(data= SAheart, mapping = aes(sbp)) +</span><br><span class="line">         geom_density(fill = <span class="string">&quot;steelblue&quot;</span>, alpha =<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># now condition on family history - by color</span></span><br><span class="line">p &lt;- ggplot(data= SAheart, mapping = aes(sbp)) +</span><br><span class="line">  geom_density(mapping = aes(fill = famhist), alpha = <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># now condition on family history - by locations and color</span></span><br><span class="line">p + facet_grid(famhist~.)</span><br><span class="line">p + facet_grid(.~famhist)</span><br><span class="line"></span><br><span class="line"><span class="comment"># now condition on faimly history (colour and location) and value of chd (location)</span></span><br><span class="line">p + facet_grid(chd ~ famhist, labeller = label_both)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a two variates display conditional on the value of a third,</span></span><br><span class="line">p &lt;- ggplot(data = SAheart, mapping = aes(ldl, sbp))</span><br><span class="line">p + geom_point(color = <span class="string">&quot;steelblue&quot;</span>)</span><br><span class="line"><span class="comment"># condition on famhist(colour)</span></span><br><span class="line">p + geom_point(mapping = aes(color = famhist))</span><br><span class="line"><span class="comment"># conditional on famhist (colour+location)</span></span><br><span class="line">p + geom_point(mapping = aes(color = famhist)) + facet_grid(.~famhist)</span><br><span class="line"><span class="comment"># conditional on famhist (colour + location) - densities</span></span><br><span class="line">p + geom_density_2d() +</span><br><span class="line">  facet_grid(.~famhist, labeller = label_both)</span><br><span class="line"></span><br><span class="line"><span class="comment"># conditional on a continuous variate, say tobacco - colour</span></span><br><span class="line">p + geom_point(mapping = aes(color = tobacco), size = <span class="number">2</span>, alpha = <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># conditional on a continuous variate, say tobacco -size</span></span><br><span class="line">p + geom_point(mapping = aes(size = tobacco), color = <span class="string">&quot;steelblue&quot;</span>, alpha = <span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># cut_interval(): make n groups having equal range</span></span><br><span class="line"><span class="comment"># cut_number(): makes n groups having euqal numbers of observations</span></span><br><span class="line"><span class="comment"># cut_width(): makes however many groups of constant width</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conditioning on one or more variate values</span></span><br><span class="line">p + geom_density2d(color = <span class="string">&quot;steelblue&quot;</span>) +</span><br><span class="line">  facet_grid(.~cut_number(tobacco, n = <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line">p + geom_point(color = <span class="string">&quot;steelblue&quot;</span>,alpha =<span class="number">0.5</span>) +</span><br><span class="line">  facet_grid(.~cut_number(tobacco, n = <span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># turn an ggplot into an interactive loon plot</span></span><br><span class="line"><span class="comment"># 这个要额外下载package， 网站https://cran.r-project.org/web/packages/loon.ggplot/index.html</span></span><br><span class="line">gg_p &lt;- p + geom_density2d(color = <span class="string">&quot;steelblue&quot;</span>) + geom_point() +</span><br><span class="line">  facet_grid(.~cut_number(tobacco, n =<span class="number">3</span>))</span><br><span class="line">myplot &lt;- loon.ggplot(gg_p, linkingGroup = <span class="string">&quot;SAheart&quot;</span>)</span><br><span class="line"><span class="comment"># marginalization = orthogonal projection</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p2 &lt;- l_plot(SAheart$tobacco, jitter(<span class="built_in">rep</span>(<span class="number">1</span>, <span class="built_in">length</span>(SAheart$tobacco))),</span><br><span class="line">             linkingGroup = <span class="string">&quot;SAheart&quot;</span>)</span><br><span class="line">p3D &lt;- l_plot3D(l_scale3D(SAheart[,<span class="built_in">c</span>(<span class="string">&quot;obesity&quot;</span>, <span class="string">&quot;tobacco&quot;</span>, <span class="string">&quot;alcohol&quot;</span>)]),</span><br><span class="line">                linkingGroup = <span class="string">&quot;SAheart&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="noncartesian"><a href="#noncartesian" class="headerlink" title="noncartesian"></a>noncartesian</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># noncartesian 1 - beyong three dimensions</span></span><br><span class="line"><span class="comment">#######################################################       </span></span><br><span class="line">data &lt;- iris[,<span class="number">1</span>:<span class="number">4</span>] <span class="comment"># the four measurements on Anderson&#x27;s irises</span></span><br><span class="line">scale01 &lt;- <span class="keyword">function</span>(x) &#123;</span><br><span class="line">  (x - <span class="built_in">min</span>(x))/diff(<span class="built_in">range</span>(x) + <span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data &lt;- apply(data, <span class="number">2</span>, scale01)</span><br><span class="line">library(TeachingDemos)</span><br><span class="line">faces2(data[<span class="built_in">c</span>(<span class="number">1</span>,<span class="number">51</span>,<span class="number">101</span>), ],</span><br><span class="line">       which = <span class="built_in">c</span>(<span class="number">8</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">17</span>), <span class="comment"># select features</span></span><br><span class="line">       scale = <span class="string">&quot;none&quot;</span>, nrows = <span class="number">1</span>, ncols = <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># with the appropriate packages, we can explore how variables these features are:</span></span><br><span class="line">library(tkrplot)</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">interactive</span>())&#123;</span><br><span class="line">  tke2 &lt;- <span class="built_in">rep</span>(<span class="built_in">list</span>(</span><br><span class="line">                <span class="built_in">list</span>(<span class="string">&#x27;slider&#x27;</span>,</span><br><span class="line">                     from = <span class="number">0</span>, to = <span class="number">1</span>, init = <span class="number">0.5</span>,</span><br><span class="line">                     resolution = <span class="number">0.1</span>)),</span><br><span class="line">              <span class="number">18</span>)</span><br><span class="line">  <span class="built_in">names</span>(tke2) &lt;- <span class="built_in">c</span>(<span class="string">&#x27;CenterWidth&#x27;</span>,<span class="string">&#x27;TopBottomWidth&#x27;</span>,<span class="string">&#x27;FaceHeight&#x27;</span>,<span class="string">&#x27;TopWidth&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;BottomWidth&#x27;</span>,<span class="string">&#x27;NoseLength&#x27;</span>,<span class="string">&#x27;MouthHeight&#x27;</span>,<span class="string">&#x27;MouthCurve&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;MouthWidth&#x27;</span>,<span class="string">&#x27;EyesHeight&#x27;</span>,<span class="string">&#x27;EyesBetween&#x27;</span>,<span class="string">&#x27;EyeAngle&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;EyeShape&#x27;</span>,<span class="string">&#x27;EyeSize&#x27;</span>,<span class="string">&#x27;EyeballPos&#x27;</span>,<span class="string">&#x27;EyebrowHeight&#x27;</span>,</span><br><span class="line">                   <span class="string">&#x27;EyebrowAngle&#x27;</span>,<span class="string">&#x27;EyebrowWidth&#x27;</span>)</span><br><span class="line">  tkfun2 &lt;- <span class="keyword">function</span>(...)&#123;</span><br><span class="line">    tmpmat &lt;- rbind(Min = <span class="number">0</span>, Adjust = unlist(<span class="built_in">list</span>(...)), Max = <span class="number">1</span>)</span><br><span class="line">    faces2(tmpmat, scale = <span class="string">&#x27;none&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  tkexamp(tkfun2, <span class="built_in">list</span>(tke2), plotloc = <span class="string">&#x27;left&#x27;</span>,</span><br><span class="line">          hscale = <span class="number">2</span>, vscale = <span class="number">2</span>)</span><br><span class="line">    <span class="comment"># Create Tk dialog boxes with controls to show examples of</span></span><br><span class="line">  <span class="comment"># changing parameters on a graph.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">n &lt;- nrow(data)</span><br><span class="line">faces2(data[sample(<span class="number">1</span>:n, n, replace = <span class="literal">FALSE</span>),],</span><br><span class="line">            which = <span class="built_in">c</span>(<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">12</span>),</span><br><span class="line">            scale = <span class="string">&quot;columns&quot;</span>,</span><br><span class="line">            nrow = <span class="number">10</span>, ncol = <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># a function that in R called stars(..), which will produce Nightingale&#x27;s rose style glyphs</span></span><br><span class="line">n &lt;- nrow(data)</span><br><span class="line">stars(data[sample(<span class="number">1</span>:n, n, replace= <span class="literal">FALSE</span>), ],</span><br><span class="line">      nrow =<span class="number">10</span>, ncol = <span class="number">15</span>,</span><br><span class="line">      main = <span class="string">&quot;Nightingales Rose (almost)&quot;</span>,</span><br><span class="line">      draw.segments = <span class="literal">TRUE</span>, cex = <span class="number">1.2</span>)</span><br><span class="line"><span class="comment"># data explorations using stars(..) again</span></span><br><span class="line">stars(data, locations =data[,<span class="number">1</span>:<span class="number">2</span>],</span><br><span class="line">      lwd = <span class="number">0.5</span>, <span class="comment"># narrow the line</span></span><br><span class="line">      len = <span class="number">0.05</span>,</span><br><span class="line">      labels = <span class="literal">NULL</span>, radius = <span class="literal">TRUE</span>,</span><br><span class="line">      col.lines = <span class="built_in">rep</span>(adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.5</span>), n),</span><br><span class="line">      col.stars = <span class="built_in">rep</span>(adjustcolor(<span class="string">&quot;steelblue&quot;</span>, <span class="number">0.5</span>), n),</span><br><span class="line">      nrow = <span class="number">10</span>, ncol = <span class="number">15</span>,</span><br><span class="line">      key.loc = <span class="built_in">c</span>(<span class="number">12</span>,-<span class="number">0.5</span>),</span><br><span class="line">      main = <span class="string">&quot;iris data&quot;</span></span><br><span class="line">      )</span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h1 id="Tableau"><a href="#Tableau" class="headerlink" title="Tableau"></a>Tableau</h1><div class="note ">
            <p>ctrl + shift + B -&gt; 放大workplace<br>ctrl + B -&gt; 缩小workplace</p>
          </div>

<h2 id="Join和blend"><a href="#Join和blend" class="headerlink" title="Join和blend"></a>Join和blend</h2><p>Join:在data source中点击要join的sheet,看到sheet的信息后注意点击中上方表的小长方块,然后拖动要join的另一个table,中间会出现两个重合的圆,来调节join的类型.</p>
<p>Blending是特别版本的join,join只能join同类型的data,但blending可以join不同版本的,比如excel join到sql dataset.<br>Join时会说left和right table,blending中叫做primary data source和secondary data source.</p>
<p>当Blending时有两个相同的key.<br>Blending will result certain level of data aggregation(sum, avg, etc…)<br>default: sum相加<br>如果是无法sum的char值,会返回星号*.<br>如果Blending时没有相同的key,会返回null.</p>
<h2 id="Scattor-plot"><a href="#Scattor-plot" class="headerlink" title="Scattor plot"></a>Scattor plot</h2><p>我们发现scattor plot需要三个值.两个负责建立坐标(columns + rows)还有一个是数值,导入marks里面.</p>
<blockquote>
<p>比如column:transation + rows:amount + marks:customer_id<br>customer_id作为每个customer的信息导入.</p>
</blockquote>
<p>关于出现的outlier:删掉或对column/row进行对数(log)转换.</p>
<blockquote>
<p>对数转换:使用calculate field中的sum和log function.</p>
</blockquote>
<p>按子类别计算更多的detail:</p>
<blockquote>
<p>增加calculated field:<br>{ fixed[Sub category]: avg([Amount]) }<br>并增加在mark中的size上.<br>以及因为是value的计算,tableau会自动求和,但我们不需要求整个sub category的sum,所以得改成avg.</p>
</blockquote>
<p>Clusters:在analytics的区域,给scattor plot分不同的群体.<br>把在marks中生成的cluster可以拖入会data里的string value区域,可以保留并用在其他的图中.</p>
<h2 id="Bar-chart"><a href="#Bar-chart" class="headerlink" title="Bar chart"></a>Bar chart</h2><p>Bar chart需要一个分组作为rows(刚刚的cluster group),以及一个数值(amount)作为值(marks).然后点击右上方的show me中的bar chart.<br>How many ppl in a cluster group, add calculated field:<br>CountD([Customer ID])</p>
<p>我们可以做一个两头bar chart:<br>将distinct customer ID也作为column值,做一个左右并排的bar chart.再选中其中的一个右键选取edit axis并reversed.</p>
<div class="note ">
            <p>在最上方的工具栏里有swap rows and columns很好用.</p>
          </div>

<h2 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h2><p>将chart(sheet)集合在一起的地方,还能加action,实时比较不同category下的分析数据,很牛逼.<br>例如:将某个category base的bar chart右键use as filter,那么点击某个category,其他的图标就会计算那个category下的数据.</p>
<p>正常流程:在dashboard tool bar中添加action,选择highlight就只会high light,不会把其他的数据隐藏.<br>source sheet:用于选取的category base的sheet.</p>
<div class="note ">
            <p>在查看图表每个数值的时候可以修改tooltip整理每个数值的标签.<br>可以将其他想要加入的数据添加到marks的detail里,再在tooltip中的insert加入.</p>
          </div>

<div class="note ">
            <p>Marks上面的filters可以用category类的值来选择要研究的数据.</p>
          </div>

<div class="note ">
            <p>常用普通表格之colouring.<br>可以将measure value按住ctrl拖入color(复制一份使用colour),然后选择square,表格上就会按照数据的大小决定颜色深浅.<br>如果有多列的数据,在colour中有use separate legend可以分别辨识颜色深浅.</p>
          </div>
<link rel="stylesheet" href="/blog/css/spoiler.css" type="text/css"><script src="/blog/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/%E4%BB%A5%E5%A4%B4%E6%8A%A2%E5%9C%B0-%E8%AF%9A/" rel="tag"># 以头抢地(诚)</a>
              <a href="/blog/tags/data/" rel="tag"># data</a>
              <a href="/blog/tags/statistics/" rel="tag"># statistics</a>
              <a href="/blog/tags/R/" rel="tag"># R</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2021/11/16/P187/" rel="prev" title="夏威夷技术学校枪支限定版">
      <i class="fa fa-chevron-left"></i> 夏威夷技术学校枪支限定版
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2021/11/01/P183/" rel="next" title="十月三十一号">
      十月三十一号 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#R"><span class="nav-number">1.</span> <span class="nav-text">R</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NumbersOrder"><span class="nav-number">1.1.</span> <span class="nav-text">NumbersOrder</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Histograms"><span class="nav-number">1.2.</span> <span class="nav-text">Histograms</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#visual-comparisons"><span class="nav-number">1.3.</span> <span class="nav-text">visual comparisons</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#visual-hypothesis-testing"><span class="nav-number">1.4.</span> <span class="nav-text">visual hypothesis testing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hypothetical-generative"><span class="nav-number">1.5.</span> <span class="nav-text">hypothetical generative</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#time-order"><span class="nav-number">1.6.</span> <span class="nav-text">time order</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#time-series-decomposition"><span class="nav-number">1.7.</span> <span class="nav-text">time series decomposition</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#transforming-data"><span class="nav-number">1.8.</span> <span class="nav-text">transforming data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#categorical-data-overview"><span class="nav-number">1.9.</span> <span class="nav-text">categorical data overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#categorical-data"><span class="nav-number">1.10.</span> <span class="nav-text">categorical data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#categorical-modelling"><span class="nav-number">1.11.</span> <span class="nav-text">categorical modelling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#onmaps"><span class="nav-number">1.12.</span> <span class="nav-text">onmaps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#three-dimensions"><span class="nav-number">1.13.</span> <span class="nav-text">three dimensions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#marginal-contribution"><span class="nav-number">1.14.</span> <span class="nav-text">marginal contribution</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#noncartesian"><span class="nav-number">1.15.</span> <span class="nav-text">noncartesian</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tableau"><span class="nav-number">2.</span> <span class="nav-text">Tableau</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Join%E5%92%8Cblend"><span class="nav-number">2.1.</span> <span class="nav-text">Join和blend</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scattor-plot"><span class="nav-number">2.2.</span> <span class="nav-text">Scattor plot</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bar-chart"><span class="nav-number">2.3.</span> <span class="nav-text">Bar chart</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dashboard"><span class="nav-number">2.4.</span> <span class="nav-text">Dashboard</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mazui"
      src="/blog/images/logo_11.jpg">
  <p class="site-author-name" itemprop="name">Mazui</p>
  <div class="site-description" itemprop="description">与孤独和平共处.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">314</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">68</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:mazui.and.rio@gmail.com" title="E-Mail → mailto:mazui.and.rio@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/3032131561?topnav=1&wvr=6&topsug=1&ssl_rnd=1606158448.6943&is_all=1" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3032131561?topnav&#x3D;1&amp;wvr&#x3D;6&amp;topsug&#x3D;1&amp;ssl_rnd&#x3D;1606158448.6943&amp;is_all&#x3D;1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/mazui_3" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;mazui_3" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/mazui_3" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;mazui_3" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



      </div>

<br>
      <!--new music test-->

  <!--网易云插件-->
<iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/4mCwspCTPF1aoWUNxsS5aD?utm_source=generator" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mazui</span>

<!--
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>


    <span title="C">1.5m</span>
  -->

  <!--
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="T">22:17</span>

  -->

</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>
<br>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">阅览室一共有1.5m的老兔正在打瞌睡</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://mazui3-com.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://mazui3.github.io/blog/2021/11/07/P182/";
    this.page.identifier = "2021/11/07/P182/";
    this.page.title = "关于stat的笔记 - visualization";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://mazui3-com.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
