<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/star.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/star.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/star.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Courier Prime:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/blog/lib/pace/pace-theme-minimal.min.css">
  <script src="/blog/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mazui3.github.io","root":"/blog/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":265,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"text":"Load Disqus","order":-1}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="ÊúãÂèãÂèãÊÉÖËµûÂä©ÁöÑstat442ÁöÑÁ¨îËÆ∞Âä†‰∏ÄÁÇπÁÇπÁÇπtableau(Âùë‰∫Ü)ÁöÑÁ¨îËÆ∞.">
<meta property="og:type" content="article">
<meta property="og:title" content="ÂÖ≥‰∫éstatÁöÑÁ¨îËÆ∞ - visualization">
<meta property="og:url" content="https://mazui3.github.io/blog/2021/11/07/P182/index.html">
<meta property="og:site_name" content="Underlake Reading Room">
<meta property="og:description" content="ÊúãÂèãÂèãÊÉÖËµûÂä©ÁöÑstat442ÁöÑÁ¨îËÆ∞Âä†‰∏ÄÁÇπÁÇπÁÇπtableau(Âùë‰∫Ü)ÁöÑÁ¨îËÆ∞.">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-11-06T16:43:19.000Z">
<meta property="article:modified_time" content="2025-12-20T09:20:14.060Z">
<meta property="article:author" content="Mazui">
<meta property="article:tag" content="‰ª•Â§¥Êä¢Âú∞(ËØö)">
<meta property="article:tag" content="data">
<meta property="article:tag" content="statistics">
<meta property="article:tag" content="R">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://mazui3.github.io/blog/2021/11/07/P182/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>ÂÖ≥‰∫éstatÁöÑÁ¨îËÆ∞ - visualization | Underlake Reading Room</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="desktop-icons">
    <div class="icon-shortcut">
        <div class="icon-box">üìÅ</div>
        <span>My Briefcase</span>
    </div>
    <div class="icon-shortcut">
        <div class="icon-box">üåê</div>
        <span>Network</span>
    </div>
    <div class="icon-shortcut">
        <div class="icon-box">üóëÔ∏è</div>
        <span>Trash</span>
    </div>
    <div class="icon-shortcut">
        <div class="icon-box">üìù</div>
        <span>Notepad</span>
    </div>
  </div>
  <div class="desktop-hidden-icon">
    <div class="icon-shortcut">
        <div class="icon-box"><img src="/blog/images/Rio.png"></div>
        <span style="padding: 13px;">Love you</span>
    </div>
  </div>
  <div class="desktop-hidden-icon2">
    <div class="icon-shortcut">
        <div class="icon-box">üåà</div>
        <span>Be Happy</span>
    </div>
  </div>
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="title-bar">
    <span>Folders</span>
    <div class="title-controls">
        <div class="win-btn">_</div>
        <div class="win-btn">√ó</div>
    </div>
</div>

<div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="phosphor-text mono">
      > BOOTING BLOG OS...<br>
      > USER: ADMIN_M3<br>
      > PACKET LOSS: 99%<br>
      > DESTINATION: UNKNOWN<span class="cursor"></span>
  </div>

  <!-- <div class="site-meta">
    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Underlake Reading Room</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">ËøôÈáåÊòØÂõæ‰π¶È¶ÜÂ§ñÁöÑÈòÖËßàÂÆ§üåü</p>
  </div> -->

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-back">

    <a href="https://mazui3.github.io/" rel="section"><i class="fa fa-cloud fa-fw"></i>Back</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="title-bar">
          <span>Command Prompt</span>
          <div class="title-controls"><div class="win-btn">
            <span class="popup-btn-close">
              x
            </span>
          </div></div>
      </div>
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>
    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

    <main class="main">
      <div class="main-inner">
        <div class="content-wrap-temp">
          <div class="title-bar">
              <span>Notepad - README.TXT</span>
              <div class="title-controls">
                  <div class="win-btn"><button class="none-btn" onclick="toggleWindow()">_</button></div>
                  <div class="win-btn">‚ñ°</div>
                  <div class="win-btn">√ó</div>
              </div>
          </div>
          <div class="menu-bar">
              <span class="menu-item">File</span>
              <span class="menu-item">Edit</span>
              <span class="menu-item">View</span>
              <span class="menu-item">Go</span>
              <span class="menu-item">Favorites</span>
              <span class="menu-item">Help</span>
          </div>
          <div class="content-wrap inset">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mazui3.github.io/blog/2021/11/07/P182/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/logo_11.jpg">
      <meta itemprop="name" content="Mazui">
      <meta itemprop="description" content="‰∏éÂ≠§Áã¨ÂíåÂπ≥ÂÖ±Â§Ñ.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Underlake Reading Room">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          ÂÖ≥‰∫éstatÁöÑÁ¨îËÆ∞ - visualization
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-11-07 00:43:19" itemprop="dateCreated datePublished" datetime="2021-11-07T00:43:19+08:00">2021-11-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-12-20 17:20:14" itemprop="dateModified" datetime="2025-12-20T17:20:14+08:00">2025-12-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E5%AD%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">Êï∞Â≠¶Á¨îËÆ∞</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/blog/2021/11/07/P182/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/11/07/P182/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="C">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>79k</span>
            </span>
            <span class="post-meta-item" title="T">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>1:12</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>ÊúãÂèãÂèãÊÉÖËµûÂä©ÁöÑstat442ÁöÑÁ¨îËÆ∞Âä†‰∏ÄÁÇπÁÇπÁÇπtableau(Âùë‰∫Ü)ÁöÑÁ¨îËÆ∞.</p>
<span id="more"></span>
<p>Âä†‰∏äÂè¶‰∏Ä‰ΩçÊúãÂèã<a href="hhttps://drive.google.com/drive/folders/142BfLAX4dMk04aFZRfkBaVwsmWBEkF8C?usp=sharing">ÂèãÊÉÖËµûÂä©ÁöÑÁ¨îËÆ∞‰∏édataset</a>.</p>
<br>
<br>
<br>

<h1 id="R"><a href="#R" class="headerlink" title="R"></a>R</h1><h2 id="NumbersOrder"><a href="#NumbersOrder" class="headerlink" title="NumbersOrder"></a>NumbersOrder</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#library(aplpack)</span></span><br><span class="line"><span class="comment"># stem(marks, scale = 0.5, width = 100)</span></span><br><span class="line"><span class="comment">#      the defalut in separated each group from 1-4 and 5-9. see page 7.</span></span><br><span class="line"><span class="comment"># stem.leaf(marks)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the value of ordered values</span></span><br><span class="line">wordLeaders <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">62</span><span class="punctuation">,</span><span class="number">65</span><span class="punctuation">,</span><span class="number">65</span><span class="punctuation">,</span><span class="number">65</span><span class="punctuation">,</span><span class="number">66</span><span class="punctuation">,</span><span class="number">67</span><span class="punctuation">,</span><span class="number">68</span><span class="punctuation">,</span><span class="number">72</span><span class="punctuation">,</span><span class="number">73</span><span class="punctuation">,</span><span class="number">73</span><span class="punctuation">)</span></span><br><span class="line">n <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>wordLeaders<span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>n<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x <span class="operator">=</span> p<span class="punctuation">,</span> y <span class="operator">=</span> wordLeaders<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;o&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> <span class="string">&quot;grey10&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;proportions&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;height in inches&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;heights of world leaders&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># n &lt;- length(marks)</span></span><br><span class="line"><span class="comment"># p &lt;- ppoints(n)</span></span><br><span class="line"><span class="comment"># plot(x = p, y = sort(marks), type = &quot;o&quot;, lwd = 2, col = &quot;grey10&quot;,</span></span><br><span class="line"><span class="comment">#     xlab = &quot;proportion p&quot;, xlim = c(0,1), ylim = c(0, 100),</span></span><br><span class="line"><span class="comment">#     main = &quot;empirical qunatile function for the final grades&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># quantile plot for marks data</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;sittingHeights&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;qqtest&quot;</span><span class="punctuation">)</span></span><br><span class="line">with<span class="punctuation">(</span>sittingHeights<span class="punctuation">,</span></span><br><span class="line">     plot<span class="punctuation">(</span>percentCumulative<span class="punctuation">,</span> upperBound<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;o&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">27</span><span class="punctuation">,</span> <span class="number">38</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          xlab <span class="operator">=</span> <span class="string">&quot;percentage of women&quot;</span><span class="punctuation">,</span></span><br><span class="line">          ylab <span class="operator">=</span> <span class="string">&quot;sitting heights in inches&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># air quality measurements</span></span><br><span class="line">qvals <span class="operator">&lt;-</span> sort<span class="punctuation">(</span>airquality<span class="operator">$</span>Solar.R<span class="punctuation">)</span></span><br><span class="line">n <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>qvals<span class="punctuation">)</span></span><br><span class="line">pvals <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>n<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>pvals<span class="punctuation">,</span> qvals<span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;solar radiation in central park&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;cumulative proportion&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;radiation (Langleys)&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># comments : very dense at the bottom, but not on the top</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># old faithful geyser</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;geyser&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;MASS&quot;</span><span class="punctuation">)</span></span><br><span class="line">qvals <span class="operator">&lt;-</span> sort<span class="punctuation">(</span>geyser<span class="operator">$</span>duration<span class="punctuation">)</span></span><br><span class="line">n <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>qvals<span class="punctuation">)</span></span><br><span class="line">pvals <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>n<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>pvals<span class="punctuation">,</span> qvals<span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;quantile plot of old faithful eruptions&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;cumulative proportion&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;duration (minutes)&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Histograms"><a href="#Histograms" class="headerlink" title="Histograms"></a>Histograms</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line">drawbox <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span>...<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  xvals <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>x<span class="punctuation">,</span> reve<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">,</span> x<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  yvals <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span>y<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> y<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  lines<span class="punctuation">(</span>xvals<span class="punctuation">,</span> yvals<span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  the emprical cumulative distirbution</span></span><br><span class="line">plot<span class="punctuation">(</span>x <span class="operator">=</span> sort<span class="punctuation">(</span>marks<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> ppoints<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>marks<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span><span class="string">&quot;o&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> <span class="string">&quot;grey10&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;final grade&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;proportion&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;empirical distribution function&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># in r, the function ecdf() produces the empirical distribution function from</span></span><br><span class="line"><span class="comment"># any collection of numbers</span></span><br><span class="line">Fhat <span class="operator">&lt;-</span> ecdf<span class="punctuation">(</span>marks<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>Fhat<span class="punctuation">,</span>type <span class="operator">=</span><span class="string">&quot;o&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> <span class="string">&quot;grey10&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;final grade&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;proportion&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;empirical distribution function&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># histogram</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;geyser&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;MASS&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot_colour <span class="operator">&lt;-</span> <span class="string">&quot;grey50&quot;</span></span><br><span class="line">with<span class="punctuation">(</span>geyser<span class="punctuation">,</span></span><br><span class="line">     hist<span class="punctuation">(</span>duration<span class="punctuation">,</span> col <span class="operator">=</span> plot_colour<span class="punctuation">,</span> xlim <span class="operator">=</span> extendrange<span class="punctuation">(</span>duration<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          main <span class="operator">=</span> <span class="string">&quot;old faithful&quot;</span><span class="punctuation">,</span>xlab <span class="operator">=</span><span class="string">&quot;duration&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># change the brak points     </span></span><br><span class="line">with<span class="punctuation">(</span>geyser<span class="punctuation">,</span></span><br><span class="line">     hist<span class="punctuation">(</span>duration<span class="punctuation">,</span> col <span class="operator">=</span> plot_colour<span class="punctuation">,</span> xlim <span class="operator">=</span> extendrange<span class="punctuation">(</span>duration<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          breaks <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">,</span><span class="number">1.0</span><span class="punctuation">,</span><span class="number">2.75</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">3.5</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">4.5</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">6.0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          main <span class="operator">=</span> <span class="string">&quot;old faithful&quot;</span><span class="punctuation">,</span>xlab <span class="operator">=</span><span class="string">&quot;duration&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>     </span><br><span class="line"></span><br><span class="line"><span class="comment"># change the starting point in histogram</span></span><br><span class="line">savepar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">with<span class="punctuation">(</span>geyser<span class="punctuation">,</span></span><br><span class="line">     <span class="keyword">for</span> <span class="punctuation">(</span>start <span class="keyword">in</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0.4</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">       <span class="punctuation">&#123;</span></span><br><span class="line">       hist<span class="punctuation">(</span>duration<span class="punctuation">,</span></span><br><span class="line">            breaks <span class="operator">=</span> seq<span class="punctuation">(</span>start<span class="punctuation">,</span> <span class="number">6.0</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            probability <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">            xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0.7</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            main <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">            xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span><span class="punctuation">)</span></span><br><span class="line">     <span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">par<span class="punctuation">(</span>savepar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># interactive histograms with loon package</span></span><br><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;geyser&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;MASS&quot;</span><span class="punctuation">)</span></span><br><span class="line">with<span class="punctuation">(</span>geyser<span class="punctuation">,</span></span><br><span class="line">     <span class="punctuation">&#123;</span>l_hist<span class="punctuation">(</span>duration<span class="punctuation">,</span></span><br><span class="line">             yshows <span class="operator">=</span> <span class="string">&quot;density&quot;</span><span class="punctuation">,</span></span><br><span class="line">             showBinHandle <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">             xlab <span class="operator">=</span> <span class="string">&quot;duration of eruption (minutes)&quot;</span><span class="punctuation">,</span></span><br><span class="line">             title <span class="operator">=</span> <span class="string">&quot;old faithful geyser&quot;</span><span class="punctuation">,</span></span><br><span class="line">             showScales <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">             showGuides <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">             linkingGroup <span class="operator">=</span> <span class="string">&quot;old faithful&quot;</span></span><br><span class="line">             <span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show uncertainty due to bin locations</span></span><br><span class="line"><span class="comment"># blurness suggests uncertainty</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;geyser&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;MASS&quot;</span><span class="punctuation">)</span></span><br><span class="line">Nstarts <span class="operator">&lt;-</span> 5</span><br><span class="line">start_values <span class="operator">&lt;-</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0.4</span><span class="punctuation">,</span> length.out <span class="operator">=</span> Nstarts<span class="punctuation">)</span></span><br><span class="line">plot_colour_transparent <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span>plot_colour<span class="punctuation">,</span> alpha.f <span class="operator">=</span> <span class="number">1</span><span class="operator">/</span>Nstarts<span class="punctuation">)</span></span><br><span class="line">with<span class="punctuation">(</span>geyser<span class="punctuation">,</span></span><br><span class="line">     <span class="keyword">for</span> <span class="punctuation">(</span>start <span class="keyword">in</span> start_values<span class="punctuation">)</span></span><br><span class="line">       <span class="punctuation">&#123;</span><span class="keyword">if</span> <span class="punctuation">(</span>start <span class="operator">==</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">         <span class="punctuation">&#123;</span>hist<span class="punctuation">(</span>duration<span class="punctuation">,</span></span><br><span class="line">               breaks <span class="operator">=</span> seq<span class="punctuation">(</span>start<span class="punctuation">,</span> <span class="number">6.0</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               col <span class="operator">=</span> plot_colour_transparent<span class="punctuation">,</span></span><br><span class="line">               border <span class="operator">=</span> adjustcolor<span class="punctuation">(</span>plot_colour_transparent<span class="punctuation">,</span> <span class="number">0.0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               probability <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">               xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">7</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0.7</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               main <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span>xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">       <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span> <span class="comment">#add the histogram to the existing plot</span></span><br><span class="line">         hist<span class="punctuation">(</span>duration<span class="punctuation">,</span></span><br><span class="line">              breaks <span class="operator">=</span> seq<span class="punctuation">(</span>start<span class="punctuation">,</span> <span class="number">6.0</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              col <span class="operator">=</span> plot_colour_transparent<span class="punctuation">,</span></span><br><span class="line">              border <span class="operator">=</span> adjustcolor<span class="punctuation">(</span>plot_colour_transparent<span class="punctuation">,</span> <span class="number">0.0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              probability <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">              add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">       <span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># averaging over histograms as the bins change</span></span><br><span class="line">hist <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>geyser<span class="operator">$</span>duration<span class="punctuation">,</span>breaks<span class="operator">=</span>seq<span class="punctuation">(</span><span class="number">0.0</span><span class="punctuation">,</span><span class="number">6.0</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">             plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># str(hist) #gives the summary of the structure</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the function averages the shifted histograms</span></span><br><span class="line">ash <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> n_hists <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> binwidth <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">                type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;average shifted histogram&quot;</span><span class="punctuation">,</span></span><br><span class="line">                ylab <span class="operator">=</span> <span class="string">&quot;averaged&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> xlim<span class="punctuation">,</span> ylim<span class="punctuation">,</span></span><br><span class="line">                col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> fill<span class="punctuation">,</span> ...<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  xrange <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>extendrange<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>binwidth<span class="punctuation">)</span><span class="punctuation">)</span> binwidth <span class="operator">&lt;-</span> diff<span class="punctuation">(</span>xrange<span class="punctuation">)</span> <span class="operator">/</span> <span class="number">10</span></span><br><span class="line">  delta <span class="operator">&lt;-</span> binwidth<span class="operator">/</span>n_hists</span><br><span class="line">  xmin <span class="operator">&lt;-</span> <span class="built_in">min</span><span class="punctuation">(</span>xrange<span class="punctuation">)</span> <span class="operator">-</span> binwidth</span><br><span class="line">  xmax <span class="operator">&lt;-</span> <span class="built_in">max</span><span class="punctuation">(</span>xrange<span class="punctuation">)</span> <span class="operator">+</span> binwidth</span><br><span class="line">  breaks <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>xmin<span class="punctuation">,</span> xmax <span class="operator">-</span>binwidth<span class="punctuation">,</span> binwidth<span class="punctuation">)</span></span><br><span class="line">  n_breaks <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>breaks<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">## x values where density will be calculated and averaged</span></span><br><span class="line">  xvals <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>xmin<span class="punctuation">,</span> xmax<span class="operator">-</span>delta<span class="punctuation">,</span> delta<span class="punctuation">)</span></span><br><span class="line">  n_xvals <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>xvals<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># total density will be numeric, this is where we store a total density for</span></span><br><span class="line">  <span class="comment">#    each xval</span></span><br><span class="line">  density <span class="operator">&lt;-</span> numeric<span class="punctuation">(</span>n_xvals<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># the loop over the histograms to get densities, add them up</span></span><br><span class="line">  <span class="comment"># the indices of x have n_hists fewer values becasue there are</span></span><br><span class="line">  <span class="comment"># n_hists shifts in the summing</span></span><br><span class="line">  x_indices <span class="operator">&lt;-</span> seq<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span>n_xvals<span class="operator">-</span>n_hists<span class="punctuation">)</span></span><br><span class="line">  <span class="keyword">for</span> <span class="punctuation">(</span> i <span class="keyword">in</span>  seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> n_hists <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    cur_hist <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>x<span class="punctuation">,</span> breaks<span class="operator">=</span>breaks<span class="operator">+</span>delta<span class="operator">*</span>i<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">    density<span class="punctuation">[</span>i<span class="operator">+</span>x_indices<span class="punctuation">]</span> <span class="operator">&lt;-</span></span><br><span class="line">      <span class="comment"># current values</span></span><br><span class="line">      density<span class="punctuation">[</span>i <span class="operator">+</span> x_indices<span class="punctuation">]</span> <span class="operator">+</span></span><br><span class="line">       <span class="comment">## add the density from the current histogram</span></span><br><span class="line">      <span class="comment">## rep: repeatsnthe data returned by its first arguement</span></span><br><span class="line">  <span class="built_in">rep</span><span class="punctuation">(</span>cur_hist<span class="operator">$</span>density<span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span>n_hists<span class="punctuation">,</span> n_breaks <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  density <span class="operator">&lt;-</span> density<span class="operator">/</span>n_hists</span><br><span class="line">  <span class="comment"># plot the averages, and check for missing arguments</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">missing</span><span class="punctuation">(</span>xlim<span class="punctuation">)</span><span class="punctuation">)</span> xlim <span class="operator">&lt;-</span> xrange</span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">missing</span><span class="punctuation">(</span>ylim<span class="punctuation">)</span><span class="punctuation">)</span> ylim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>density<span class="punctuation">)</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">missing</span><span class="punctuation">(</span>fill<span class="punctuation">)</span><span class="punctuation">)</span> fill <span class="operator">&lt;-</span> col</span><br><span class="line">  plot<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span>xvals<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span>delta<span class="operator">/</span><span class="number">2</span><span class="punctuation">,</span> delta<span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>xvals<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       <span class="built_in">rep</span><span class="punctuation">(</span>density<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> type<span class="punctuation">,</span></span><br><span class="line">       xlim <span class="operator">=</span> xlim<span class="punctuation">,</span> ylim <span class="operator">=</span> ylim<span class="punctuation">,</span> xlab <span class="operator">=</span> xlab<span class="punctuation">,</span> ylab <span class="operator">=</span> ylab<span class="punctuation">,</span> main <span class="operator">=</span> main<span class="punctuation">,</span></span><br><span class="line">       lwd <span class="operator">=</span> lwd<span class="punctuation">,</span> lty <span class="operator">=</span> lty<span class="punctuation">,</span> col <span class="operator">=</span> col<span class="punctuation">,</span></span><br><span class="line">       bty <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># and fill it in</span></span><br><span class="line">  polygon<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span>xvals<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span>delta<span class="operator">/</span><span class="number">2</span><span class="punctuation">,</span> delta<span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>xvals<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          <span class="built_in">rep</span><span class="punctuation">(</span>density<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span>fill<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">with<span class="punctuation">(</span>geyser<span class="punctuation">,</span></span><br><span class="line">     <span class="punctuation">&#123;</span><span class="keyword">for</span><span class="punctuation">(</span>start <span class="keyword">in</span> seq<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0.4</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">     <span class="punctuation">&#123;</span>hist<span class="punctuation">(</span>duration<span class="punctuation">,</span></span><br><span class="line">           breaks<span class="operator">=</span>seq<span class="punctuation">(</span>start<span class="punctuation">,</span><span class="number">6.0</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">           col <span class="operator">=</span> plot_colour<span class="punctuation">,</span></span><br><span class="line">           probability <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">           xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">           ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">0.7</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">           main <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">           xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span></span><br><span class="line">           <span class="punctuation">)</span>  </span><br><span class="line">     <span class="punctuation">&#125;</span></span><br><span class="line">       ash<span class="punctuation">(</span>duration<span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">,</span>xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span><span class="punctuation">,</span> xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">           ylim<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0.7</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">       <span class="punctuation">&#125;</span></span><br><span class="line">     <span class="punctuation">)</span>  </span><br><span class="line">par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># weight function, this returns the weights alone or the weights and information</span></span><br><span class="line"><span class="comment"># on how to draw them as a function of x</span></span><br><span class="line">ashweights <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>m<span class="punctuation">,</span>h<span class="punctuation">,</span>k<span class="operator">=</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment"># k is the subscript of the central bin containing x, B_k,</span></span><br><span class="line">  <span class="comment"># m is the number of histograms</span></span><br><span class="line">  <span class="comment"># h is the bin width in each of the m histograms being averaged</span></span><br><span class="line">  indices <span class="operator">&lt;-</span> seq<span class="punctuation">(</span><span class="number">1</span><span class="operator">-</span>m<span class="punctuation">,</span> m<span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">  wts <span class="operator">&lt;-</span> 1<span class="operator">-</span><span class="built_in">abs</span><span class="punctuation">(</span>indices<span class="punctuation">)</span><span class="operator">/</span>m</span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span><span class="built_in">missing</span><span class="punctuation">(</span>h<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    width <span class="operator">&lt;-</span> h<span class="operator">/</span>m</span><br><span class="line">    hts <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> wts<span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">    bins <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span>m<span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>indices<span class="punctuation">,</span> m<span class="punctuation">)</span><span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> m<span class="operator">+</span><span class="number">1</span><span class="punctuation">)</span> <span class="operator">*</span> width <span class="operator">+</span> k</span><br><span class="line">    <span class="built_in">list</span><span class="punctuation">(</span>wts <span class="operator">=</span> wts<span class="punctuation">,</span> bins <span class="operator">=</span> bins<span class="punctuation">,</span> hts <span class="operator">=</span> hts<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="built_in">list</span><span class="punctuation">(</span>wts <span class="operator">=</span> wts<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># when m = 4, the weights are</span></span><br><span class="line">ashweights<span class="punctuation">(</span>m <span class="operator">=</span> <span class="number">4</span><span class="punctuation">)</span><span class="operator">$</span>wts</span><br><span class="line"></span><br><span class="line"><span class="comment"># draw the weighted function</span></span><br><span class="line">h <span class="operator">&lt;-</span> 0.5</span><br><span class="line">m <span class="operator">&lt;-</span> 4</span><br><span class="line">ashInfo <span class="operator">&lt;-</span> ashweights<span class="punctuation">(</span>m <span class="operator">=</span> m<span class="punctuation">,</span> h <span class="operator">=</span> h<span class="punctuation">,</span> k <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">w_hts <span class="operator">&lt;-</span> ashInfo<span class="operator">$</span>hts</span><br><span class="line">B_bins <span class="operator">&lt;-</span> ashInfo<span class="operator">$</span>bins</span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>B_bins<span class="punctuation">,</span> w_hts<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="built_in">expression</span><span class="punctuation">(</span><span class="string">&quot;ASH weight function for&quot;</span> <span class="operator">~</span> x <span class="operator">%in%</span> B<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;weights&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">max</span><span class="punctuation">(</span>w_hts<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span>h<span class="operator">/</span>m<span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">max</span><span class="punctuation">(</span>w_hts<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">text<span class="punctuation">(</span><span class="number">0.5</span><span class="operator">*</span><span class="punctuation">(</span>h<span class="operator">/</span>m<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">expression</span><span class="punctuation">(</span>B<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the weight is highest for the count of x in B_0, and decreases symmetrically</span></span><br><span class="line"><span class="comment">#  for m-1 small bins on either side</span></span><br></pre></td></tr></table></figure>

<h2 id="visual-comparisons"><a href="#visual-comparisons" class="headerlink" title="visual comparisons"></a>visual comparisons</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>knitr<span class="punctuation">)</span></span><br><span class="line">classTable <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>Titanic<span class="punctuation">,</span>MARGIN <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line">kable<span class="punctuation">(</span>classTable<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># number in each class is</span></span><br><span class="line">classTotals <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>classTable<span class="punctuation">,</span> MARGIN <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> FUN <span class="operator">=</span><span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line">classSurvival <span class="operator">&lt;-</span> t<span class="punctuation">(</span>classTable<span class="punctuation">[</span><span class="string">&quot;Yes&quot;</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="operator">/</span>classTotals<span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>classSurvival<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;survived&quot;</span><span class="punctuation">)</span></span><br><span class="line">kable<span class="punctuation">(</span>classSurvival<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># follw the rules for tables, a better way to present these numbers is</span></span><br><span class="line">newTable <span class="operator">&lt;-</span> 100 <span class="operator">*</span> <span class="built_in">round</span><span class="punctuation">(</span>classSurvival<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">newTable <span class="operator">&lt;-</span> t<span class="punctuation">(</span>newTable<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># descendeing order</span></span><br><span class="line">descendingOrder <span class="operator">&lt;-</span> order<span class="punctuation">(</span>newTable<span class="punctuation">,</span> decreasing <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">newTable <span class="operator">&lt;-</span> newTable<span class="punctuation">[</span>descendingOrder<span class="punctuation">,</span> <span class="punctuation">,</span>drop <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">]</span> <span class="comment"># note drop argument</span></span><br><span class="line">colnames<span class="punctuation">(</span>newTable<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;% survived&quot;</span><span class="punctuation">)</span></span><br><span class="line">kable<span class="punctuation">(</span>newTable<span class="punctuation">,</span> caption <span class="operator">=</span> <span class="string">&quot;survival rates on the titanic by class&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># as lengths of bars, colour coded and labelled by class</span></span><br><span class="line">nvals <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>newTable<span class="punctuation">)</span></span><br><span class="line">col <span class="operator">&lt;-</span> rainbow<span class="punctuation">(</span>nvals<span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>newTable<span class="punctuation">,</span> col <span class="operator">=</span> col<span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> axes <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">        names.arg <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> xlab <span class="operator">=</span> colnames<span class="punctuation">(</span>newTable<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">xlocs <span class="operator">&lt;-</span> <span class="built_in">cumsum</span><span class="punctuation">(</span>newTable<span class="punctuation">)</span></span><br><span class="line">centres <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>xlocs<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="operator">/</span><span class="number">2</span><span class="punctuation">,</span> xlocs<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="punctuation">(</span>nvals <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">+</span> diff<span class="punctuation">(</span>xlocs<span class="punctuation">)</span><span class="operator">/</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">text<span class="punctuation">(</span>centres<span class="punctuation">,</span> <span class="number">0.75</span><span class="punctuation">,</span> labels <span class="operator">=</span> rownames<span class="punctuation">(</span>newTable<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">barplot<span class="punctuation">(</span>newTable<span class="punctuation">,</span> col <span class="operator">=</span> col<span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> beside <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">        names.arg <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        xlab <span class="operator">=</span> colnames<span class="punctuation">(</span>newTable<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        legend.text <span class="operator">=</span> rownames<span class="punctuation">(</span>newTable<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the titanic - survivors beside deaths</span></span><br><span class="line">survivalProportions <span class="operator">&lt;-</span> classTable</span><br><span class="line">survivalProportions<span class="punctuation">[</span><span class="string">&quot;Yes&quot;</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> survivalProportions<span class="punctuation">[</span><span class="string">&quot;Yes&quot;</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="operator">/</span>classTotals</span><br><span class="line">survivalProportions<span class="punctuation">[</span><span class="string">&quot;No&quot;</span><span class="punctuation">,</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> survivalProportions<span class="punctuation">[</span><span class="string">&quot;No&quot;</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="operator">/</span>classTotals</span><br><span class="line">survivalCols <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>survivalProportions<span class="punctuation">,</span> col <span class="operator">=</span> survivalCols<span class="punctuation">,</span></span><br><span class="line">        horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> beside <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">        xlab <span class="operator">=</span> <span class="string">&quot;proportion of class&quot;</span><span class="punctuation">,</span> xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;bottomright&quot;</span><span class="punctuation">,</span> title <span class="operator">=</span> <span class="string">&quot;survival&quot;</span><span class="punctuation">,</span> fill <span class="operator">=</span> survivalCols<span class="punctuation">,</span></span><br><span class="line">       legend <span class="operator">=</span> rownames<span class="punctuation">(</span>survivalProportions<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># survivor and deaths within a common frame</span></span><br><span class="line"><span class="comment"># there ia a framing effect which makes proportions very easy to compare</span></span><br><span class="line"><span class="comment"># from one end or the other</span></span><br><span class="line"><span class="comment"># all are along common aligned scales</span></span><br><span class="line"></span><br><span class="line">barplot<span class="punctuation">(</span>survivalProportions<span class="punctuation">,</span> col <span class="operator">=</span> survivalCols<span class="punctuation">,</span></span><br><span class="line">        horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> beside <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">        xlab <span class="operator">=</span> <span class="string">&quot;proportion of class&quot;</span><span class="punctuation">,</span> space <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">barplot<span class="punctuation">(</span>apply<span class="punctuation">(</span>classTable<span class="punctuation">,</span> MARGIN <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> FUN <span class="operator">=</span><span class="built_in">sum</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        xlab <span class="operator">=</span> <span class="string">&quot;class&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;number of passengers&quot;</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>classTable<span class="punctuation">,</span> col<span class="operator">=</span>survivalCols<span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;class&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;numebr of passengers&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>loon.data<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;SAheart&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;loon.data&quot;</span><span class="punctuation">)</span></span><br><span class="line">kable<span class="punctuation">(</span>head<span class="punctuation">(</span>SAheart<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">noFamilyHistory <span class="operator">&lt;-</span> SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;famhist&quot;</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&quot;Absent&quot;</span></span><br><span class="line">FamilyHistory <span class="operator">&lt;-</span> SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;famhist&quot;</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&quot;Present&quot;</span></span><br><span class="line">famHIsotryCol <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line">noHistoryCol <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">,</span></span><br><span class="line">        main <span class="operator">=</span> <span class="string">&quot;No family history&quot;</span><span class="punctuation">,</span> horizontal <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># use formula notation y~x and a single data set, on common aligned scales</span></span><br><span class="line">boxplot<span class="punctuation">(</span>sbp<span class="operator">~</span>famhist<span class="punctuation">,</span> data <span class="operator">=</span> SAheart<span class="punctuation">,</span> col <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>noHistoryCol<span class="punctuation">,</span> famHIsotryCol<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        main <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span> horizontal <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>SAheart<span class="punctuation">,</span> mapping <span class="operator">=</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>famhist<span class="punctuation">,</span> y <span class="operator">=</span> sbp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_boxplot<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               fill <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  coord_flip<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">hist<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> noHistoryCol<span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;No family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">60</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># when use par(mfrow = c(2,1)) , means not on common scale</span></span><br><span class="line"><span class="comment"># put on common scale as follows</span></span><br><span class="line">hist<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> noHistoryCol<span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;No family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">hist<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>FamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reflected histograms</span></span><br><span class="line">xrange <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">breaks <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>xrange<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> xrange<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">h1 <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">           breaks <span class="operator">=</span> breaks<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">h2 <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>FamilyHistory<span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">           breaks <span class="operator">=</span> breaks<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">hmax <span class="operator">=</span> <span class="built_in">max</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>h1<span class="operator">$</span>counts<span class="punctuation">,</span> h2<span class="operator">$</span>counts<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">h2<span class="operator">$</span>counts <span class="operator">&lt;-</span> <span class="operator">-</span>h2<span class="operator">$</span>counts</span><br><span class="line">hmin <span class="operator">=</span> <span class="operator">-</span>hmax</span><br><span class="line">X <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>h1<span class="operator">$</span>breaks<span class="punctuation">,</span> h2<span class="operator">$</span>breaks<span class="punctuation">)</span></span><br><span class="line">xmax <span class="operator">&lt;-</span> <span class="built_in">max</span><span class="punctuation">(</span>X<span class="punctuation">)</span></span><br><span class="line">xmin <span class="operator">=</span> <span class="built_in">min</span><span class="punctuation">(</span>X<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>h1<span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;comapring patients with(blue) and without(pink)&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>hmin<span class="punctuation">,</span> hmax<span class="punctuation">)</span><span class="punctuation">,</span>xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>xmin<span class="punctuation">,</span> xmax<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> noHistoryCol<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>h2<span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># back to back histograms&#x27;</span></span><br><span class="line">yrange <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">breaks <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>yrange<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> yrange<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">h1 <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">           breaks <span class="operator">=</span> breaks<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">h2 <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>FamilyHistory<span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">           breaks <span class="operator">=</span> breaks<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">nbreaks <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>breaks<span class="punctuation">)</span></span><br><span class="line">hmax <span class="operator">=</span> <span class="built_in">max</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>h1<span class="operator">$</span>counts<span class="punctuation">,</span> h2<span class="operator">$</span>counts<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">h2<span class="operator">$</span>counts <span class="operator">&lt;-</span> <span class="operator">-</span>h2<span class="operator">$</span>counts</span><br><span class="line">hmin <span class="operator">=</span> <span class="operator">-</span>hmax</span><br><span class="line">Y <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span>h1<span class="operator">$</span>breaks<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">X <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="built_in">rep</span><span class="punctuation">(</span>h1<span class="operator">$</span>counts<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">range</span><span class="punctuation">(</span>Y<span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>hmin<span class="punctuation">,</span> hmax<span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> extendrange<span class="punctuation">(</span>Y<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">     bty <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;frequency&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;comparing patients with and without&quot;</span><span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>X<span class="punctuation">,</span> Y<span class="punctuation">,</span> col <span class="operator">=</span> noHistoryCol<span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nbreaks<span class="punctuation">)</span><span class="punctuation">&#123;</span>lines<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> h1<span class="operator">$</span>counts<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span>h1<span class="operator">$</span>breaks<span class="punctuation">[</span>i<span class="operator">+</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">Y <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span>h2<span class="operator">$</span>breaks<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">X <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="built_in">rep</span><span class="punctuation">(</span>h2<span class="operator">$</span>counts<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>X<span class="punctuation">,</span> Y<span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nbreaks<span class="punctuation">)</span><span class="punctuation">&#123;</span>lines<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span>h2<span class="operator">$</span>counts<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span>h2<span class="operator">$</span>breaks<span class="punctuation">[</span>i<span class="operator">+</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># using facet with ggplot2</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data <span class="operator">=</span>SAheart<span class="punctuation">,</span> mapping <span class="operator">=</span> aes<span class="punctuation">(</span>x <span class="operator">=</span>sbp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_histogram<span class="punctuation">(</span>bins <span class="operator">=</span><span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">                 colour <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span></span><br><span class="line">                 fill<span class="operator">=</span><span class="string">&quot;white&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>famhist<span class="operator">~</span>.<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># what can be compared via density estimates</span></span><br><span class="line">savepAr <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">densAbsent <span class="operator">&lt;-</span> density<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> bw <span class="operator">=</span> <span class="string">&quot;SJ&quot;</span><span class="punctuation">)</span></span><br><span class="line">densPresent <span class="operator">&lt;-</span> density<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>FamilyHistory<span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> bw <span class="operator">=</span> <span class="string">&quot;SJ&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>densAbsent<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;no family history&quot;</span><span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>densAbsent<span class="punctuation">,</span> col <span class="operator">=</span> noHistoryCol<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>densPresent<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;family history&quot;</span><span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>densPresent<span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>savepAr<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># note the scales are not necesssarily identical</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># compare both x,y aligned x only scales</span></span><br><span class="line">savep <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">xlim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">ylim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>densAbsent<span class="operator">$</span>y<span class="punctuation">,</span> densPresent<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>densAbsent<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;no family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> xlim<span class="punctuation">,</span> ylim <span class="operator">=</span> ylim<span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>densAbsent<span class="punctuation">,</span> col <span class="operator">=</span> noHistoryCol<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>densPresent<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span>main <span class="operator">=</span> <span class="string">&quot;family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> xlim<span class="punctuation">,</span> ylim <span class="operator">=</span> ylim<span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>densPresent<span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>savep<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># common aligned scales</span></span><br><span class="line">plot<span class="punctuation">(</span>densAbsent<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;comparing a no family history with family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> xlim<span class="punctuation">,</span> ylim <span class="operator">=</span> ylim<span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>densAbsent<span class="punctuation">,</span> col <span class="operator">=</span> noHistoryCol<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>densPresent<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>densPresent<span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># common aligned scales-reflected</span></span><br><span class="line">densPresent<span class="operator">$</span>y <span class="operator">&lt;-</span> <span class="operator">-</span> densPresent<span class="operator">$</span>y</span><br><span class="line">ylim2 <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>densAbsent<span class="operator">$</span>y<span class="punctuation">,</span> densPresent<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>densAbsent<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;comparing a no family history with family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> xlim<span class="punctuation">,</span> ylim <span class="operator">=</span> ylim2<span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>densAbsent<span class="punctuation">,</span> col <span class="operator">=</span> noHistoryCol<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>densPresent<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>densPresent<span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># back to back</span></span><br><span class="line">ylim3 <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">xlim2 <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>densAbsent<span class="operator">$</span>y<span class="punctuation">,</span> densPresent<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">xyswitch <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>xy_thing<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  yx_thing <span class="operator">&lt;-</span> xy_thing</span><br><span class="line">  yx_thing<span class="operator">$</span>x <span class="operator">&lt;-</span> xy_thing<span class="operator">$</span>y</span><br><span class="line">  yx_thing<span class="operator">$</span>y <span class="operator">&lt;-</span> xy_thing<span class="operator">$</span>x</span><br><span class="line">  yx_thing</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">plot<span class="punctuation">(</span>xyswitch<span class="punctuation">(</span>densAbsent<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;Density&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;comparing a no family history with family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> xlim2<span class="punctuation">,</span> ylim <span class="operator">=</span> ylim3<span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>xyswitch<span class="punctuation">(</span>densAbsent<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> noHistoryCol<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>xyswitch<span class="punctuation">(</span>densPresent<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span></span><br><span class="line">polygon<span class="punctuation">(</span>xyswitch<span class="punctuation">(</span>densPresent<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># using facet with ggplot2</span></span><br><span class="line">libarary<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span>SAheart<span class="punctuation">,</span> mapping <span class="operator">=</span> aes<span class="punctuation">(</span>x<span class="operator">=</span>sbp<span class="punctuation">,</span> col <span class="operator">=</span> famhist<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_density<span class="punctuation">(</span>colour <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span></span><br><span class="line">               fill <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span></span><br><span class="line">               alpha <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">,</span></span><br><span class="line">               bw <span class="operator">=</span> <span class="string">&quot;SJ&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>famhist<span class="operator">~</span>.<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># simple points</span></span><br><span class="line">xlim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">n <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>SAheart<span class="punctuation">)</span></span><br><span class="line">col <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span>adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">,</span>n<span class="punctuation">)</span></span><br><span class="line">col<span class="punctuation">[</span>FamilyHistory<span class="punctuation">]</span> <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.2</span><span class="punctuation">)</span></span><br><span class="line">Y <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span>n<span class="punctuation">)</span></span><br><span class="line">Y<span class="punctuation">[</span>FamilyHistory<span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">plot<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> y <span class="operator">=</span> Y<span class="punctuation">,</span> col <span class="operator">=</span> col<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;comparing a no family history with family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> xlim<span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> bty <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># simple points with jittering</span></span><br><span class="line"></span><br><span class="line">xlim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">n <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>SAheart<span class="punctuation">)</span></span><br><span class="line">col <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span>adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.2</span><span class="punctuation">)</span><span class="punctuation">,</span>n<span class="punctuation">)</span></span><br><span class="line">col<span class="punctuation">[</span>FamilyHistory<span class="punctuation">]</span> <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.2</span><span class="punctuation">)</span></span><br><span class="line">Y <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span>n<span class="punctuation">)</span></span><br><span class="line">Y<span class="punctuation">[</span>FamilyHistory<span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="operator">-</span><span class="number">1</span></span><br><span class="line">U <span class="operator">&lt;-</span> runif<span class="punctuation">(</span>n<span class="punctuation">,</span> <span class="operator">-</span><span class="number">0.3</span><span class="punctuation">,</span><span class="number">0.3</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> y <span class="operator">=</span> Y <span class="operator">+</span> U<span class="punctuation">,</span> col <span class="operator">=</span> col<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;comparing a no family history with family history&quot;</span><span class="punctuation">,</span></span><br><span class="line">     xlim <span class="operator">=</span> xlim<span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> bty <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># quantile plots</span></span><br><span class="line">savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">nAbsent <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>noFamilyHistory<span class="punctuation">)</span></span><br><span class="line">nPresent <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>FamilyHistory<span class="punctuation">)</span></span><br><span class="line">pAbsent <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>nAbsent<span class="punctuation">)</span></span><br><span class="line">pPresent <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>nPresent<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>pAbsent<span class="punctuation">,</span>sort<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> noHistoryCol<span class="punctuation">,</span> pch <span class="operator">=</span><span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;cumulative proportion&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;no family histroy&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>pPresent<span class="punctuation">,</span>sort<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>FamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> famHIsotryCol<span class="punctuation">,</span> pch <span class="operator">=</span><span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;cumulative proportion&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;family histroy&quot;</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># quantile plot common aligned scales via overlaying</span></span><br><span class="line">ylim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">nAbsent <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>noFamilyHistory<span class="punctuation">)</span></span><br><span class="line">nPresent <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>FamilyHistory<span class="punctuation">)</span></span><br><span class="line">pAbsent <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>nAbsent<span class="punctuation">)</span></span><br><span class="line">pPresent <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>nPresent<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>pAbsent<span class="punctuation">,</span>sort<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> noHistoryCol<span class="punctuation">,</span> pch <span class="operator">=</span><span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;cumulative proportion&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;systolic blood pressure&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;no family histroy&quot;</span><span class="punctuation">)</span></span><br><span class="line">points<span class="punctuation">(</span>pPresent<span class="punctuation">,</span> sort<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>FamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> famHIsotryCol<span class="punctuation">,</span> pch <span class="operator">=</span><span class="number">19</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="visual-hypothesis-testing"><a href="#visual-hypothesis-testing" class="headerlink" title="visual hypothesis testing"></a>visual hypothesis testing</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># a function which would achieve this mixing is</span></span><br><span class="line">mixRandomly <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment"># note the data need not to be a data frame</span></span><br><span class="line">  <span class="comment"># it is expected to be a list with an x and y component (possibly different lengths)</span></span><br><span class="line">  x <span class="operator">&lt;-</span> data<span class="operator">$</span>x</span><br><span class="line">  y <span class="operator">&lt;-</span> data<span class="operator">$</span>y</span><br><span class="line">  m <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  n <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>y<span class="punctuation">)</span></span><br><span class="line">  mix <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span></span><br><span class="line">  select4x <span class="operator">&lt;-</span> sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="punctuation">(</span>m<span class="operator">+</span>n<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                     m<span class="punctuation">,</span></span><br><span class="line">                     replace <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  new_x <span class="operator">&lt;-</span> mix<span class="punctuation">[</span>select4x<span class="punctuation">]</span></span><br><span class="line">  new_y <span class="operator">&lt;-</span> mix<span class="punctuation">[</span><span class="operator">-</span>select4x<span class="punctuation">]</span></span><br><span class="line">  <span class="built_in">list</span><span class="punctuation">(</span>x <span class="operator">=</span> new_x<span class="punctuation">,</span> y <span class="operator">=</span> new_y<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">myplot <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  xrange <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">,</span> data<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  breaks <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>xrange<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> xrange<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">  hx <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">,</span> breaks <span class="operator">=</span> breaks<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  hy <span class="operator">=</span> hist<span class="punctuation">(</span>data<span class="operator">$</span>y<span class="punctuation">,</span> breaks <span class="operator">=</span> breaks<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  yrange <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>hx<span class="operator">$</span>counts<span class="punctuation">,</span> hy<span class="operator">$</span>counts<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  plot<span class="punctuation">(</span>hx<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> axes <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">       ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">       ylim <span class="operator">=</span> yrange<span class="punctuation">,</span> xlim <span class="operator">=</span> xrange<span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  lines<span class="punctuation">(</span>hy<span class="punctuation">,</span> col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># apply it</span></span><br><span class="line">library<span class="punctuation">(</span>loon.data<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;SAheart&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;loon.data&quot;</span><span class="punctuation">)</span></span><br><span class="line">Present <span class="operator">&lt;-</span> SAheart<span class="punctuation">[</span><span class="punctuation">,</span> <span class="string">&quot;famhist&quot;</span><span class="punctuation">]</span> <span class="operator">==</span> <span class="string">&quot;Present&quot;</span></span><br><span class="line">x <span class="operator">&lt;-</span> SAheart<span class="punctuation">[</span>Present<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span></span><br><span class="line">y <span class="operator">&lt;-</span> SAheart<span class="punctuation">[</span><span class="operator">!</span>Present<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span></span><br><span class="line">data <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>x<span class="operator">=</span> x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">heads <span class="operator">&lt;-</span> runif<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">)</span> <span class="operator">&gt;</span> <span class="number">0.5</span> <span class="comment"># toss a coin for order</span></span><br><span class="line">tails <span class="operator">=</span> <span class="operator">!</span>heads</span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span>heads<span class="punctuation">)</span> myplot<span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="keyword">else</span> myplot<span class="punctuation">(</span>mixRandomly<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span>tails<span class="punctuation">)</span> myplot<span class="punctuation">(</span>mixRandomly<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">)</span> <span class="keyword">else</span> myplot<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># function to do a line up test</span></span><br><span class="line"></span><br><span class="line">lineup <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span> showSubject <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> generateSubject <span class="operator">=</span> NUll<span class="punctuation">,</span></span><br><span class="line">                   trueLoc <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> layout <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  nSubjects <span class="operator">&lt;-</span> layout<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">*</span>layout<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>trueLoc<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>trueLoc <span class="operator">&lt;-</span> sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nSubjects<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>showSubject<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>stop<span class="punctuation">(</span><span class="string">&quot;need a plot function for the subject&quot;</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>generateSubject<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span> stop<span class="punctuation">(</span><span class="string">&quot;need a function to generate subject&quot;</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># need to decide which subject to present</span></span><br><span class="line">  presentSubject <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>subjectNo<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="punctuation">(</span>subjectNo <span class="operator">!=</span> trueLoc<span class="punctuation">)</span> <span class="punctuation">&#123;</span>data <span class="operator">&lt;-</span> generateSubject<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">    showSubject<span class="punctuation">(</span>data<span class="punctuation">,</span> subjectNo<span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># this does the plotting</span></span><br><span class="line">    savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow<span class="operator">=</span> layout<span class="punctuation">,</span></span><br><span class="line">                   mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">2.5</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.3</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span> oma <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    sapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nSubjects<span class="punctuation">,</span> FUN <span class="operator">=</span> presentSubject<span class="punctuation">)</span></span><br><span class="line">    par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># hide the true location but return information to reconstruct it</span></span><br><span class="line">    hideLocation<span class="punctuation">(</span>trueLoc<span class="punctuation">,</span> nSubjects<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">hideLocation <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>trueLoc<span class="punctuation">,</span> nSubjects<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  possibleBaseVals <span class="operator">&lt;-</span> 3<span class="operator">:</span><span class="built_in">min</span><span class="punctuation">(</span><span class="number">2</span><span class="operator">*</span>nSubjects<span class="punctuation">,</span> <span class="number">50</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># remove easy base values</span></span><br><span class="line">  possibleBaseVals <span class="operator">&lt;-</span> possibleBaseVals<span class="punctuation">[</span>possibleBaseVals <span class="operator">!=</span> <span class="number">10</span> <span class="operator">&amp;</span></span><br><span class="line">                                         possibleBaseVals <span class="operator">!=</span> <span class="number">5</span><span class="punctuation">]</span></span><br><span class="line">  base <span class="operator">&lt;-</span> sample<span class="punctuation">(</span>possibleBaseVals<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">  offset <span class="operator">&lt;-</span> sample<span class="punctuation">(</span><span class="number">5</span><span class="operator">:</span><span class="built_in">min</span><span class="punctuation">(</span><span class="number">5</span><span class="operator">*</span>nSubjects<span class="punctuation">,</span> <span class="number">125</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># return the location information (trueLoc hidden)</span></span><br><span class="line">  <span class="built_in">list</span><span class="punctuation">(</span>trueLoc <span class="operator">&lt;-</span> paste0<span class="punctuation">(</span><span class="string">&quot;log(&quot;</span><span class="punctuation">,</span></span><br><span class="line">                         base<span class="operator">^</span><span class="punctuation">(</span>trueLoc <span class="operator">+</span>offset<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                         <span class="string">&quot;, base = &quot;</span><span class="punctuation">,</span> base<span class="punctuation">,</span></span><br><span class="line">                         <span class="string">&quot;) - &quot;</span><span class="punctuation">,</span> offset<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">revealLocation <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>hideLocation<span class="punctuation">)</span><span class="punctuation">&#123;</span>eval<span class="punctuation">(</span>parse<span class="punctuation">(</span>text<span class="operator">=</span>hideLocation<span class="operator">$</span>trueLoc<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># suspectLocation &lt;- hideLocation(3,20)</span></span><br><span class="line"><span class="comment"># revealLocation(suspectLocation)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># have to fix myPlot to acccept a subject number</span></span><br><span class="line">myPlot <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span> subjectNo<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  xrange <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">,</span> data<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  breaks <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>xrange<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> xrange<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> length.out <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">  hx <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">,</span> breaks <span class="operator">=</span> breaks<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  hy <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>data<span class="operator">$</span>y<span class="punctuation">,</span> breaks <span class="operator">=</span> breaks<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  yrange <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>hx<span class="operator">$</span>counts<span class="punctuation">,</span> hy<span class="operator">$</span>counts<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  plot<span class="punctuation">(</span>hx<span class="punctuation">,</span> main <span class="operator">=</span> paste<span class="punctuation">(</span>   subjectNo<span class="punctuation">)</span><span class="punctuation">,</span> cex.main <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> line <span class="operator">=</span> <span class="operator">-</span><span class="number">0.75</span><span class="punctuation">,</span></span><br><span class="line">       ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">       ylim <span class="operator">=</span> yrange<span class="punctuation">,</span> xlim <span class="operator">=</span> xrange<span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  lines<span class="punctuation">(</span>hy<span class="punctuation">,</span> col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># we need only execute the test as follows</span></span><br><span class="line">data <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">)</span></span><br><span class="line">lineup<span class="punctuation">(</span>data<span class="punctuation">,</span></span><br><span class="line">       generateSubject <span class="operator">=</span> mixRandomly<span class="punctuation">,</span></span><br><span class="line">       showSubject <span class="operator">=</span> myPlot<span class="punctuation">,</span></span><br><span class="line">       layout <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># back to back displays</span></span><br><span class="line">back2back <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span> subjectNo<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  ylim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">,</span> data<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  Xdensity <span class="operator">&lt;-</span> density<span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">,</span> bw <span class="operator">=</span> <span class="string">&quot;SJ&quot;</span><span class="punctuation">)</span></span><br><span class="line">  Ydensity <span class="operator">&lt;-</span> density<span class="punctuation">(</span>data<span class="operator">$</span>y<span class="punctuation">,</span> bw <span class="operator">=</span> <span class="string">&quot;SJ&quot;</span><span class="punctuation">)</span></span><br><span class="line">  Ydensity<span class="operator">$</span>y <span class="operator">&lt;-</span> <span class="operator">-</span> Ydensity<span class="operator">$</span>y</span><br><span class="line">  xlim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>Xdensity<span class="operator">$</span>y<span class="punctuation">,</span> Ydensity<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  xyswitch <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>xy_thing<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    yx_thing <span class="operator">&lt;-</span> xy_thing</span><br><span class="line">    yx_thing<span class="operator">$</span>x <span class="operator">&lt;-</span> xy_thing<span class="operator">$</span>y</span><br><span class="line">    yx_thing<span class="operator">$</span>y <span class="operator">&lt;-</span> xy_thing<span class="operator">$</span>x</span><br><span class="line">    yx_thing</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  plot<span class="punctuation">(</span>xyswitch<span class="punctuation">(</span>Xdensity<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">       ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">       main <span class="operator">=</span> paste<span class="punctuation">(</span>subjectNo<span class="punctuation">)</span><span class="punctuation">,</span>cex.main <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> adj <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">,</span>line <span class="operator">=</span> <span class="operator">-</span><span class="number">0.85</span><span class="punctuation">,</span></span><br><span class="line">       xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">       xlim <span class="operator">=</span> xlim<span class="punctuation">,</span> ylim <span class="operator">=</span> ylim<span class="punctuation">)</span></span><br><span class="line">  polygon<span class="punctuation">(</span>xyswitch<span class="punctuation">(</span>Xdensity<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  lines<span class="punctuation">(</span>xyswitch<span class="punctuation">(</span>Ydensity<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span></span><br><span class="line">  polygon<span class="punctuation">(</span>xyswitch<span class="punctuation">(</span>Ydensity<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">data <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">)</span></span><br><span class="line">lineup<span class="punctuation">(</span>data<span class="punctuation">,</span></span><br><span class="line">       generateSubject <span class="operator">=</span> mixRandomly<span class="punctuation">,</span></span><br><span class="line">       showSubject <span class="operator">=</span> back2back<span class="punctuation">,</span></span><br><span class="line">       layout <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># quantiles display</span></span><br><span class="line">quantiles <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span> subjectNo<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  ylim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">,</span> data<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  n_x <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">)</span></span><br><span class="line">  n_y <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>data<span class="operator">$</span>y<span class="punctuation">)</span></span><br><span class="line">  p_x <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>n_x<span class="punctuation">)</span></span><br><span class="line">  p_y <span class="operator">&lt;-</span> ppoints<span class="punctuation">(</span>n_y<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  plot<span class="punctuation">(</span>p_x<span class="punctuation">,</span> sort<span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">       pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       cex <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> ylim <span class="operator">=</span> ylim<span class="punctuation">,</span></span><br><span class="line">      xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> paste<span class="punctuation">(</span>subjectNo<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      cex.main <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> adj <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">,</span>line <span class="operator">=</span> <span class="operator">-</span><span class="number">0.85</span><span class="punctuation">,</span></span><br><span class="line">      xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">)</span></span><br><span class="line">  points<span class="punctuation">(</span>p_y<span class="punctuation">,</span> sort<span class="punctuation">(</span>data<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line">         col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">,</span>pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">         cex <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">lineup<span class="punctuation">(</span>data<span class="punctuation">,</span></span><br><span class="line">       generateSubject <span class="operator">=</span> mixRandomly<span class="punctuation">,</span></span><br><span class="line">       showSubject <span class="operator">=</span> quantiles<span class="punctuation">,</span></span><br><span class="line">       layout <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># we might use boxplot if we are only interested in comparing locations and</span></span><br><span class="line"><span class="comment">#   possible scales and symmetry</span></span><br><span class="line"></span><br><span class="line">boxplots <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span> subjectNo<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  y <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">,</span> data<span class="operator">$</span>y<span class="punctuation">)</span></span><br><span class="line">  x <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>data<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  boxplot<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> cbind<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          main <span class="operator">=</span> paste<span class="punctuation">(</span>subjectNo<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">          cex.main <span class="operator">=</span> <span class="number">1.5</span><span class="punctuation">,</span> adj <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">,</span> line <span class="operator">=</span> <span class="operator">-</span><span class="number">0.75</span><span class="punctuation">,</span></span><br><span class="line">          xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="hypothetical-generative"><a href="#hypothetical-generative" class="headerlink" title="hypothetical generative"></a>hypothetical generative</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># this function will return x and y data that have the same median(0) and</span></span><br><span class="line"><span class="comment"># interquartile range(1): same slope in the middle</span></span><br><span class="line"></span><br><span class="line">matchData <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  x <span class="operator">&lt;-</span> data<span class="operator">$</span>x</span><br><span class="line">  y <span class="operator">&lt;-</span> data<span class="operator">$</span>y</span><br><span class="line">  <span class="built_in">list</span> <span class="punctuation">(</span>x <span class="operator">=</span> scale<span class="punctuation">(</span>x<span class="punctuation">,</span> center <span class="operator">=</span> median<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">,</span> scale<span class="operator">=</span>IQR<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        y <span class="operator">=</span> scale<span class="punctuation">(</span>y<span class="punctuation">,</span> center <span class="operator">=</span> median<span class="punctuation">(</span>y<span class="punctuation">)</span><span class="punctuation">,</span> scale<span class="operator">=</span>IQR<span class="punctuation">(</span>y<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">lineup<span class="punctuation">(</span>data<span class="punctuation">,</span></span><br><span class="line">       showSubject <span class="operator">=</span> back2back<span class="punctuation">,</span></span><br><span class="line">       layout <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       generateSubject <span class="operator">=</span></span><br><span class="line">         <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">           data <span class="operator">&lt;-</span> matchData<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">           data <span class="operator">&lt;-</span> mixRandomly<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">           matchData<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># compare to a specific shape</span></span><br><span class="line"><span class="comment"># rdist(): will generate n pseudo-random values from the hypothesized generative</span></span><br><span class="line"><span class="comment">#  distribution (for some location and scale), then data matched on location (median)</span></span><br><span class="line"><span class="comment">#  and scale(IQR) can be geenrated using:</span></span><br><span class="line">getMatchData <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span></span><br><span class="line">                         rdist <span class="operator">=</span> rnorm<span class="punctuation">,</span></span><br><span class="line">                         matchScale <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">                         matchLocation <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  new_x <span class="operator">&lt;-</span> rdist<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span>   <span class="comment"># geenrate new data Hershey</span></span><br><span class="line">  <span class="comment"># now match the new data to have the same location and scale as the old data</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>matchScale<span class="punctuation">)</span> <span class="punctuation">&#123;</span>new_x <span class="operator">&lt;-</span> new_x <span class="operator">*</span> <span class="punctuation">(</span>IQR<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="operator">/</span>IQR<span class="punctuation">(</span>new_x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>matchLocation<span class="punctuation">)</span> <span class="punctuation">&#123;</span>new_x <span class="operator">&lt;-</span> new_x <span class="operator">-</span> median<span class="punctuation">(</span>new_x<span class="punctuation">)</span> <span class="operator">+</span> median<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">  new_x</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># first, get the actual data</span></span><br><span class="line">x <span class="operator">&lt;-</span> beaver1<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;temp&quot;</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># construct a pairing of it with a randomly geenrated sample from any Gaussian distribution</span></span><br><span class="line"><span class="comment"># and match the location and scale</span></span><br><span class="line">data <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> getMatchData<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># then this data can now be used in a line up test,</span></span><br><span class="line">lineup<span class="punctuation">(</span>data<span class="punctuation">,</span></span><br><span class="line">       showSubject <span class="operator">=</span> back2back<span class="punctuation">,</span></span><br><span class="line">       layout <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       generateSubject <span class="operator">=</span></span><br><span class="line">         <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">           <span class="built_in">list</span><span class="punctuation">(</span>x <span class="operator">=</span> getMatchData<span class="punctuation">(</span>data<span class="operator">$</span>x<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                y <span class="operator">=</span> getMatchData<span class="punctuation">(</span>data<span class="operator">$</span>y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">         <span class="punctuation">&#125;</span></span><br><span class="line">       <span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if from other distribution, like t3</span></span><br><span class="line">rdist <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>n<span class="punctuation">)</span> rt<span class="punctuation">(</span>n<span class="punctuation">,</span> df <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>x <span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> getMatchData<span class="punctuation">(</span>x<span class="punctuation">,</span> rdist <span class="operator">=</span> rdist<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## the above method was compared to several other pairs of x and y where both were</span></span><br><span class="line"><span class="comment"># generated from the hyppthesized dsitribuiotn</span></span><br><span class="line"><span class="comment"># the extra variation introduced by random generation of both x and y under the null hypothesis might</span></span><br><span class="line"><span class="comment"># be making the detemination more difficult</span></span><br><span class="line"><span class="comment"># the variation might be reduced if we instead use a single representative set of values</span></span><br><span class="line"><span class="comment"># for the comparison in each graphic.</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sample quantiles vs. theoretical quantiles</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;MASS&quot;</span><span class="punctuation">)</span></span><br><span class="line">attach<span class="punctuation">(</span>geyser<span class="punctuation">)</span></span><br><span class="line">plot_colour <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;black&quot;</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">)</span></span><br><span class="line">qqnorm<span class="punctuation">(</span>duration<span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> col <span class="operator">=</span> plot_colour<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># here geyser duration data with alpha blending to help reveal point density</span></span><br><span class="line"></span><br><span class="line">savePar <span class="operator">=</span> par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">qqnorm<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>noFamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       main <span class="operator">=</span> <span class="string">&quot;no family history&quot;</span><span class="punctuation">)</span></span><br><span class="line">qqnorm<span class="punctuation">(</span>SAheart<span class="punctuation">[</span>FamilyHistory<span class="punctuation">,</span> <span class="string">&quot;sbp&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">       col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       main <span class="operator">=</span> <span class="string">&quot;family history&quot;</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># self calibrating qqplots</span></span><br><span class="line">library<span class="punctuation">(</span>qqtest<span class="punctuation">)</span></span><br><span class="line">qqtest<span class="punctuation">(</span>duration<span class="punctuation">)</span></span><br><span class="line">qqtest<span class="punctuation">(</span>duration<span class="punctuation">,</span> xAxisAsProbs <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span>yAxisAsProbs <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ordering comparisons</span></span><br><span class="line">library<span class="punctuation">(</span>loon.data<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;SAheart&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># getting the comparisons of interest</span></span><br><span class="line"><span class="comment"># get the groups</span></span><br><span class="line">groups <span class="operator">&lt;-</span> with<span class="punctuation">(</span>SAheart<span class="punctuation">,</span> split<span class="punctuation">(</span>sbp<span class="punctuation">,</span> <span class="built_in">list</span><span class="punctuation">(</span>famhist<span class="punctuation">,</span> chd<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">kable<span class="punctuation">(</span>t<span class="punctuation">(</span><span class="built_in">names</span><span class="punctuation">(</span>groups<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># now ordering the groups</span></span><br><span class="line">ord <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Present.No&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Present.Yes&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Absent.Yes&quot;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;Absent.No&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Present.No&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># match the colours to the famliy history</span></span><br><span class="line">cols <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span></span><br><span class="line">                      <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>groups<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> cols<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># layout via graph structure</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;PairViz&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>loon.data<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span>cancer<span class="punctuation">)</span></span><br><span class="line">str<span class="punctuation">(</span>cancer<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># we can separate the survival times by which organ is affected</span></span><br><span class="line">organs <span class="operator">&lt;-</span> with<span class="punctuation">(</span>cancer<span class="punctuation">,</span> split<span class="punctuation">(</span>Survival<span class="punctuation">,</span> Organ<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># and record their names for use later</span></span><br><span class="line">organNames <span class="operator">&lt;-</span> <span class="built_in">names</span><span class="punctuation">(</span>organs<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># the structure of the organs data</span></span><br><span class="line">str<span class="punctuation">(</span>organs<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># getting Eulerians and Hamiltonians</span></span><br><span class="line">ord <span class="operator">&lt;-</span> eulerian<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>colorspace<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># getting a rainbow of colours but choose chromaticity of 50 to dull them</span></span><br><span class="line">cols <span class="operator">&lt;-</span> rainbow_hcl<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="built_in">c</span> <span class="operator">=</span> <span class="number">50</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>organs<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> cols<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        ylab <span class="operator">=</span> <span class="string">&quot;Survival time&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;cancer treated by vitamin C&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># logout via graph structure</span></span><br><span class="line"><span class="comment"># taking square roots should make the data look a liitle more symmetric</span></span><br><span class="line">sqrtOrgans <span class="operator">&lt;-</span> with<span class="punctuation">(</span>cancer<span class="punctuation">,</span> split<span class="punctuation">(</span><span class="built_in">sqrt</span><span class="punctuation">(</span>Survival<span class="punctuation">)</span><span class="punctuation">,</span> Organ<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">boxplot<span class="punctuation">(</span>sqrtOrgans<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> col <span class="operator">=</span> cols<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">        ylab <span class="operator">=</span> <span class="built_in">expression</span><span class="punctuation">(</span><span class="built_in">sqrt</span><span class="punctuation">(</span><span class="string">&quot;Survival time&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        main <span class="operator">=</span> <span class="string">&quot;cancer treated by vitamin C&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hamiltonian decompositions</span></span><br><span class="line">ordHam <span class="operator">&lt;-</span> hpaths<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">)</span> <span class="comment"># here each hamiltonian is a row of the matrix&#x27;</span></span><br><span class="line"><span class="comment"># for our purpose, we would like the hamiltonians to be joined togehter</span></span><br><span class="line">ordHam <span class="operator">&lt;-</span> hpaths<span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> matrix <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># run a statistical test comapring each pair and use the p-value</span></span><br><span class="line"><span class="comment"># to order. e.g. test the equality of each pair of means(assuming normlaity)</span></span><br><span class="line"><span class="comment"># pairwise.t.test() does this and corrects the p-values for simultaneity</span></span><br><span class="line">test <span class="operator">&lt;-</span> with<span class="punctuation">(</span>cancer<span class="punctuation">,</span></span><br><span class="line">             pairwise.t.test<span class="punctuation">(</span><span class="built_in">sqrt</span><span class="punctuation">(</span>Survival<span class="punctuation">)</span><span class="punctuation">,</span> Organ<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">pvals <span class="operator">&lt;-</span> test<span class="operator">$</span>p.value</span><br><span class="line"><span class="built_in">round</span><span class="punctuation">(</span>pvals<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the pairviz package can handle graphs with weights</span></span><br><span class="line">ngrps <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>organNames<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># build matrix of weights</span></span><br><span class="line">weights <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> nrow <span class="operator">=</span> ngrps<span class="punctuation">,</span> ncol<span class="operator">=</span> ngrps<span class="punctuation">)</span></span><br><span class="line">rownames<span class="punctuation">(</span>weights<span class="punctuation">)</span> <span class="operator">&lt;-</span> organNames</span><br><span class="line">colnames<span class="punctuation">(</span>weights<span class="punctuation">)</span> <span class="operator">&lt;-</span> organNames</span><br><span class="line">weights<span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span>ngrps<span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="punctuation">(</span>ngrps<span class="operator">-</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> pvals</span><br><span class="line"><span class="built_in">round</span><span class="punctuation">(</span>weights<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># right size matrix but need to be symmetric by filling the upper triangle to</span></span><br><span class="line"><span class="comment"># match lower</span></span><br><span class="line">diag<span class="punctuation">(</span>weights<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="punctuation">(</span>ngrps <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">for</span> <span class="punctuation">(</span>j <span class="keyword">in</span> <span class="punctuation">(</span>i<span class="operator">+</span><span class="number">1</span><span class="punctuation">)</span><span class="operator">:</span>ngrps<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    weights<span class="punctuation">[</span>i<span class="punctuation">,</span>j<span class="punctuation">]</span> <span class="operator">&lt;-</span> weights<span class="punctuation">[</span>j<span class="punctuation">,</span>i<span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="built_in">round</span><span class="punctuation">(</span>weights<span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># greedy eulerians</span></span><br><span class="line"><span class="comment"># low to high</span></span><br><span class="line">low2highEulord <span class="operator">&lt;-</span> eulerian<span class="punctuation">(</span>weights<span class="punctuation">)</span>;</span><br><span class="line">colnames<span class="punctuation">(</span>weights<span class="punctuation">)</span><span class="punctuation">[</span>low2highEulord<span class="punctuation">]</span></span><br><span class="line"><span class="comment"># high to low</span></span><br><span class="line">high2lowEulord <span class="operator">&lt;-</span> eulerian<span class="punctuation">(</span><span class="operator">-</span> weights<span class="punctuation">)</span></span><br><span class="line">colnames<span class="punctuation">(</span>weights<span class="punctuation">)</span><span class="punctuation">[</span>high2lowEulord<span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># weighted hamiltonian decompositions</span></span><br><span class="line">low2higihHamord <span class="operator">&lt;-</span> weighted_hpaths<span class="punctuation">(</span>weights<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># high to low</span></span><br><span class="line">high2lowHamord <span class="operator">&lt;-</span> weighted_hpaths<span class="punctuation">(</span><span class="operator">-</span> weights<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># having weigthed graph g</span></span><br><span class="line">library<span class="punctuation">(</span>Rgraphviz<span class="punctuation">)</span></span><br><span class="line">g <span class="operator">&lt;-</span> mk_complete_graph<span class="punctuation">(</span>weights<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># par(mar = c(bottom, left, top, right))</span></span><br><span class="line">par<span class="punctuation">(</span>mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>g<span class="punctuation">,</span> <span class="string">&quot;circo&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment">########### the code used to install packages in bioManager</span></span><br><span class="line"><span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span>requireNamespace<span class="punctuation">(</span><span class="string">&quot;BiocManager&quot;</span><span class="punctuation">,</span> quietly <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  install.packages<span class="punctuation">(</span><span class="string">&quot;BiocManager&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">BiocManager<span class="operator">::</span>install<span class="punctuation">(</span><span class="string">&quot;Rgraphviz&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># remove all edges in the top hald the edges weights</span></span><br><span class="line">wvals <span class="operator">&lt;-</span> weights<span class="punctuation">[</span>upper.tri<span class="punctuation">(</span>weights<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="comment"># the median</span></span><br><span class="line">q <span class="operator">&lt;-</span> quantile<span class="punctuation">(</span>wvals<span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># trim the graph via the pairviz function dn_graph()</span></span><br><span class="line">g1 <span class="operator">&lt;-</span> dn_graph<span class="punctuation">(</span>g<span class="punctuation">,</span>q<span class="punctuation">,</span>`&lt;=`<span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>g1<span class="punctuation">,</span> <span class="string">&quot;circo&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># this subgraph g1 is not even (some nodes have an odd numebr of edges)</span></span><br><span class="line"><span class="comment"># so it must be made even by adding extra edges to get an Eulerian</span></span><br><span class="line">g1EulOrd <span class="operator">&lt;-</span> eulerian<span class="punctuation">(</span>g1<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># back to the SAheart data</span></span><br><span class="line">library<span class="punctuation">(</span>PairViz<span class="punctuation">)</span>;library<span class="punctuation">(</span>loon.data<span class="punctuation">)</span>;data<span class="punctuation">(</span><span class="string">&quot;SAheart&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># building the graph</span></span><br><span class="line">nodes <span class="operator">&lt;-</span> <span class="built_in">names</span><span class="punctuation">(</span>groups<span class="punctuation">)</span></span><br><span class="line">SAheartGraph <span class="operator">&lt;-</span> new<span class="punctuation">(</span><span class="string">&quot;graphNEL&quot;</span><span class="punctuation">,</span> nodes <span class="operator">=</span> nodes<span class="punctuation">,</span> edgemode <span class="operator">=</span> <span class="string">&quot;undirected&quot;</span><span class="punctuation">)</span></span><br><span class="line">SAheartGraph <span class="operator">&lt;-</span> addEdge<span class="punctuation">(</span><span class="string">&quot;Present.Yes&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Absent.No&quot;</span><span class="punctuation">,</span> SAheartGraph<span class="punctuation">)</span></span><br><span class="line">SAheartGraph <span class="operator">&lt;-</span> addEdge<span class="punctuation">(</span><span class="string">&quot;Present.Yes&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Absent.Yes&quot;</span><span class="punctuation">,</span> SAheartGraph<span class="punctuation">)</span></span><br><span class="line">SAheartGraph <span class="operator">&lt;-</span> addEdge<span class="punctuation">(</span><span class="string">&quot;Absent.Yes&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Absent.No&quot;</span><span class="punctuation">,</span> SAheartGraph<span class="punctuation">)</span></span><br><span class="line">SAheartGraph <span class="operator">&lt;-</span> addEdge<span class="punctuation">(</span><span class="string">&quot;Absent.No&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Present.No&quot;</span><span class="punctuation">,</span> SAheartGraph<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">ord <span class="operator">&lt;-</span>eulerian<span class="punctuation">(</span>SAheartGraph<span class="punctuation">)</span></span><br><span class="line">cols <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>cols<span class="punctuation">)</span> <span class="operator">&lt;-</span> nodes</span><br><span class="line">savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> oma <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">boxplot<span class="punctuation">(</span>groups<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> col<span class="operator">=</span> cols<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;family hisotry and chd&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>SAheartGraph<span class="punctuation">,</span> <span class="string">&quot;circo&quot;</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="time-order"><a href="#time-order" class="headerlink" title="time order"></a>time order</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># time series data</span></span><br><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line">p <span class="operator">&lt;-</span> l_plot<span class="punctuation">(</span>sunspot.month<span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            showScales <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># connect the dots</span></span><br><span class="line">l_layer_line<span class="punctuation">(</span>p<span class="punctuation">,</span> x <span class="operator">=</span> time<span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> sunspot.month<span class="punctuation">,</span></span><br><span class="line">             color <span class="operator">=</span> <span class="string">&quot;grey&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">             index <span class="operator">=</span> <span class="string">&quot;end&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">l_layer_hide<span class="punctuation">(</span>p<span class="punctuation">,</span> <span class="string">&quot;model&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># show a window of a couple of years</span></span><br><span class="line">window<span class="punctuation">(</span>sunspot.month<span class="punctuation">,</span> start<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1960</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> end <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1961</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">end<span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span></span><br><span class="line">start<span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># cycle: group the data by season or quarterly phase by using the cycle() function</span></span><br><span class="line">window<span class="punctuation">(</span>cycle<span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span><span class="punctuation">,</span> start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1960</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> end <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1960</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">quarter <span class="operator">&lt;-</span> 1 <span class="operator">+</span> <span class="punctuation">(</span><span class="punctuation">(</span>cycle<span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span> <span class="operator">%/%</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line">monthplot<span class="punctuation">(</span>sunspot.month<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> col.base <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">          lwd.base <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;quarter&quot;</span><span class="punctuation">,</span> phase <span class="operator">=</span> quarter<span class="punctuation">,</span></span><br><span class="line">          labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;first&quot;</span><span class="punctuation">,</span> <span class="string">&quot;second&quot;</span><span class="punctuation">,</span> <span class="string">&quot;third&quot;</span><span class="punctuation">,</span> <span class="string">&quot;fourth&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># we might explore how well the value of one month might be predicted by the immediately</span></span><br><span class="line"><span class="comment"># prior month, that is how well might any value be predicted from knowing</span></span><br><span class="line"><span class="comment"># only its immediate predecessor</span></span><br><span class="line">plot<span class="punctuation">(</span>x <span class="operator">=</span> sunspot.month<span class="punctuation">[</span><span class="operator">-</span><span class="built_in">length</span><span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">,</span> y <span class="operator">=</span> sunspot.month<span class="punctuation">[</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.15</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;sunspot activity lagged by one month&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># lag plots: can lag the data by any number of months,</span></span><br><span class="line">lag.plot<span class="punctuation">(</span>sunspot.month<span class="punctuation">,</span></span><br><span class="line">         col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.15</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">         main <span class="operator">=</span> <span class="string">&quot;sunspot activity lagged by up to 12 months&quot;</span><span class="punctuation">,</span></span><br><span class="line">         lags <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">freq <span class="operator">&lt;-</span> frequency<span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span></span><br><span class="line">lag.plot<span class="punctuation">(</span>sunspot.month<span class="punctuation">,</span></span><br><span class="line">         col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.15</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">         main <span class="operator">=</span> <span class="string">&quot;sunspot activity lagged by up to 15 months&quot;</span><span class="punctuation">,</span></span><br><span class="line">         set.lags <span class="operator">=</span> freq<span class="operator">*</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">15</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># jumped by 4 months</span></span><br><span class="line">lag.plot<span class="punctuation">(</span><span class="built_in">sqrt</span><span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="number">0.15</span><span class="punctuation">)</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">         main <span class="operator">=</span> <span class="string">&quot;sunspot activity^(1/2) lagged 84 tp 180 by 4&quot;</span><span class="punctuation">,</span></span><br><span class="line">         set.lags <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">84</span><span class="punctuation">,</span><span class="number">180</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># identify every 11 years of the series as a cycle.</span></span><br><span class="line"><span class="comment"># determine the starting year of each 11 year cycle</span></span><br><span class="line">timeseries <span class="operator">&lt;-</span> <span class="built_in">sqrt</span><span class="punctuation">(</span>sunspot.month<span class="punctuation">)</span></span><br><span class="line">startYears <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>start<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> end<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">11</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># number of cycles</span></span><br><span class="line">ncycles <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>startYears<span class="punctuation">)</span></span><br><span class="line">cycleNums <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>ncycles<span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">132</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># only need as many as we have data points</span></span><br><span class="line">cycleNUms <span class="operator">&lt;-</span> cycleNUms<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># each month will have a position number within its cycle</span></span><br><span class="line">cyclePositions <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">132</span><span class="punctuation">,</span> ncycles<span class="punctuation">)</span></span><br><span class="line">cyclePositions <span class="operator">&lt;-</span> cyclePositions<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">head<span class="punctuation">(</span>cyclePositions<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">cols <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span>brewer.pal<span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span> name <span class="operator">=</span> <span class="string">&quot;Set1&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                       length.out <span class="operator">=</span> ncycles<span class="punctuation">)</span><span class="punctuation">,</span> alpha.f <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line">opt <span class="operator">&lt;-</span> par<span class="punctuation">(</span>bg<span class="operator">=</span><span class="string">&quot;grey95&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x <span class="operator">=</span> time<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span>as.vector<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">     type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> col<span class="operator">=</span>cols<span class="punctuation">[</span>cycleNUms<span class="punctuation">]</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;Time&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;sqrt monthly sunspots&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;sunspot activity&quot;</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>opt<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># comparing groups by overlaying them</span></span><br><span class="line">opt <span class="operator">&lt;-</span> par<span class="punctuation">(</span>bg <span class="operator">=</span> <span class="string">&quot;grey95&quot;</span><span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> window<span class="punctuation">(</span>timeseries<span class="punctuation">,</span> start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                end <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                frequency <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> data<span class="punctuation">,</span></span><br><span class="line">     type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> col<span class="operator">=</span>cols<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">     xlab <span class="operator">=</span> <span class="string">&quot;Month number in 11 year sequence&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;sqrt monthly sunspots&quot;</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;all 11 tear sequence: 1749-1983&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span> i <span class="keyword">in</span> <span class="number">2</span><span class="operator">:</span><span class="punctuation">(</span>ncycles <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"> data <span class="operator">&lt;-</span> window<span class="punctuation">(</span>timeseries<span class="punctuation">,</span> start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 end <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span>i<span class="operator">+</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 frequency <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line"> lines<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> data<span class="punctuation">,</span> col <span class="operator">=</span> cols<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tidy up the last partial cycle</span></span><br><span class="line">data <span class="operator">&lt;-</span> window<span class="punctuation">(</span>timeseries<span class="punctuation">,</span> start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span>ncycles<span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               end <span class="operator">=</span> end<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               frequency <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> data<span class="punctuation">,</span> col <span class="operator">=</span> cols<span class="punctuation">[</span>ncycles<span class="punctuation">]</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>opt<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#### an interactive display</span></span><br><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># plot the original data, marking 11 year cycles in colour</span></span><br><span class="line">p <span class="operator">&lt;-</span>l_plot<span class="punctuation">(</span>x <span class="operator">=</span>time<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">,</span> y<span class="operator">=</span>as.vector<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">           ylabel<span class="operator">=</span><span class="string">&quot;Mean sqrt monthly sunspots&quot;</span><span class="punctuation">,</span></span><br><span class="line">           xlabel<span class="operator">=</span><span class="string">&quot;Time&quot;</span><span class="punctuation">,</span></span><br><span class="line">           title<span class="operator">=</span><span class="string">&quot;Sunspot activity&quot;</span><span class="punctuation">,</span></span><br><span class="line">           linkingGroup<span class="operator">=</span><span class="string">&quot;sunspots&quot;</span><span class="punctuation">,</span></span><br><span class="line">           color <span class="operator">=</span> cols<span class="punctuation">[</span>cycleNums<span class="punctuation">]</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>showGuides<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  And all the cycles over top of each ot</span></span><br><span class="line">cycleplot <span class="operator">&lt;-</span>l_plot<span class="punctuation">(</span>x <span class="operator">=</span> cyclePositions<span class="punctuation">,</span></span><br><span class="line">                  y<span class="operator">=</span>as.vector<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                  ylabel<span class="operator">=</span><span class="string">&quot;Mean sqrt monthly sunspots&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  xlabel<span class="operator">=</span><span class="string">&quot;Month number in 11 year sequence&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  title<span class="operator">=</span><span class="string">&quot;11 year sequences&quot;</span><span class="punctuation">,</span>linkingGroup<span class="operator">=</span><span class="string">&quot;sunspots&quot;</span><span class="punctuation">,</span></span><br><span class="line">                  color <span class="operator">=</span> cols<span class="punctuation">[</span>cycleNums<span class="punctuation">]</span><span class="punctuation">,</span> size<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span>showGuides<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Adding a histogram in the same linking group allows</span></span><br><span class="line"><span class="comment">#    all to the# plots to be linked together</span></span><br><span class="line">h <span class="operator">&lt;-</span>l_hist<span class="punctuation">(</span>x<span class="operator">=</span> cycleNums<span class="punctuation">,</span>xlabel<span class="operator">=</span><span class="string">&quot;Cycle number&quot;</span><span class="punctuation">,</span></span><br><span class="line">           title<span class="operator">=</span><span class="string">&quot;Sunspot  cycles&quot;</span><span class="punctuation">,</span>linkingGroup<span class="operator">=</span><span class="string">&quot;sunspots&quot;</span><span class="punctuation">,</span></span><br><span class="line">           color <span class="operator">=</span> cols<span class="punctuation">[</span>cycleNums<span class="punctuation">]</span><span class="punctuation">,</span>showStackedColors <span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">           showGuides<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># now add the lines as layers</span></span><br><span class="line">data <span class="operator">&lt;-</span> window<span class="punctuation">(</span>timeseries<span class="punctuation">,</span> start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span>ncycles<span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               end <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               frequency <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">l_layer_line<span class="punctuation">(</span>cyclesplot<span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> data<span class="punctuation">,</span> color <span class="operator">=</span> cols<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">             label <span class="operator">=</span> paste<span class="punctuation">(</span>start<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> end<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;-&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> indx <span class="operator">=</span> <span class="string">&quot;end&quot;</span><span class="punctuation">)</span></span><br><span class="line">l_layer_line<span class="punctuation">(</span>p<span class="punctuation">,</span> x <span class="operator">=</span> time<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> data<span class="punctuation">,</span> color <span class="operator">=</span> cols<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">             label <span class="operator">=</span> paste<span class="punctuation">(</span>start<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> end<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;-&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> indx <span class="operator">=</span> <span class="string">&quot;end&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">2</span><span class="operator">:</span><span class="punctuation">(</span>ncycles <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  data <span class="operator">&lt;-</span> window<span class="punctuation">(</span>timeseries<span class="punctuation">,</span> start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 end <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span>i<span class="operator">+</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 frequency <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">  l_layer_line<span class="punctuation">(</span>cyclesplot<span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> data<span class="punctuation">,</span> color <span class="operator">=</span> cols<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">               label <span class="operator">=</span> paste<span class="punctuation">(</span>start<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> end<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;-&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               indx <span class="operator">=</span> <span class="string">&quot;end&quot;</span><span class="punctuation">)</span></span><br><span class="line">  l_layer_line<span class="punctuation">(</span>p<span class="punctuation">,</span> x <span class="operator">=</span> time<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> data<span class="punctuation">,</span> color <span class="operator">=</span> cols<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">               label <span class="operator">=</span> paste<span class="punctuation">(</span>start<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> end<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;-&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               indx <span class="operator">=</span> <span class="string">&quot;end&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># tidy up the last partial cycles</span></span><br><span class="line">data <span class="operator">&lt;-</span> window<span class="punctuation">(</span>timeseries<span class="punctuation">,</span> start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>startYears<span class="punctuation">[</span>ncycles<span class="punctuation">]</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               end <span class="operator">=</span> end<span class="punctuation">(</span>timeseries<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               frequency <span class="operator">=</span> <span class="number">12</span><span class="punctuation">)</span></span><br><span class="line">l_layer_line<span class="punctuation">(</span>p<span class="punctuation">,</span> x <span class="operator">=</span> time<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> y <span class="operator">=</span> data<span class="punctuation">,</span> color <span class="operator">=</span> cols<span class="punctuation">[</span>ncycles<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">             label <span class="operator">=</span> paste<span class="punctuation">(</span>start<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> end<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;-&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">             indx <span class="operator">=</span> <span class="string">&quot;end&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="time-series-decomposition"><a href="#time-series-decomposition" class="headerlink" title="time series decomposition"></a>time series decomposition</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br></pre></td><td class="code"><pre><span class="line">plot<span class="punctuation">(</span>co2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># explore it interactively</span></span><br><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line">getDates <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>ts<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  mapply<span class="punctuation">(</span>FUN <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span> <span class="punctuation">&#123;</span>paste<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">,</span> <span class="built_in">floor</span><span class="punctuation">(</span>time<span class="punctuation">(</span>co2<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">         <span class="built_in">month.name</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">data <span class="operator">=</span> co2</span><br><span class="line"></span><br><span class="line">p <span class="operator">&lt;-</span> l_plot<span class="punctuation">(</span>data<span class="punctuation">,</span> title<span class="operator">=</span><span class="string">&quot;Muna loa atmospheric CO2&quot;</span><span class="punctuation">,</span></span><br><span class="line">            ylabel <span class="operator">=</span> <span class="string">&quot;concentration (ppm)&quot;</span><span class="punctuation">,</span></span><br><span class="line">            xlabel <span class="operator">=</span> <span class="string">&quot;Date&quot;</span><span class="punctuation">,</span> linkingGroup <span class="operator">=</span> <span class="string">&quot;co2&quot;</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;grey20&quot;</span><span class="punctuation">,</span></span><br><span class="line">            showScales <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> showGuides <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">            itemLabel <span class="operator">=</span> getDates<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">,</span> showItemLabels <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># another way to get the x and y coordinates</span></span><br><span class="line">xy.raw <span class="operator">&lt;-</span> xy.coords<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">l_layer_line<span class="punctuation">(</span>p<span class="punctuation">,</span> x <span class="operator">=</span> xy.raw<span class="operator">$</span>x<span class="punctuation">,</span> y <span class="operator">=</span> xy.raw<span class="operator">$</span>y<span class="punctuation">,</span></span><br><span class="line">             clor <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&quot;end&quot;</span><span class="punctuation">,</span></span><br><span class="line">             label <span class="operator">=</span> <span class="string">&quot;connect the dots&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># a couple of helper functions</span></span><br><span class="line">getYears <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>ts<span class="punctuation">)</span> <span class="punctuation">&#123;</span>unique<span class="punctuation">(</span><span class="built_in">floor</span><span class="punctuation">(</span>time<span class="punctuation">(</span>ts<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">getYears<span class="punctuation">(</span>co2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get the number of the month</span></span><br><span class="line"><span class="comment"># this will actually work more generally using frequency()</span></span><br><span class="line">getMonthNos <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>ts<span class="punctuation">)</span><span class="punctuation">&#123;</span><span class="number">1</span><span class="operator">:</span>frequency<span class="punctuation">(</span>ts<span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">getMonthNos<span class="punctuation">(</span>co2<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># we can now computate the averages, first over all months for each year, and</span></span><br><span class="line"><span class="comment">#   second over all years for each month</span></span><br><span class="line">getAves <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;year&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  years <span class="operator">&lt;-</span> getYears<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  monthNos <span class="operator">&lt;-</span> getMonthNos<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  nyears <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>years<span class="punctuation">)</span></span><br><span class="line">  nmonths <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>monthNos<span class="punctuation">)</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="operator">!</span> <span class="punctuation">(</span>by <span class="operator">%in%</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;year&quot;</span><span class="punctuation">,</span> <span class="string">&quot;month&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    stop<span class="punctuation">(</span><span class="string">&quot;unkwown value for by = &quot;</span><span class="punctuation">,</span></span><br><span class="line">         by<span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;; by must be one of &#123;\&quot;year\&quot;,\&quot;month\&quot;&#125;&quot;</span><span class="punctuation">)</span></span><br><span class="line">         <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>by <span class="operator">==</span> <span class="string">&quot;year&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    aves <span class="operator">&lt;-</span> sapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nyears<span class="punctuation">,</span></span><br><span class="line">                   FUN <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>i<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     mean<span class="punctuation">(</span>window<span class="punctuation">(</span>x<span class="punctuation">,</span></span><br><span class="line">                                 start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>years<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> monthNos<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                 end <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>years<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> monthNos<span class="punctuation">[</span>nmonths<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                   <span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line">    aves <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>aves <span class="operator">=</span> aves<span class="punctuation">,</span> row.names <span class="operator">=</span> years<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    aves <span class="operator">&lt;-</span> sapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nmonths<span class="punctuation">,</span></span><br><span class="line">                   FUN <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>i<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">                     mean<span class="punctuation">(</span>window<span class="punctuation">(</span>x<span class="punctuation">,</span></span><br><span class="line">                                 start <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>years<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> monthNos<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                 end <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>years<span class="punctuation">[</span>nyears<span class="punctuation">]</span><span class="punctuation">,</span> monthNos<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                 frequency <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                   <span class="punctuation">&#125;</span><span class="punctuation">)</span></span><br><span class="line">    aves <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>aves <span class="operator">=</span> aves<span class="punctuation">,</span> row.names <span class="operator">=</span> <span class="built_in">month.abb</span><span class="punctuation">[</span>monthNos<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  aves</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">head<span class="punctuation">(</span>getAves<span class="punctuation">(</span>co2<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;month&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># plot them</span></span><br><span class="line">plot<span class="punctuation">(</span>getYears<span class="punctuation">(</span>co2<span class="punctuation">)</span><span class="punctuation">,</span> getAves<span class="punctuation">(</span>co2<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;year&quot;</span><span class="punctuation">)</span><span class="operator">$</span>aves<span class="punctuation">,</span></span><br><span class="line">     type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;annual average over ll months&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>getAves<span class="punctuation">(</span>co2<span class="punctuation">,</span> by <span class="operator">=</span> <span class="string">&quot;month&quot;</span><span class="punctuation">)</span><span class="operator">$</span>aves<span class="punctuation">,</span></span><br><span class="line">     type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;Year&quot;</span><span class="punctuation">,</span>xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">     ylab <span class="operator">=</span> <span class="string">&quot;monthly average over all years&quot;</span><span class="punctuation">)</span></span><br><span class="line">axis<span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span>at <span class="operator">=</span> getMonthNos<span class="punctuation">(</span>co2<span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">month.abb</span><span class="punctuation">)</span> <span class="comment">#month.abb: month abbreviations</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reduce the white space between plots</span></span><br><span class="line">savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">1.5</span><span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> oma <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># decompositions of a time series</span></span><br><span class="line"><span class="comment"># the default decomposition is an additive one</span></span><br><span class="line">co2_decomp <span class="operator">&lt;-</span> decompose<span class="punctuation">(</span>co2<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># having structure</span></span><br><span class="line">str<span class="punctuation">(</span>co2_decomp<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>co2_decomp<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># we can see how the local fits behave as we change various elements</span></span><br><span class="line"><span class="comment">#  xloc is the location where we are fitting</span></span><br><span class="line"><span class="comment">#  proportionRange stands for proportion of the x range, which determine</span></span><br><span class="line"><span class="comment">#     what is meant by local</span></span><br><span class="line"><span class="comment"># all weights are 1 or zero</span></span><br><span class="line"></span><br><span class="line">ourdata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x <span class="operator">=</span> xy.raw<span class="operator">$</span>x<span class="punctuation">,</span> y <span class="operator">=</span> xy.raw<span class="operator">$</span>y<span class="punctuation">)</span></span><br><span class="line">unitWeight <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>xloc<span class="punctuation">,</span> x<span class="punctuation">,</span> proportionRange <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  xhalf <span class="operator">&lt;-</span> diff<span class="punctuation">(</span><span class="built_in">range</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">*</span> proportionRange<span class="operator">/</span><span class="number">2</span></span><br><span class="line">  wts <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  wts<span class="punctuation">[</span>x <span class="operator">&lt;</span> xloc <span class="operator">+</span> xhalf <span class="operator">&amp;</span> x <span class="operator">&gt;</span> xloc <span class="operator">-</span> xhalf<span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">1</span></span><br><span class="line">  wts</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># we have our data with x and y as before and need weights</span></span><br><span class="line">xloc <span class="operator">&lt;-</span> 0.5</span><br><span class="line">weights <span class="operator">&lt;-</span> unitWeight<span class="punctuation">(</span>xloc<span class="punctuation">,</span> xy.raw<span class="operator">$</span>x<span class="punctuation">,</span> proportionRange <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># and use thes to fit a line</span></span><br><span class="line"></span><br><span class="line">fitw <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> ourdata<span class="punctuation">,</span> weights <span class="operator">=</span> weights<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># use a weight function shaped like a Gaussian</span></span><br><span class="line">GaussianWeight <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>xloc<span class="punctuation">,</span> x<span class="punctuation">,</span> h <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment"># normal density</span></span><br><span class="line">  dnorm<span class="punctuation">(</span>x<span class="punctuation">,</span> mean <span class="operator">=</span> xloc<span class="punctuation">,</span> sd <span class="operator">=</span> h<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the function that will produce a smooth cureve from minimizing the locally</span></span><br><span class="line"><span class="comment">#   weighted sum of squares, or LoWeSS.</span></span><br><span class="line"><span class="comment"># it requires:</span></span><br><span class="line"><span class="comment">#   x,y:  - the data</span></span><br><span class="line"><span class="comment">#   xloc : - x locations at which the estimate is to be calculated</span></span><br><span class="line"><span class="comment">#   span: - a bandwidth</span></span><br><span class="line"><span class="comment">#   weightFn: - a weigthed function ,default will be GaussWeight</span></span><br><span class="line"><span class="comment">#   nloc: - number of equi-spaced locations at which estimate will be calculated</span></span><br><span class="line"><span class="comment">#               if xloc = NULL, ignored otherwise</span></span><br><span class="line"></span><br><span class="line">LoWeSS <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y<span class="punctuation">,</span> xloc <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> span <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> weightFn <span class="operator">=</span> GaussianWeight<span class="punctuation">,</span></span><br><span class="line">                   nlocs <span class="operator">=</span> <span class="number">200</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  data <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>x<span class="operator">=</span> x<span class="punctuation">,</span> y <span class="operator">=</span> y<span class="punctuation">)</span></span><br><span class="line">  xrange <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  bandwidth <span class="operator">&lt;-</span> <span class="punctuation">(</span>diff<span class="punctuation">(</span>xrange<span class="punctuation">)</span><span class="operator">*</span>span<span class="punctuation">)</span><span class="operator">/</span><span class="number">4</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>xloc<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    xloc <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>xrange<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> xrange<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span> length.out <span class="operator">=</span> nlocs<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  estimates <span class="operator">&lt;-</span> vector<span class="punctuation">(</span><span class="string">&quot;numeric&quot;</span><span class="punctuation">,</span> <span class="built_in">length</span> <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>xloc<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>xloc<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    weights <span class="operator">&lt;-</span> weightFn<span class="punctuation">(</span>xloc<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> x<span class="punctuation">,</span> bandwidth<span class="punctuation">)</span></span><br><span class="line">    fit <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> data<span class="punctuation">,</span> weights <span class="operator">=</span> weights<span class="punctuation">)</span></span><br><span class="line">    pred <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>fit<span class="punctuation">,</span> newdata <span class="operator">=</span> data.frame<span class="punctuation">(</span>x<span class="operator">=</span> xloc<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    estimates<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> pred</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment"># return the estimates</span></span><br><span class="line">  <span class="built_in">list</span><span class="punctuation">(</span>x <span class="operator">=</span> xloc<span class="punctuation">,</span> y <span class="operator">=</span> estimates<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">x <span class="operator">&lt;-</span> xy.raw<span class="operator">$</span>x</span><br><span class="line">y <span class="operator">&lt;-</span> xy.raw<span class="operator">$</span>y</span><br><span class="line">smooth <span class="operator">&lt;-</span> LoWeSS<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span> nlocs <span class="operator">=</span> <span class="number">1000</span><span class="punctuation">,</span> span <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span>col<span class="operator">=</span><span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;our data&quot;</span><span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;p&quot;</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>smooth<span class="operator">$</span>x<span class="punctuation">,</span> smooth<span class="operator">$</span>y<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the data</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span> y <span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;relating y to x&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the LoWeSS estimate</span></span><br><span class="line">lines<span class="punctuation">(</span>smooth<span class="operator">$</span>x<span class="punctuation">,</span> smooth<span class="operator">$</span>y<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># add the true mu(x)</span></span><br><span class="line">xordered <span class="operator">&lt;-</span> sort<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>stpm<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>xordered<span class="punctuation">,</span> mu<span class="punctuation">(</span>xordered<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">      <span class="comment"># mu function is in library(stpm)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># locally weigthed sums of squares</span></span><br><span class="line">fit <span class="operator">&lt;-</span> loess<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> ourdata<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span>col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span><span class="number">19</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;relating y to x&quot;</span><span class="punctuation">)</span>  </span><br><span class="line"><span class="comment"># get the values predicted by the loess</span></span><br><span class="line">pred <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># get the order of the x</span></span><br><span class="line">ord <span class="operator">&lt;-</span> order<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> pred<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span>  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># we could also reduce the span being used here (default is 0.75)</span></span><br><span class="line">fit_Large <span class="operator">&lt;-</span> loess<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> ourdata<span class="punctuation">,</span> span <span class="operator">=</span> <span class="number">0.15</span><span class="punctuation">)</span></span><br><span class="line">pred_Large <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>fit_Large<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>fit<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># using spans to decompose</span></span><br><span class="line"><span class="comment"># first fit the large span</span></span><br><span class="line">fit <span class="operator">&lt;-</span> loess<span class="punctuation">(</span>y<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> ourdata<span class="punctuation">,</span> span <span class="operator">=</span> <span class="number">0.75</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># from the fit we extract the estimated residuals</span></span><br><span class="line">r_Large <span class="operator">&lt;-</span> fit_Large<span class="operator">$</span>residuals</span><br><span class="line"></span><br><span class="line"><span class="comment"># this is another data set that we can plot</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span> r_Large<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span><span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">     main <span class="operator">=</span> <span class="string">&quot;s_small fit of r_large on x&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># and we can fit this with a smaller span</span></span><br><span class="line">data_resids <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>r <span class="operator">=</span> r_Large<span class="punctuation">,</span> x <span class="operator">=</span> x<span class="punctuation">)</span></span><br><span class="line">fit_small <span class="operator">&lt;-</span> loess<span class="punctuation">(</span>r<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> data_resids<span class="punctuation">,</span> span <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># get the values predicted by the loess</span></span><br><span class="line">pred_small <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>fit_small<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># need the order of x</span></span><br><span class="line">ord <span class="operator">&lt;-</span> order<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> pred_small<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r_Remains <span class="operator">&lt;-</span> fit_small<span class="operator">$</span>residuals</span><br><span class="line">data.remains <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>r <span class="operator">=</span> r_Remains<span class="punctuation">,</span>  x<span class="operator">=</span> x<span class="punctuation">)</span></span><br><span class="line">fit_Tiny <span class="operator">&lt;-</span> loess<span class="punctuation">(</span>r<span class="operator">~</span>x<span class="punctuation">,</span> data <span class="operator">=</span> data.remains<span class="punctuation">,</span> span <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># get the values predicteed by the loess</span></span><br><span class="line">pred_Tiny <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>fit_Tiny<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># putting together for the various fitted smooths we have adecomposition of the</span></span><br><span class="line"><span class="comment">#  observed values as</span></span><br><span class="line">opt <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span> <span class="operator">+</span> <span class="number">0.1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> pred_Large<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span><span class="number">19</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;large span smooth&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add a range of residuals rectangle</span></span><br><span class="line">xleft <span class="operator">&lt;-</span> 1.01</span><br><span class="line">xright <span class="operator">&lt;-</span> 1.02</span><br><span class="line">yDelta <span class="operator">&lt;-</span> sd<span class="punctuation">(</span>r_Remains<span class="punctuation">)</span></span><br><span class="line">rectCol <span class="operator">&lt;-</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line">ymiddle <span class="operator">&lt;-</span> mean<span class="punctuation">(</span>pred_Large<span class="punctuation">)</span></span><br><span class="line">rect<span class="punctuation">(</span>xleft<span class="punctuation">,</span> ymiddle <span class="operator">-</span> yDelta<span class="punctuation">,</span> xright<span class="punctuation">,</span> ymiddle<span class="operator">+</span>yDelta<span class="punctuation">,</span></span><br><span class="line">     border <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> rectCol<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> pred_small<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> cex<span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;small span smooth&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># add the same range rectangle</span></span><br><span class="line">ymiddle <span class="operator">&lt;-</span> mean<span class="punctuation">(</span>pred_small<span class="punctuation">)</span></span><br><span class="line">rect<span class="punctuation">(</span>xleft<span class="punctuation">,</span> ymiddle <span class="operator">-</span> yDelta<span class="punctuation">,</span> xright<span class="punctuation">,</span> ymiddle<span class="operator">+</span>yDelta<span class="punctuation">,</span></span><br><span class="line">     border <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> rectCol<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> pred_small<span class="punctuation">[</span>ord<span class="punctuation">]</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> cex<span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;remaining residuals&quot;</span><span class="punctuation">)</span></span><br><span class="line">ablines<span class="punctuation">(</span>h <span class="operator">=</span><span class="number">0</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;lightgrey&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># add the same range rectangle</span></span><br><span class="line">ymiddle <span class="operator">&lt;-</span> mean<span class="punctuation">(</span>r_Remains<span class="punctuation">)</span></span><br><span class="line">rect<span class="punctuation">(</span>xleft<span class="punctuation">,</span> ymiddle <span class="operator">-</span> yDelta<span class="punctuation">,</span> xright<span class="punctuation">,</span> ymiddle<span class="operator">+</span>yDelta<span class="punctuation">,</span></span><br><span class="line">     border <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> rectCol<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">rect<span class="punctuation">(</span>xleft<span class="punctuation">,</span> ybottom<span class="punctuation">,</span> xright<span class="punctuation">,</span> ytop<span class="punctuation">,</span> border <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> col <span class="operator">=</span> rectCol<span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>opt<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the seasonal components now vary a little more over the years</span></span><br><span class="line"><span class="comment"># there are similar arguements t.window and t.degree for the loess smoothing of the</span></span><br><span class="line"><span class="comment"># trend component</span></span><br><span class="line">plot<span class="punctuation">(</span>stl<span class="punctuation">(</span>co2<span class="punctuation">,</span> s.window <span class="operator">=</span> <span class="number">7</span><span class="punctuation">,</span> s.degree <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> t.degree <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;loon&quot;</span><span class="punctuation">)</span></span><br><span class="line">l_plot<span class="punctuation">(</span>stl<span class="punctuation">(</span>co2<span class="punctuation">,</span> s.window <span class="operator">=</span> <span class="number">7</span><span class="punctuation">,</span> s.degree <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> t.degree <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">demo<span class="punctuation">(</span><span class="string">&quot;l_timeseries&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h2 id="transforming-data"><a href="#transforming-data" class="headerlink" title="transforming data"></a>transforming data</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line">x <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>rnorm<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># the ranks (in order smallest to largest)</span></span><br><span class="line">rank<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the family of power transformation</span></span><br><span class="line">powerfun <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> alpha<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>alpha <span class="operator">==</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="built_in">log</span><span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">(</span>x<span class="operator">^</span>alpha <span class="operator">-</span> <span class="number">1</span><span class="punctuation">)</span><span class="operator">/</span>alpha</span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>loon.data<span class="punctuation">)</span>; data<span class="punctuation">(</span>SAheart<span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;loon.data&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>qqtest<span class="punctuation">)</span></span><br><span class="line">data <span class="operator">&lt;-</span> SAheart<span class="operator">$</span>sbp</span><br><span class="line">savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># note alpha is in descending order here</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>alpha <span class="keyword">in</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">/</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">/</span><span class="number">3</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">1</span><span class="operator">/</span><span class="number">3</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">1</span><span class="operator">/</span><span class="number">2</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  newdata <span class="operator">&lt;-</span> powerfun<span class="punctuation">(</span>data<span class="punctuation">,</span> alpha<span class="punctuation">)</span></span><br><span class="line">  dens <span class="operator">&lt;-</span> density<span class="punctuation">(</span>newdata<span class="punctuation">,</span> bw <span class="operator">=</span> <span class="string">&quot;SJ&quot;</span><span class="punctuation">)</span></span><br><span class="line">  h <span class="operator">&lt;-</span> hist<span class="punctuation">(</span>newdata<span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  ylim <span class="operator">&lt;-</span> extendrange<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>dens<span class="operator">$</span>y<span class="punctuation">,</span> h<span class="operator">$</span>density<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  plot<span class="punctuation">(</span>h<span class="punctuation">,</span> ylim <span class="operator">=</span> ylim<span class="punctuation">,</span> freq <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> yaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span> xaxt <span class="operator">=</span> <span class="string">&quot;n&quot;</span><span class="punctuation">,</span></span><br><span class="line">       main <span class="operator">=</span> <span class="string">&quot;SAheart&quot;</span><span class="punctuation">,</span> xlab <span class="operator">=</span> paste0<span class="punctuation">(</span><span class="string">&quot;(sbp)^&quot;</span><span class="punctuation">,</span> <span class="built_in">round</span><span class="punctuation">(</span>alpha<span class="punctuation">,</span> digits <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       ylab <span class="operator">=</span><span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br><span class="line">  polygon<span class="punctuation">(</span>dens<span class="punctuation">,</span> col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  qqtest<span class="punctuation">(</span>newdata<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;normal qqplot&quot;</span><span class="punctuation">,</span> legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># an interactive exploration of chnaging alpha</span></span><br><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># something to scale the data</span></span><br><span class="line">scale01 <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="punctuation">(</span>x <span class="operator">-</span> <span class="built_in">min</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span>diff<span class="punctuation">(</span><span class="built_in">range</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## setting up the interactive plots that will respond to chaning power</span></span><br><span class="line">power <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> lowest <span class="operator">=</span> <span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span> highest <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> ...<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>xlab<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>xlab <span class="operator">&lt;-</span> <span class="string">&quot;x&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>labels<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>labels <span class="operator">&lt;-</span> <span class="built_in">as.character</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">#scale and order the x values</span></span><br><span class="line">  xs <span class="operator">&lt;-</span> scale01<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  ord <span class="operator">&lt;-</span> order<span class="punctuation">(</span>xs<span class="punctuation">)</span></span><br><span class="line">  xs <span class="operator">&lt;-</span> xs<span class="punctuation">[</span>ord<span class="punctuation">]</span></span><br><span class="line">  labels <span class="operator">&lt;-</span> labels<span class="punctuation">[</span>ord<span class="punctuation">]</span></span><br><span class="line">  <span class="comment"># normal quantiles</span></span><br><span class="line">  qs <span class="operator">&lt;-</span> qnorm<span class="punctuation">(</span>ppoints<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># qqplot</span></span><br><span class="line">  p <span class="operator">&lt;-</span> l_plot<span class="punctuation">(</span>x <span class="operator">=</span> qs<span class="punctuation">,</span> y <span class="operator">=</span> xs<span class="punctuation">,</span> itemLabel <span class="operator">=</span> labels<span class="punctuation">,</span></span><br><span class="line">              ylabel <span class="operator">=</span> xlab<span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;Gaussian qunatiles&quot;</span><span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># now we iwll build a more complex interface a histogram plus a slider for the</span></span><br><span class="line">  <span class="comment"># power</span></span><br><span class="line">  <span class="comment"># the top level window</span></span><br><span class="line">  tw <span class="operator">&lt;-</span> tktoplevel<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># create and add the histogram to the top window</span></span><br><span class="line">  hx <span class="operator">&lt;-</span> l_hist<span class="punctuation">(</span>xs<span class="punctuation">,</span> xlabel <span class="operator">=</span> xlab<span class="punctuation">,</span> yshows <span class="operator">=</span> <span class="string">&quot;density&quot;</span><span class="punctuation">,</span> parent <span class="operator">=</span> tw<span class="punctuation">,</span> ...<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># now create a slider whose value will be the alpha of the power</span></span><br><span class="line">  <span class="comment">#  transformation</span></span><br><span class="line">  alpha_x <span class="operator">&lt;-</span> tclVar<span class="punctuation">(</span><span class="string">&quot;1&quot;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># slider for x</span></span><br><span class="line">  sx <span class="operator">&lt;-</span> tkscale<span class="punctuation">(</span>tw<span class="punctuation">,</span> orient <span class="operator">=</span> <span class="string">&#x27;horizontal&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;power x&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                variable <span class="operator">=</span> alpha_x<span class="punctuation">,</span> from <span class="operator">=</span> lowest<span class="punctuation">,</span> to <span class="operator">=</span> highest<span class="punctuation">,</span></span><br><span class="line">                resolution <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># pack the histogram and slider into the same window</span></span><br><span class="line">  tkpack<span class="punctuation">(</span>sx<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;x&#x27;</span><span class="punctuation">,</span> side <span class="operator">=</span> <span class="string">&#x27;bottom&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  tkpack<span class="punctuation">(</span>hx<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;both&#x27;</span><span class="punctuation">,</span> expand <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># now we need an update function to evaluate when the slider changes</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># this is the power function that will change with the slider</span></span><br><span class="line">  update <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>...<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    alphax <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>tclvalue<span class="punctuation">(</span>alpha_x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    newx <span class="operator">&lt;-</span> sort<span class="punctuation">(</span>scale01<span class="punctuation">(</span>powerfun<span class="punctuation">(</span>x<span class="punctuation">,</span>alphax<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    <span class="comment"># update the label</span></span><br><span class="line">    xlabel <span class="operator">&lt;-</span> <span class="keyword">if</span><span class="punctuation">(</span>alphax <span class="operator">==</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">&#123;</span>paste0<span class="punctuation">(</span><span class="string">&quot;log(&quot;</span><span class="punctuation">,</span>xlab<span class="punctuation">,</span><span class="string">&quot;)&quot;</span><span class="punctuation">)</span></span><br><span class="line">      <span class="punctuation">&#125;</span> <span class="keyword">else</span><span class="punctuation">&#123;</span></span><br><span class="line">          <span class="keyword">if</span> <span class="punctuation">(</span>alphax <span class="operator">==</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">            xlab</span><br><span class="line">          <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">            paste0<span class="punctuation">(</span>xlab<span class="punctuation">,</span> <span class="string">&quot;^&quot;</span><span class="punctuation">,</span> alphax<span class="punctuation">)</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    xrng <span class="operator">&lt;-</span> <span class="built_in">range</span><span class="punctuation">(</span>newx<span class="punctuation">)</span></span><br><span class="line">    <span class="comment"># update the qqplot p</span></span><br><span class="line">    l_configure<span class="punctuation">(</span>p<span class="punctuation">,</span> y <span class="operator">=</span> newx<span class="punctuation">,</span> ylabel <span class="operator">=</span> xlabel<span class="punctuation">,</span> xlabel <span class="operator">=</span> <span class="string">&quot;Gaussian quantiles&quot;</span><span class="punctuation">)</span></span><br><span class="line">    <span class="comment"># update the histogram</span></span><br><span class="line">    binwidthx <span class="operator">&lt;-</span> hx<span class="punctuation">[</span><span class="string">&#x27;binwidth&#x27;</span><span class="punctuation">]</span></span><br><span class="line">    l_configure<span class="punctuation">(</span>hx<span class="punctuation">,</span> x <span class="operator">=</span> newx<span class="punctuation">,</span> binwidth <span class="operator">=</span> binwidthx<span class="punctuation">,</span> xlabel <span class="operator">=</span> xlabel<span class="punctuation">)</span></span><br><span class="line">    l_scaleto_world<span class="punctuation">(</span>hx<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment"># configure the scale to call &quot;update&quot;</span></span><br><span class="line">  tkconfigure<span class="punctuation">(</span>sx<span class="punctuation">,</span> command <span class="operator">=</span> update<span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">invisible</span><span class="punctuation">(</span>p<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">with<span class="punctuation">(</span>SAheart<span class="punctuation">,</span></span><br><span class="line">     p <span class="operator">&lt;-</span> power<span class="punctuation">(</span>x<span class="operator">=</span> sbp<span class="punctuation">,</span> labels <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&quot;Patient&quot;</span><span class="punctuation">,</span> rownames<span class="punctuation">(</span>SAheart<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                linkingGroup <span class="operator">=</span> <span class="string">&quot;SAheart&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># turkey&#x27;s ladder of power transformation</span></span><br><span class="line">data <span class="operator">&lt;-</span> rchisq<span class="punctuation">(</span><span class="number">200</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">power<span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="comment"># Create a Power Link Object</span></span><br><span class="line"><span class="comment"># if it is concenrated on lower values, then move the power lower on the ladder</span></span><br><span class="line"><span class="comment"># otherwise, in the reverse order</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># power transformation</span></span><br><span class="line">library<span class="punctuation">(</span>MASS<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span>mammals<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># straightening plots via power transformation</span></span><br><span class="line">power_xy <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">,</span> y <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span></span><br><span class="line">                     from<span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> to <span class="operator">=</span> <span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span>...<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>xlab<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>xlab <span class="operator">&lt;-</span> <span class="string">&quot;x&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>ylab<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>ylab <span class="operator">&lt;-</span> <span class="string">&quot;y&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  scale01 <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="punctuation">(</span>x <span class="operator">-</span> <span class="built_in">min</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span>diff<span class="punctuation">(</span><span class="built_in">range</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  tt <span class="operator">&lt;-</span> tktoplevel<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment"># this is about dynamic graphic in r (‰Ω†ÂèØ‰ª•Áúã‰∏Ä‰∏ã)</span></span><br><span class="line">  <span class="comment"># https://www.stat.berkeley.edu/~spector/s244/Dyngraph.html</span></span><br><span class="line">  <span class="comment"># The basic widget in Tk is the frame, which is essentially a container for</span></span><br><span class="line">  <span class="comment"># any other widgets you wish to use.</span></span><br><span class="line">  <span class="comment"># You can have as many frames as you want, but each individual entity which</span></span><br><span class="line">  <span class="comment"># appears on the screen must be in a &quot;top level&quot; frame,</span></span><br><span class="line">  <span class="comment"># created with the tktoplevel function.</span></span><br><span class="line">  <span class="comment"># When using Tk, you first create a widget (specifying its appearance, the</span></span><br><span class="line">  <span class="comment"># command to be executed when the widget is activated, etc.), and then you</span></span><br><span class="line">  <span class="comment"># specify how it should appear in its parent frame. While Tk provides a number</span></span><br><span class="line">  <span class="comment"># of different schemes for achieving this, we&#x27;ll discuss the technique known as</span></span><br><span class="line">  <span class="comment"># &quot;packing&quot;. The basic idea is to group together widgets (and accompanying</span></span><br><span class="line">  <span class="comment"># labels, if appropriate) into a series of frames, and then to call the tkpack</span></span><br><span class="line">  <span class="comment"># function to put the widgets in the frames, then to finally pack the frames</span></span><br><span class="line">  <span class="comment"># into a main frame which is contained in a top-level widget</span></span><br><span class="line">  <span class="comment"># By default, objects are backed into a frame from top to bottom, with each</span></span><br><span class="line">  <span class="comment"># object being centered within its parent frame. You can control how widgets</span></span><br><span class="line">  <span class="comment"># get packed into a frame by the order in which you call tkpack, and the</span></span><br><span class="line">  <span class="comment"># optional side= argument which can take the values &quot;left&quot;, &quot;right&quot;, &quot;top&quot;</span></span><br><span class="line">  <span class="comment"># or &quot;bottom&quot;</span></span><br><span class="line">  xs <span class="operator">&lt;-</span> scale01<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  ys <span class="operator">&lt;-</span> scale01<span class="punctuation">(</span>y<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># scatterplot</span></span><br><span class="line">  p <span class="operator">&lt;-</span> l_plot<span class="punctuation">(</span>x<span class="operator">=</span> xs<span class="punctuation">,</span> y <span class="operator">=</span> ys<span class="punctuation">,</span> xlabel <span class="operator">=</span> xlab<span class="punctuation">,</span> ylabel <span class="operator">=</span> ylab<span class="punctuation">,</span></span><br><span class="line">              parent <span class="operator">=</span> tt<span class="punctuation">,</span>...<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># a valid Tk parent widget path. When the parent widget is specified (i.e.</span></span><br><span class="line">  <span class="comment">#   not NULL) then the plot widget needs to be placed using some geometry</span></span><br><span class="line">  <span class="comment">#   manager like tkpack or tkplace in order to be displaye</span></span><br><span class="line">  fit <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>ys<span class="operator">~</span>xs<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># layer a fitted line</span></span><br><span class="line">  xrng <span class="operator">&lt;-</span> <span class="built_in">range</span><span class="punctuation">(</span>xs<span class="punctuation">)</span></span><br><span class="line">  yhat <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>fit<span class="punctuation">,</span> data.frame<span class="punctuation">(</span>xs <span class="operator">=</span> xrng<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  line <span class="operator">&lt;-</span> l_layer_line<span class="punctuation">(</span>p<span class="punctuation">,</span> x<span class="operator">=</span> xrng<span class="punctuation">,</span> y <span class="operator">=</span> yhat<span class="punctuation">,</span> linewidth <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> index <span class="operator">=</span> <span class="string">&quot;end&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># histogram on each</span></span><br><span class="line">  hx <span class="operator">&lt;-</span> l_hist<span class="punctuation">(</span>xs<span class="punctuation">,</span> xlabel <span class="operator">=</span> xlab<span class="punctuation">,</span> yshows <span class="operator">=</span> <span class="string">&quot;density&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># setting up separate sliders for each power transformation</span></span><br><span class="line">  alpha_x <span class="operator">&lt;-</span> tclVar<span class="punctuation">(</span><span class="string">&#x27;1&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  alpha_y <span class="operator">&lt;-</span> tclVar<span class="punctuation">(</span><span class="string">&#x27;1&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  sx <span class="operator">&lt;-</span> tkscale<span class="punctuation">(</span>tt<span class="punctuation">,</span> orient <span class="operator">=</span> <span class="string">&#x27;vertical&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;power x&#x27;</span><span class="punctuation">,</span> variable <span class="operator">=</span> alpha_x<span class="punctuation">,</span></span><br><span class="line">                from <span class="operator">=</span> from<span class="punctuation">,</span> to <span class="operator">=</span> to<span class="punctuation">,</span> resoluation <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span></span><br><span class="line">  sy <span class="operator">&lt;-</span> tkscale<span class="punctuation">(</span>tt<span class="punctuation">,</span> orient <span class="operator">=</span> <span class="string">&#x27;vertical&#x27;</span><span class="punctuation">,</span> label <span class="operator">=</span> <span class="string">&#x27;power x&#x27;</span><span class="punctuation">,</span> variable <span class="operator">=</span> alpha_y<span class="punctuation">,</span></span><br><span class="line">                from <span class="operator">=</span> from<span class="punctuation">,</span> to <span class="operator">=</span> to<span class="punctuation">,</span> resoluation <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span></span><br><span class="line">  tkpack<span class="punctuation">(</span>sy<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;y&#x27;</span><span class="punctuation">,</span> side <span class="operator">=</span> <span class="string">&#x27;right&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  tkpack<span class="punctuation">(</span>p<span class="punctuation">,</span> fill <span class="operator">=</span> <span class="string">&#x27;both&#x27;</span><span class="punctuation">,</span> expand <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">  update <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    alphax <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>tclvalue<span class="punctuation">(</span>alpha_x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    alphay <span class="operator">&lt;-</span> <span class="built_in">as.numeric</span><span class="punctuation">(</span>tclvalue<span class="punctuation">(</span>alpha_y<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    newx <span class="operator">&lt;-</span> scale01<span class="punctuation">(</span>powerfun<span class="punctuation">(</span>x<span class="punctuation">,</span> alphax<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    newy <span class="operator">&lt;-</span> scale01<span class="punctuation">(</span>powerfun<span class="punctuation">(</span>y<span class="punctuation">,</span> alphay<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    xlabel <span class="operator">&lt;-</span> <span class="keyword">if</span> <span class="punctuation">(</span>alphax <span class="operator">==</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>paste0<span class="punctuation">(</span><span class="string">&quot;log(&quot;</span><span class="punctuation">,</span> xlab<span class="punctuation">,</span><span class="string">&quot;)&quot;</span><span class="punctuation">)</span><span class="punctuation">&#125;</span> <span class="keyword">else</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="keyword">if</span> <span class="punctuation">(</span>alphax<span class="operator">==</span> <span class="number">1</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>xlab<span class="punctuation">&#125;</span><span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">        paste0<span class="punctuation">(</span>xlab<span class="punctuation">,</span> <span class="string">&quot;^&quot;</span><span class="punctuation">,</span> alphax<span class="punctuation">)</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    ylabel <span class="operator">&lt;-</span> <span class="keyword">if</span> <span class="punctuation">(</span>alphay <span class="operator">==</span> <span class="number">0</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>paste0<span class="punctuation">(</span><span class="string">&quot;log(&quot;</span><span class="punctuation">,</span> ylab<span class="punctuation">,</span><span class="string">&quot;)&quot;</span><span class="punctuation">)</span><span class="punctuation">&#125;</span> <span class="keyword">else</span><span class="punctuation">&#123;</span></span><br><span class="line">      <span class="keyword">if</span> <span class="punctuation">(</span>alphay<span class="operator">==</span> <span class="number">1</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>ylab<span class="punctuation">&#125;</span><span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">        paste0<span class="punctuation">(</span>ylab<span class="punctuation">,</span> <span class="string">&quot;^&quot;</span><span class="punctuation">,</span> alphay<span class="punctuation">)</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="comment"># fit the line to the new data</span></span><br><span class="line">    fit.temp <span class="operator">&lt;-</span> lm<span class="punctuation">(</span>newy<span class="operator">~</span>newx<span class="punctuation">)</span></span><br><span class="line">    xrng <span class="operator">&lt;-</span> <span class="built_in">range</span><span class="punctuation">(</span>newx<span class="punctuation">)</span></span><br><span class="line">    <span class="comment">## get the fitted line</span></span><br><span class="line">    yhat <span class="operator">&lt;-</span> predict<span class="punctuation">(</span>fit.temp<span class="punctuation">,</span> data.frame<span class="punctuation">(</span>newx<span class="operator">=</span>xrng<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">    <span class="comment"># update the line values</span></span><br><span class="line">    l_configure<span class="punctuation">(</span>line<span class="punctuation">,</span> y<span class="operator">=</span> yhat<span class="punctuation">,</span> x<span class="operator">=</span>xrng<span class="punctuation">)</span></span><br><span class="line">    <span class="comment"># reconfigure the points</span></span><br><span class="line">    l_configure<span class="punctuation">(</span>p<span class="punctuation">,</span> x <span class="operator">=</span> newx<span class="punctuation">,</span> y<span class="operator">=</span> newy<span class="punctuation">,</span> xlabel <span class="operator">=</span> xlabel<span class="punctuation">,</span> ylabel <span class="operator">=</span> ylabel<span class="punctuation">)</span></span><br><span class="line">    <span class="comment"># and the histogram</span></span><br><span class="line">    binwidthx <span class="operator">&lt;-</span> hx<span class="punctuation">[</span><span class="string">&#x27;binwidth&#x27;</span><span class="punctuation">]</span></span><br><span class="line">    binwidthy <span class="operator">&lt;-</span> hx<span class="punctuation">[</span><span class="string">&#x27;binwidth&#x27;</span><span class="punctuation">]</span></span><br><span class="line">    l_configure<span class="punctuation">(</span>hx<span class="punctuation">,</span> x <span class="operator">=</span> newx<span class="punctuation">,</span> binwidth <span class="operator">=</span> binwidth<span class="punctuation">,</span></span><br><span class="line">                xlabel <span class="operator">=</span> xlabel<span class="punctuation">)</span></span><br><span class="line">    l_scaleto_world<span class="punctuation">(</span>hx<span class="punctuation">)</span> <span class="comment">#Change Plot Region to Display All Plot Data</span></span><br><span class="line">    l_configure<span class="punctuation">(</span>hy<span class="punctuation">,</span> x <span class="operator">=</span> newy<span class="punctuation">,</span></span><br><span class="line">                binwidth <span class="operator">=</span> binwidthy<span class="punctuation">,</span></span><br><span class="line">                xlabel <span class="operator">=</span> ylabel<span class="punctuation">)</span></span><br><span class="line">    l_scaleto_world<span class="punctuation">(</span>hy<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="comment"># add the update functions to the sliders</span></span><br><span class="line">  tkconfigure<span class="punctuation">(</span>sx<span class="punctuation">,</span> commmand <span class="operator">=</span> update<span class="punctuation">)</span></span><br><span class="line">  tkconfigure<span class="punctuation">(</span>sy<span class="punctuation">,</span> commmand <span class="operator">=</span> update<span class="punctuation">)</span></span><br><span class="line">  invisbile<span class="punctuation">(</span>p<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="categorical-data-overview"><a href="#categorical-data-overview" class="headerlink" title="categorical data overview"></a>categorical data overview</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line">areas <span class="operator">&lt;-</span> unique<span class="punctuation">(</span>olive<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;Area&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">nAreas <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>areas<span class="punctuation">)</span></span><br><span class="line">counts <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> nAreas<span class="punctuation">)</span></span><br><span class="line">regions <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># construct the dataset</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nAreas<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  counts<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="built_in">sum</span><span class="punctuation">(</span>olive<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;Area&quot;</span><span class="punctuation">]</span> <span class="operator">==</span> areas<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">  regions <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>regions<span class="punctuation">,</span> unique<span class="punctuation">(</span>olive<span class="punctuation">[</span>olive<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;Area&quot;</span><span class="punctuation">]</span> <span class="operator">==</span> areas<span class="punctuation">[</span>i<span class="punctuation">]</span><span class="punctuation">,</span> <span class="string">&quot;Region&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"><span class="comment"># turn regions into a factor with the proper names</span></span><br><span class="line">regions <span class="operator">&lt;-</span> as.factor<span class="punctuation">(</span>levels<span class="punctuation">(</span>olive<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;Region&quot;</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">[</span>regions<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># our constructed dataset of counts</span></span><br><span class="line">oliveOilCounts <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>Region <span class="operator">=</span> regions<span class="punctuation">,</span> Area <span class="operator">=</span> areas<span class="punctuation">,</span> count<span class="operator">=</span> counts<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>treemap<span class="punctuation">)</span></span><br><span class="line">treemap<span class="punctuation">(</span>oliveOilCounts<span class="punctuation">,</span> index <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Region&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Area&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> vSize <span class="operator">=</span> <span class="string">&quot;count&quot;</span><span class="punctuation">)</span> <span class="comment"># vsize could be any variate</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># could construct one interactively</span></span><br><span class="line">itreemap<span class="punctuation">(</span>oliveOilCounts<span class="punctuation">,</span> index <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Region&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> vSize <span class="operator">=</span> <span class="string">&quot;count&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># another package that based on ggplot2 for graphics and employs an algorithm which</span></span><br><span class="line"><span class="comment"># tries to achive much squarer boxes</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>treemapify<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">treeMapPlot <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>oliveOilCounts<span class="punctuation">,</span> aes<span class="punctuation">(</span>area <span class="operator">=</span> count<span class="punctuation">,</span> fill <span class="operator">=</span> Region<span class="punctuation">,</span> <span class="comment"># colour by region</span></span><br><span class="line">                                          label <span class="operator">=</span> Area<span class="punctuation">,</span> subgroup <span class="operator">=</span> Region<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">treeMapPlot <span class="operator">+</span> geom_treemap<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_treemap_text<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_treemap_subgroup_border<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_treemap_subgroup_text<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># alternatively, the coordinates of the squares can be had via the treemapify(...)</span></span><br><span class="line"><span class="comment"># function</span></span><br><span class="line">library<span class="punctuation">(</span>treemapify<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># alternatively</span></span><br><span class="line">treeMapCoordinates <span class="operator">&lt;-</span> treemapify<span class="punctuation">(</span>oliveOilCounts<span class="punctuation">,</span> area <span class="operator">=</span> <span class="string">&quot;count&quot;</span><span class="punctuation">,</span></span><br><span class="line">                                   subgroup <span class="operator">=</span> <span class="string">&quot;Region&quot;</span><span class="punctuation">)</span></span><br><span class="line">head<span class="punctuation">(</span>treeMapCoordinates<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># non-nested data - venneuler package</span></span><br><span class="line">library<span class="punctuation">(</span>venneuler<span class="punctuation">)</span>  <span class="comment"># ÂßêÔºåËøô‰∏™Êàë‰∏çÂáÜÂ§árun‰∫ÜÔºåÂõ†‰∏∫Ëøô‰∏™Ë¶Å‰∏ãËΩΩjavaÈáåÁöÑjdkÔºå ËøòÊúârstudio</span></span><br><span class="line"><span class="comment"># ÈáåÁöÑrjavaÂíåvennecularÔºå Êàë‰∏çÊÉ≥‰∏ãËΩΩ‰∫Ü</span></span><br><span class="line">ve <span class="operator">&lt;-</span> venneuler<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>A<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> B<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> <span class="string">&quot;A&amp;B&quot;</span> <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>ve<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">HairEye <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">,</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>eikosograms<span class="punctuation">)</span></span><br><span class="line">eikos<span class="punctuation">(</span>y <span class="operator">=</span> <span class="string">&quot;Hair&quot;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="string">&quot;Eye&quot;</span><span class="punctuation">,</span> data <span class="operator">=</span> HairEye<span class="punctuation">,</span> xaxs <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> yaxs <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="categorical-data"><a href="#categorical-data" class="headerlink" title="categorical data"></a>categorical data</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># categorical data</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line">city <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Kitchener&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Waterloo&quot;</span><span class="punctuation">)</span></span><br><span class="line">housing <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;House&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Apartment&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Residence&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># fake data</span></span><br><span class="line">counts <span class="operator">&lt;-</span> rpois<span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span> lambda <span class="operator">=</span> <span class="number">50</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># arranged in a rectangular array</span></span><br><span class="line">vacancy <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span>counts<span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>city<span class="punctuation">)</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="built_in">length</span><span class="punctuation">(</span>housing<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                  byrow <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> <span class="built_in">dimnames</span> <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>city <span class="operator">=</span> city<span class="punctuation">,</span> housing <span class="operator">=</span> housing<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># coereced to be an object of class table</span></span><br><span class="line">vacancy <span class="operator">&lt;-</span> as.table<span class="punctuation">(</span>vacancy<span class="punctuation">)</span></span><br><span class="line">vacancy</span><br><span class="line"><span class="comment"># creating a multi-way table</span></span><br><span class="line">term <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Fall&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Winter&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Spring&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># more fake counts</span></span><br><span class="line">counts <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>from <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> to <span class="operator">=</span> <span class="number">180</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">10</span><span class="punctuation">)</span></span><br><span class="line">vacancy <span class="operator">&lt;-</span> array<span class="punctuation">(</span>counts<span class="punctuation">,</span></span><br><span class="line">                 <span class="built_in">dim</span> <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>city<span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>housing<span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>term<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                 <span class="built_in">dimnames</span> <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>city <span class="operator">=</span> city<span class="punctuation">,</span> housing <span class="operator">=</span> housing<span class="punctuation">,</span> term <span class="operator">=</span> term<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">vacancy <span class="operator">&lt;-</span> as.table<span class="punctuation">(</span>vacancy<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reordering variates in tables</span></span><br><span class="line"><span class="comment"># the array dimension permutation function aperm(..)</span></span><br><span class="line">aperm<span class="punctuation">(</span>vacancy<span class="punctuation">,</span> perm <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># construting tables from data</span></span><br><span class="line">library<span class="punctuation">(</span>loon.data<span class="punctuation">)</span></span><br><span class="line">data<span class="punctuation">(</span><span class="string">&quot;SAheart&quot;</span><span class="punctuation">,</span> package <span class="operator">=</span> <span class="string">&quot;loon.data&quot;</span><span class="punctuation">)</span></span><br><span class="line">table<span class="punctuation">(</span>SAheart<span class="operator">$</span>chd<span class="punctuation">,</span> SAheart<span class="operator">$</span>famhist<span class="punctuation">,</span> dnn <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;chd&quot;</span><span class="punctuation">,</span> <span class="string">&quot;famhist&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># by cross-tabulation (&quot;cross tabs or xtabs)</span></span><br><span class="line">xtabs<span class="punctuation">(</span><span class="operator">~</span>chd <span class="operator">+</span> famhist<span class="punctuation">,</span> data <span class="operator">=</span> SAheart<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># collapsing dimensions (marginalizing, projecting)</span></span><br><span class="line"><span class="comment"># zero dimensional</span></span><br><span class="line">margin.table<span class="punctuation">(</span>HairEyeColor<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 dimensional</span></span><br><span class="line">margin.table<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 2 dimensioanl -- here margins 1 and 2 (&quot;hair&quot;, &quot;eye&quot;) are preserved</span></span><br><span class="line">margin.table<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># note: except for 0 dimensional. there are the same as using apply with sum</span></span><br><span class="line">apply<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> MARGIN <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> FUN <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># adding sums to a table</span></span><br><span class="line"><span class="comment"># every margin is summed</span></span><br><span class="line">addmargins<span class="punctuation">(</span>HairEyeColor<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># just producing marginal sums over dimension 2(&quot;eye&quot;) values</span></span><br><span class="line"><span class="comment"># for each pair(i,k) pf remaining variates &quot;hair&quot; and &quot;sex</span></span><br><span class="line">addmargins<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># producing marginal sums over both dimensions 1 and 2 (&quot;hair&quot;, and &quot;eye&quot;)</span></span><br><span class="line">addmargins<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sums to proportions</span></span><br><span class="line"><span class="comment"># no margins fixed, just total.. single multinomial</span></span><br><span class="line"><span class="built_in">round</span><span class="punctuation">(</span>prop.table<span class="punctuation">(</span>HairEyeColor<span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># one margin is fiexed, (the theird here, i.e. Sex) is fixed,... as may multinomial</span></span><br><span class="line"><span class="comment">#  as in</span></span><br><span class="line"><span class="built_in">round</span><span class="punctuation">(</span>prop.table<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># probability models from tables</span></span><br><span class="line"><span class="comment"># easier to see with sums for a two way table</span></span><br><span class="line">HairEye <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># sum of each table&#x27;s proportions must be one</span></span><br><span class="line"><span class="built_in">round</span><span class="punctuation">(</span>prop.table<span class="punctuation">(</span>HairEye<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>tidytable<span class="punctuation">)</span> <span class="comment"># provide an implementation of the rules we developed</span></span><br><span class="line"><span class="comment"># for table analysis</span></span><br><span class="line"></span><br><span class="line">tidytable<span class="punctuation">(</span>HairEyeColor<span class="punctuation">)</span><span class="operator">$</span>table</span><br><span class="line"></span><br><span class="line">proportions <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>prop.table<span class="punctuation">(</span>HairEye<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">tidyproportions <span class="operator">&lt;-</span> tidytable<span class="punctuation">(</span>proportions<span class="punctuation">)</span></span><br><span class="line">tidyproportions<span class="operator">$</span>proportions</span><br></pre></td></tr></table></figure>

<h2 id="categorical-modelling"><a href="#categorical-modelling" class="headerlink" title="categorical modelling"></a>categorical modelling</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># categorical modelling - modelling and independence</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line">HairEye <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>HairEyeColor<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">total <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>HairEye<span class="punctuation">)</span></span><br><span class="line">colsums <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>HairEye<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">colsums</span><br><span class="line">rowsums <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>HairEye<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">rowsums</span><br><span class="line">rowProbs <span class="operator">&lt;-</span> rowsums <span class="operator">/</span> total</span><br><span class="line">rowProbs</span><br><span class="line"><span class="comment"># Draw one sample for column 1</span></span><br><span class="line">rmultinom<span class="punctuation">(</span>n <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> colsums<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> prob <span class="operator">=</span> rowProbs<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the function that generates a new table for fixed column totals</span></span><br><span class="line"><span class="comment">#   and given row probabilities</span></span><br><span class="line">generateCondTable <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>columnSums <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">100</span><span class="punctuation">,</span> <span class="number">300</span><span class="punctuation">,</span> <span class="number">100</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                              rowProbs <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">0.4</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                              dnn <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>dnn<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    dnn <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span>Y <span class="operator">=</span> paste0<span class="punctuation">(</span><span class="string">&quot;y_&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>rowProbs<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">               X <span class="operator">=</span> paste0<span class="punctuation">(</span><span class="string">&quot;x_&quot;</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="built_in">length</span><span class="punctuation">(</span>columnSums<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">               <span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"> nRows <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>rowProbs<span class="punctuation">)</span></span><br><span class="line"> nCols <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>columnSums<span class="punctuation">)</span></span><br><span class="line"> result <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span>nrow <span class="operator">=</span> nRows<span class="punctuation">,</span> ncol <span class="operator">=</span> nCols<span class="punctuation">)</span></span><br><span class="line"> <span class="keyword">for</span> <span class="punctuation">(</span>j <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>nCols<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">   result<span class="punctuation">[</span><span class="punctuation">,</span>j<span class="punctuation">]</span> <span class="operator">&lt;-</span> rmultinom<span class="punctuation">(</span>n <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> columnSums<span class="punctuation">[</span>j<span class="punctuation">]</span><span class="punctuation">,</span> prob <span class="operator">=</span> rowProbs<span class="punctuation">)</span></span><br><span class="line"> <span class="punctuation">&#125;</span></span><br><span class="line"> result <span class="operator">&lt;-</span> as.table<span class="punctuation">(</span>result<span class="punctuation">)</span></span><br><span class="line"> <span class="built_in">dimnames</span><span class="punctuation">(</span>result<span class="punctuation">)</span> <span class="operator">&lt;-</span> dnn</span><br><span class="line"> result</span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># unconditional - NO fixed margin</span></span><br><span class="line">generateUncondTable <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>total <span class="operator">=</span> <span class="number">1000</span><span class="punctuation">,</span> colProbs <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0.1</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                rowProbs <span class="operator">=</span> seq<span class="punctuation">(</span><span class="number">0.4</span><span class="punctuation">,</span> <span class="number">0.1</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span> dnn <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  colSums <span class="operator">&lt;-</span> rmultinom<span class="punctuation">(</span>n<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> size <span class="operator">=</span> total<span class="punctuation">,</span> prob <span class="operator">=</span> colProbs<span class="punctuation">)</span></span><br><span class="line">  generateCondTable<span class="punctuation">(</span>columnSums <span class="operator">=</span> colSums<span class="punctuation">,</span> rowProbs <span class="operator">=</span> rowProbs<span class="punctuation">,</span> dnn <span class="operator">=</span> dnn<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># generating a new table under the hypothesis of independence , from an existing</span></span><br><span class="line"><span class="comment"># table of counts</span></span><br><span class="line">generateTable <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>Table<span class="punctuation">,</span> y<span class="punctuation">,</span> x<span class="punctuation">,</span> conditionalTest <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  new_table <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>Table<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span>y<span class="punctuation">,</span>x<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment">#get the marginal probabilities for the response variates</span></span><br><span class="line">  rowSums <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>new_table<span class="punctuation">,</span> margin <span class="operator">=</span> y<span class="punctuation">)</span></span><br><span class="line">  rowProbs <span class="operator">&lt;-</span> prop.table<span class="punctuation">(</span>rowSums<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># get the marginal probailities for the conditioning variate</span></span><br><span class="line">  colSums <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>new_table<span class="punctuation">,</span> margin <span class="operator">=</span> x<span class="punctuation">)</span></span><br><span class="line">  colProbs <span class="operator">&lt;-</span> prop.table<span class="punctuation">(</span>colSums<span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># get the dnn</span></span><br><span class="line">  dnn <span class="operator">&lt;-</span> <span class="built_in">dimnames</span><span class="punctuation">(</span>new_table<span class="punctuation">)</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span>conditionalTest<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    generateCondTable<span class="punctuation">(</span>columnSums <span class="operator">=</span> colSums<span class="punctuation">,</span> rowProbs <span class="operator">=</span> rowProbs<span class="punctuation">,</span></span><br><span class="line">                      dnn <span class="operator">=</span> dnn<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line">    generateUncondTable<span class="punctuation">(</span>total <span class="operator">=</span> <span class="built_in">sum</span><span class="punctuation">(</span>new_table<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                        colProbs <span class="operator">=</span> colProbs<span class="punctuation">,</span></span><br><span class="line">                        rowProbs <span class="operator">=</span> rowProbs<span class="punctuation">,</span></span><br><span class="line">                        dnn <span class="operator">=</span> dnn<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># need to functions of the single argument data which will geenrate new data under</span></span><br><span class="line"><span class="comment"># the hypothesis</span></span><br><span class="line">generateTableDataCond <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  newtable <span class="operator">&lt;-</span> generateTable<span class="punctuation">(</span>data<span class="operator">$</span>table<span class="punctuation">,</span> y <span class="operator">=</span> data<span class="operator">$</span>y<span class="punctuation">,</span> x <span class="operator">=</span> data<span class="operator">$</span>x<span class="punctuation">,</span></span><br><span class="line">                            conditionalTest <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">list</span><span class="punctuation">(</span>table <span class="operator">=</span> newtable<span class="punctuation">,</span> y<span class="operator">=</span> data<span class="operator">$</span>y<span class="punctuation">,</span> x <span class="operator">=</span> data<span class="operator">$</span>x<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">generateTableDataUncond <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  newtable <span class="operator">&lt;-</span> generateTable<span class="punctuation">(</span>data<span class="operator">$</span>table<span class="punctuation">,</span> y <span class="operator">=</span> data<span class="operator">$</span>y<span class="punctuation">,</span> x <span class="operator">=</span> data<span class="operator">$</span>x<span class="punctuation">,</span></span><br><span class="line">                            conditionalTest <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">list</span><span class="punctuation">(</span>table <span class="operator">=</span> newtable<span class="punctuation">,</span> y<span class="operator">=</span> data<span class="operator">$</span>y<span class="punctuation">,</span> x <span class="operator">=</span> data<span class="operator">$</span>x<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># the function that will show an eikosogram</span></span><br><span class="line">showTable <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span> Suspect<span class="punctuation">,</span> draw <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  result <span class="operator">&lt;-</span> eikos<span class="punctuation">(</span>y <span class="operator">=</span>data<span class="operator">$</span>y<span class="punctuation">,</span> x <span class="operator">=</span> data<span class="operator">$</span>x<span class="punctuation">,</span></span><br><span class="line">                  data <span class="operator">=</span> data<span class="operator">$</span>table<span class="punctuation">,</span> legend <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">                  xlabs <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> ylabs <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">                  xaxs <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> yaxs <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">                  main <span class="operator">=</span> paste<span class="punctuation">(</span><span class="string">&quot;Suspect&quot;</span><span class="punctuation">,</span> Suspect<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                  draw <span class="operator">=</span> draw<span class="punctuation">)</span> <span class="comment"># default don&#x27;t draw</span></span><br><span class="line">  <span class="built_in">invisible</span><span class="punctuation">(</span>result<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># since the eikos function is implemented using grid, need to update the lineup function</span></span><br><span class="line"></span><br><span class="line">lineup1 <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>data<span class="punctuation">,</span> showSuspect <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> generateSuspect <span class="operator">=</span> NUll<span class="punctuation">,</span></span><br><span class="line">                   trueLoc <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> layout <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                   pkg <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Graphics&quot;</span><span class="punctuation">,</span> <span class="string">&quot;grid&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ggplot2&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment"># get the number of suspects in total</span></span><br><span class="line">  nSuspects <span class="operator">&lt;-</span> layout<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">*</span>layout<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>trueLoc<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>trueLoc <span class="operator">&lt;-</span> sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nSuspects<span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>showSuspect<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span>stop<span class="punctuation">(</span><span class="string">&quot;need a plot function for the subject&quot;</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">  <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.null</span><span class="punctuation">(</span>generateSuspect<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span> stop<span class="punctuation">(</span><span class="string">&quot;need a function to generate subject&quot;</span><span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># need to decide which subject to present</span></span><br><span class="line">  presentSuspect <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>suspectNo<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="punctuation">(</span>SuspectNo <span class="operator">!=</span> trueLoc<span class="punctuation">)</span> <span class="punctuation">&#123;</span>data <span class="operator">&lt;-</span> generateSuspect<span class="punctuation">(</span>data<span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line">    showSuspect<span class="punctuation">(</span>data<span class="punctuation">,</span> suspectNo<span class="punctuation">)</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"> <span class="comment"># plotting depends on the plotting package</span></span><br><span class="line">  pkg <span class="operator">&lt;-</span> match.arg<span class="punctuation">(</span>pkg<span class="punctuation">)</span> <span class="comment"># Argument Verification Using Partial Matching</span></span><br><span class="line">  <span class="built_in">switch</span><span class="punctuation">(</span>pkg<span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;graphics&quot;</span> <span class="operator">=</span> <span class="punctuation">&#123;</span></span><br><span class="line">           savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> layout<span class="punctuation">,</span></span><br><span class="line">                          mar <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">2.5</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                          oma <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">           sapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nSuspects<span class="punctuation">,</span> FUN <span class="operator">=</span> presentSuspect<span class="punctuation">)</span></span><br><span class="line">           <span class="comment"># the plot layout here is of no value for graphics</span></span><br><span class="line">           plotLayput <span class="operator">&lt;-</span> layout</span><br><span class="line">           par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;grid&quot;</span> <span class="operator">=</span> <span class="punctuation">&#123;</span></span><br><span class="line">           grobs <span class="operator">&lt;-</span> lapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nSuspects<span class="punctuation">,</span> FUN <span class="operator">=</span> presentSuspect<span class="punctuation">)</span></span><br><span class="line">           plotLayout <span class="operator">&lt;-</span> arrangeGrob<span class="punctuation">(</span>grobs <span class="operator">=</span> plots<span class="punctuation">,</span> <span class="comment"># Arrange multiple grobs on a page</span></span><br><span class="line">                                     nrow <span class="operator">=</span> layout<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> ncol <span class="operator">=</span> layout<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         <span class="string">&quot;ggplot2&quot;</span> <span class="operator">=</span> <span class="punctuation">&#123;</span></span><br><span class="line">           plots <span class="operator">&lt;-</span> lapply<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nSuspects<span class="punctuation">,</span> FUN <span class="operator">=</span> presentSuspect<span class="punctuation">)</span></span><br><span class="line">           plotLayout <span class="operator">&lt;-</span> arrangeGrob<span class="punctuation">(</span>grobs <span class="operator">=</span> plots<span class="punctuation">,</span></span><br><span class="line">                                     nrow <span class="operator">=</span> layput<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> ncol <span class="operator">=</span> layout<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">         <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">         stop<span class="punctuation">(</span><span class="string">&quot;Wrong pkg&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">  <span class="comment"># return obfuscated location and plot (if not &quot;graphics)</span></span><br><span class="line">  <span class="built_in">list</span><span class="punctuation">(</span>trueLoc <span class="operator">=</span> hideLocation<span class="punctuation">(</span>trueLoc<span class="punctuation">,</span> nSuspects<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       plotLayout <span class="operator">=</span> plotLayout<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">results <span class="operator">&lt;-</span> lineup<span class="punctuation">(</span>...<span class="punctuation">,</span> pkg <span class="operator">=</span> <span class="string">&quot;grid&quot;</span><span class="punctuation">,</span>...<span class="punctuation">)</span> <span class="comment"># must supple other args</span></span><br><span class="line">grid.arrange<span class="punctuation">(</span>results<span class="operator">$</span>plotLayout<span class="punctuation">)</span> <span class="comment"># display the lineup</span></span><br><span class="line">revealLocation<span class="punctuation">(</span>results<span class="operator">$</span>trueLoc<span class="punctuation">)</span> <span class="comment"># reveal the true location</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>eikosograms<span class="punctuation">)</span>; library<span class="punctuation">(</span>gridExtra<span class="punctuation">)</span></span><br><span class="line">results <span class="operator">&lt;-</span> lineup1<span class="punctuation">(</span>data<span class="punctuation">,</span></span><br><span class="line">                  generateSuspect <span class="operator">=</span> generateTableDataCond<span class="punctuation">,</span></span><br><span class="line">                  showSuspect <span class="operator">=</span> showTable<span class="punctuation">,</span></span><br><span class="line">                  layout <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                  pkg <span class="operator">=</span> <span class="string">&quot;grid&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># display equivalence in eikosograms</span></span><br><span class="line">titanicsurvclass <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>Titanic<span class="punctuation">,</span> margin <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">mosaicplot<span class="punctuation">(</span>titanicsurvclass<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;MOsaic plot (two way table&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># spine plot</span></span><br><span class="line">spineplot<span class="punctuation">(</span>titanicsurvclass<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;spineplot (two way table&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># eikosograms and mosaic plots differ when there are more than two variates</span></span><br><span class="line">eikos<span class="punctuation">(</span>y <span class="operator">=</span> <span class="string">&quot;Survived&quot;</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Class&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Sex&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      data <span class="operator">=</span> Titanic<span class="punctuation">,</span> xaxs <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span> yaxs <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">      main <span class="operator">=</span> <span class="string">&quot;Eikosogram (three way table)&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mosaic plot, need to construct the marginal table first,</span></span><br><span class="line"><span class="comment"># note that the table is ordered so that survived is first,</span></span><br><span class="line"><span class="comment"># then class and sex (to match the eikosogram order above)</span></span><br><span class="line">titanicsurvclasssex <span class="operator">&lt;-</span> margin.table<span class="punctuation">(</span>Titanic<span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the mosaic plot</span></span><br><span class="line">mosaicplot<span class="punctuation">(</span>titanicsurvclasssex<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;mosaic plot ( three way table&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>


<h2 id="onmaps"><a href="#onmaps" class="headerlink" title="onmaps"></a>onmaps</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># onmaps</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line">library<span class="punctuation">(</span>maps<span class="punctuation">)</span></span><br><span class="line">savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># first the map from the maps package</span></span><br><span class="line">map<span class="punctuation">(</span><span class="string">&quot;world&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Canada&quot;</span><span class="punctuation">,</span> xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">141</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">53</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">40</span><span class="punctuation">,</span> <span class="number">85</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">    col <span class="operator">=</span> <span class="string">&quot;grey90&quot;</span><span class="punctuation">,</span> fill<span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">title<span class="punctuation">(</span>main <span class="operator">=</span> <span class="string">&quot;maps package&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># or use the map from the mapdata package</span></span><br><span class="line">library<span class="punctuation">(</span>mapdata<span class="punctuation">)</span></span><br><span class="line">map<span class="punctuation">(</span><span class="string">&quot;worldHires&quot;</span><span class="punctuation">,</span> <span class="string">&quot;canada&quot;</span><span class="punctuation">,</span> xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">141</span><span class="punctuation">,</span> <span class="operator">-</span><span class="number">53</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">40</span><span class="punctuation">,</span> <span class="number">85</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        col <span class="operator">=</span> <span class="string">&quot;grey90&quot;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">title<span class="punctuation">(</span>main <span class="operator">=</span> <span class="string">&quot;mapdata package&quot;</span><span class="punctuation">)</span></span><br><span class="line">par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># annual precipitation as thermometer glyphs</span></span><br><span class="line">library<span class="punctuation">(</span>maps<span class="punctuation">)</span></span><br><span class="line">precip <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;/Users/xuanxiaowu/Desktop/stat442/rcode/precip.csv&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># Ëøô‰∏™csvÂèØ‰ª•Âú®ÁΩë‰∏äÊâæÂà∞Ôºå Â¶ÇÊûú‰Ω†ÊÉ≥Ë¶ÅÁöÑËØùÊàëÁªô‰Ω†emailÔºå ÊàñËÄÖÁ≠âËøáÂá†Â§©ÊàëÂ≠¶‰∏Ä‰∏ãgithub</span></span><br><span class="line"></span><br><span class="line">n <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>precip<span class="punctuation">)</span></span><br><span class="line">lat <span class="operator">&lt;-</span> vector<span class="punctuation">(</span><span class="string">&quot;numeric&quot;</span><span class="punctuation">,</span> n<span class="punctuation">)</span></span><br><span class="line">pop <span class="operator">&lt;-</span> vector<span class="punctuation">(</span><span class="string">&quot;numeric&quot;</span><span class="punctuation">,</span> n<span class="punctuation">)</span></span><br><span class="line">long <span class="operator">&lt;-</span> vector<span class="punctuation">(</span><span class="string">&quot;numeric&quot;</span><span class="punctuation">,</span> n<span class="punctuation">)</span></span><br><span class="line"><span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span>n<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  city <span class="operator">&lt;-</span> precip<span class="punctuation">[</span>i<span class="punctuation">,</span> <span class="string">&quot;name&quot;</span><span class="punctuation">]</span></span><br><span class="line">  selected.city <span class="operator">&lt;-</span> canada.cities<span class="punctuation">[</span><span class="punctuation">,</span><span class="string">&quot;name&quot;</span><span class="punctuation">]</span> <span class="operator">==</span> city</span><br><span class="line">  lat<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> canada.cities<span class="punctuation">[</span>selected.city<span class="punctuation">,</span> <span class="string">&quot;lat&quot;</span><span class="punctuation">]</span></span><br><span class="line">  long<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> canada.cities<span class="punctuation">[</span>selected.city<span class="punctuation">,</span> <span class="string">&quot;long&quot;</span><span class="punctuation">]</span></span><br><span class="line">  pop<span class="punctuation">[</span>i<span class="punctuation">]</span> <span class="operator">&lt;-</span> canada.cities<span class="punctuation">[</span>selected.city<span class="punctuation">,</span> <span class="string">&quot;pop&quot;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">cities <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>precip<span class="punctuation">,</span> lat <span class="operator">=</span> lat<span class="punctuation">,</span> long<span class="operator">=</span> long<span class="punctuation">,</span> pop <span class="operator">=</span> pop<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># take the subset</span></span><br><span class="line">indices <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span><span class="number">13</span><span class="punctuation">,</span><span class="number">18</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">24</span><span class="punctuation">,</span> <span class="number">26</span><span class="punctuation">,</span> <span class="number">27</span><span class="punctuation">,</span> <span class="number">29</span><span class="punctuation">,</span> <span class="number">32</span><span class="punctuation">)</span></span><br><span class="line">cities <span class="operator">&lt;-</span> cities<span class="punctuation">[</span>indices<span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line">map<span class="punctuation">(</span><span class="string">&quot;world&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Canada&quot;</span><span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">symbols<span class="punctuation">(</span>cities<span class="operator">$</span>long <span class="operator">-</span> <span class="number">1</span><span class="punctuation">,</span> cities<span class="operator">$</span>lat<span class="punctuation">,</span> inches <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">        thermometers <span class="operator">=</span> cbind<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>cities<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                             <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span> nrow<span class="punctuation">(</span>cities<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                             <span class="punctuation">(</span>cities<span class="operator">$</span>precip<span class="punctuation">)</span><span class="operator">/</span><span class="number">2000</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># precip in mm</span></span><br><span class="line">        fg <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">,</span></span><br><span class="line">        add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># statiscal glyphs - any kind of graphic</span></span><br><span class="line">vars <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;days&quot;</span><span class="punctuation">,</span> <span class="string">&quot;precip.mm.&quot;</span><span class="punctuation">,</span> <span class="string">&quot;pop&quot;</span><span class="punctuation">)</span></span><br><span class="line">nVars <span class="operator">&lt;-</span> <span class="built_in">length</span><span class="punctuation">(</span>vars<span class="punctuation">)</span></span><br><span class="line">ncities <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>cities<span class="punctuation">)</span></span><br><span class="line">cityVals <span class="operator">&lt;-</span> cities<span class="punctuation">[</span><span class="punctuation">,</span>vars<span class="punctuation">]</span></span><br><span class="line">maxVals <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>cityVals<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span><span class="built_in">max</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># get values as proportions of each column</span></span><br><span class="line">stdCities <span class="operator">&lt;-</span> sweep<span class="punctuation">(</span>cityVals<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> maxVals<span class="punctuation">,</span>`/`<span class="punctuation">)</span> <span class="comment"># sweep: Return an array obtained</span></span><br><span class="line">              <span class="comment">#from an input array by sweeping out a summary statistic.</span></span><br><span class="line">stdCitiesList <span class="operator">&lt;-</span> Map<span class="punctuation">(</span><span class="keyword">function</span><span class="punctuation">(</span>rowNum<span class="punctuation">)</span> <span class="punctuation">&#123;</span>t<span class="punctuation">(</span>stdCities<span class="punctuation">[</span>rowNum<span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                     <span class="number">1</span><span class="operator">:</span>ncities<span class="punctuation">)</span> <span class="comment"># apply a function to each element of a vector</span></span><br><span class="line"><span class="comment"># in the loon package, the function l_make_glyphys() will create glyphs from any</span></span><br><span class="line"><span class="comment"># statiscal graphic</span></span><br><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># create the glyphs for each city</span></span><br><span class="line">my_glyphs <span class="operator">&lt;-</span> l_make_glyphs<span class="punctuation">(</span>stdCitiesList<span class="punctuation">,</span></span><br><span class="line">                           draw_fun <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>city<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">                             par<span class="punctuation">(</span>mar <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                             barplot<span class="punctuation">(</span>height <span class="operator">=</span> city<span class="punctuation">,</span></span><br><span class="line">                                     beside <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">                                     axes <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">                                     col <span class="operator">=</span> rainbow<span class="punctuation">(</span>nVars<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                                     axisnames <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">                                     ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">                           <span class="punctuation">&#125;</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">100</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">100</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># can view the glyphs</span></span><br><span class="line">l_imageviewer<span class="punctuation">(</span>my_glyphs<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># these can be added as points symbols to any l_plot</span></span><br><span class="line"><span class="comment"># plot city locations</span></span><br><span class="line">p <span class="operator">&lt;-</span> l_plot<span class="punctuation">(</span>cities<span class="operator">$</span>long<span class="punctuation">,</span> cities<span class="operator">$</span>lat<span class="punctuation">,</span></span><br><span class="line">            xlabel <span class="operator">=</span> <span class="string">&quot;longitude&quot;</span><span class="punctuation">,</span></span><br><span class="line">            ylabel <span class="operator">=</span> <span class="string">&quot;laitude&quot;</span><span class="punctuation">,</span></span><br><span class="line">            showLabels <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># add the map</span></span><br><span class="line">Canada <span class="operator">&lt;-</span> map<span class="punctuation">(</span><span class="string">&quot;world&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Canada&quot;</span><span class="punctuation">,</span> fill <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> plot <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">l_map <span class="operator">&lt;-</span> l_layer<span class="punctuation">(</span>p<span class="punctuation">,</span> Canada<span class="punctuation">,</span> asSingleLayer <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;cornsilk&quot;</span><span class="punctuation">)</span></span><br><span class="line">l_scaleto_world<span class="punctuation">(</span>p<span class="punctuation">)</span> <span class="comment">#Change Plot Region to Display All Plot Data</span></span><br><span class="line"><span class="comment"># then add the images as glyphs called &quot;barplot&quot;</span></span><br><span class="line">g <span class="operator">&lt;-</span> l_glyph_add_image<span class="punctuation">(</span>p<span class="punctuation">,</span> my_glyphs<span class="punctuation">,</span> <span class="string">&quot;barplot&quot;</span><span class="punctuation">)</span></span><br><span class="line">p<span class="punctuation">[</span><span class="string">&#x27;glyph&#x27;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> g</span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line">theEast <span class="operator">&lt;-</span> cities<span class="operator">$</span>long <span class="operator">&gt;</span> <span class="operator">-</span><span class="number">80</span></span><br><span class="line">p<span class="punctuation">[</span><span class="string">&quot;selected&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> theEast</span><br><span class="line"></span><br><span class="line"><span class="comment"># readShapeSpatial &#123;maptools&#125;	R Documentation</span></span><br><span class="line"><span class="comment">#       Read shape files into Spatial*DataFrame objects</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># rm(list = ls()): rm will remove all of the objects that are stored in</span></span><br><span class="line"><span class="comment"># your global environment (which may be what you want) but will not unload any</span></span><br><span class="line"><span class="comment">#   of the packages that you have loaded. You can do both by restarting your</span></span><br><span class="line"><span class="comment"># R session in RStudio with the keyboard shortcut Ctrl+Shift+F10 which will</span></span><br><span class="line"><span class="comment"># totally clear your global environment of both objects and loaded packages.</span></span><br><span class="line"><span class="comment">#  use graphic.off() to clear all the plots you have generated</span></span><br></pre></td></tr></table></figure>

<h2 id="three-dimensions"><a href="#three-dimensions" class="headerlink" title="three dimensions"></a>three dimensions</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># three dimensions</span></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line">library<span class="punctuation">(</span>MASS<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># use square grids, count the number of points in each cell</span></span><br><span class="line"><span class="comment"># code count to saturation. here use geom_bin2d() from ggplot2</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>geyser<span class="punctuation">,</span> aes<span class="punctuation">(</span>x <span class="operator">=</span> duration<span class="punctuation">,</span> y <span class="operator">=</span> waiting<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">h <span class="operator">&lt;-</span> p <span class="operator">+</span> geom_bin2d<span class="punctuation">(</span>bins <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span></span><br><span class="line">h</span><br><span class="line"><span class="comment"># to switch the color around</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># brew a sequence of blues</span></span><br><span class="line">blues <span class="operator">&lt;-</span> brewer.pal<span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span> <span class="string">&quot;Blues&quot;</span><span class="punctuation">)</span></span><br><span class="line">darkerBlues <span class="operator">&lt;-</span> blues<span class="punctuation">[</span><span class="operator">-</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="comment"># remove the two lightest blues</span></span><br><span class="line">h <span class="operator">+</span> scale_fill_gradientn<span class="punctuation">(</span>colours <span class="operator">=</span> darkerBlues<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># use hexbin for hexagonal binning</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;hexbin&quot;</span><span class="punctuation">)</span></span><br><span class="line">bins <span class="operator">&lt;-</span> hexbin<span class="punctuation">(</span>x <span class="operator">=</span> geyser<span class="operator">$</span>duration<span class="punctuation">,</span> y <span class="operator">=</span> geyser<span class="operator">$</span>waiting<span class="punctuation">,</span> xbins <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>bins<span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;hexagonal bin histogram&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># alternatively we cna use the hexbinplot directly</span></span><br><span class="line">hexbinplot<span class="punctuation">(</span>waiting<span class="operator">~</span>duration<span class="punctuation">,</span>data <span class="operator">=</span> geyser<span class="punctuation">,</span> xbins <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">           colramp <span class="operator">=</span> <span class="keyword">function</span><span class="punctuation">(</span>n<span class="punctuation">)</span> rev<span class="punctuation">(</span>gray.colors<span class="punctuation">(</span>n<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># rev:Reverse Elements</span></span><br><span class="line">           aspect <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">           main <span class="operator">=</span> <span class="string">&quot;Hexagonal bin histogram&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  or we could use size instead of the colour to indicate counts</span></span><br><span class="line">hexbinplot<span class="punctuation">(</span>waiting<span class="operator">~</span>duration<span class="punctuation">,</span> data <span class="operator">=</span> geyser<span class="punctuation">,</span></span><br><span class="line">           style <span class="operator">=</span> <span class="string">&quot;lattice&quot;</span><span class="punctuation">,</span> aspect <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">           main <span class="operator">=</span> <span class="string">&quot;hexagonal bin histogram&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># both colour and size are used</span></span><br><span class="line">hexbinplot<span class="punctuation">(</span>waiting<span class="operator">~</span>duration<span class="punctuation">,</span> data <span class="operator">=</span> geyser<span class="punctuation">,</span></span><br><span class="line">           style <span class="operator">=</span> <span class="string">&quot;nested.lattice&quot;</span><span class="punctuation">,</span> aspect <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">           main <span class="operator">=</span> <span class="string">&quot;hexagonal bin histogram&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># density estimation in two-dimensions</span></span><br><span class="line"><span class="comment"># calculate the contours of the kernel function</span></span><br><span class="line">nxvals <span class="operator">&lt;-</span> 100</span><br><span class="line">nyvals <span class="operator">&lt;-</span> 100</span><br><span class="line">x <span class="operator">&lt;-</span> seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span>length.out <span class="operator">=</span> nxvals<span class="punctuation">)</span></span><br><span class="line">y <span class="operator">&lt;-</span> seq<span class="punctuation">(</span><span class="operator">-</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span>length.out <span class="operator">=</span> nyvals<span class="punctuation">)</span></span><br><span class="line">gridLocs <span class="operator">&lt;-</span> expand.grid<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># now have the indices to match the locations</span></span><br><span class="line">indices <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nxvals<span class="punctuation">,</span> times <span class="operator">=</span> nyvals<span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>nyvals<span class="punctuation">,</span> each <span class="operator">=</span> nxvals<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># a matrix to store away the kernel values</span></span><br><span class="line">kernel <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> nrow <span class="operator">=</span> nxvals<span class="punctuation">,</span> ncol<span class="operator">=</span>nyvals<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># need multivariate nromal densities from mvtnorm</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&#x27;mvtnorm&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># bivaraite normal density</span></span><br><span class="line"><span class="comment"># (default is mean 0, and var-cov matrix the 2x2 identity matrix)</span></span><br><span class="line">kernel<span class="punctuation">[</span>indices<span class="punctuation">]</span> <span class="operator">&lt;-</span> dmvnorm<span class="punctuation">(</span>gridLocs<span class="punctuation">)</span></span><br><span class="line"><span class="comment">#there is a contour function to showmlevel curves</span></span><br><span class="line">contour<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span> y<span class="operator">=</span>y<span class="punctuation">,</span> z<span class="operator">=</span> kernel<span class="punctuation">,</span> asp <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        xlim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">2</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">        col <span class="operator">=</span> <span class="string">&quot;black&quot;</span><span class="punctuation">,</span> lty <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        main <span class="operator">=</span> <span class="string">&quot;contours of a standard normal&quot;</span><span class="punctuation">)</span></span><br><span class="line">points<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span> pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># we can use this bivariate density as a kernel for bivariate density estimation</span></span><br><span class="line"><span class="comment"># a function that performs the density estimation is kde2d() from the mass package</span></span><br><span class="line">x <span class="operator">&lt;-</span> geyser<span class="operator">$</span>duration</span><br><span class="line">y <span class="operator">&lt;-</span> geyser<span class="operator">$</span>waiting</span><br><span class="line">den <span class="operator">&lt;-</span> kde2d<span class="punctuation">(</span>x<span class="operator">=</span>x<span class="punctuation">,</span> y <span class="operator">=</span> y <span class="punctuation">,</span> n <span class="operator">=</span> <span class="number">100</span><span class="punctuation">)</span></span><br><span class="line">str<span class="punctuation">(</span>den<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># now plot the density estimates as contours</span></span><br><span class="line">zlim <span class="operator">&lt;-</span> <span class="built_in">range</span><span class="punctuation">(</span>den<span class="operator">$</span>z<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span>pch <span class="operator">=</span><span class="number">19</span><span class="punctuation">,</span></span><br><span class="line">     col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">contour<span class="punctuation">(</span>den<span class="operator">$</span>x<span class="punctuation">,</span> den<span class="operator">$</span>y<span class="punctuation">,</span> den<span class="operator">$</span>z<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;grey10&quot;</span><span class="punctuation">,</span></span><br><span class="line">        levels <span class="operator">=</span> pretty<span class="punctuation">(</span>zlim<span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> lwd <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> add <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># pretty :Compute a sequence of about n+1 equally spaced ‚Äòround‚Äô values</span></span><br><span class="line"><span class="comment"># which cover the range of the values in x. The values are chosen so that</span></span><br><span class="line"><span class="comment"># they are 1, 2 or 5 times a power of 10.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># could add colour images of density</span></span><br><span class="line">library<span class="punctuation">(</span>RColorBrewer<span class="punctuation">)</span></span><br><span class="line">blues <span class="operator">&lt;-</span> brewer.pal<span class="punctuation">(</span><span class="number">9</span><span class="punctuation">,</span> <span class="string">&quot;Blues&quot;</span><span class="punctuation">)</span></span><br><span class="line">image<span class="punctuation">(</span>den<span class="operator">$</span>x<span class="punctuation">,</span> den<span class="operator">$</span>y<span class="punctuation">,</span> den<span class="operator">$</span>z<span class="punctuation">,</span> col <span class="operator">=</span> blues<span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span><span class="punctuation">,</span></span><br><span class="line">      ylab <span class="operator">=</span> <span class="string">&quot;waiting&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;rectangles coloured by density&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># draw the density in three dimensions</span></span><br><span class="line"><span class="comment"># using the perspective &quot;wire frame&quot; drawings</span></span><br><span class="line">lineCol <span class="operator">&lt;-</span> <span class="string">&quot;steelblue&quot;</span></span><br><span class="line">fillCol <span class="operator">&lt;-</span> <span class="string">&quot;cornsilk&quot;</span></span><br><span class="line">savePar <span class="operator">&lt;-</span> par<span class="punctuation">(</span>mfrow <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># 3d surface</span></span><br><span class="line">persp<span class="punctuation">(</span>den<span class="operator">$</span>z<span class="punctuation">,</span> border <span class="operator">=</span> lineCol<span class="punctuation">,</span> col <span class="operator">=</span> fillCol<span class="punctuation">,</span></span><br><span class="line">      xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;waiting time&quot;</span><span class="punctuation">,</span></span><br><span class="line">      zlab <span class="operator">=</span> <span class="string">&quot;density&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;geyser density estimate&quot;</span><span class="punctuation">,</span></span><br><span class="line">      sub <span class="operator">=</span> <span class="string">&quot;solid&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># see through</span></span><br><span class="line">persp<span class="punctuation">(</span>den<span class="operator">$</span>z<span class="punctuation">,</span> border <span class="operator">=</span> lineCol<span class="punctuation">,</span> col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span>fillCol<span class="punctuation">,</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;waiting time&quot;</span><span class="punctuation">,</span></span><br><span class="line">      zlab <span class="operator">=</span> <span class="string">&quot;density&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;geyser density estimate&quot;</span><span class="punctuation">,</span></span><br><span class="line">      sub <span class="operator">=</span> <span class="string">&quot;transparent&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">par<span class="punctuation">(</span>savePar<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># can change the viewing angles</span></span><br><span class="line">theta.val <span class="operator">&lt;-</span> 0   <span class="comment"># horizontal moving right to the left</span></span><br><span class="line">phi.val <span class="operator">&lt;-</span> 0 <span class="comment"># angle of tilt toward viewer</span></span><br><span class="line">lineCol <span class="operator">&lt;-</span> <span class="string">&quot;steelblue&quot;</span></span><br><span class="line">fillCol <span class="operator">&lt;-</span> <span class="string">&quot;cornsilk&quot;</span></span><br><span class="line">persp<span class="punctuation">(</span>den<span class="operator">$</span>z<span class="punctuation">,</span> border <span class="operator">=</span> lineCol<span class="punctuation">,</span> col <span class="operator">=</span> fillCol<span class="punctuation">,</span></span><br><span class="line">      xlab <span class="operator">=</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;y&quot;</span><span class="punctuation">,</span> zlab <span class="operator">=</span> <span class="string">&quot;z&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="comment"># some magic below:</span></span><br><span class="line">      <span class="comment"># bquote: allows partial substitution;</span></span><br><span class="line">      <span class="comment"># terms wrapped in .() are evaluated</span></span><br><span class="line">      main <span class="operator">=</span> bquote<span class="punctuation">(</span>paste<span class="punctuation">(</span>phi<span class="punctuation">,</span> <span class="string">&quot;=&quot;</span><span class="punctuation">,</span> .<span class="punctuation">(</span>phi.val<span class="punctuation">)</span><span class="punctuation">,</span><span class="string">&quot;;&quot;</span><span class="punctuation">,</span></span><br><span class="line">                          thera<span class="punctuation">,</span><span class="string">&quot;=&quot;</span><span class="punctuation">,</span>.<span class="punctuation">(</span>theta.val<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      theta <span class="operator">=</span> theta.val<span class="punctuation">,</span></span><br><span class="line">      phi <span class="operator">=</span> phi.val<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># radius r, the distance of the eyepoint from the centre of the box</span></span><br><span class="line"><span class="comment"># changing the radius (think of points at infinity)</span></span><br><span class="line">persp<span class="punctuation">(</span>den<span class="punctuation">,</span> border <span class="operator">=</span> lineCol<span class="punctuation">,</span> col <span class="operator">=</span> fillCol<span class="punctuation">,</span></span><br><span class="line">      r <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> phi <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;r = 0.5&quot;</span><span class="punctuation">)</span><span class="comment"># the smaller the r, the sooner the parallel lines meet</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># the lattice package could be used</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;lattice&quot;</span><span class="punctuation">)</span></span><br><span class="line">wireframe<span class="punctuation">(</span>den<span class="operator">$</span>z<span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;waiting&quot;</span><span class="punctuation">,</span> zlab <span class="operator">=</span> <span class="string">&quot;density&quot;</span><span class="punctuation">,</span></span><br><span class="line">          col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># can change the relative dimensions of the box</span></span><br><span class="line">wireframe<span class="punctuation">(</span>den<span class="operator">$</span>z<span class="punctuation">,</span> xlab <span class="operator">=</span> <span class="string">&quot;duration&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;waiting&quot;</span><span class="punctuation">,</span> zlab <span class="operator">=</span> <span class="string">&quot;density&quot;</span><span class="punctuation">,</span></span><br><span class="line">          col <span class="operator">=</span> <span class="string">&quot;grey50&quot;</span><span class="punctuation">,</span> aspect <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1.2</span><span class="punctuation">,</span> <span class="number">0.4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>loon.data<span class="punctuation">)</span>; data<span class="punctuation">(</span>SAheart<span class="punctuation">)</span></span><br><span class="line">cloud<span class="punctuation">(</span>sbp<span class="operator">~</span>ldl <span class="operator">+</span> tobacco<span class="punctuation">,</span> data <span class="operator">=</span> SAheart<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># change the colour, point symbol, remove perspective and the frame box</span></span><br><span class="line">cloud<span class="punctuation">(</span>sbp<span class="operator">~</span>ldl <span class="operator">+</span> tobacco<span class="punctuation">,</span> data <span class="operator">=</span> SAheart<span class="punctuation">,</span></span><br><span class="line">      col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;grey10&quot;</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> perspective <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">,</span></span><br><span class="line">      par.settings <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>axis.line<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>col <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span>gridExtra<span class="punctuation">)</span></span><br><span class="line">cloud1 <span class="operator">&lt;-</span> cloud<span class="punctuation">(</span>sbp<span class="operator">~</span>ldl <span class="operator">+</span> tobacco<span class="punctuation">,</span> data <span class="operator">=</span> SAheart<span class="punctuation">,</span></span><br><span class="line">           col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;grey10&quot;</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">           pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> perspective <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">           par.settings <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>axis.line<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>col <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">           <span class="comment"># rotate (in degrees) about each axis</span></span><br><span class="line">           screen <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>z<span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="operator">-</span><span class="number">70</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">           xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> zlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># rotate about y by 3 degrees</span></span><br><span class="line">cloud2 <span class="operator">&lt;-</span> cloud<span class="punctuation">(</span>sbp<span class="operator">~</span>ldl <span class="operator">+</span> tobacco<span class="punctuation">,</span> data <span class="operator">=</span> SAheart<span class="punctuation">,</span></span><br><span class="line">                col <span class="operator">=</span> adjustcolor<span class="punctuation">(</span><span class="string">&quot;grey10&quot;</span><span class="punctuation">,</span> <span class="number">0.3</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                pch <span class="operator">=</span> <span class="number">19</span><span class="punctuation">,</span> perspective <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">                par.settings <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>axis.line<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>col <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                <span class="comment"># rotate (in degrees) about each axis</span></span><br><span class="line">                screen <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>z<span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="operator">-</span><span class="number">70</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                xlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span> zlab <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># stereo display</span></span><br><span class="line">grid.arrange<span class="punctuation">(</span>cloud1<span class="punctuation">,</span> cloud2<span class="punctuation">,</span> nrow <span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># use the rgl package</span></span><br><span class="line">library<span class="punctuation">(</span>rgl<span class="punctuation">)</span></span><br><span class="line">solidcol <span class="operator">&lt;-</span> <span class="string">&quot;steelblue&quot;</span></span><br><span class="line">persp3d<span class="punctuation">(</span>den<span class="operator">$</span>z<span class="punctuation">,</span> col <span class="operator">=</span> solidcol<span class="punctuation">)</span></span><br><span class="line">        <span class="comment"># with a three button mouse:</span></span><br><span class="line">        <span class="comment">#left buttom  - rotate</span></span><br><span class="line">        <span class="comment">#middle button - change perspective</span></span><br><span class="line">        <span class="comment"># right button - size)</span></span><br><span class="line">    <span class="comment"># get rid of perspective, make things orthogonal</span></span><br><span class="line">    <span class="comment"># FOV(or field of view) is &quot;the degee of parallax&quot;</span></span><br><span class="line">    <span class="comment"># FOV = 0, is orthogonal (or isometric) projection.</span></span><br><span class="line">par3d<span class="punctuation">(</span>FOV <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span></span><br><span class="line">persp3d<span class="punctuation">(</span>den<span class="operator">$</span>z<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;cornsilk&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># interacitve three dimensional plots</span></span><br><span class="line"><span class="comment"># surfaces and planes</span></span><br><span class="line">x <span class="operator">&lt;-</span> den<span class="operator">$</span>x</span><br><span class="line">y <span class="operator">&lt;-</span> den<span class="operator">$</span>y        </span><br><span class="line">z <span class="operator">&lt;-</span> den<span class="operator">$</span>z</span><br><span class="line"><span class="comment"># put the coordinates in a unit cube</span></span><br><span class="line">myscale <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  xrange <span class="operator">&lt;-</span> <span class="built_in">range</span><span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">(</span>x <span class="operator">-</span> <span class="built_in">min</span><span class="punctuation">(</span>xrange<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span>diff<span class="punctuation">(</span>xrange<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line">x <span class="operator">&lt;-</span> myscale<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">y <span class="operator">&lt;-</span> myscale<span class="punctuation">(</span>y<span class="punctuation">)</span></span><br><span class="line">z <span class="operator">&lt;-</span> myscale<span class="punctuation">(</span>z<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">surface3d<span class="punctuation">(</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span>z<span class="punctuation">,</span> color <span class="operator">=</span> solidcol<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># we could ass an arbitrary plane as well</span></span><br><span class="line"><span class="comment"># say the plane a*x + b*y + c*z + d = 0</span></span><br><span class="line">planes3d<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span> <span class="operator">-</span>median<span class="punctuation">(</span>z<span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line">planes3d<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span> <span class="operator">-</span>quantile<span class="punctuation">(</span>z<span class="punctuation">,</span> <span class="number">0.75</span><span class="punctuation">)</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a point in the centre of the box is</span></span><br><span class="line">centre <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>median<span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">,</span> median<span class="punctuation">(</span>y<span class="punctuation">)</span><span class="punctuation">,</span> median<span class="punctuation">(</span>z<span class="punctuation">)</span> <span class="punctuation">)</span></span><br><span class="line"><span class="comment"># a plane&#x27;s orientation is given by its normal vector</span></span><br><span class="line">a <span class="operator">&lt;-</span> 1</span><br><span class="line">b <span class="operator">&lt;-</span> 1</span><br><span class="line"><span class="built_in">c</span> <span class="operator">&lt;-</span> 1</span><br><span class="line">normal <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>a<span class="punctuation">,</span>b<span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># get d to put this through the centre</span></span><br><span class="line">d <span class="operator">&lt;-</span> <span class="operator">-</span> t<span class="punctuation">(</span>normal<span class="punctuation">)</span> <span class="operator">%*%</span> centre</span><br><span class="line">planes3d<span class="punctuation">(</span>a<span class="punctuation">,</span>b<span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">,</span>d<span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;purple&quot;</span><span class="punctuation">,</span> alpha<span class="operator">=</span> <span class="number">0.7</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h2 id="marginal-contribution"><a href="#marginal-contribution" class="headerlink" title="marginal contribution"></a>marginal contribution</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># marginal contribution - projections and slices</span></span><br><span class="line"><span class="comment">#######################################################       </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># distance determines the amount of perspective ,default is 0.2</span></span><br><span class="line">cloud <span class="operator">&lt;-</span> cloud<span class="punctuation">(</span>obesity<span class="operator">~</span>alcohol <span class="operator">+</span> tobacco<span class="punctuation">,</span> data <span class="operator">=</span> SAheart<span class="punctuation">,</span></span><br><span class="line">                distance <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> perspective <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">                par.settings <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>axis.line<span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>col <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                <span class="comment"># rotate (in degrees) about each axis</span></span><br><span class="line">                screen <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>z<span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> x <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> y <span class="operator">=</span> <span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                xlab <span class="operator">=</span> <span class="string">&quot;x&quot;</span><span class="punctuation">,</span> ylab <span class="operator">=</span> <span class="string">&quot;y&quot;</span><span class="punctuation">,</span> zlab <span class="operator">=</span> <span class="string">&quot;z&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># no perspective = marginal = orthogonal projection</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># three dimensional scatterplot - interactive</span></span><br><span class="line">library<span class="punctuation">(</span>loon<span class="punctuation">)</span></span><br><span class="line">cols <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="string">&quot;firebrick&quot;</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>SAheart<span class="operator">$</span>chd<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">cols<span class="punctuation">[</span>SAheart<span class="operator">$</span>chd <span class="operator">==</span> <span class="string">&quot;Yes&quot;</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="string">&quot;steelblue&quot;</span></span><br><span class="line"><span class="comment"># need a new data frame</span></span><br><span class="line">newdata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>sbp <span class="operator">=</span> SAheart<span class="operator">$</span>sbp<span class="punctuation">,</span> ldl <span class="operator">=</span> SAheart<span class="operator">$</span>ldl<span class="punctuation">,</span></span><br><span class="line">                      tob <span class="operator">=</span> SAheart<span class="operator">$</span>tobacco<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># create the navigation graph</span></span><br><span class="line">l_navgraph<span class="punctuation">(</span>data <span class="operator">=</span> newdata<span class="punctuation">,</span></span><br><span class="line">           <span class="comment"># optional arguements follow</span></span><br><span class="line">           color <span class="operator">=</span> cols<span class="punctuation">,</span> glyph <span class="operator">=</span> <span class="string">&quot;ccircle&quot;</span><span class="punctuation">,</span> showGuides <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a free hand rotation in loon</span></span><br><span class="line">with<span class="punctuation">(</span>l_scale3D<span class="punctuation">(</span>newdata<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">     l_plot3D<span class="punctuation">(</span>x <span class="operator">=</span> sbp<span class="punctuation">,</span> y <span class="operator">=</span> ldl<span class="punctuation">,</span> z <span class="operator">=</span> tob<span class="punctuation">,</span> color <span class="operator">=</span> cols<span class="punctuation">,</span></span><br><span class="line">              showGuides <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> glyph <span class="operator">=</span> <span class="string">&quot;ccircle&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># conditioninh on one or more variate values</span></span><br><span class="line"><span class="comment"># beginning with a density estimate for sbp</span></span><br><span class="line">library<span class="punctuation">(</span>ggplot2<span class="punctuation">)</span></span><br><span class="line">ggplot<span class="punctuation">(</span>data<span class="operator">=</span> SAheart<span class="punctuation">,</span> mapping <span class="operator">=</span> aes<span class="punctuation">(</span>sbp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">         geom_density<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># now condition on family history - by color</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data<span class="operator">=</span> SAheart<span class="punctuation">,</span> mapping <span class="operator">=</span> aes<span class="punctuation">(</span>sbp<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  geom_density<span class="punctuation">(</span>mapping <span class="operator">=</span> aes<span class="punctuation">(</span>fill <span class="operator">=</span> famhist<span class="punctuation">)</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># now condition on family history - by locations and color</span></span><br><span class="line">p <span class="operator">+</span> facet_grid<span class="punctuation">(</span>famhist<span class="operator">~</span>.<span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> facet_grid<span class="punctuation">(</span>.<span class="operator">~</span>famhist<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># now condition on faimly history (colour and location) and value of chd (location)</span></span><br><span class="line">p <span class="operator">+</span> facet_grid<span class="punctuation">(</span>chd <span class="operator">~</span> famhist<span class="punctuation">,</span> labeller <span class="operator">=</span> label_both<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a two variates display conditional on the value of a third,</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> SAheart<span class="punctuation">,</span> mapping <span class="operator">=</span> aes<span class="punctuation">(</span>ldl<span class="punctuation">,</span> sbp<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># condition on famhist(colour)</span></span><br><span class="line">p <span class="operator">+</span> geom_point<span class="punctuation">(</span>mapping <span class="operator">=</span> aes<span class="punctuation">(</span>color <span class="operator">=</span> famhist<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># conditional on famhist (colour+location)</span></span><br><span class="line">p <span class="operator">+</span> geom_point<span class="punctuation">(</span>mapping <span class="operator">=</span> aes<span class="punctuation">(</span>color <span class="operator">=</span> famhist<span class="punctuation">)</span><span class="punctuation">)</span> <span class="operator">+</span> facet_grid<span class="punctuation">(</span>.<span class="operator">~</span>famhist<span class="punctuation">)</span></span><br><span class="line"><span class="comment"># conditional on famhist (colour + location) - densities</span></span><br><span class="line">p <span class="operator">+</span> geom_density_2d<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>.<span class="operator">~</span>famhist<span class="punctuation">,</span> labeller <span class="operator">=</span> label_both<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conditional on a continuous variate, say tobacco - colour</span></span><br><span class="line">p <span class="operator">+</span> geom_point<span class="punctuation">(</span>mapping <span class="operator">=</span> aes<span class="punctuation">(</span>color <span class="operator">=</span> tobacco<span class="punctuation">)</span><span class="punctuation">,</span> size <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># conditional on a continuous variate, say tobacco -size</span></span><br><span class="line">p <span class="operator">+</span> geom_point<span class="punctuation">(</span>mapping <span class="operator">=</span> aes<span class="punctuation">(</span>size <span class="operator">=</span> tobacco<span class="punctuation">)</span><span class="punctuation">,</span> color <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># cut_interval(): make n groups having equal range</span></span><br><span class="line"><span class="comment"># cut_number(): makes n groups having euqal numbers of observations</span></span><br><span class="line"><span class="comment"># cut_width(): makes however many groups of constant width</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conditioning on one or more variate values</span></span><br><span class="line">p <span class="operator">+</span> geom_density2d<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>.<span class="operator">~</span>cut_number<span class="punctuation">(</span>tobacco<span class="punctuation">,</span> n <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p <span class="operator">+</span> geom_point<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span>alpha <span class="operator">=</span><span class="number">0.5</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>.<span class="operator">~</span>cut_number<span class="punctuation">(</span>tobacco<span class="punctuation">,</span> n <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># turn an ggplot into an interactive loon plot</span></span><br><span class="line"><span class="comment"># Ëøô‰∏™Ë¶ÅÈ¢ùÂ§ñ‰∏ãËΩΩpackageÔºå ÁΩëÁ´ôhttps://cran.r-project.org/web/packages/loon.ggplot/index.html</span></span><br><span class="line">gg_p <span class="operator">&lt;-</span> p <span class="operator">+</span> geom_density2d<span class="punctuation">(</span>color <span class="operator">=</span> <span class="string">&quot;steelblue&quot;</span><span class="punctuation">)</span> <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">  facet_grid<span class="punctuation">(</span>.<span class="operator">~</span>cut_number<span class="punctuation">(</span>tobacco<span class="punctuation">,</span> n <span class="operator">=</span><span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">myplot <span class="operator">&lt;-</span> loon.ggplot<span class="punctuation">(</span>gg_p<span class="punctuation">,</span> linkingGroup <span class="operator">=</span> <span class="string">&quot;SAheart&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># marginalization = orthogonal projection</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p2 <span class="operator">&lt;-</span> l_plot<span class="punctuation">(</span>SAheart<span class="operator">$</span>tobacco<span class="punctuation">,</span> jitter<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="built_in">length</span><span class="punctuation">(</span>SAheart<span class="operator">$</span>tobacco<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">             linkingGroup <span class="operator">=</span> <span class="string">&quot;SAheart&quot;</span><span class="punctuation">)</span></span><br><span class="line">p3D <span class="operator">&lt;-</span> l_plot3D<span class="punctuation">(</span>l_scale3D<span class="punctuation">(</span>SAheart<span class="punctuation">[</span><span class="punctuation">,</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;obesity&quot;</span><span class="punctuation">,</span> <span class="string">&quot;tobacco&quot;</span><span class="punctuation">,</span> <span class="string">&quot;alcohol&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">                linkingGroup <span class="operator">=</span> <span class="string">&quot;SAheart&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="noncartesian"><a href="#noncartesian" class="headerlink" title="noncartesian"></a>noncartesian</h2><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#######################################################</span></span><br><span class="line"><span class="comment"># noncartesian 1 - beyong three dimensions</span></span><br><span class="line"><span class="comment">#######################################################       </span></span><br><span class="line">data <span class="operator">&lt;-</span> iris<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">]</span> <span class="comment"># the four measurements on Anderson&#x27;s irises</span></span><br><span class="line">scale01 <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="punctuation">(</span>x <span class="operator">-</span> <span class="built_in">min</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="operator">/</span>diff<span class="punctuation">(</span><span class="built_in">range</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">+</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">data <span class="operator">&lt;-</span> apply<span class="punctuation">(</span>data<span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> scale01<span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span>TeachingDemos<span class="punctuation">)</span></span><br><span class="line">faces2<span class="punctuation">(</span>data<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span><span class="number">51</span><span class="punctuation">,</span><span class="number">101</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">       which <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">8</span><span class="punctuation">,</span><span class="number">13</span><span class="punctuation">,</span><span class="number">14</span><span class="punctuation">,</span><span class="number">17</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="comment"># select features</span></span><br><span class="line">       scale <span class="operator">=</span> <span class="string">&quot;none&quot;</span><span class="punctuation">,</span> nrows <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> ncols <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># with the appropriate packages, we can explore how variables these features are:</span></span><br><span class="line">library<span class="punctuation">(</span>tkrplot<span class="punctuation">)</span></span><br><span class="line"><span class="keyword">if</span><span class="punctuation">(</span><span class="built_in">interactive</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">  tke2 <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span><span class="built_in">list</span><span class="punctuation">(</span></span><br><span class="line">                <span class="built_in">list</span><span class="punctuation">(</span><span class="string">&#x27;slider&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                     from <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> to <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> init <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span></span><br><span class="line">                     resolution <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">              <span class="number">18</span><span class="punctuation">)</span></span><br><span class="line">  <span class="built_in">names</span><span class="punctuation">(</span>tke2<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;CenterWidth&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;TopBottomWidth&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;FaceHeight&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;TopWidth&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                   <span class="string">&#x27;BottomWidth&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;NoseLength&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;MouthHeight&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;MouthCurve&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                   <span class="string">&#x27;MouthWidth&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;EyesHeight&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;EyesBetween&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;EyeAngle&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                   <span class="string">&#x27;EyeShape&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;EyeSize&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;EyeballPos&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;EyebrowHeight&#x27;</span><span class="punctuation">,</span></span><br><span class="line">                   <span class="string">&#x27;EyebrowAngle&#x27;</span><span class="punctuation">,</span><span class="string">&#x27;EyebrowWidth&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  tkfun2 <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>...<span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line">    tmpmat <span class="operator">&lt;-</span> rbind<span class="punctuation">(</span>Min <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> Adjust <span class="operator">=</span> unlist<span class="punctuation">(</span><span class="built_in">list</span><span class="punctuation">(</span>...<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> Max <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">    faces2<span class="punctuation">(</span>tmpmat<span class="punctuation">,</span> scale <span class="operator">=</span> <span class="string">&#x27;none&#x27;</span><span class="punctuation">)</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  tkexamp<span class="punctuation">(</span>tkfun2<span class="punctuation">,</span> <span class="built_in">list</span><span class="punctuation">(</span>tke2<span class="punctuation">)</span><span class="punctuation">,</span> plotloc <span class="operator">=</span> <span class="string">&#x27;left&#x27;</span><span class="punctuation">,</span></span><br><span class="line">          hscale <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> vscale <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">    <span class="comment"># Create Tk dialog boxes with controls to show examples of</span></span><br><span class="line">  <span class="comment"># changing parameters on a graph.</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">n <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">faces2<span class="punctuation">(</span>data<span class="punctuation">[</span>sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>n<span class="punctuation">,</span> n<span class="punctuation">,</span> replace <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">,</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">            which <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span><span class="number">7</span><span class="punctuation">,</span><span class="number">8</span><span class="punctuation">,</span><span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">            scale <span class="operator">=</span> <span class="string">&quot;columns&quot;</span><span class="punctuation">,</span></span><br><span class="line">            nrow <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">15</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># a function that in R called stars(..), which will produce Nightingale&#x27;s rose style glyphs</span></span><br><span class="line">n <span class="operator">&lt;-</span> nrow<span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">stars<span class="punctuation">(</span>data<span class="punctuation">[</span>sample<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span>n<span class="punctuation">,</span> n<span class="punctuation">,</span> replace<span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      nrow <span class="operator">=</span><span class="number">10</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">      main <span class="operator">=</span> <span class="string">&quot;Nightingales Rose (almost)&quot;</span><span class="punctuation">,</span></span><br><span class="line">      draw.segments <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">1.2</span><span class="punctuation">)</span></span><br><span class="line"><span class="comment"># data explorations using stars(..) again</span></span><br><span class="line">stars<span class="punctuation">(</span>data<span class="punctuation">,</span> locations <span class="operator">=</span>data<span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      lwd <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">,</span> <span class="comment"># narrow the line</span></span><br><span class="line">      len <span class="operator">=</span> <span class="number">0.05</span><span class="punctuation">,</span></span><br><span class="line">      labels <span class="operator">=</span> <span class="literal">NULL</span><span class="punctuation">,</span> radius <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span></span><br><span class="line">      col.lines <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span>adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> n<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      col.stars <span class="operator">=</span> <span class="built_in">rep</span><span class="punctuation">(</span>adjustcolor<span class="punctuation">(</span><span class="string">&quot;steelblue&quot;</span><span class="punctuation">,</span> <span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span> n<span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      nrow <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">15</span><span class="punctuation">,</span></span><br><span class="line">      key.loc <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">12</span><span class="punctuation">,</span><span class="operator">-</span><span class="number">0.5</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">      main <span class="operator">=</span> <span class="string">&quot;iris data&quot;</span></span><br><span class="line">      <span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<br>
<br>
<br>

<h1 id="Tableau"><a href="#Tableau" class="headerlink" title="Tableau"></a>Tableau</h1><div class="note ">
            <p>ctrl + shift + B -&gt; ÊîæÂ§ßworkplace<br>ctrl + B -&gt; Áº©Â∞èworkplace</p>
          </div>

<h2 id="JoinÂíåblend"><a href="#JoinÂíåblend" class="headerlink" title="JoinÂíåblend"></a>JoinÂíåblend</h2><p>Join:Âú®data source‰∏≠ÁÇπÂáªË¶ÅjoinÁöÑsheet,ÁúãÂà∞sheetÁöÑ‰ø°ÊÅØÂêéÊ≥®ÊÑèÁÇπÂáª‰∏≠‰∏äÊñπË°®ÁöÑÂ∞èÈïøÊñπÂùó,ÁÑ∂ÂêéÊãñÂä®Ë¶ÅjoinÁöÑÂè¶‰∏Ä‰∏™table,‰∏≠Èó¥‰ºöÂá∫Áé∞‰∏§‰∏™ÈáçÂêàÁöÑÂúÜ,Êù•Ë∞ÉËäÇjoinÁöÑÁ±ªÂûã.</p>
<p>BlendingÊòØÁâπÂà´ÁâàÊú¨ÁöÑjoin,joinÂè™ËÉΩjoinÂêåÁ±ªÂûãÁöÑdata,‰ΩÜblendingÂèØ‰ª•join‰∏çÂêåÁâàÊú¨ÁöÑ,ÊØîÂ¶Çexcel joinÂà∞sql dataset.<br>JoinÊó∂‰ºöËØ¥leftÂíåright table,blending‰∏≠Âè´ÂÅöprimary data sourceÂíåsecondary data source.</p>
<p>ÂΩìBlendingÊó∂Êúâ‰∏§‰∏™Áõ∏ÂêåÁöÑkey.<br>Blending will result certain level of data aggregation(sum, avg, etc‚Ä¶)<br>default: sumÁõ∏Âä†<br>Â¶ÇÊûúÊòØÊó†Ê≥ïsumÁöÑcharÂÄº,‰ºöËøîÂõûÊòüÂè∑*.<br>Â¶ÇÊûúBlendingÊó∂Ê≤°ÊúâÁõ∏ÂêåÁöÑkey,‰ºöËøîÂõûnull.</p>
<h2 id="Scattor-plot"><a href="#Scattor-plot" class="headerlink" title="Scattor plot"></a>Scattor plot</h2><p>Êàë‰ª¨ÂèëÁé∞scattor plotÈúÄË¶Å‰∏â‰∏™ÂÄº.‰∏§‰∏™Ë¥üË¥£Âª∫Á´ãÂùêÊ†á(columns + rows)ËøòÊúâ‰∏Ä‰∏™ÊòØÊï∞ÂÄº,ÂØºÂÖ•marksÈáåÈù¢.</p>
<blockquote>
<p>ÊØîÂ¶Çcolumn:transation + rows:amount + marks:customer_id<br>customer_id‰Ωú‰∏∫ÊØè‰∏™customerÁöÑ‰ø°ÊÅØÂØºÂÖ•.</p>
</blockquote>
<p>ÂÖ≥‰∫éÂá∫Áé∞ÁöÑoutlier:Âà†ÊéâÊàñÂØπcolumn/rowËøõË°åÂØπÊï∞(log)ËΩ¨Êç¢.</p>
<blockquote>
<p>ÂØπÊï∞ËΩ¨Êç¢:‰ΩøÁî®calculate field‰∏≠ÁöÑsumÂíålog function.</p>
</blockquote>
<p>ÊåâÂ≠êÁ±ªÂà´ËÆ°ÁÆóÊõ¥Â§öÁöÑdetail:</p>
<blockquote>
<p>Â¢ûÂä†calculated field:<br>{ fixed[Sub category]: avg([Amount]) }<br>Âπ∂Â¢ûÂä†Âú®mark‰∏≠ÁöÑsize‰∏ä.<br>‰ª•ÂèäÂõ†‰∏∫ÊòØvalueÁöÑËÆ°ÁÆó,tableau‰ºöËá™Âä®Ê±ÇÂíå,‰ΩÜÊàë‰ª¨‰∏çÈúÄË¶ÅÊ±ÇÊï¥‰∏™sub categoryÁöÑsum,ÊâÄ‰ª•ÂæóÊîπÊàêavg.</p>
</blockquote>
<p>Clusters:Âú®analyticsÁöÑÂå∫Âüü,Áªôscattor plotÂàÜ‰∏çÂêåÁöÑÁæ§‰Ωì.<br>ÊääÂú®marks‰∏≠ÁîüÊàêÁöÑclusterÂèØ‰ª•ÊãñÂÖ•‰ºödataÈáåÁöÑstring valueÂå∫Âüü,ÂèØ‰ª•‰øùÁïôÂπ∂Áî®Âú®ÂÖ∂‰ªñÁöÑÂõæ‰∏≠.</p>
<h2 id="Bar-chart"><a href="#Bar-chart" class="headerlink" title="Bar chart"></a>Bar chart</h2><p>Bar chartÈúÄË¶Å‰∏Ä‰∏™ÂàÜÁªÑ‰Ωú‰∏∫rows(ÂàöÂàöÁöÑcluster group),‰ª•Âèä‰∏Ä‰∏™Êï∞ÂÄº(amount)‰Ωú‰∏∫ÂÄº(marks).ÁÑ∂ÂêéÁÇπÂáªÂè≥‰∏äÊñπÁöÑshow me‰∏≠ÁöÑbar chart.<br>How many ppl in a cluster group, add calculated field:<br>CountD([Customer ID])</p>
<p>Êàë‰ª¨ÂèØ‰ª•ÂÅö‰∏Ä‰∏™‰∏§Â§¥bar chart:<br>Â∞Üdistinct customer ID‰πü‰Ωú‰∏∫columnÂÄº,ÂÅö‰∏Ä‰∏™Â∑¶Âè≥Âπ∂ÊéíÁöÑbar chart.ÂÜçÈÄâ‰∏≠ÂÖ∂‰∏≠ÁöÑ‰∏Ä‰∏™Âè≥ÈîÆÈÄâÂèñedit axisÂπ∂reversed.</p>
<div class="note ">
            <p>Âú®ÊúÄ‰∏äÊñπÁöÑÂ∑•ÂÖ∑Ê†èÈáåÊúâswap rows and columnsÂæàÂ•ΩÁî®.</p>
          </div>

<h2 id="Dashboard"><a href="#Dashboard" class="headerlink" title="Dashboard"></a>Dashboard</h2><p>Â∞Üchart(sheet)ÈõÜÂêàÂú®‰∏ÄËµ∑ÁöÑÂú∞Êñπ,ËøòËÉΩÂä†action,ÂÆûÊó∂ÊØîËæÉ‰∏çÂêåcategory‰∏ãÁöÑÂàÜÊûêÊï∞ÊçÆ,ÂæàÁâõÈÄº.<br>‰æãÂ¶Ç:Â∞ÜÊüê‰∏™category baseÁöÑbar chartÂè≥ÈîÆuse as filter,ÈÇ£‰πàÁÇπÂáªÊüê‰∏™category,ÂÖ∂‰ªñÁöÑÂõæÊ†áÂ∞±‰ºöËÆ°ÁÆóÈÇ£‰∏™category‰∏ãÁöÑÊï∞ÊçÆ.</p>
<p>Ê≠£Â∏∏ÊµÅÁ®ã:Âú®dashboard tool bar‰∏≠Ê∑ªÂä†action,ÈÄâÊã©highlightÂ∞±Âè™‰ºöhigh light,‰∏ç‰ºöÊääÂÖ∂‰ªñÁöÑÊï∞ÊçÆÈöêËóè.<br>source sheet:Áî®‰∫éÈÄâÂèñÁöÑcategory baseÁöÑsheet.</p>
<div class="note ">
            <p>Âú®Êü•ÁúãÂõæË°®ÊØè‰∏™Êï∞ÂÄºÁöÑÊó∂ÂÄôÂèØ‰ª•‰øÆÊîπtooltipÊï¥ÁêÜÊØè‰∏™Êï∞ÂÄºÁöÑÊ†áÁ≠æ.<br>ÂèØ‰ª•Â∞ÜÂÖ∂‰ªñÊÉ≥Ë¶ÅÂä†ÂÖ•ÁöÑÊï∞ÊçÆÊ∑ªÂä†Âà∞marksÁöÑdetailÈáå,ÂÜçÂú®tooltip‰∏≠ÁöÑinsertÂä†ÂÖ•.</p>
          </div>

<div class="note ">
            <p>Marks‰∏äÈù¢ÁöÑfiltersÂèØ‰ª•Áî®categoryÁ±ªÁöÑÂÄºÊù•ÈÄâÊã©Ë¶ÅÁ†îÁ©∂ÁöÑÊï∞ÊçÆ.</p>
          </div>

<div class="note ">
            <p>Â∏∏Áî®ÊôÆÈÄöË°®Ê†º‰πãcolouring.<br>ÂèØ‰ª•Â∞Ümeasure valueÊåâ‰ΩèctrlÊãñÂÖ•color(Â§çÂà∂‰∏Ä‰ªΩ‰ΩøÁî®colour),ÁÑ∂ÂêéÈÄâÊã©square,Ë°®Ê†º‰∏äÂ∞±‰ºöÊåâÁÖßÊï∞ÊçÆÁöÑÂ§ßÂ∞èÂÜ≥ÂÆöÈ¢úËâ≤Ê∑±ÊµÖ.<br>Â¶ÇÊûúÊúâÂ§öÂàóÁöÑÊï∞ÊçÆ,Âú®colour‰∏≠Êúâuse separate legendÂèØ‰ª•ÂàÜÂà´Ëæ®ËØÜÈ¢úËâ≤Ê∑±ÊµÖ.</p>
          </div>
<link rel="stylesheet" href="/blog/css/spoiler.css" type="text/css"><script src="/blog/js/spoiler.js" type="text/javascript" async></script>
    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/%E4%BB%A5%E5%A4%B4%E6%8A%A2%E5%9C%B0-%E8%AF%9A/" rel="tag"># ‰ª•Â§¥Êä¢Âú∞(ËØö)</a>
              <a href="/blog/tags/data/" rel="tag"># data</a>
              <a href="/blog/tags/statistics/" rel="tag"># statistics</a>
              <a href="/blog/tags/R/" rel="tag"># R</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2021/11/16/P187/" rel="prev" title="Â§èÂ®ÅÂ§∑ÊäÄÊúØÂ≠¶Ê†°Êû™ÊîØÈôêÂÆöÁâà">
      <i class="fa fa-chevron-left"></i> Â§èÂ®ÅÂ§∑ÊäÄÊúØÂ≠¶Ê†°Êû™ÊîØÈôêÂÆöÁâà
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2021/11/01/P183/" rel="next" title="ÂçÅÊúà‰∏âÂçÅ‰∏ÄÂè∑">
      ÂçÅÊúà‰∏âÂçÅ‰∏ÄÂè∑ <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
        </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
      <div class="title-bar">
        <span>System_Monitor</span>
        <div class="title-controls"><div class="win-btn">√ó</div></div>
      </div>
      <div class="sidebar-inner-wrapper">

        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview">
            Overview
          </li>
        </ul>

        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#R"><span class="nav-number">1.</span> <span class="nav-text">R</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#NumbersOrder"><span class="nav-number">1.1.</span> <span class="nav-text">NumbersOrder</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Histograms"><span class="nav-number">1.2.</span> <span class="nav-text">Histograms</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#visual-comparisons"><span class="nav-number">1.3.</span> <span class="nav-text">visual comparisons</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#visual-hypothesis-testing"><span class="nav-number">1.4.</span> <span class="nav-text">visual hypothesis testing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hypothetical-generative"><span class="nav-number">1.5.</span> <span class="nav-text">hypothetical generative</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#time-order"><span class="nav-number">1.6.</span> <span class="nav-text">time order</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#time-series-decomposition"><span class="nav-number">1.7.</span> <span class="nav-text">time series decomposition</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#transforming-data"><span class="nav-number">1.8.</span> <span class="nav-text">transforming data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#categorical-data-overview"><span class="nav-number">1.9.</span> <span class="nav-text">categorical data overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#categorical-data"><span class="nav-number">1.10.</span> <span class="nav-text">categorical data</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#categorical-modelling"><span class="nav-number">1.11.</span> <span class="nav-text">categorical modelling</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#onmaps"><span class="nav-number">1.12.</span> <span class="nav-text">onmaps</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#three-dimensions"><span class="nav-number">1.13.</span> <span class="nav-text">three dimensions</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#marginal-contribution"><span class="nav-number">1.14.</span> <span class="nav-text">marginal contribution</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#noncartesian"><span class="nav-number">1.15.</span> <span class="nav-text">noncartesian</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Tableau"><span class="nav-number">2.</span> <span class="nav-text">Tableau</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Join%E5%92%8Cblend"><span class="nav-number">2.1.</span> <span class="nav-text">JoinÂíåblend</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Scattor-plot"><span class="nav-number">2.2.</span> <span class="nav-text">Scattor plot</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bar-chart"><span class="nav-number">2.3.</span> <span class="nav-text">Bar chart</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dashboard"><span class="nav-number">2.4.</span> <span class="nav-text">Dashboard</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mazui"
      src="/blog/images/logo_11.jpg">
  <p class="site-author-name" itemprop="name">Mazui</p>
  <div class="site-description" itemprop="description">‰∏éÂ≠§Áã¨ÂíåÂπ≥ÂÖ±Â§Ñ.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">352</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">73</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:mazui.and.rio@gmail.com" title="E-Mail ‚Üí mailto:mazui.and.rio@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/3032131561?topnav=1&wvr=6&topsug=1&ssl_rnd=1606158448.6943&is_all=1" title="Weibo ‚Üí https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3032131561?topnav&#x3D;1&amp;wvr&#x3D;6&amp;topsug&#x3D;1&amp;ssl_rnd&#x3D;1606158448.6943&amp;is_all&#x3D;1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/mazui_3" title="Twitter ‚Üí https:&#x2F;&#x2F;twitter.com&#x2F;mazui_3" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/mazui_3" title="Instagram ‚Üí https:&#x2F;&#x2F;instagram.com&#x2F;mazui_3" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 ‚Äì 
  <span itemprop="copyrightYear">2026</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mazui</span>

<!--
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>


    <span title="C">2m</span>
-->

<!--
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="T">30:24</span>
-->
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>
<br>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">ÈòÖËßàÂÆ§‰∏ÄÂÖ±Êúâ2mÁöÑËÄÅÂÖîÊ≠£Âú®ÊâìÁûåÁù°</span>
</div>

        








      </div>
    </footer>
  </div>
  <!-- Taskbar -->
  <div class="taskbar">
    <button class="start-btn">
        <span style="background: #000; color: #fff; padding: 0 3px; border-radius: 2px;">Áî∞</span>
        Start
    </button>

    <div style="width: 2px; border-left: 1px solid var(--win-shadow); border-right: 1px solid var(--win-high); height: 100%; margin: 0 4px;"></div>
    <button class="start-btn" onclick="toggleWindow()">
      <div class="window" style="flex-direction: row; align-items: center; padding: 2px 8px; font-size: 12px; min-width: 120px;">
          <span style="margin-right: 8px;">üìÅ</span> Underlake_Reading_Room
      </div>
    </button>
    <div class="tray">
        <span id="clock">12:00 PM</span>
    </div>
  </div>
  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://mazui3-com.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://mazui3.github.io/blog/2021/11/07/P182/";
    this.page.identifier = "2021/11/07/P182/";
    this.page.title = "ÂÖ≥‰∫éstatÁöÑÁ¨îËÆ∞ - visualization";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://mazui3-com.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

  <script>
    // Update Clock
    function updateClock() {
        const now = new Date();
        const timeStr = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        document.getElementById('clock').textContent = timeStr;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // Generate Mosaic Pixels
    const grid = document.getElementById('pixelGrid');
    for (let i = 0; i < 16; i++) {
        const pixel = document.createElement('div');
        pixel.className = 'pixel';
        if (Math.random() > 0.6) pixel.classList.add('active');
        if (grid !== null) grid.appendChild(pixel);
    }

    // Randomize blink for mosaic
    setInterval(() => {
        const pixels = document.querySelectorAll('.pixel');
        const target = pixels[Math.floor(Math.random() * pixels.length)];
        if (target !== undefined) target.classList.toggle('active');
    }, 800);
  </script>
  <script>
    function toggleWindow() {
      var elements = document.getElementsByClassName("content-wrap-temp");
      var n = elements.length;
      for (var i = 0; i < n; i++) {
        var e = elements[i];

        if(e.style.display === 'none') {
          e.style.display = 'block';
        } else {
          e.style.display = 'none';
        }
     }

     var elements2 = document.getElementsByClassName("footer-inner");
     var n2 = elements2.length;
     for (var j = 0; j < n2; j++) {
       var e2 = elements2[j];

       if(e2.style.display === 'none') {
         e2.style.display = 'block';
       } else {
         e2.style.display = 'none';
       }
      }
    }
  </script>
</body>
</html>
