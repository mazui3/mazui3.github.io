<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/blog/images/star.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/blog/images/star.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/blog/images/star.png">
  <link rel="mask-icon" href="/blog/images/logo.svg" color="#222">

<link rel="stylesheet" href="/blog/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">
  <link rel="stylesheet" href="/blog/lib/pace/pace-theme-minimal.min.css">
  <script src="/blog/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"mazui3.github.io","root":"/blog/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":265,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":{"text":"Load Disqus","order":-1}},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="个人用笔记,因为太长了所以分成了两份.上一回.">
<meta property="og:type" content="article">
<meta property="og:title" content="关于SQL的笔记 - 错题本">
<meta property="og:url" content="https://mazui3.github.io/blog/2021/01/31/P167/index.html">
<meta property="og:site_name" content="Underlake Reading Room">
<meta property="og:description" content="个人用笔记,因为太长了所以分成了两份.上一回.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://mazui3.github.io/blog/2021/01/31/P167/P167_1.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2021/01/31/P167/P167_2.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2021/01/31/P167/P167_3.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2021/01/31/P167/P167_4.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2021/01/31/P167/P167_5.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2021/01/31/P167/P167_6.png">
<meta property="og:image" content="https://mazui3.github.io/blog/2021/01/31/P167/P167_7.png">
<meta property="article:published_time" content="2021-01-31T19:30:10.000Z">
<meta property="article:modified_time" content="2022-02-17T19:49:34.999Z">
<meta property="article:author" content="Mazui">
<meta property="article:tag" content="编码">
<meta property="article:tag" content="以头抢地(诚)">
<meta property="article:tag" content="data">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mazui3.github.io/blog/2021/01/31/P167/P167_1.png">

<link rel="canonical" href="https://mazui3.github.io/blog/2021/01/31/P167/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>关于SQL的笔记 - 错题本 | Underlake Reading Room</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/blog/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Underlake Reading Room</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">这里是图书馆外的阅览室🌟</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/blog/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/blog/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/blog/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/blog/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/blog/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/blog/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
        <li class="menu-item menu-item-friendlink">

    <a href="/blog/link/" rel="section"><i class="fas fa-user-friends fa-fw"></i>FriendLink</a>

  </li>
        <li class="menu-item menu-item-back">

    <a href="https://mazui3.github.io/" rel="section"><i class="fa fa-cloud fa-fw"></i>Back</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://mazui3.github.io/blog/2021/01/31/P167/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/blog/images/logo_7.png">
      <meta itemprop="name" content="Mazui">
      <meta itemprop="description" content="与孤独和平共处.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Underlake Reading Room">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          关于SQL的笔记 - 错题本
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-31 14:30:10" itemprop="dateCreated datePublished" datetime="2021-01-31T14:30:10-05:00">2021-01-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2022-02-17 14:49:34" itemprop="dateModified" datetime="2022-02-17T14:49:34-05:00">2022-02-17</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/%E6%95%B0%E5%AD%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">数学笔记</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/blog/2021/01/31/P167/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2021/01/31/P167/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <span class="post-meta-item" title="C">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="T">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>13 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>个人用笔记,因为太长了所以分成了两份.<br><a href="https://mazui3.github.io/blog/2020/11/24/P134/">上一回</a>.</p>
<span id="more"></span>

<br>
<br>
<br>
<br>

<h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes"></a>Notes</h2><div class="note ">
            <p>Note:sql的常用数据格式</p><table><thead><tr><th>Syntax</th><th>Description</th></tr></thead><tbody><tr><td><strong>Bigint:</strong></td><td>-1* 10(18) ~ 1* 10(18) \(&lt;——Big Int 10^18)</td></tr><tr><td><strong>BLOB:</strong></td><td>Binary Large OBject 2(64) -1  \(&lt;——最大数字2^64 - 1)</td></tr><tr><td><strong>Boolean:</strong></td><td>True or False</td></tr><tr><td><strong>CHAR(500):</strong></td><td>500 \(500个字符)</td></tr><tr><td><strong>Date/DateTime/Time:</strong></td><td>‘2020-07-25 15:25:25.666’ YYYY-MM-DD HH:MM:SS.SSS</td></tr><tr><td><strong>Decimal:</strong></td><td>123.456</td></tr><tr><td><strong>Double:</strong></td><td>1* 10(-308) ~ 1 * 10(308)  / -1 * 10(308) ~ -1 * 10(-308)</td></tr><tr><td><strong>Float:</strong></td><td>1* 10(-38) ~ 1 * 10(38)      / -1 * 10(38) ~ -1 * 10(-38)</td></tr><tr><td><strong>INT/Integer:</strong></td><td>0 ~ 65535</td></tr><tr><td><strong>String:</strong></td><td>length &lt;= 4000</td></tr><tr><td><strong>Text:</strong></td><td>length&gt; 4000 \(mySql and sqlite)</td></tr><tr><td><strong>CLOB:</strong></td><td>Char Large Object   length &gt; 4000</td></tr><tr><td><strong>VARCHAR(500):</strong></td><td>real length &lt;= 500 \(不管多少长度都给500)</td></tr><tr><td><strong>Real:</strong></td><td>approximation of a real number</td></tr></tbody></table>
          </div>

<p>注:sql中首先生成table,table中是数据格式,然后在import数据到table中.<br>可以在table中用双击的方式来更改格式.</p>
<br>
<br>

<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><ul>
<li><a target="_blank" rel="noopener" href="https://quip.com/2gwZArKuWk7W">The Best Medium-Hard Data Analyst SQL Interview Questions</a></li>
<li><a target="_blank" rel="noopener" href="https://selectstarsql.com/">Select Star SQL</a></li>
<li><a target="_blank" rel="noopener" href="https://leetcode.com/problemset/database/">Leetcode</a></li>
<li><a target="_blank" rel="noopener" href="https://www.linkedin.com/learning/topics/sql">LinkedIn Study</a></li>
<li><a target="_blank" rel="noopener" href="https://www.windowfunctions.com/">Windowfunctions</a></li>
<li><a target="_blank" rel="noopener" href="https://www.hackerrank.com/domains/sql">Hacker rank</a></li>
<li><a target="_blank" rel="noopener" href="https://www.w3schools.com/sql/">W3schools</a></li>
<li><a target="_blank" rel="noopener" href="https://www.codecademy.com/learn/learn-sql">Codecademy</a></li>
<li><a target="_blank" rel="noopener" href="https://sqlzoo.net/wiki/SQL_Tutorial">Sqlzoo</a></li>
<li><a target="_blank" rel="noopener" href="https://sqlbolt.com/">Sqlbolt</a></li>
<li><a target="_blank" rel="noopener" href="https://www.interviewquery.com/questions">Interview query</a></li>
</ul>
<h2 id="Examples"><a href="#Examples" class="headerlink" title="Examples"></a>Examples</h2><h3 id="Pivot-the-table-in-sql"><a href="#Pivot-the-table-in-sql" class="headerlink" title="Pivot the table in sql:"></a><a target="_blank" rel="noopener" href="https://docs.microsoft.com/en-us/sql/t-sql/queries/from-using-pivot-and-unpivot?view=sql-server-ver15">Pivot the table in sql:</a></h3><br>
<br>
<br>

<h3 id="Categories-triangle"><a href="#Categories-triangle" class="headerlink" title="Categories triangle"></a>Categories triangle</h3><p>Write a query identifying the type of each record in the TRIANGLES table using its three side lengths. Output one of the following statements for each record in the table:</p>
<p>Equilateral: It’s a triangle with  sides of equal length.<br>Isosceles: It’s a triangle with  sides of equal length.<br>Scalene: It’s a triangle with  sides of differing lengths.<br>Not A Triangle: The given values of A, B, and C don’t form a triangle.<br>Input Format</p>
<p>The TRIANGLES table is described as follows:</p>


<p>Each row in the table denotes the lengths of each of a triangle’s three sides.</p>
<p>Sample Input:</p>


<p>Sample Output</p>
<div class="note ">
            <p>Isosceles<br>Equilateral<br>Scalene<br>Not A Triangle</p>
          </div>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CASE</span>             </span><br><span class="line">            <span class="keyword">WHEN</span> A <span class="operator">+</span> B <span class="operator">&gt;</span> C <span class="keyword">AND</span> B <span class="operator">+</span> C <span class="operator">&gt;</span> A <span class="keyword">AND</span> A <span class="operator">+</span> C <span class="operator">&gt;</span> B <span class="keyword">THEN</span></span><br><span class="line">                <span class="keyword">CASE</span></span><br><span class="line">                    <span class="keyword">WHEN</span> A <span class="operator">=</span> B <span class="keyword">AND</span> B <span class="operator">=</span> C <span class="keyword">THEN</span> <span class="string">&#x27;Equilateral&#x27;</span></span><br><span class="line">                    <span class="keyword">WHEN</span> A <span class="operator">=</span> B <span class="keyword">OR</span> B <span class="operator">=</span> C <span class="keyword">OR</span> A <span class="operator">=</span> C <span class="keyword">THEN</span> <span class="string">&#x27;Isosceles&#x27;</span></span><br><span class="line">                    <span class="keyword">ELSE</span> <span class="string">&#x27;Scalene&#x27;</span></span><br><span class="line">                <span class="keyword">END</span></span><br><span class="line">            <span class="keyword">ELSE</span> <span class="string">&#x27;Not A Triangle&#x27;</span></span><br><span class="line">        <span class="keyword">END</span></span><br><span class="line"><span class="keyword">FROM</span> TRIANGLES;</span><br></pre></td></tr></table></figure>
<p>这道题虽然是简单的,但才发现可以直接写A + B &gt; C.</p>
<br>
<br>
<br>

<h3 id="Distince"><a href="#Distince" class="headerlink" title="Distince"></a>Distince</h3><p>Consider P1(a,b) and P2(c,d) to be two points on a 2D plane.</p>
<p> a happens to equal the minimum value in Northern Latitude (LAT_N in STATION).<br> b happens to equal the minimum value in Western Longitude (LONG_W in STATION).<br> c happens to equal the maximum value in Northern Latitude (LAT_N in STATION).<br> d happens to equal the maximum value in Western Longitude (LONG_W in STATION).<br>Query the Manhattan Distance between points P1 and P2 and round it to a scale of 4 decimal places.</p>
<div class="note ">
            <p>SELECT ROUND( MAX(lat_n)-MIN(lat_n) + MAX(long_w)-MIN(long_w), 4) FROM Station;</p>
          </div>
<p>这道题代码也很简单,但记得decimal的问题用round来取位数.</p>
<br>
<br>
<br>

<h3 id="Two-minimum"><a href="#Two-minimum" class="headerlink" title="Two minimum"></a>Two minimum</h3><p>Write a query to retrieve two minimum and maximum salaries from the EmployeePosition table.</p>
<p><u>To retrieve two <strong>minimum</strong> salaries, you can write a query as below:</u></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Salary <span class="keyword">FROM</span> EmployeePosition E1</span><br><span class="line"> <span class="keyword">WHERE</span> <span class="number">2</span> <span class="operator">&gt;=</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> Salary) <span class="keyword">FROM</span> EmployeePosition E2</span><br><span class="line">  <span class="keyword">WHERE</span> E1.Salary <span class="operator">&gt;=</span> E2.Salary) <span class="keyword">ORDER</span> <span class="keyword">BY</span> E1.Salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<p><u>To retrieve two <strong>maximum</strong> salaries, you can write a query as below:</u></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> Salary <span class="keyword">FROM</span> EmployeePosition E1</span><br><span class="line"> <span class="keyword">WHERE</span> <span class="number">2</span> <span class="operator">&gt;=</span> (<span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> Salary) <span class="keyword">FROM</span> EmployeePosition E2</span><br><span class="line">  <span class="keyword">WHERE</span> E1.Salary <span class="operator">&lt;=</span> E2.Salary) <span class="keyword">ORDER</span> <span class="keyword">BY</span> E1.Salary <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Odd-records"><a href="#Odd-records" class="headerlink" title="Odd records"></a>Odd records</h3><p><u>Write a query to calculate the even and odd records from a table.</u></p>
<p>To retrieve the even records from a table, you have to use the MOD() function as follows:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> EmpID</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> rowno, EmpID <span class="keyword">from</span> EmployeeInfo)</span><br><span class="line"><span class="keyword">WHERE</span> <span class="built_in">MOD</span>(rowno,<span class="number">2</span>)<span class="operator">=</span><span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<p>Similarly, to retrieve the odd records from a table, you can write a query as follows:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> EmpID</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> rowno, EmpID <span class="keyword">from</span> EmployeeInfo)</span><br><span class="line"><span class="keyword">WHERE</span> <span class="built_in">MOD</span>(rowno,<span class="number">2</span>)<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Nth-highest"><a href="#Nth-highest" class="headerlink" title="Nth highest"></a>Nth highest</h3><p><u>Write a query to find the Nth highest salary from the table without using TOP/limit keyword.</u></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> Salary</span><br><span class="line"><span class="keyword">FROM</span> EmployeePosition E1</span><br><span class="line"><span class="keyword">WHERE</span> N<span class="number">-1</span> <span class="operator">=</span> (</span><br><span class="line">      <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>( <span class="keyword">DISTINCT</span> ( E2.Salary ) )</span><br><span class="line">      <span class="keyword">FROM</span> EmployeePosition E2</span><br><span class="line">      <span class="keyword">WHERE</span> E2.Salary <span class="operator">&gt;</span>  E1.Salary );</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Retrieve-duplicate"><a href="#Retrieve-duplicate" class="headerlink" title="Retrieve duplicate"></a>Retrieve duplicate</h3><p><u>Write a query to retrieve duplicate records from a table.</u></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> EmpID, EmpFname, Department <span class="built_in">COUNT</span>(<span class="operator">*</span>)</span><br><span class="line"><span class="keyword">FROM</span> EmployeeInfo <span class="keyword">GROUP</span> <span class="keyword">BY</span> EmpID, EmpFname, Department</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="Same-department"><a href="#Same-department" class="headerlink" title="Same department"></a>Same department</h3><p><u>Write a query to retrieve the list of employees working in the same department.</u></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Select</span> <span class="keyword">DISTINCT</span> E.EmpID, E.EmpFname, E.Department</span><br><span class="line"><span class="keyword">FROM</span> EmployeeInfo E, Employee E1</span><br><span class="line"><span class="keyword">WHERE</span> E.Department <span class="operator">=</span> E1.Department <span class="keyword">AND</span> E.EmpID <span class="operator">!=</span> E1.EmpID;</span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="3rd-highest"><a href="#3rd-highest" class="headerlink" title="3rd highest"></a>3rd highest</h3><p><u>Write a query to find the third-highest salary from the EmpPosition table.</u></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">1</span> salary</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line"><span class="keyword">SELECT</span> TOP <span class="number">3</span> salary</span><br><span class="line"><span class="keyword">FROM</span> employee_table</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span>) <span class="keyword">AS</span> emp</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>

<br>
<br>

<p>这里插入面试时的sql题:</p>
<h3 id="LAG"><a href="#LAG" class="headerlink" title="LAG"></a>LAG</h3><p><a target="_blank" rel="noopener" href="https://www.sqlshack.com/sql-lag-function-overview-and-examples/">When does lag function useful?</a></p>
<h3 id="What-is-the-difference-between-select-unique-and-select-distinct"><a href="#What-is-the-difference-between-select-unique-and-select-distinct" class="headerlink" title="What is the difference between select unique and select distinct?"></a><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/336268/difference-between-select-unique-and-select-distinct/336282">What is the difference between select unique and select distinct?</a></h3><blockquote>
<p>SELECT UNIQUE is old syntax supported by Oracle’s flavor of SQL. It is synonymous with SELECT DISTINCT.<br>Use SELECT DISTINCT because this is standard SQL, and SELECT UNIQUE is non-standard, and in database brands other than Oracle, SELECT UNIQUE may not be recognized at all.</p>
</blockquote>
<h3 id="drop-delete-and-truncate"><a href="#drop-delete-and-truncate" class="headerlink" title="drop, delete and truncate"></a>drop, delete and truncate</h3><p><a target="_blank" rel="noopener" href="https://www.geeksforgeeks.org/difference-between-delete-drop-and-truncate/">What is the difference between drop, delete and truncate?</a></p>
<h3 id="When-are-count-and-count-distinct-equal"><a href="#When-are-count-and-count-distinct-equal" class="headerlink" title="When are count(*) and count distinct equal?"></a>When are count(*) and count distinct equal?</h3><p>The COUNT(*) function counts the total rows in the table, including the NULL values.<br>COUNT DISTINCT does not count NULL as a distinct value.</p>
<h3 id="How-do-you-dedup-rows"><a href="#How-do-you-dedup-rows" class="headerlink" title="How do you dedup rows?"></a><a target="_blank" rel="noopener" href="https://www.sqlshack.com/different-ways-to-sql-delete-duplicate-rows-from-a-sql-table/">How do you dedup rows?</a></h3><br>
<br>

<h3 id="Employee-Salaries"><a href="#Employee-Salaries" class="headerlink" title="Employee Salaries"></a>Employee Salaries</h3><p>Given a employees and departments table, select the top 3 departments with at least ten employees and rank them according to the percentage of their employees making over 100K in salary.</p>
<img src="/blog/2021/01/31/P167/P167_1.png" class="">

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- join</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">FROM</span> departments <span class="keyword">AS</span> d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees <span class="keyword">AS</span> e</span><br><span class="line">    <span class="keyword">ON</span> d.id <span class="operator">=</span> e.department_id</span><br><span class="line"></span><br><span class="line"><span class="comment">-- use having to filter departments which has at least ten emplyees</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    d.name</span><br><span class="line"><span class="keyword">FROM</span> departments <span class="keyword">AS</span> d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees <span class="keyword">AS</span> e</span><br><span class="line">    <span class="keyword">ON</span> d.id <span class="operator">=</span> e.department_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>A CASE WHEN clause then allows us to differentiate when a employee makes over 100K. We can do this by running a SUM only when the employee is making over 100K. If the employee makes over 100K, then we mark the employee as a 1, otherwise we mark them as a 0.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span></span><br><span class="line">        salary <span class="operator">&gt;</span> <span class="number">100000</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">END</span>) <span class="keyword">AS</span> Total</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"></span><br><span class="line"><span class="comment">-- final version</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">CAST</span>(<span class="built_in">SUM</span>(</span><br><span class="line">        <span class="keyword">CASE</span> <span class="keyword">WHEN</span></span><br><span class="line">            salary <span class="operator">&gt;</span> <span class="number">100000</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">END</span>) <span class="keyword">AS</span> <span class="type">DECIMAL</span></span><br><span class="line">      )<span class="operator">/</span><span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> percentage_over_100K</span><br><span class="line">      , d.name <span class="keyword">as</span> department_name</span><br><span class="line">      , <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">AS</span> number_of_employees</span><br><span class="line"><span class="keyword">FROM</span> departments <span class="keyword">AS</span> d</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> employees <span class="keyword">AS</span> e</span><br><span class="line">    <span class="keyword">ON</span> d.id <span class="operator">=</span> e.department_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> d.name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="operator">&gt;=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">DESC</span></span><br><span class="line">LIMIT <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>注:<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/3445118/what-is-the-purpose-of-order-by-1-in-sql-select-statement">Order 1</a>的意思,</p>
<p>…is known as an “Ordinal” - the number stands for the column based on the number of columns defined in the <strong>SELECT</strong> clause.</p>
<br>
<br>

<h3 id="ATM-Robbery"><a href="#ATM-Robbery" class="headerlink" title="ATM Robbery"></a>ATM Robbery</h3><p>There was a robbery from the ATM at the bank where you work. Some unauthorized withdrawals were made, and you need to help your bank find out more about those withdrawals.</p>
<p>However, the only information you have is that there was more than 1 withdrawal, they were all performed in 10-second gaps, and no legitimate transactions were performed in between two fraudulent withdrawals.</p>
<p>We’re given a table of bank transactions with three columns, user_id, a deposit or withdrawal value transaction_value, and created_at time for each transaction.</p>
<p>Write a query to retrieve all user IDs in ascending order whose transactions have exactly a 10-second gap from one another.</p>
<img src="/blog/2021/01/31/P167/P167_2.png" class="">
<p>这道题的答案是不是过于困难了.</p>
<p>Since we need to identify users making transactions that occur exactly ten seconds apart, it’s useful to first order the transactions by created_at.</p>
<p>We need to match each timestamp to the next and previous row. We can do this by creating 2 new columns, one with the next row’s timestamps and another with the previous row’s timestamps.</p>
<p>Functions that perform calculations related to the current row are called window functions. The window functions, LEAD() or LAG() do exactly as explained above – LEAD() creates a new column with the next row’s timestamps, and LAG() does so for the previous row. Window functions require certain inputs, such as a partition column or an order column.</p>
<p>Since we care most about the time a transaction was made, we should make a table with information about time differences between transactions, and integrate it into the query using a WITH statement.</p>
<p>We need <strong>both</strong> of the users that made transactions with a 10 second gap. So a single window function may not be sufficient here.</p>
<p>In order to get the relevant user IDs, we need to get the difference between each sequential timestamp.</p>
<p>To do this, we use the window functions, LAG() &amp; LEAD(). These functions create a copy of the desired column but offset it by a certain number of rows. In this case, we use the default of 1. LAG() offsets to the previous row, LEAD() offsets to the next row.</p>
<p>Next, we can use the OVER() clause to order by created_date in our selection. ORDER BY specifies the ordering of the rows within each partition, for the window function to apply.</p>
<p>The LAG() and LEAD() window functions on the created_at column get the previous &amp; next row’s timestamp in a new column. Since we are considering the entire dataset, there is no need to consider different groups and we thereby do not need to use a PARTITION BY clause. The values have to be ordered by created_at so that the values are sequential.</p>
<p>We make our table with LEAD and LAG columns added as follows:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> bank_transactions_lead_lag <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">user_id</span><br><span class="line">, created_at <span class="keyword">AS</span> <span class="type">timestamp</span></span><br><span class="line">, <span class="built_in">LAG</span>(created_at) <span class="keyword">OVER</span>(</span><br><span class="line">                            <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at</span><br><span class="line">                     ) <span class="keyword">AS</span> timestamp_previous</span><br><span class="line">	, <span class="built_in">LEAD</span>(created_at) <span class="keyword">OVER</span>(</span><br><span class="line">                            <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at</span><br><span class="line">                     ) <span class="keyword">AS</span> timestamp_next</span><br><span class="line"><span class="keyword">FROM</span> bank_transactions</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>Next we calculate the time differences to check if there is 10 second gap between transactions. We get the absolute difference in seconds, so that it’s easier to filter in the next step.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">, bank_transactions_time_diff <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	user_id</span><br><span class="line">	, <span class="built_in">ABS</span>(TIMESTAMPDIFF(<span class="keyword">SECOND</span>, <span class="type">timestamp</span>, timestamp_previous)) timestamp_previous_diff</span><br><span class="line">	, <span class="built_in">ABS</span>(TIMESTAMPDIFF(<span class="keyword">SECOND</span>, <span class="type">timestamp</span>, timestamp_next)) timestamp_next_diff</span><br><span class="line"><span class="keyword">FROM</span> bank_transactions_lead_lag</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>We then select the unique ordered user IDs that have a 10 second gap.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> user_id</span><br><span class="line"><span class="keyword">FROM</span> bank_transactions_time_diff</span><br><span class="line"><span class="keyword">WHERE</span> timestamp_previous_diff <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">OR</span> timestamp_next_diff <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>Putting it all together:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> lead_lag <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">user_id</span><br><span class="line">, created_at <span class="keyword">AS</span> <span class="type">timestamp</span></span><br><span class="line">, <span class="built_in">LAG</span>(created_at) <span class="keyword">OVER</span>(</span><br><span class="line">                            <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at</span><br><span class="line">                     ) <span class="keyword">AS</span> timestamp_previous</span><br><span class="line">	, <span class="built_in">LEAD</span>(created_at) <span class="keyword">OVER</span>(</span><br><span class="line">                            <span class="keyword">ORDER</span> <span class="keyword">BY</span> created_at</span><br><span class="line">                     ) <span class="keyword">AS</span> timestamp_next</span><br><span class="line"><span class="keyword">FROM</span> bank_transactions</span><br><span class="line">)</span><br><span class="line">, time_diff <span class="keyword">as</span> (</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	user_id</span><br><span class="line">	, <span class="built_in">ABS</span>(TIMESTAMPDIFF(<span class="keyword">SECOND</span>, <span class="type">timestamp</span>, timestamp_previous)) timestamp_previous_diff</span><br><span class="line">	, <span class="built_in">ABS</span>(TIMESTAMPDIFF(<span class="keyword">SECOND</span>, <span class="type">timestamp</span>, timestamp_next)) timestamp_next_diff</span><br><span class="line"><span class="keyword">FROM</span> lead_lag</span><br><span class="line">)</span><br><span class="line"><span class="keyword">SELECT</span> user_id</span><br><span class="line"><span class="keyword">FROM</span> time_diff</span><br><span class="line"><span class="keyword">WHERE</span> timestamp_previous_diff <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">OR</span> timestamp_next_diff <span class="operator">=</span> <span class="number">10</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<br>
<br>

<h3 id="2nd-Highest-Salary"><a href="#2nd-Highest-Salary" class="headerlink" title="2nd Highest Salary"></a>2nd Highest Salary</h3><p>Write a SQL query to select the 2nd highest salary in the engineering department. If more than one person shares the highest salary, the query should select the next highest salary.</p>
<img src="/blog/2021/01/31/P167/P167_3.png" class="">

<p>First, we need the name of the department to be associated with each employee in the employees table, to understand which department each employee is a part of.</p>
<p>The “department_id” field in the employees table is associated with the “id” field in the departments table. We call the “department_id” a foreign key because it is a column that references the primary key of another table, which in this case is the “id” field in the departments table.</p>
<p>Based on this common field, we can join both tables, using INNER JOIN, to associate the name of the department name to the employees that are a part of those departments.   </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments</span><br><span class="line">        <span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.id</span><br></pre></td></tr></table></figure>

<p>For our joined table, we need to filter our employees table to those employees in the engineering department.</p>
<p>In SQL, you should use the WHERE clause, which is used to specify a condition while fetching the data, to filter the records and fetch only the necessary records.</p>
<p>To filter our joined table to only include those employees that are a part of the engineering department, we would run:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments</span><br><span class="line">        <span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.id</span><br><span class="line">    <span class="keyword">WHERE</span> departments.name <span class="operator">=</span> <span class="string">&#x27;engineering&#x27;</span></span><br></pre></td></tr></table></figure>

<p>We need to sort the salaries from highest to lowest, which will allow us to observe which salary is highest, second highest, third highest, and so on.</p>
<p>Luckily, SQL provides a great way of sorting columns with the ORDER BY clause which, by default, sorts a column in ascending order (alphabetical order if categorical, or lowest to highest if numerical). In order to sort by descending order, we need to specify the DESC keyword after ORDER BY field.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments</span><br><span class="line">        <span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.id</span><br><span class="line">    <span class="keyword">WHERE</span> departments.name <span class="operator">=</span> <span class="string">&#x27;engineering&#x27;</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>

<p>If two people share the same highest salary, the query should select the next highest salary. Therefore, we need to remove duplicate salaries.</p>
<p>SQL provides a great way for filtering out duplicate values using the SELECT DISTINCT clause, or GROUP BY clause on the specified field to return unique values. An example of GROUP BY to filter out duplicate salary values is as follows:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments</span><br><span class="line">        <span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.id</span><br><span class="line">    <span class="keyword">WHERE</span> departments.name <span class="operator">=</span> <span class="string">&#x27;engineering&#x27;</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> salary <span class="comment">-- remove duplicate salary values</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> salary <span class="keyword">DESC</span> <span class="comment">-- sort salary in descending order</span></span><br></pre></td></tr></table></figure>

<p>Once the employees table is filtered for those employees in the engineering department, and the salaries are sorted in descending order, we need to extract the second highest salary.</p>
<p>In our filtered table, this value is located in the second row. SQL provides a way to limit the number of rows to return using the LIMIT clause. We can extract the highest and second highest salary from the employees table as follows:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments</span><br><span class="line">        <span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.id</span><br><span class="line">    <span class="keyword">WHERE</span> departments.name <span class="operator">=</span> <span class="string">&#x27;engineering&#x27;</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="comment">-- group by first column (salary)</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">DESC</span> <span class="comment">-- order by first column (salary)</span></span><br><span class="line">    LIMIT <span class="number">2</span> <span class="comment">-- return first two rows (highest salary and second highest salary)</span></span><br></pre></td></tr></table></figure>

<p>Now we should utilize subqueries, in order to further filter out the highest salary, and return the second highest. In SQL, a subquery is a SQL query within a query. An example for our query above is:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments</span><br><span class="line">        <span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.id</span><br><span class="line">    <span class="keyword">WHERE</span> departments.name <span class="operator">=</span> <span class="string">&#x27;engineering&#x27;</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">DESC</span></span><br><span class="line">    LIMIT <span class="number">2</span></span><br><span class="line">) <span class="keyword">AS</span> t</span><br></pre></td></tr></table></figure>

<p>Note that the subquery in FROM must have an alias (e.g. AS t). Using our knowledge of ORDER BY and LIMIT, how can we extract the second highest salary from the rows returned by the subquery above?</p>
<p>When the question prompts for “2nd highest” anything, many times people’s heads go straight to partition rank functions.</p>
<p>This problem isn’t meant to test your query optimization skills, but rather your understanding of basic SQL functions.</p>
<p>Solution<br>When the question prompts for “2nd highest” anything, many times people’s heads go straight to partition rank functions. Do not be fooled, the question asks for a singular value.</p>
<p>This can be done easily by first selecting all of the salaries within engineering. We’ll join on the department_id in both fields and filter where the department name is equivalent to engineering.</p>
<p>Now that we have all of the salaries, we can order by salary and only select the top two after grabbing all of the distinct values by grouping by the salary field. Then we can query from this CTE and reverse the order and select the top one which will then by the second highest salary.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    salary</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments</span><br><span class="line">        <span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.id</span><br><span class="line">    <span class="keyword">WHERE</span> departments.name <span class="operator">=</span> <span class="string">&#x27;engineering&#x27;</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">DESC</span></span><br><span class="line">    LIMIT <span class="number">2</span></span><br><span class="line">) <span class="keyword">AS</span> t</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">ASC</span></span><br><span class="line">LIMIT <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>Alternative Solution (using OFFSET):</p>
<p>We can use the OFFSET clause, after LIMIT, to skip a prespecified number of rows before returning the rows. In this case, since our salaries are sorted in descending order, and we want the second highest salary, we can offset the highest salary row:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> salary</span><br><span class="line">    <span class="keyword">FROM</span> employees</span><br><span class="line">    <span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments</span><br><span class="line">        <span class="keyword">ON</span> employees.department_id <span class="operator">=</span> departments.id</span><br><span class="line">    <span class="keyword">WHERE</span> departments.name <span class="operator">=</span> <span class="string">&#x27;engineering&#x27;</span></span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="number">1</span> <span class="keyword">DESC</span></span><br><span class="line">    LIMIT <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<br>
<br>

<p>以下是遇到的面试题.</p>
<h2 id="find-pair"><a href="#find-pair" class="headerlink" title="find pair"></a>find pair</h2><img src="/blog/2021/01/31/P167/P167_4.png" class="">
<img src="/blog/2021/01/31/P167/P167_5.png" class="">


<br>
<br>

<h2 id="range-of-address-length"><a href="#range-of-address-length" class="headerlink" title="range of address length"></a>range of address length</h2><p>这道题如果能用两个query是很简单的,我现在还没学会如何并成一个query.</p>
<img src="/blog/2021/01/31/P167/P167_6.png" class="">
<img src="/blog/2021/01/31/P167/P167_7.png" class="">

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/%E7%BC%96%E7%A0%81/" rel="tag"># 编码</a>
              <a href="/blog/tags/%E4%BB%A5%E5%A4%B4%E6%8A%A2%E5%9C%B0-%E8%AF%9A/" rel="tag"># 以头抢地(诚)</a>
              <a href="/blog/tags/data/" rel="tag"># data</a>
              <a href="/blog/tags/SQL/" rel="tag"># SQL</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2021/02/02/P165/" rel="prev" title="关于R语言的笔记 - 续">
      <i class="fa fa-chevron-left"></i> 关于R语言的笔记 - 续
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2021/01/18/P163/" rel="next" title="关于R语言的笔记 - R markdown">
      关于R语言的笔记 - R markdown <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Notes"><span class="nav-number">1.</span> <span class="nav-text">Notes</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Links"><span class="nav-number">2.</span> <span class="nav-text">Links</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Examples"><span class="nav-number">3.</span> <span class="nav-text">Examples</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Pivot-the-table-in-sql"><span class="nav-number">3.1.</span> <span class="nav-text">Pivot the table in sql:</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Categories-triangle"><span class="nav-number">3.2.</span> <span class="nav-text">Categories triangle</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Distince"><span class="nav-number">3.3.</span> <span class="nav-text">Distince</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Two-minimum"><span class="nav-number">3.4.</span> <span class="nav-text">Two minimum</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Odd-records"><span class="nav-number">3.5.</span> <span class="nav-text">Odd records</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Nth-highest"><span class="nav-number">3.6.</span> <span class="nav-text">Nth highest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Retrieve-duplicate"><span class="nav-number">3.7.</span> <span class="nav-text">Retrieve duplicate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Same-department"><span class="nav-number">3.8.</span> <span class="nav-text">Same department</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3rd-highest"><span class="nav-number">3.9.</span> <span class="nav-text">3rd highest</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LAG"><span class="nav-number">3.10.</span> <span class="nav-text">LAG</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#What-is-the-difference-between-select-unique-and-select-distinct"><span class="nav-number">3.11.</span> <span class="nav-text">What is the difference between select unique and select distinct?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#drop-delete-and-truncate"><span class="nav-number">3.12.</span> <span class="nav-text">drop, delete and truncate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#When-are-count-and-count-distinct-equal"><span class="nav-number">3.13.</span> <span class="nav-text">When are count(*) and count distinct equal?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#How-do-you-dedup-rows"><span class="nav-number">3.14.</span> <span class="nav-text">How do you dedup rows?</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Employee-Salaries"><span class="nav-number">3.15.</span> <span class="nav-text">Employee Salaries</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ATM-Robbery"><span class="nav-number">3.16.</span> <span class="nav-text">ATM Robbery</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2nd-Highest-Salary"><span class="nav-number">3.17.</span> <span class="nav-text">2nd Highest Salary</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#find-pair"><span class="nav-number">4.</span> <span class="nav-text">find pair</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#range-of-address-length"><span class="nav-number">5.</span> <span class="nav-text">range of address length</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mazui"
      src="/blog/images/logo_7.png">
  <p class="site-author-name" itemprop="name">Mazui</p>
  <div class="site-description" itemprop="description">与孤独和平共处.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives/">
        
          <span class="site-state-item-count">236</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags/">
          
        <span class="site-state-item-count">51</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="mailto:mazui.and.rio@gmail.com" title="E-Mail → mailto:mazui.and.rio@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/u/3032131561?topnav=1&wvr=6&topsug=1&ssl_rnd=1606158448.6943&is_all=1" title="Weibo → https:&#x2F;&#x2F;weibo.com&#x2F;u&#x2F;3032131561?topnav&#x3D;1&amp;wvr&#x3D;6&amp;topsug&#x3D;1&amp;ssl_rnd&#x3D;1606158448.6943&amp;is_all&#x3D;1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/mazui_3" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;mazui_3" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://instagram.com/mazui_3" title="Instagram → https:&#x2F;&#x2F;instagram.com&#x2F;mazui_3" rel="noopener" target="_blank"><i class="fab fa-instagram fa-fw"></i>Instagram</a>
      </span>
  </div>



      </div>

<br>
      <!--new music test-->

  <!--网易云插件-->
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=465530020&auto=0&height=66"></iframe>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2015 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mazui</span>

<!--
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>


    <span title="C">996k</span>
  -->

  <!--
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="T">15:06</span>

  -->

</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>
<br>
<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">阅览室一共有996k的老兔正在打瞌睡</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/blog/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>

<script src="/blog/js/utils.js"></script>

<script src="/blog/js/motion.js"></script>


<script src="/blog/js/schemes/pisces.js"></script>


<script src="/blog/js/next-boot.js"></script>




  




  
<script src="/blog/js/local-search.js"></script>













  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://mazui3-com.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  var disqus_config = function() {
    this.page.url = "https://mazui3.github.io/blog/2021/01/31/P167/";
    this.page.identifier = "2021/01/31/P167/";
    this.page.title = "关于SQL的笔记 - 错题本";
    };
  NexT.utils.loadComments(document.querySelector('#disqus_thread'), () => {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: disqus_config
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://mazui3-com.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  });
</script>

</body>
</html>
